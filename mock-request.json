[{"rendered_body":"\u003cp\u003e\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。なにやら最近は完全に\u003ca href=\"http://qiita.com/armorik83/items/5542daed0c408cb9f605\"\u003eAngular芸人\u003c/a\u003eと呼ばれるようになったのですが、一方でRuby知識はド素人、今まで避け続けてきたもんだから仕方がない。で、思い立ったので学び始めます。理由はご想像にお任せ。\u003c/p\u003e\n\n\u003cp\u003e以下の文体ですが、他言語にはある程度長けていても、Rubyは一切やったことがない、というレベルを想定しています。比較対象は主にJavaScript ES6、自分用なので雑です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"バージョン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eバージョン\u003c/h1\u003e\n\n\u003cp\u003eJavaScriptのバージョンは\u003ccode\u003eES n\u003c/code\u003eで表現するが、基本的にはブラウザの実装次第。Rubyはインタプリタ自体のバージョンを指す。インタプリタといっても、Ruby 1.9からは\u003ca href=\"http://ja.wikipedia.org/wiki/YARV\"\u003eYARV\u003c/a\u003eというVM上で動いてるらしい。\u003c/p\u003e\n\n\u003cp\u003e最新は執筆時点で\u003ccode\u003e2.1.6\u003c/code\u003e, \u003ccode\u003e2.2.2\u003c/code\u003e。この2系統あたりを見ておけばいいのかな、\u003ca href=\"https://www.ruby-lang.org/ja/news/2015/02/23/support-for-ruby-1-9-3-has-ended/\"\u003e\u003ccode\u003e1.9.3\u003c/code\u003eはサポート終了してるらしい\u003c/a\u003eので、今回は\u003ccode\u003e2.0\u003c/code\u003e以降に絞って学ぶ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"読むもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%AD%E3%82%80%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e読むもの\u003c/h2\u003e\n\n\u003cp\u003eざっと\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/index.html\"\u003e\u003ccode\u003e2.0.0\u003c/code\u003eのマニュアル\u003c/a\u003eを読んでいく。\u003ccode\u003e2.1\u003c/code\u003e, \u003ccode\u003e2.2\u003c/code\u003e前提で学ぶとやんごとなき事情でハマる恐れがあるので、あとで知識を上書きする。\u003c/p\u003e\n\n\u003cp\u003eリンク先は全て2.0.0にしているので、参照される方は注意。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"目安にするコーディングスタイル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E5%AE%89%E3%81%AB%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目安にするコーディングスタイル\u003c/h2\u003e\n\n\u003cp\u003e右も左も分かってないので、とりあえず以下のものを参照する。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/cookpad/styleguide/blob/master/ruby.ja.md\"\u003ehttps://github.com/cookpad/styleguide/blob/master/ruby.ja.md\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"特徴\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%89%B9%E5%BE%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e特徴\u003c/h1\u003e\n\n\u003cp\u003e『\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fintro.html\"\u003eはじめに\u003c/a\u003e』の引用。調べなくても想像つくものと、つかないものに分ける。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"想像つく\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%83%B3%E5%83%8F%E3%81%A4%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e想像つく\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eインタプリタ\u003c/li\u003e\n\u003cli\u003e変数に型が無い (動的型付け)\u003c/li\u003e\n\u003cli\u003eユーザによるメモリ管理が不要\u003c/li\u003e\n\u003cli\u003e全てがオブジェクト\u003c/li\u003e\n\u003cli\u003eクラス、継承、メソッド\u003c/li\u003e\n\u003cli\u003eブロック付きメソッド呼び出し(イテレータ)\u003c/li\u003e\n\u003cli\u003eクロージャ（※でもJSとは全然違った）\u003c/li\u003e\n\u003cli\u003e強力な文字列操作/正規表現\u003c/li\u003e\n\u003cli\u003e多倍長整数\u003c/li\u003e\n\u003cli\u003e例外処理機能\u003c/li\u003e\n\u003cli\u003eOSへの直接アクセス\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"想像つかん\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%83%B3%E5%83%8F%E3%81%A4%E3%81%8B%E3%82%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e想像つかん\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e変数宣言が不要\u003c/li\u003e\n\u003cli\u003e特異メソッド\u003c/li\u003e\n\u003cli\u003eモジュールによるMix-in\u003c/li\u003e\n\u003cli\u003eダイナミックローディング\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eスクリプト言語はJavaScriptとPHPの経験があるので、ざっと見て馴染みないなーというものを下に分けた。CLIでのHello Worldとかはパスだパス!\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"基礎構文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%BA%E7%A4%8E%E6%A7%8B%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e基礎構文\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ステートメント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%83%86%E3%83%BC%E3%83%88%E3%83%A1%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eステートメント\u003c/h2\u003e\n\n\u003cp\u003e1行1ステートメント。セミコロンなし。1行2ステートメント以上書きたいときに限りセミコロンで区切る。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eJS\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eRuby\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eいつも付けてる\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e要らない\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コメント行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコメント行\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003e#\u003c/code\u003eを使う。行末まで有効。行頭、行中でも構わない。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eJS\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eRuby\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003e//\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003e#\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コメントブロック\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコメントブロック\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003e=begin\u003c/code\u003e, \u003ccode\u003e=end\u003c/code\u003eを使う。\u003cstrong\u003e埋め込みドキュメント\u003c/strong\u003eと名付けられていて、JSの\u003ccode\u003e/*...*/\u003c/code\u003eとは想定が異なる。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eJS\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eRuby\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003e/*\u003c/code\u003e, \u003ccode\u003e*/\u003c/code\u003e\n\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003e=begin\u003c/code\u003e, \u003ccode\u003e=end\u003c/code\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"変数と定数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%89%E6%95%B0%E3%81%A8%E5%AE%9A%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e変数と定数\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eRuby の変数と定数の種別は変数名の最初の一文字によって、ローカル変数、インスタンス変数、クラス変数、 グローバル変数、定数のいずれかに区別されます。\u003cbr\u003e\n\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fvariables.html\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fvariables.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eローカル変数だけでなく、インスタンス変数も格納された時点から有効になる。クラス変数が\u003ccode\u003estatic\u003c/code\u003eで宣言できるのはTypeScriptの特徴。グローバル変数の比較は一例。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eJS\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eRuby\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eTypeScript\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003evar foobar = 42;\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003efoobar = 42\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003ethis.instanceVar = 42;\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003e@instanceVar = 42\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003eClassName.classVar = 42;\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003e@@classVar = 42\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003estatic classVar = 42;\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003econst FOO_BAR = 42;\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003eFOO_BAR = 42\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003ewindow.foobar = 42;\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003e$foobar = 42\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ローカル変数のスコープ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0%E3%81%AE%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eローカル変数のスコープ\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e宣言した位置からその変数が宣言されたブロック、メソッド定義、またはクラス/モジュール定義の終りまでです。\u003cbr\u003e\n\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fvariables.html\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fvariables.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e以下も参照する。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/cookpad/styleguide/blob/master/ruby.ja.md#%E5%A4%89%E6%95%B0\"\u003ehttps://github.com/cookpad/styleguide/blob/master/ruby.ja.md#変数\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"全てがオブジェクト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A8%E3%81%A6%E3%81%8C%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e全てがオブジェクト\u003c/h2\u003e\n\n\u003cp\u003e一例。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://ruby-doc.org/core-2.2.2/String.html\"\u003eString\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://ruby-doc.org/core-2.2.2/Integer.html\"\u003eInteger\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://ruby-doc.org/core-2.2.2/Float.html\"\u003eFloat\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://ruby-doc.org/core-2.2.2/Regexp.html\"\u003eRegexp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://ruby-doc.org/core-2.2.2/Time.html\"\u003eTime\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e数値型は\u003ccode\u003eInteger\u003c/code\u003e, \u003ccode\u003eFloat\u003c/code\u003eになるんだな。\u003ca href=\"http://docs.ruby-lang.org/ja/2.1.0/class/Numeric.html\"\u003e\u003ccode\u003eNumeric\u003c/code\u003e\u003c/a\u003eはAbstractなので後回し。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"演算子\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BC%94%E7%AE%97%E5%AD%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e演算子\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/symref.html\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/doc/symref.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e+\u003c/code\u003e \u003ccode\u003e-\u003c/code\u003e \u003ccode\u003e*\u003c/code\u003e \u003ccode\u003e/\u003c/code\u003e \u003ccode\u003e%\u003c/code\u003e おなじみ\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e**\u003c/code\u003e 累乗\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e+=\u003c/code\u003e 自己代入（\u003ca href=\"http://docs.ruby-lang.org/ja/1.9.3/doc/spec=2foperator.html#selfassign\"\u003e可能な構文はここ\u003c/a\u003e）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e\u0026lt;\u003c/code\u003e \u003ccode\u003e\u0026gt;\u003c/code\u003e \u003ccode\u003e\u0026lt;=\u003c/code\u003e \u003ccode\u003e\u0026gt;=\u003c/code\u003e 比較\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e \u003ccode\u003e||\u003c/code\u003e \u003ccode\u003e!\u003c/code\u003e and, or, not\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e\u0026amp;\u003c/code\u003e \u003ccode\u003e|\u003c/code\u003e \u003ccode\u003e\u0026lt;\u0026lt;\u003c/code\u003e \u003ccode\u003e\u0026gt;\u0026gt;\u003c/code\u003e \u003ccode\u003e^\u003c/code\u003e \u003ccode\u003e~\u003c/code\u003e ビット演算\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"文字列\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%87%E5%AD%97%E5%88%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e文字列\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fliteral.html#string\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fliteral.html#string\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eシングルクオートとダブルクオートに挙動の違いがあるのはPHPと同じ。JSではES6よりTemplate stringsが使える\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'armorik83'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003estr1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'hello ${name}'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// hello ${name}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003estr2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hello ${name}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// hello ${name}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003estr3\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003ehello\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// hello armorik83\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'armorik83'\u003c/span\u003e\n\u003cspan class=\"n\"\u003estr1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'hello #{name}'\u003c/span\u003e \u003cspan class=\"c1\"\u003e# hello \\#{name}\u003c/span\u003e\n\u003cspan class=\"n\"\u003estr2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hello \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"nb\"\u003ename\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"c1\"\u003e# hello armorik83\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"正規表現\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e正規表現\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003e/abc/\u003c/code\u003eで正規表現リテラルなのはJSと同じ。\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fregexp.html\"\u003eDocs\u003c/a\u003eをざっと見た感じJSとそんなに変わらないが、モードにいくつか違いがありそうだ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"破壊的メソッドと値渡し参照渡し\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A0%B4%E5%A3%8A%E7%9A%84%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%A8%E5%80%A4%E6%B8%A1%E3%81%97%E5%8F%82%E7%85%A7%E6%B8%A1%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e破壊的メソッドと値渡し・参照渡し\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcall.html\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcall.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eメソッド名の後に\u003ccode\u003e!\u003c/code\u003eが付くと破壊的メソッド。公式が行っているものの慣習らしく、言語仕様として定められているわけではない。\u003c/p\u003e\n\n\u003cp\u003eあと、\u003ca href=\"http://magazine.rubyist.net/?0032-CallByValueAndCallByReference\"\u003eRubyでは常に値渡し\u003c/a\u003eらしい。ただ、オブジェクトなので\u003ca href=\"http://magazine.rubyist.net/?0032-CallByValueAndCallByReference#l4\"\u003e参照の値渡し\u003c/a\u003eということだ。副作用でハマったらこの辺を疑うってことで。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"真偽値を返すメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9C%9F%E5%81%BD%E5%80%A4%E3%82%92%E8%BF%94%E3%81%99%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e真偽値を返すメソッド\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e慣用的に、真偽値を返すタイプのメソッドを示すために使われます。\u003cbr\u003e\n\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/symref.html#q\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/doc/symref.html#q\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eJSとかで、キャメルケースで\u003ccode\u003eisFoo\u003c/code\u003eとかするやつ。慣習的にRubyでは\u003ccode\u003eisFoo\u003c/code\u003eしない。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eなにがしの言語\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eRuby\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003eisEmpty()\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003eempty?\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"配列\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%85%8D%E5%88%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e配列\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/class/Array.html\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/class/Array.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// [1, 4, 3]\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003earr\u003c/span\u003e \u003cspan class=\"c1\"\u003e# [1, 4, 3]\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"範囲指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AF%84%E5%9B%B2%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e範囲指定\u003c/h3\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/class/Range.html\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/class/Range.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこういう構文だと覚えるより、Rangeリテラルを与えていると考えた方がよさそう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e..\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e       \u003cspan class=\"c1\"\u003e// SyntaxError: Unexpected number\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e...\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// SyntaxError: Unexpected number\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"c1\"\u003e// [2, 3, 4]\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"c1\"\u003e// [2, 3]\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# [2, 3, 4]\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# [2, 3]\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"逆から\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%86%E3%81%8B%E3%82%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e逆から\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 4\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 3\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"o\"\u003e[-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 4\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"o\"\u003e[-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 3\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eおおっ、JS地味につらい…。（比較にすらなってない）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"記法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%98%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e%記法\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003ewords\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'foo'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'bar'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'baz'\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003ewords\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"sx\"\u003e%w(foo bar baz)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eArray\u0026lt;String\u0026gt;\u003c/code\u003eは下のようにも書ける。\u003ca href=\"https://github.com/cookpad/styleguide/blob/master/ruby.ja.md#%E9%85%8D%E5%88%97\"\u003eコーディングスタイル\u003c/a\u003eではこちらを推奨していた。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ハッシュ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eハッシュ\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/class/Hash.html\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/class/Hash.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eJSでいうObject型、他の言語でいう連想配列、辞書のあたり。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eprice1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s1\"\u003e'apple'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'orange'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1500\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'grape'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eprice1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'apple'\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eprice2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eapple\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eorange\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1500\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egrape\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eprice2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eapple\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003eprice1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s1\"\u003e'apple'\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'orange'\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1500\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'grape'\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3000\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eprice1\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'apple'\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 2000\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eprice2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"ss\"\u003eapple\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eorange\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1500\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003egrape\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3000\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eprice2\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"ss\"\u003e:apple\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 2000\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eapple:\u003c/code\u003eで宣言すると、参照時は\u003ccode\u003e:apple\u003c/code\u003eという\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/class/Symbol.html\"\u003eSymbolリテラル\u003c/a\u003e形式なのが特徴的。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"制御構造\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%B6%E5%BE%A1%E6%A7%8B%E9%80%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e制御構造\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"if-unless\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#if-unless\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eif, unless\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eRubyでは\u003ccode\u003eif\u003c/code\u003eを繋げるのは\u003ccode\u003eelsif\u003c/code\u003eであり、\u003ccode\u003eelse if\u003c/code\u003e（Cのように）でも \u003ccode\u003eelif\u003c/code\u003e（shのように）でもないことに注意してください。\u003cbr\u003e\n\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcontrol.html#if\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcontrol.html#if\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ccode\u003eend\u003c/code\u003eってのもJSからすると驚きがデカい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003econd\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelsif\u003c/span\u003e \u003cspan class=\"n\"\u003econd\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e \n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e後置\u003ccode\u003eif\u003c/code\u003eという書き方もある。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eactive?\u003c/span\u003e\n  \u003cspan class=\"n\"\u003esend_mail_to\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esend_mail_to\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eactive?\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e三項演算子はちゃんとある。\u003ccode\u003eif\u003c/code\u003e内代入もある。個人的には\u003ccode\u003eif\u003c/code\u003e内代入は使わない。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eunless\u003c/code\u003eは鳥肌もので、JSで\u003ccode\u003eif (!arg) { return; }\u003c/code\u003eのように書くことに馴染んでいる自分としては、こんな逆転する構文は面倒にしか見えない。\u003c/p\u003e\n\n\u003cp\u003eコーディングスタイルで推奨どころか\u003cstrong\u003eSHOULD\u003c/strong\u003e扱いなので、そういうものかーと思いながら見てる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"case\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#case\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecase\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003econd\u003c/span\u003e\n\u003cspan class=\"k\"\u003ewhen\u003c/span\u003e \u003cspan class=\"n\"\u003eval1\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003ewhen\u003c/span\u003e \u003cspan class=\"n\"\u003eval2\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"for\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#for\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efor\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ehash\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ek\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"nx\"\u003ehash\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ehash\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ehash\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003ehash\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"ss\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003ehash\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e意外なことにJSの\u003ccode\u003efor\u003c/code\u003e文（\u003ccode\u003efor (var i; i \u0026lt; len; i++)\u003c/code\u003eみたいな）とRubyの\u003ccode\u003efor\u003c/code\u003e文は全く別物だった。JSの\u003ccode\u003efor-in\u003c/code\u003e文が近い。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他の繰り返し\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他の繰り返し\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003ewhile\u003c/code\u003e文はまだ馴染みがあるが、\u003ccode\u003etimes\u003c/code\u003e, \u003ccode\u003eupto\u003c/code\u003e, \u003ccode\u003edownto\u003c/code\u003eなどのメソッドはかなり新鮮。慣れるまでは毎回調べそう。\u003c/p\u003e\n\n\u003cp\u003e上の例は\u003ccode\u003eeach\u003c/code\u003eメソッドでこうも書ける。\u003ccode\u003edo\u003c/code\u003e必須。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003ehash\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"ss\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003ehash\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eeach\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"関数クラスメソッド宣言\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E6%95%B0%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E5%AE%A3%E8%A8%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関数・クラス・メソッド宣言\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"def\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#def\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edef\u003c/h2\u003e\n\n\u003cp\u003e比較に使うJSはオーソドックスな書き方にしている。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003esquare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esquare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 9\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esquare\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\n  \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003esquare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 9\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"class-initialize\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class-initialize\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eclass, initialize\u003c/h2\u003e\n\n\u003cp\u003eJSの\u003ccode\u003econstructor\u003c/code\u003eのように、\u003ccode\u003edef initialize\u003c/code\u003eを定義する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eComponent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eComponent\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einitialize\u003c/span\u003e \u003cspan class=\"n\"\u003estore\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@store\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estore\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"newとアクセサ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#new%E3%81%A8%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enewとアクセサ\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eUser\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'armorik83'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e83\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \"armorik83\"\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 83\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einitialize\u003c/span\u003e \u003cspan class=\"nb\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ename\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@age\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'armorik83'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e83\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"c1\"\u003e# NoMethodError\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# NoMethodError\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eNoMethodError\u003c/code\u003eとなるので、アクセサの宣言が必要らしい。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eattr_accessor\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eattr_reader\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eattr_writer\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://docs.ruby-lang.org/ja/2.0.0/class/Module.html#I_ATTR_ACCESSOR\"\u003ehttp://docs.ruby-lang.org/ja/2.0.0/class/Module.html#I_ATTR_ACCESSOR\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einitialize\u003c/span\u003e \u003cspan class=\"nb\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ename\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@age\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"kp\"\u003eattr_accessor\u003c/span\u003e \u003cspan class=\"ss\"\u003e:name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:age\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'armorik83'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e83\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \"armorik83\"\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 83\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなるほど。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"インスタンスメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインスタンスメソッド\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eUser\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eisAdult\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e20\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'armorik83'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e83\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAdult\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'child'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAdult\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einitialize\u003c/span\u003e \u003cspan class=\"nb\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ename\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@age\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eadult?\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e20\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"vi\"\u003e@age\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'armorik83'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e83\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadult?\u003c/span\u003e \u003cspan class=\"c1\"\u003e# true\u003c/span\u003e\n\u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'child'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadult?\u003c/span\u003e \u003cspan class=\"c1\"\u003e# false\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eここだけ見ると、OOPL経験者なら戸惑うところは無さそう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"クラスメソッドクラス変数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%AF%E3%83%A9%E3%82%B9%E5%A4%89%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクラスメソッド、クラス変数\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eClassName\u003c/span\u003e\n  \u003cspan class=\"vc\"\u003e@@classVar\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e42\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nc\"\u003eClassName\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003emethodName\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eクラス変数は\u003ca href=\"https://github.com/cookpad/styleguide/blob/master/ruby.ja.md#%E5%A4%89%E6%95%B0\"\u003eコーディングスタイル\u003c/a\u003eで\u003cstrong\u003eMUST NOT\u003c/strong\u003eだった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"継承\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B6%99%E6%89%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e継承\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eruby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBase\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einitialize\u003c/span\u003e \u003cspan class=\"n\"\u003eprop\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@prop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eprop\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"vi\"\u003e@prop\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eConcrete\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eBase\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einitialize\u003c/span\u003e \u003cspan class=\"n\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echildProp\u003c/span\u003e\n    \u003cspan class=\"k\"\u003esuper\u003c/span\u003e \u003cspan class=\"n\"\u003eprop\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@childProp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echildProp\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprintAll\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"vi\"\u003e@prop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"vi\"\u003e@childProp\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ebase\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eBase\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'a'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebase\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprint\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eConcrete\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'b'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprint\u003c/span\u003e\n\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprintAll\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eあまりいい例とは言えん。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"馴染みがなくて用途が分かってないもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%A6%B4%E6%9F%93%E3%81%BF%E3%81%8C%E3%81%AA%E3%81%8F%E3%81%A6%E7%94%A8%E9%80%94%E3%81%8C%E5%88%86%E3%81%8B%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%84%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e馴染みがなくて用途が分かってないもの\u003c/h1\u003e\n\n\u003cp\u003e以下雑多。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"proc\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#proc\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProc\u003c/h2\u003e\n\n\u003cp\u003eクロージャっぽいもの? Rubyに第一級関数は無いようで、Procで実現しているようだ。アプリケーションを書いたことがないので想像が付いてない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"特異メソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%89%B9%E7%95%B0%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e特異メソッド\u003c/h2\u003e\n\n\u003cp\u003eインスタンスにメソッドを足せるらしい。使い道想像できず。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"mix-in\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mix-in\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMix-in\u003c/h2\u003e\n\n\u003cp\u003e必要になったら覚えたい。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"21-22の新機能\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#21-22%E3%81%AE%E6%96%B0%E6%A9%9F%E8%83%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.1, 2.2の新機能\u003c/h2\u003e\n\n\u003cp\u003e公式ソースではないので、ググるキッカケ的に。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://techracho.bpsinc.jp/baba/2013_12_26/15026\"\u003eRuby 2.1.0リリース！注目の新機能を見てみましょう\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://allabout.co.jp/gm/gc/452102/\"\u003eRuby2.2の変更点と新機能の紹介\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ちょっとは読めるようになった\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%AF%E8%AA%AD%E3%82%81%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eちょっとは読めるようになった\u003c/h1\u003e\n\n\u003cp\u003eそもそも、どの解説記事を読むにも構文が分かっておらず読めなかったので、今回はその問題を潰す目的。Rubyらしい文化、Ruby最高ってなる機能はまだまだ全然分かってないので、まあぼちぼち…。\u003c/p\u003e\n\n\u003cp\u003e以下まさかりやオススメ記事が並ぶと大変嬉しいです。それでは。\u003c/p\u003e\n","body":"@armorik83です。なにやら最近は完全に[Angular芸人](http://qiita.com/armorik83/items/5542daed0c408cb9f605)と呼ばれるようになったのですが、一方でRuby知識はド素人、今まで避け続けてきたもんだから仕方がない。で、思い立ったので学び始めます。理由はご想像にお任せ。\n\n以下の文体ですが、他言語にはある程度長けていても、Rubyは一切やったことがない、というレベルを想定しています。比較対象は主にJavaScript ES6、自分用なので雑です。\n\n# バージョン\nJavaScriptのバージョンは`ES n`で表現するが、基本的にはブラウザの実装次第。Rubyはインタプリタ自体のバージョンを指す。インタプリタといっても、Ruby 1.9からは[YARV](http://ja.wikipedia.org/wiki/YARV)というVM上で動いてるらしい。\n\n最新は執筆時点で`2.1.6`, `2.2.2`。この2系統あたりを見ておけばいいのかな、[`1.9.3`はサポート終了してるらしい](https://www.ruby-lang.org/ja/news/2015/02/23/support-for-ruby-1-9-3-has-ended/)ので、今回は`2.0`以降に絞って学ぶ。\n\n## 読むもの\nざっと[`2.0.0`のマニュアル](http://docs.ruby-lang.org/ja/2.0.0/doc/index.html)を読んでいく。`2.1`, `2.2`前提で学ぶとやんごとなき事情でハマる恐れがあるので、あとで知識を上書きする。\n\nリンク先は全て2.0.0にしているので、参照される方は注意。\n\n## 目安にするコーディングスタイル\n右も左も分かってないので、とりあえず以下のものを参照する。\n\n\u003e https://github.com/cookpad/styleguide/blob/master/ruby.ja.md\n\n# 特徴\n『[はじめに](http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fintro.html)』の引用。調べなくても想像つくものと、つかないものに分ける。\n\n## 想像つく\n- インタプリタ\n- 変数に型が無い (動的型付け)\n- ユーザによるメモリ管理が不要\n- 全てがオブジェクト\n- クラス、継承、メソッド\n- ブロック付きメソッド呼び出し(イテレータ)\n- クロージャ（※でもJSとは全然違った）\n- 強力な文字列操作/正規表現\n- 多倍長整数\n- 例外処理機能\n- OSへの直接アクセス\n\n## 想像つかん\n- 変数宣言が不要\n- 特異メソッド\n- モジュールによるMix-in\n- ダイナミックローディング\n\nスクリプト言語はJavaScriptとPHPの経験があるので、ざっと見て馴染みないなーというものを下に分けた。CLIでのHello Worldとかはパスだパス!\n\n# 基礎構文\n\n## ステートメント\n1行1ステートメント。セミコロンなし。1行2ステートメント以上書きたいときに限りセミコロンで区切る。\n\n|JS|Ruby|\n|:--|:--|\n|いつも付けてる|要らない|\n\n## コメント行\n`#`を使う。行末まで有効。行頭、行中でも構わない。\n\n|JS|Ruby|\n|:--|:--|\n|`//`|`#`|\n\n## コメントブロック\n`=begin`, `=end`を使う。**埋め込みドキュメント**と名付けられていて、JSの`/*...*/`とは想定が異なる。\n\n|JS|Ruby|\n|:--|:--|\n|`/*`, `*/`|`=begin`, `=end`|\n\n## 変数と定数\n\n\u003e Ruby の変数と定数の種別は変数名の最初の一文字によって、ローカル変数、インスタンス変数、クラス変数、 グローバル変数、定数のいずれかに区別されます。\n\u003e http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fvariables.html\n\nローカル変数だけでなく、インスタンス変数も格納された時点から有効になる。クラス変数が`static`で宣言できるのはTypeScriptの特徴。グローバル変数の比較は一例。\n\n|JS|Ruby|TypeScript|\n|:--|:--|:--|\n|`var foobar = 42;`|`foobar = 42`||\n|`this.instanceVar = 42;`|`@instanceVar = 42`||\n|`ClassName.classVar = 42;`|`@@classVar = 42`|`static classVar = 42;`|\n|`const FOO_BAR = 42;`|`FOO_BAR = 42`||\n|`window.foobar = 42;`|`$foobar = 42`||\n\n## ローカル変数のスコープ\n\n\u003e 宣言した位置からその変数が宣言されたブロック、メソッド定義、またはクラス/モジュール定義の終りまでです。\n\u003e http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fvariables.html\n\n以下も参照する。\n\n\u003e https://github.com/cookpad/styleguide/blob/master/ruby.ja.md#変数\n\n## 全てがオブジェクト\n一例。\n\n- [String](http://ruby-doc.org/core-2.2.2/String.html)\n- [Integer](http://ruby-doc.org/core-2.2.2/Integer.html)\n- [Float](http://ruby-doc.org/core-2.2.2/Float.html)\n- [Regexp](http://ruby-doc.org/core-2.2.2/Regexp.html)\n- [Time](http://ruby-doc.org/core-2.2.2/Time.html)\n\n数値型は`Integer`, `Float`になるんだな。[`Numeric`](http://docs.ruby-lang.org/ja/2.1.0/class/Numeric.html)はAbstractなので後回し。\n\n## 演算子\n\n\u003e http://docs.ruby-lang.org/ja/2.0.0/doc/symref.html\n\n- `+` `-` `*` `/` `%` おなじみ\n- `**` 累乗\n- `+=` 自己代入（[可能な構文はここ](http://docs.ruby-lang.org/ja/1.9.3/doc/spec=2foperator.html#selfassign)）\n- `\u003c` `\u003e` `\u003c=` `\u003e=` 比較\n- `\u0026\u0026` `||` `!` and, or, not\n- `\u0026` `|` `\u003c\u003c` `\u003e\u003e` `^` `~` ビット演算\n\n## 文字列\n\n\u003e http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fliteral.html#string\n\nシングルクオートとダブルクオートに挙動の違いがあるのはPHPと同じ。JSではES6よりTemplate stringsが使える\n\n```js:js\nvar name = 'armorik83';\nvar str1 = 'hello ${name}'; // hello ${name}\nvar str2 = \"hello ${name}\"; // hello ${name}\nvar str3 = `hello ${name}`; // hello armorik83\n```\n\n```rb:ruby\nname = 'armorik83'\nstr1 = 'hello #{name}' # hello \\#{name}\nstr2 = \"hello #{name}\" # hello armorik83\n```\n\n## 正規表現\n\n`/abc/`で正規表現リテラルなのはJSと同じ。[Docs](http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fregexp.html)をざっと見た感じJSとそんなに変わらないが、モードにいくつか違いがありそうだ。\n\n## 破壊的メソッドと値渡し・参照渡し\n\n\u003e http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcall.html\n\nメソッド名の後に`!`が付くと破壊的メソッド。公式が行っているものの慣習らしく、言語仕様として定められているわけではない。\n\nあと、[Rubyでは常に値渡し](http://magazine.rubyist.net/?0032-CallByValueAndCallByReference)らしい。ただ、オブジェクトなので[参照の値渡し](http://magazine.rubyist.net/?0032-CallByValueAndCallByReference#l4)ということだ。副作用でハマったらこの辺を疑うってことで。\n\n## 真偽値を返すメソッド\n\n\u003e 慣用的に、真偽値を返すタイプのメソッドを示すために使われます。\n\u003e http://docs.ruby-lang.org/ja/2.0.0/doc/symref.html#q\n\nJSとかで、キャメルケースで`isFoo`とかするやつ。慣習的にRubyでは`isFoo`しない。\n\n|なにがしの言語|Ruby|\n|:--|:--|\n|`isEmpty()`|`empty?`|\n\n## 配列\n\n\u003e http://docs.ruby-lang.org/ja/2.0.0/class/Array.html\n\n```js:js\nvar arr = [1, 2, 3];\narr[1] = 4;\nconsole.log(arr); // [1, 4, 3]\n```\n\n```rb:ruby\narr = [1, 2, 3]\narr[1] = 4;\np arr # [1, 4, 3]\n```\n\n### 範囲指定\n\n\u003e http://docs.ruby-lang.org/ja/2.0.0/class/Range.html\n\nこういう構文だと覚えるより、Rangeリテラルを与えていると考えた方がよさそう。\n\n```js:js\nvar arr = [1, 2, 3, 4];\nconsole.log(arr[1..3]);       // SyntaxError: Unexpected number\nconsole.log(arr[1...3]);      // SyntaxError: Unexpected number\nconsole.log(arr.slice(1, 4)); // [2, 3, 4]\nconsole.log(arr.slice(1, 3)); // [2, 3]\n```\n\n```rb:ruby\narr = [1, 2, 3, 4]\np arr[1..3]  # [2, 3, 4]\np arr[1...3] # [2, 3]\n```\n\n### 逆から\n\n```js:js\nvar arr = [1, 2, 3, 4];\nconsole.log(arr.slice(-1)[0]);     // 4\nconsole.log(arr.slice(-2, -1)[0]); // 3\n```\n\n```rb:ruby\narr = [1, 2, 3, 4]\np arr[-1] # 4\np arr[-2] # 3\n```\n\nおおっ、JS地味につらい…。（比較にすらなってない）\n\n## %記法\n\n```rb:ruby\nwords = ['foo', 'bar', 'baz']\nwords = %w(foo bar baz)\n```\n\n`Array\u003cString\u003e`は下のようにも書ける。[コーディングスタイル](https://github.com/cookpad/styleguide/blob/master/ruby.ja.md#配列)ではこちらを推奨していた。\n\n\n## ハッシュ\n\n\u003e http://docs.ruby-lang.org/ja/2.0.0/class/Hash.html\n\nJSでいうObject型、他の言語でいう連想配列、辞書のあたり。\n\n```js:js\nvar price1 = {'apple': 2000, 'orange': 1500, 'grape': 3000};\nconsole.log(price1['apple']);\n\nvar price2 = {apple: 2000, orange: 1500, grape: 3000};\nconsole.log(price2.apple);\n```\n\n```rb:ruby\nprice1 = { 'apple' =\u003e 2000, 'orange' =\u003e 1500, 'grape' =\u003e 3000 }\np price1['apple'] # 2000\n\nprice2 = { apple: 2000, orange: 1500, grape: 3000 }\np price2[:apple] # 2000\n```\n\n`apple:`で宣言すると、参照時は`:apple`という[Symbolリテラル](http://docs.ruby-lang.org/ja/2.0.0/class/Symbol.html)形式なのが特徴的。\n\n# 制御構造\n## if, unless\n\n\u003e Rubyでは`if`を繋げるのは`elsif`であり、`else if`（Cのように）でも `elif`（shのように）でもないことに注意してください。\n\u003e http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcontrol.html#if\n\n`end`ってのもJSからすると驚きがデカい。\n\n```rb:ruby\nif cond\n  # ...\nelsif cond\n  # ...\nelse\n  # ...\nend \n```\n\n後置`if`という書き方もある。\n\n```rb:ruby\nif user.active?\n  send_mail_to(user)\nend\n\nsend_mail_to(user) if user.active?\n```\n\n三項演算子はちゃんとある。`if`内代入もある。個人的には`if`内代入は使わない。\n\n`unless`は鳥肌もので、JSで`if (!arg) { return; }`のように書くことに馴染んでいる自分としては、こんな逆転する構文は面倒にしか見えない。\n\nコーディングスタイルで推奨どころか**SHOULD**扱いなので、そういうものかーと思いながら見てる。\n\n## case\n\n```rb:ruby\ncase cond\nwhen val1\n  # ...\nwhen val2\n  # ...\nelse\n  # ...\nend\n```\n\n## for\n\n```js:js\nvar hash = {a: 1, b: 2, c: 3};\n\nfor (let k in hash) {\n  if (hash.hasOwnProperty(k)) {\n    let v = hash[k];\n    console.log(k, v);\n  }\n}\n```\n\n```rb:ruby\nhash = {a: 1, b: 2, c: 3}\n\nfor k, v in hash\n  p k, v\nend\n```\n\n意外なことにJSの`for`文（`for (var i; i \u003c len; i++)`みたいな）とRubyの`for`文は全く別物だった。JSの`for-in`文が近い。\n\n### その他の繰り返し\n`while`文はまだ馴染みがあるが、`times`, `upto`, `downto`などのメソッドはかなり新鮮。慣れるまでは毎回調べそう。\n\n上の例は`each`メソッドでこうも書ける。`do`必須。\n\n```rb:ruby\nhash = {a: 1, b: 2, c: 3}\n\nhash.each do |k, v|\n  p k, v\nend\n```\n\n# 関数・クラス・メソッド宣言\n## def\n\n比較に使うJSはオーソドックスな書き方にしている。\n\n```js:js\nfunction square(n) {\n  return n * n;\n}\nconsole.log(square(3)); // 9\n```\n\n```rb:ruby\ndef square n\n  n * n\nend\n\np square(3) # 9\n```\n\n## class, initialize\n\nJSの`constructor`のように、`def initialize`を定義する。\n\n```js:js\nclass Component {\n  constructor(store) {\n    this.store = store;\n  }\n}\n```\n\n```rb:ruby\nclass Component\n  def initialize store\n    @store = store\n  end\nend\n```\n\n## newとアクセサ\n\n```js:js\nclass User {\n  constructor(name, age) {\n    this.name = name;\n    this.age = age;\n  }\n}\n\nvar u = new User('armorik83', 83);\nconsole.log(u.name); // \"armorik83\"\nconsole.log(u.age);  // 83\n```\n\n```rb:ruby\nclass User\n  def initialize name, age\n    @name = name\n    @age = age\n  end\nend\n\nu = User.new('armorik83', 83)\np u.name # NoMethodError\np u.age  # NoMethodError\n```\n\n`NoMethodError`となるので、アクセサの宣言が必要らしい。\n\n- `attr_accessor`\n- `attr_reader`\n- `attr_writer`\n\n\u003e http://docs.ruby-lang.org/ja/2.0.0/class/Module.html#I_ATTR_ACCESSOR\n\n```rb:ruby\nclass User\n  def initialize name, age\n    @name = name\n    @age = age\n  end\n  attr_accessor :name, :age\nend\n\nu = User.new('armorik83', 83)\np u.name # \"armorik83\"\np u.age  # 83\n```\n\nなるほど。\n\n## インスタンスメソッド\n```js:js\nclass User {\n  constructor(name, age) {\n    this.name = name;\n    this.age = age;\n  }\n\n  isAdult() {\n    return 20 \u003c= this.age;\n  }\n}\n\nvar u = new User('armorik83', 83);\nconsole.log(u.isAdult()); // true\nvar c = new User('child', 8);\nconsole.log(c.isAdult()); // false\n```\n\n```rb:ruby\nclass User\n  def initialize name, age\n    @name = name\n    @age = age\n  end\n  \n  def adult?\n    20 \u003c= @age\n  end\nend\n\nu = User.new('armorik83', 83)\np u.adult? # true\nc = User.new('child', 8)\np c.adult? # false\n```\n\nここだけ見ると、OOPL経験者なら戸惑うところは無さそう。\n\n## クラスメソッド、クラス変数\n\n```rb:ruby\nclass ClassName\n  @@classVar = 42\n\n  def ClassName.methodName\n    # ...\n  end\nend\n```\n\nクラス変数は[コーディングスタイル](https://github.com/cookpad/styleguide/blob/master/ruby.ja.md#変数)で**MUST NOT**だった。\n\n## 継承\n\n```rb:ruby\nclass Base\n  def initialize prop\n    @prop = prop\n  end\n\n  def print\n    p @prop\n  end\nend\n\nclass Concrete \u003c Base\n  def initialize prop, childProp\n    super prop\n    @childProp = childProp\n  end\n\n  def printAll\n    p @prop, @childProp\n  end\nend\n\nbase = Base.new('a')\nbase.print\n\nc = Concrete.new('b', 2)\nc.print\nc.printAll\n```\n\nあまりいい例とは言えん。\n\n# 馴染みがなくて用途が分かってないもの\n以下雑多。\n\n## Proc\nクロージャっぽいもの? Rubyに第一級関数は無いようで、Procで実現しているようだ。アプリケーションを書いたことがないので想像が付いてない。\n\n## 特異メソッド\nインスタンスにメソッドを足せるらしい。使い道想像できず。\n\n## Mix-in\n必要になったら覚えたい。\n\n## 2.1, 2.2の新機能\n公式ソースではないので、ググるキッカケ的に。\n\n- [Ruby 2.1.0リリース！注目の新機能を見てみましょう](http://techracho.bpsinc.jp/baba/2013_12_26/15026)\n- [Ruby2.2の変更点と新機能の紹介](http://allabout.co.jp/gm/gc/452102/)\n\n# ちょっとは読めるようになった\nそもそも、どの解説記事を読むにも構文が分かっておらず読めなかったので、今回はその問題を潰す目的。Rubyらしい文化、Ruby最高ってなる機能はまだまだ全然分かってないので、まあぼちぼち…。\n\n以下まさかりやオススメ記事が並ぶと大変嬉しいです。それでは。\n","coediting":false,"created_at":"2015-06-05T17:25:39+09:00","id":"e06f697cd17a27d873c4","private":false,"tags":[{"name":"Ruby","versions":[]},{"name":"JavaScript","versions":[]}],"title":"JSerがRubyやるので備忘録","updated_at":"2015-06-05T19:17:57+09:00","url":"http://qiita.com/armorik83/items/e06f697cd17a27d873c4","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003eこんにちは。imaiです。待望のAngularJS1.4がリリースされましたね。Directive関係では、\u003ca href=\"https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/%24compile\"\u003e\u003ccode\u003ebindToController\u003c/code\u003e\u003c/a\u003eの機能が向上しました。\u003cbr\u003e\nこの\u003ccode\u003ebindToController\u003c/code\u003eとは一体何なのか。使って嬉しいことは何か。どう機能が向上したのか。について書いていきます。また、最後に自作Directiveを作っていく際に筆者がよくつまずく点を記しておきます。\u003c/p\u003e\n\n\u003cp\u003eこの記事の対象者:AngularJSに触れたことがある、自作のDirectiveを作ったことがある\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"bindtocontrollerとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bindtocontroller%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebindToControllerとは\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/%24compile\"\u003eAngularJS公式サイトのReference\u003c/a\u003eから\u003ccode\u003ebindToConroller\u003c/code\u003eの説明を意訳すると、\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e再利用可能なコンポーネントを作るために、分離?隔離?スコープや\u003ccode\u003econtrollerAs\u003c/code\u003eを用いる際に、\u003ccode\u003ebindToController:true\u003c/code\u003eとすることでコンポーネントのプロパティは\u003ccode\u003econtroller\u003c/code\u003eに結び付けられる(\u003ccode\u003escope\u003c/code\u003eには結びつかない)。コントローラが生成していれば、分離スコープに結びついた値を利用することができる。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ccode\u003ebindToController\u003c/code\u003eは、\u003ca href=\"https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/%24compile\"\u003eコントローラー\u003c/a\u003eと\u003ca href=\"https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/%24compile\"\u003e分離スコープ\u003c/a\u003e(他のスコープから切り離されたDirectiveが持てるスコープ)を結びつけると解釈していいと思います。\u003cbr\u003e\n\u003cem\u003e\"bind to controller\" === \"bind an isolated scope to a controller\"\u003c/em\u003e\u003cbr\u003e\nということ。\u003cbr\u003e\nざっくりいいますと、これまでDirectiveを自作する時に、コントローラーへ値を引き渡し、バインディングするには\u003ccode\u003e$scope\u003c/code\u003eが必要でしたが、これが\u003ccode\u003e$scope\u003c/code\u003eいらずで行えるようになりました。ng-controllerのas構文では先行して可能だったことがDirectiveでも可能になったんです。また、1.4では、どの値をバインディングするのか、どの値をバインディングしないのかを明確に定めることができるようになりました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"bindtocontrollerを使って嬉しいこと機能向上したところ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bindtocontroller%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%AC%89%E3%81%97%E3%81%84%E3%81%93%E3%81%A8%E6%A9%9F%E8%83%BD%E5%90%91%E4%B8%8A%E3%81%97%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebindToControllerを使って嬉しいこと、機能向上したところ\u003c/h1\u003e\n\n\u003cp\u003eでは実際に「\u003ccode\u003ebindToController\u003c/code\u003eを利用することで嬉しいことは何か」について書いていきます。例を示した方が早いと思うので、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAngularJS 1.2.xを用いて自作Directiveを作る場合\u003c/li\u003e\n\u003cli\u003eAngularJS 1.3.xを用いて自作Directiveを作る場合\u003c/li\u003e\n\u003cli\u003eAngularJS 1.4.xを用いて自作Directiveを作る場合\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの３つの例を見ていきます。お題は「ボタンがクリックされたら、クリックされた回数を表示する」\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularjs-12xの場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs-12x%E3%81%AE%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS 1.2.xの場合\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ポイント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポイント\u003c/h3\u003e\n\n\u003cp\u003eAngularJS 1.2.x系では、Directive間にて値のやり取りをするには\u003ccode\u003e$scope\u003c/code\u003eを用いるのが一番簡単のように思えます。しかしながら\u003ccode\u003econtrollerAs\u003c/code\u003eを用いた方がDirectiveがネストされた時の煩雑さを防げます(\u003ca href=\"http://qiita.com/Quramy/items/e55ba394031794236fc9\"\u003e参考\u003c/a\u003e)。よって\u003ccode\u003econtrollerAs\u003c/code\u003eを使いたいのですが、コントローラにおいて変更を感知するには\u003ccode\u003e$scope.$watch\u003c/code\u003eを用いるしかないため、書き方が複雑になってしまいます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ソース\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソース\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;parent-directive\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/parent-directive\u0026gt;\u003c/span\u003e        \n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eparent.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,[]);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//---親のDirective\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------親のDirectiveのcontroller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentController\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincrement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------親のDirectiveのDirective Definition Object\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"E\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"parent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;div style='background-color: #f0f0f0'\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;span\u0026gt;num: {{parent.num}} in parent \u0026lt;/span\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;button ng-click='parent.increment()'\u0026gt;+1\u0026lt;/button\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;child-directive prop1='parent.num'\u0026gt;\u0026lt;/child-directive\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;/div\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"parentDirective\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003echild.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c1\"\u003e//---子のDirective\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------子のDirectiveのcontroller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003echildController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//ここでのthisは、templateの{{child}}。(controllerAs)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//numのをwatchしなければ変更をthisに伝えることはできない。\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$watch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"num\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewVal\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enewVal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------子のDirectiveのDirective Definition Object\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003echildDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"E\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"=prop1\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003echildController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"child\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;div style='background-color: #d0d0d0'\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;span\u0026gt;num: {{child.num}} in child \u0026lt;/span\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;/div\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"childDirective\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003echildDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://jsfiddle.net/f73x4Law/3/\"\u003ehttps://jsfiddle.net/f73x4Law/3/\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularjs-13xの場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs-13x%E3%81%AE%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS 1.3.xの場合\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ポイント-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポイント\u003c/h3\u003e\n\n\u003cp\u003eAngularJS 1.3.xでは\u003ccode\u003ebindToController\u003c/code\u003eを利用できます。\u003ccode\u003ebindToController: true\u003c/code\u003eとすることにより\u003ccode\u003econtrollerAs\u003c/code\u003eを用いてコントローラ内で\u003ccode\u003ethis\u003c/code\u003eを通じて値を参照できます。\u003ccode\u003e$scope.$watch\u003c/code\u003eを用いずとも、親の変更を反映することできます。childControllerを見れば楽に書けるようになったことは明らかです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ソース-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソース\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eparent.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,[]);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//---親のDirective\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------親のDirectiveのcontroller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentController\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincrement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------親のDirectiveのDirective Definition Object\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"E\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"parent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;div style='background-color: #f0f0f0'\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;span\u0026gt;num: {{parent.num}} in parent \u0026lt;/span\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;button ng-click='parent.increment()'\u0026gt;+1\u0026lt;/button\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;child-directive prop1='parent.num'\u0026gt;\u0026lt;/child-directive\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;/div\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"parentDirective\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003echild.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c1\"\u003e//---子のDirective\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------子のDirectiveのcontroller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003echildController\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//ここでのthisは、templateの{{child}}。(controllerAs)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//bindToControllerによって、scopeがthis.~に紐づく。\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------子のDirectiveのDirective Definition Object\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003echildDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"E\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"=prop1\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003echildController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"child\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//bindToCotrollerをtrueにすることでthisとscopeを紐づけることができる。\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003ebindToController\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;div style='background-color: #d0d0d0'\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;span\u0026gt;num: {{child.num}} in child \u0026lt;/span\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;/div\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"childDirective\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003echildDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://jsfiddle.net/f73x4Law/4/\"\u003ehttps://jsfiddle.net/f73x4Law/4/\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularjs-14xの場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs-14x%E3%81%AE%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS 1.4.xの場合\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ポイント-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポイント\u003c/h3\u003e\n\n\u003cp\u003eAngularJS 1.4.xでは、\u003ccode\u003ebindToController\u003c/code\u003eにて紐づける値を直接指定することができます。\u003ccode\u003ebindToController:{hoge: \"=\"}\u003c/code\u003eと書いていきます。スコープオプションは書かなくてもいい。しかしながら、\u003ccode\u003escope:{}\u003c/code\u003eもしくは\u003ccode\u003escope:true\u003c/code\u003eと書いておかないと動きません。ので、分離スコープを生成する\u003ccode\u003escope:{}\u003c/code\u003eを指定すればよいでしょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ソース-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソース\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eparent.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,[]);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//---親のDirective\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------親のDirectiveのcontroller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentController\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincrement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//this.notBindはbindToControllerにてbindしない場合。\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enotBind\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"notBind\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------親のDirectiveのDirective Definition Object\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"E\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"parent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;div style='background-color: #f0f0f0'\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;span\u0026gt;num: {{parent.num}} in parent \u0026lt;/span\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;button ng-click='parent.increment()'\u0026gt;+1\u0026lt;/button\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;child-directive prop1='parent.num' prop2='parent.notBind'\u0026gt;\u0026lt;/child-directive\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;/div\u0026gt;\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"parentDirective\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eparentDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003echild.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c1\"\u003e//---子のDirective\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------子のDirectiveのcontroller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003echildController\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//ここでのthisは、templateの{{child}}。(controllerAs)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//bindToControllerによって、scopeがthis.~に紐づく。\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//this.notBindは紐づきません。\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enotBind\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------子のDirectiveのDirective Definition Object\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003echildDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"E\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003enotBind\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"=prop2\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003echildController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"child\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//1.4からはbindToCotrollerにて直接bindする値を選択できる。\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ebindToController\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"=prop1\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;div style='background-color: #d0d0d0'\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s2\"\u003e\"\u0026lt;span\u0026gt;num: {{child.num}} in child \u0026lt;/span\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\"\u0026lt;/div\u0026gt;\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"childDirective\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003echildDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://jsfiddle.net/f73x4Law/2/\"\u003ehttps://jsfiddle.net/f73x4Law/2/\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意点\u003c/h1\u003e\n\n\u003cp\u003e自作Directiveを作ろうとした時に筆者がよくつまずく点を記しておきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2語以上のdirective名だと動かない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E8%AA%9E%E4%BB%A5%E4%B8%8A%E3%81%AEdirective%E5%90%8D%E3%81%A0%E3%81%A8%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2語以上のDirective名だと動かない\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eangular.module().directive(\"sampleDirective\", sampleDirective);\u003c/code\u003e\u003cbr\u003e\nとした時のHTML要素は\u003cbr\u003e\n\u003ccode\u003e\u0026lt;sampleDirective\u0026gt;\u0026lt;/sampleDirective\u0026gt;\u003c/code\u003e\u003cbr\u003e\nではなく\u003cbr\u003e\n\u003ccode\u003e\u0026lt;sample-directive\u0026gt;\u0026lt;/sample-directive\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2語以上のscope名だと動かない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E8%AA%9E%E4%BB%A5%E4%B8%8A%E3%81%AEscope%E5%90%8D%E3%81%A0%E3%81%A8%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2語以上のscope名だと動かない\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003e{child: \"=sampleModel\"}\u003c/code\u003e\u003cbr\u003e\nのとき\u003cbr\u003e\n\u003ccode\u003e\u0026lt;sample-directive sampleModel='data'\u0026gt;\u0026lt;/sample-directive\u0026gt;\u003c/code\u003e\u003cbr\u003e\nではなく\u003cbr\u003e\n\u003ccode\u003e\u0026lt;sample-directive sample-model='data'\u0026gt;\u0026lt;/sample-directive\u0026gt;\u003c/code\u003e\u003cbr\u003e\nDirective名はキャメルケース、テンプレート上での名前はハイフンケース\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bindtocontrollerがうまく動かない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bindtocontroller%E3%81%8C%E3%81%86%E3%81%BE%E3%81%8F%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebindToControllerがうまく動かない\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ebindToController: {hoge: \"=foo\"}\u003c/code\u003e\u003cbr\u003e\nとしたけど動かない。これはかなりひっかけではないか。\u003cbr\u003e\n上でも書いたが、\u003ccode\u003escope:{}\u003c/code\u003eもしくは\u003ccode\u003escope:true\u003c/code\u003eと書いておかないと動きません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003e1.4ではDirectiveの扱いが簡単に、そして分かりやすく、便利になったと思います。\u003cbr\u003e\n今回の話題を、\u003ca href=\"http://ng-kyoto.connpass.com/event/15595/\"\u003eAngular Meetup Kyoto #1\u003c/a\u003e @京都6.19 presented by \u003ca href=\"http://ng-kyoto.github.io/\"\u003eng-kyoto\u003c/a\u003eにてもう少し詳しく話します。お時間がありましたらお越しください。\u003c/p\u003e\n","body":"\nこんにちは。imaiです。待望のAngularJS1.4がリリースされましたね。Directive関係では、[`bindToController`](https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/$compile)の機能が向上しました。\nこの`bindToController`とは一体何なのか。使って嬉しいことは何か。どう機能が向上したのか。について書いていきます。また、最後に自作Directiveを作っていく際に筆者がよくつまずく点を記しておきます。\n\nこの記事の対象者:AngularJSに触れたことがある、自作のDirectiveを作ったことがある\n#bindToControllerとは\n[AngularJS公式サイトのReference](https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/$compile)から`bindToConroller`の説明を意訳すると、\n\u003e再利用可能なコンポーネントを作るために、分離?隔離?スコープや`controllerAs`を用いる際に、`bindToController:true`とすることでコンポーネントのプロパティは`controller`に結び付けられる(`scope`には結びつかない)。コントローラが生成していれば、分離スコープに結びついた値を利用することができる。\n\n`bindToController`は、[コントローラー](https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/$compile)と[分離スコープ](https://code.angularjs.org/1.4.0-rc.2/docs/api/ng/service/$compile)(他のスコープから切り離されたDirectiveが持てるスコープ)を結びつけると解釈していいと思います。\n*\"bind to controller\" === \"bind an isolated scope to a controller\"*\nということ。\nざっくりいいますと、これまでDirectiveを自作する時に、コントローラーへ値を引き渡し、バインディングするには`$scope`が必要でしたが、これが`$scope`いらずで行えるようになりました。ng-controllerのas構文では先行して可能だったことがDirectiveでも可能になったんです。また、1.4では、どの値をバインディングするのか、どの値をバインディングしないのかを明確に定めることができるようになりました。\n\n#bindToControllerを使って嬉しいこと、機能向上したところ\nでは実際に「`bindToController`を利用することで嬉しいことは何か」について書いていきます。例を示した方が早いと思うので、\n\n- AngularJS 1.2.xを用いて自作Directiveを作る場合\n- AngularJS 1.3.xを用いて自作Directiveを作る場合\n- AngularJS 1.4.xを用いて自作Directiveを作る場合\n\nこの３つの例を見ていきます。お題は「ボタンがクリックされたら、クリックされた回数を表示する」\n##AngularJS 1.2.xの場合\n###ポイント\nAngularJS 1.2.x系では、Directive間にて値のやり取りをするには`$scope`を用いるのが一番簡単のように思えます。しかしながら`controllerAs`を用いた方がDirectiveがネストされた時の煩雑さを防げます([参考](http://qiita.com/Quramy/items/e55ba394031794236fc9))。よって`controllerAs`を使いたいのですが、コントローラにおいて変更を感知するには`$scope.$watch`を用いるしかないため、書き方が複雑になってしまいます。\n###ソース\n\n```html\n\u003cdiv ng-app=\"myApp\"\u003e\n    \u003cparent-directive\u003e\n    \u003c/parent-directive\u003e        \n\u003c/div\u003e\n```\n\n```parent.js\nangular.module(\"myApp\",[]);\n\n//---親のDirective\n//------親のDirectiveのcontroller\nfunction parentController(){\n    this.num = 0;\n    this.increment = function(){\n        this.num++;\n    }\n}\n//------親のDirectiveのDirective Definition Object\nfunction parentDirective(){\n    var ddo = {\n        restrict: \"E\",\n        scope: {},\n        controller: parentController,\n        controllerAs: \"parent\",\n        template: [\n            \"\u003cdiv style='background-color: #f0f0f0'\u003e\",\n                \"\u003cspan\u003enum: {{parent.num}} in parent \u003c/span\u003e\",\n                \"\u003cbutton ng-click='parent.increment()'\u003e+1\u003c/button\u003e\",\n                \"\u003cchild-directive prop1='parent.num'\u003e\u003c/child-directive\u003e\",\n            \"\u003c/div\u003e\"].join(\"\")\n    };\n    return ddo;\n}\nangular.module(\"myApp\").directive(\"parentDirective\", parentDirective);\n```\n\n```child.js\n//---子のDirective\n//------子のDirectiveのcontroller\nfunction childController($scope){\n\n    //ここでのthisは、templateの{{child}}。(controllerAs)\n    //numのをwatchしなければ変更をthisに伝えることはできない。\n    \n    $scope.$watch(\"num\", function(newVal){\n        this.num = newVal;\n    }.bind(this));\n}\n//------子のDirectiveのDirective Definition Object\nfunction childDirective(){\n    var ddo = {\n        restrict: \"E\",\n        scope: {\n        \tnum: \"=prop1\"\n        },\n        controller: childController,\n        controllerAs: \"child\",\n        template: [\n            \"\u003cdiv style='background-color: #d0d0d0'\u003e\",\n                \"\u003cspan\u003enum: {{child.num}} in child \u003c/span\u003e\",\n            \"\u003c/div\u003e\"].join(\"\")\n    };\n    return ddo;\n}\nangular.module(\"myApp\").directive(\"childDirective\", childDirective);\n\n```\n\nhttps://jsfiddle.net/f73x4Law/3/\n\n##AngularJS 1.3.xの場合\n###ポイント\nAngularJS 1.3.xでは`bindToController`を利用できます。`bindToController: true`とすることにより`controllerAs`を用いてコントローラ内で`this`を通じて値を参照できます。`$scope.$watch`を用いずとも、親の変更を反映することできます。childControllerを見れば楽に書けるようになったことは明らかです。\n###ソース\n\n```parent.js\nangular.module(\"myApp\",[]);\n\n//---親のDirective\n//------親のDirectiveのcontroller\nfunction parentController(){\n    this.num = 0;\n    this.increment = function(){\n        this.num++;\n    }\n}\n//------親のDirectiveのDirective Definition Object\nfunction parentDirective(){\n    var ddo = {\n        restrict: \"E\",\n        scope: {},\n        controller: parentController,\n        controllerAs: \"parent\",\n        template: [\n            \"\u003cdiv style='background-color: #f0f0f0'\u003e\",\n                \"\u003cspan\u003enum: {{parent.num}} in parent \u003c/span\u003e\",\n                \"\u003cbutton ng-click='parent.increment()'\u003e+1\u003c/button\u003e\",\n                \"\u003cchild-directive prop1='parent.num'\u003e\u003c/child-directive\u003e\",\n            \"\u003c/div\u003e\"].join(\"\")\n    };\n    return ddo;\n}\nangular.module(\"myApp\").directive(\"parentDirective\", parentDirective);\n```\n\n```child.js\n//---子のDirective\n//------子のDirectiveのcontroller\nfunction childController(){\n\n    //ここでのthisは、templateの{{child}}。(controllerAs)\n    //bindToControllerによって、scopeがthis.~に紐づく。\n    \n    console.log(this.num);\n}\n//------子のDirectiveのDirective Definition Object\nfunction childDirective(){\n    var ddo = {\n        restrict: \"E\",\n        scope: {\n        \tnum: \"=prop1\"\n        },\n        controller: childController,\n        controllerAs: \"child\",\n        \n        //bindToCotrollerをtrueにすることでthisとscopeを紐づけることができる。\n        \n        bindToController: true,\n        template: [\n            \"\u003cdiv style='background-color: #d0d0d0'\u003e\",\n                \"\u003cspan\u003enum: {{child.num}} in child \u003c/span\u003e\",\n            \"\u003c/div\u003e\"].join(\"\")\n    };\n    return ddo;\n}\nangular.module(\"myApp\").directive(\"childDirective\", childDirective);\n\n```\n\nhttps://jsfiddle.net/f73x4Law/4/\n\n##AngularJS 1.4.xの場合\n###ポイント\nAngularJS 1.4.xでは、`bindToController`にて紐づける値を直接指定することができます。`bindToController:{hoge: \"=\"}`と書いていきます。スコープオプションは書かなくてもいい。しかしながら、`scope:{}`もしくは`scope:true`と書いておかないと動きません。ので、分離スコープを生成する`scope:{}`を指定すればよいでしょう。\n###ソース\n\n```parent.js\nangular.module(\"myApp\",[]);\n\n//---親のDirective\n//------親のDirectiveのcontroller\nfunction parentController(){\n    this.num = 0;\n    this.increment = function(){\n        this.num++;\n    }\n    \n    //this.notBindはbindToControllerにてbindしない場合。\n    \n    this.notBind = \"notBind\";\n}\n//------親のDirectiveのDirective Definition Object\nfunction parentDirective(){\n    var ddo = {\n        restrict: \"E\",\n        scope: {},\n        controller: parentController,\n        controllerAs: \"parent\",\n        template: [\n            \"\u003cdiv style='background-color: #f0f0f0'\u003e\",\n                \"\u003cspan\u003enum: {{parent.num}} in parent \u003c/span\u003e\",\n                \"\u003cbutton ng-click='parent.increment()'\u003e+1\u003c/button\u003e\",\n                \"\u003cchild-directive prop1='parent.num' prop2='parent.notBind'\u003e\u003c/child-directive\u003e\",\n            \"\u003c/div\u003e\"\n        ].join(\"\")\n    };\n    return ddo;\n}\nangular.module(\"myApp\").directive(\"parentDirective\", parentDirective);\n```\n\n\n```child.js\n//---子のDirective\n//------子のDirectiveのcontroller\nfunction childController(){\n    //ここでのthisは、templateの{{child}}。(controllerAs)\n    //bindToControllerによって、scopeがthis.~に紐づく。\n\n    console.log(this.num);\n\n    //this.notBindは紐づきません。\n    \n    console.log(this.notBind);\n}\n//------子のDirectiveのDirective Definition Object\nfunction childDirective(){\n    var ddo = {\n        restrict: \"E\",\n        scope: {\n            notBind: \"=prop2\"\n        },\n        controller: childController,\n        controllerAs: \"child\",\n        //1.4からはbindToCotrollerにて直接bindする値を選択できる。\n        bindToController: {\n            num: \"=prop1\"\n        },\n        template: [\n            \"\u003cdiv style='background-color: #d0d0d0'\u003e\",\n                \"\u003cspan\u003enum: {{child.num}} in child \u003c/span\u003e\",\n            \"\u003c/div\u003e\"\n        ].join(\"\")\n    };\n    return ddo;\n}\nangular.module(\"myApp\").directive(\"childDirective\", childDirective);\n```\n\nhttps://jsfiddle.net/f73x4Law/2/\n\n#注意点\n自作Directiveを作ろうとした時に筆者がよくつまずく点を記しておきます。\n##2語以上のDirective名だと動かない\n`angular.module().directive(\"sampleDirective\", sampleDirective);`\nとした時のHTML要素は\n`\u003csampleDirective\u003e\u003c/sampleDirective\u003e`\nではなく\n`\u003csample-directive\u003e\u003c/sample-directive\u003e`\n##2語以上のscope名だと動かない\n`{child: \"=sampleModel\"}`\nのとき\n`\u003csample-directive sampleModel='data'\u003e\u003c/sample-directive\u003e`\nではなく\n`\u003csample-directive sample-model='data'\u003e\u003c/sample-directive\u003e`\nDirective名はキャメルケース、テンプレート上での名前はハイフンケース\n\n##bindToControllerがうまく動かない\n`bindToController: {hoge: \"=foo\"}`\nとしたけど動かない。これはかなりひっかけではないか。\n上でも書いたが、`scope:{}`もしくは`scope:true`と書いておかないと動きません。\n\n#最後に\n1.4ではDirectiveの扱いが簡単に、そして分かりやすく、便利になったと思います。\n今回の話題を、[Angular Meetup Kyoto #1](http://ng-kyoto.connpass.com/event/15595/) @京都6.19 presented by [ng-kyoto](http://ng-kyoto.github.io/)にてもう少し詳しく話します。お時間がありましたらお越しください。\n","coediting":false,"created_at":"2015-05-29T21:17:51+09:00","id":"131780e2f0d82cbf799a","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"HTML5","versions":[]},{"name":"AngularJS","versions":["1.4.0"]}],"title":"AngularJS1.4とbindToController","updated_at":"2015-05-29T21:17:51+09:00","url":"http://qiita.com/shinsukeimai/items/131780e2f0d82cbf799a","user":{"description":null,"facebook_id":null,"followees_count":11,"followers_count":6,"github_login_name":"shinsukeimai","id":"shinsukeimai","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":58613,"profile_image_url":"https://avatars.githubusercontent.com/u/7425556?v=2","twitter_screen_name":"shin_v1","website_url":null}},{"rendered_body":"\u003cp\u003e\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。新MacBook Pro 15\"が発売され、長らくの相棒MacBook Proも6年選手だったため、めでたく引退となった。今日は個人の日記レベルで新しいMacをセットアップしていく。\u003c/p\u003e\n\n\u003cp\u003eOSを丸ごと再インストールする機会自体あまりないが、私は儀式的にOS Xをアップグレードする度にクリーン・インストールする癖があり、次の機会に備えてメモを残す。（未だにクリーン・インストール儀式を執り行うが、周りはどうなんだろう）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"購入時点の環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B3%BC%E5%85%A5%E6%99%82%E7%82%B9%E3%81%AE%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e購入時点の環境\u003c/h1\u003e\n\n\u003cp\u003e2015年5月28日、開封直後の状態。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eMacBook Pro 15\" Mid 2015\u003c/li\u003e\n\u003cli\u003e2.8GHz Core i7\u003c/li\u003e\n\u003cli\u003e16GB DDR3\u003c/li\u003e\n\u003cli\u003e500GB Storage\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"電源投入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9B%BB%E6%BA%90%E6%8A%95%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e電源投入\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ecmd-R\u003c/code\u003eを押しっぱなし\u003c/li\u003e\n\u003cli\u003eDisk Utilityでプリインストールを削除\u003c/li\u003e\n\u003cli\u003eYosemite再インストール（要Wifi）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e確認\u003c/h1\u003e\n\n\u003cp\u003e「Yosemite 10.10.3だとこうなってるのかーなるほどー」などと言いながら。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003ebash --version\n# 3.2.57\n\nruby -v\n# 2.0.0p481\n\npython -V\n# 2.7.6\n\nphp -v\n# 5.5.20\n\nnode -v\n# node: command not found そりゃそうだ\n\ngit --version\n# この辺からXcodeを求められる\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"xcode必須\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#xcode%E5%BF%85%E9%A0%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eXcode必須\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ecommand line developer tools\u003c/code\u003eの兼ね合いでOS X, iOSエンジニアでなくともXcodeは必須。App Storeからサクっと落とす。これがまた長い。待ってる間に他の作業を進める。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"dropbox\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dropbox\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDropbox\u003c/h1\u003e\n\n\u003cp\u003e色々自動化したいところだが、この記事を旧Macで書いている都合でデータのやりとりが必要だったので、Dropboxは手動インストールで妥協した。2段階認証の端末が手元にないと詰む。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"システム環境設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシステム環境設定\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003eMission Control\u003c/strong\u003e\u003cbr\u003e\n- Mission Control: F12\u003cbr\u003e\n- Application windows: F13\u003cbr\u003e\n- Show Desktop: F11\u003cbr\u003e\n- Show Dashboard: -\u003c/p\u003e\n\n\u003cp\u003e手癖。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eKeyboard\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUse all F1, F2…\u003c/li\u003e\n\u003cli\u003eControlとCaps lockを入れ替え\u003c/li\u003e\n\u003cli\u003eShow Spotlight searchのショートカットを\u003ccode\u003ectrl-A\u003c/code\u003eに\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eUS配列なのでControlをAの左隣に入れ替える。これも手癖。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eTrackpad\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e追加でONにするもの。\u003cbr\u003e\n- Tap to click\u003c/p\u003e\n\n\u003cp\u003e3本指ドラッグが無いじゃないか! と憤慨しかけたが、ちゃんと機能自体は残っていた。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"yosemiteでの3本指ドラッグ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#yosemite%E3%81%A7%E3%81%AE3%E6%9C%AC%E6%8C%87%E3%83%89%E3%83%A9%E3%83%83%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eYosemiteでの3本指ドラッグ\u003c/h2\u003e\n\n\u003cp\u003eここにあった、よかった。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/17959/6e1785eb-985c-30d6-d8e7-5d0e8c003a8a.png\" alt=\"Shot\"\u003e\u003cbr\u003e\n\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/17959/da7024d4-448d-8ff7-8236-bce2a6324774.png\" alt=\"Screen Shot 2015-05-28 at 2.00.20 PM.png\"\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"xcode-command-line-developer-tools\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#xcode-command-line-developer-tools\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eXcode command line developer tools\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"認証\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%8D%E8%A8%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e認証\u003c/h2\u003e\n\n\u003cp\u003eXcodeのインストールが終わったので続き。Xcodeのライセンス認証はTerminalで。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003esudo xcodebuild -license\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eBy typing 'agree' you are agreeing to the terms of the software license agreements. Type 'print' to print them or anything else to cancel, [agree, print, cancel] \n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e何度か\u003ccode\u003espace\u003c/code\u003e連打して、これが表示されたら\u003ccode\u003eagree\u003c/code\u003eと入力。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"command-line-developer-tools\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#command-line-developer-tools\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecommand line developer tools\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003excode-select --install\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecommand line developer toolsをインストール、しばし待つ。インストールが完了したら確認。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003egit --version\n# 2.3.2\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"homebrew\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#homebrew\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHomebrew\u003c/h1\u003e\n\n\u003cp\u003eHomebrewを入れる。コマンドはおなじみのやつ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n\nbrew -v\n# Homebrew 0.9.5\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003ebrew doctor\nbrew update\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003edoctor\u003c/code\u003e, \u003ccode\u003eupdate\u003c/code\u003eは慣習だが、真っさらなので何も起こらなかった（珍しい）。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ansible\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ansible\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAnsible\u003c/h1\u003e\n\n\u003cp\u003e今回、\u003ca href=\"/t_wada\" class=\"user-mention\" title=\"t_wada\"\u003e@t_wada\u003c/a\u003e氏の『\u003ca href=\"http://t-wada.hatenablog.jp/entry/mac-provisioning-by-ansible\"\u003eMac の開発環境構築を自動化する (2015 年初旬編)\u003c/a\u003e』を実践すべくこの記事を書いているため、Ansibleに初挑戦する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003ebrew install ansible\nansible --version\n# ansible 1.9.1\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"自動化開始\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%8B%95%E5%8C%96%E9%96%8B%E5%A7%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自動化開始\u003c/h1\u003e\n\n\u003cp\u003e元の記事に従ってプロビジョニング用のディレクトリを作る。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003emkdir .mac-provisioning; cd $_\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"inventoryファイル作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#inventory%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003einventoryファイル作成\u003c/h2\u003e\n\n\u003cp\u003eansible用のinventoryファイル（実行対象ホスト指定ファイル）を作る。この辺も元の記事に従う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eecho 'localhost' \u0026gt; hosts\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"playbookファイル作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#playbook%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eplaybookファイル作成\u003c/h2\u003e\n\n\u003cp\u003e次にplaybook（プロビジョニングの内容）を書く…って、ずっと元記事をなぞってますよ。これは面倒だったので旧Macの方で作成。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elocalhost.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003elocalhost\u003c/span\u003e\n  \u003cspan class=\"l-Scalar-Plain\"\u003econnection\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003elocal\u003c/span\u003e\n  \u003cspan class=\"l-Scalar-Plain\"\u003egather_facts\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003eno\u003c/span\u003e\n  \u003cspan class=\"l-Scalar-Plain\"\u003esudo\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003eno\u003c/span\u003e\n  \u003cspan class=\"l-Scalar-Plain\"\u003evars\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_taps\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ecaskroom/cask\u003c/span\u003e\n    \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_packages\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003enodebrew\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eansible\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003egit\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003ezsh\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003einstall_options\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003edisable-etcdir\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003ewget\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003ecurl\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003etree\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003ephantomjs\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_cask_packages\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e0xed\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003emongochef\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eatom\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eclamxav\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003ecleanarchiver\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003ecyberduck\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003edaisydisk\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eeasyfind\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003efirefox\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eflux\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003egoogle-chrome\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003egoogle-japanese-ime\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eimageoptim\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eiterm2\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003ekobito\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eskim\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eskype\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eslack\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003eteamviewer\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003etimemachineeditor\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003evagrant\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003evirtualbox\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"l-Scalar-Plain\"\u003etasks\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003eadd tap repos\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_tap\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003etap={{ item }} state=present\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ewith_items\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_taps\u003c/span\u003e\n\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003eupdate homebrew\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003eupdate_homebrew=yes\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# brew\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003einstall brew packages\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"p-Indicator\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"no\"\u003ename={{ item.name }}\u003c/span\u003e\n        \u003cspan class=\"no\"\u003estate={{ item.state | default('latest') }}\u003c/span\u003e\n        \u003cspan class=\"no\"\u003einstall_options={{\u003c/span\u003e\n          \u003cspan class=\"no\"\u003eitem.install_options | default() | join(',')\u003c/span\u003e\n          \u003cspan class=\"no\"\u003eif item.install_options is not string\u003c/span\u003e\n          \u003cspan class=\"no\"\u003eelse item.install_options\u003c/span\u003e\n        \u003cspan class=\"no\"\u003e}}\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ewith_items\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_packages\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003eregister\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ebrew_result\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003emake package info dir\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003efile\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003epath=brew_info state=directory\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003esave package info\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003eshell\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ebrew info {{ item }} \u0026gt; brew_info/{{ item }}\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ewith_items\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ebrew_result.results | selectattr('changed') | map(attribute='item') | map(attribute='name') | list\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# cask\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003einstall homebrew-cask\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename=brew-cask state=latest\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003einstall packages\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_cask\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename={{ item.name }} state={{ item.state|default('installed') }}\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ewith_items\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ehomebrew_cask_packages\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003eregister\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ecask_result\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003emake package info dir\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003efile\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003epath=cask_info state=directory\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003esave package info\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003eshell\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ebrew cask info {{ item }} \u0026gt; cask_info/{{ item }}\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003ewith_items\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ecask_result.results | selectattr('changed') | map(attribute='item') | map(attribute='name') | list\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# oh-my-zsh\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003einstall oh-my-zsh\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003eshell\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ecurl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003eargs\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"l-Scalar-Plain\"\u003ecreates\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003e~/.oh-my-zsh/\u003c/span\u003e\n\n  \u003cspan class=\"l-Scalar-Plain\"\u003ehandlers\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"p-Indicator\"\u003e-\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003ename\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003erun fc-cache\u003c/span\u003e\n      \u003cspan class=\"l-Scalar-Plain\"\u003eshell\u003c/span\u003e\u003cspan class=\"p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l-Scalar-Plain\"\u003efc-cache -vf\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eGUI依存率高し、黒い画面に詳しくないのでこんな量。オススメがあったら教えてください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eHOMEBREW_CASK_OPTS=\"--appdir=/Applications\" ansible-playbook -i hosts -vv localhost.yml\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあとは\u003cimg class=\"emoji\" title=\":coffee:\" alt=\":coffee:\" src=\"https://cdn.qiita.com/emoji/unicode/2615.png\" height=\"20\" width=\"20\" align=\"absmiddle\"\u003eしながら眺める。\u003ccode\u003eHOMEBREW_CASK_OPTS\u003c/code\u003eは入れたほうがいいみたいだ。Caskのインストール先が\u003ccode\u003e~/Applications\u003c/code\u003eにならないようにするため。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"いくつかコケてた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%82%B3%E3%82%B1%E3%81%A6%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいくつかコケてた\u003c/h2\u003e\n\n\u003cp\u003eCaskでコケてるのがあった。もう今回は原因追求せず手動で入れることにした。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nodebrew\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nodebrew\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enodebrew\u003c/h1\u003e\n\n\u003cp\u003eフロントエンドで\u003ccode\u003enode\u003c/code\u003e必須なので。Node.js, io,jsのバージョン管理は\u003ca href=\"https://github.com/hokaccha/nodebrew\"\u003enodebrew\u003c/a\u003eで行う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003enodebrew ls-remote\n# 最新版のバージョンを確認\nnodebrew install-binary v0.12.4\nnodebrew install-binary io@v2.1.0\nnodebrew use io@v2.1.0\n\nnode -v\n# v2.1.0\n# パスは通っている前提\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"npm-i--g\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-i--g\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm i -g\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003enpm i -g npm\nnpm i -g babel browserify mocha fixpack\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003enpm i -g\u003c/code\u003eは、あまり入れない。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"残りは手作業\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AE%8B%E3%82%8A%E3%81%AF%E6%89%8B%E4%BD%9C%E6%A5%AD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e残りは手作業\u003c/h1\u003e\n\n\u003cp\u003eあとはどうしても手作業的な部分があるので、それはチマチマと。今回の自動化も詳しく分かっていないまま試みているので詰めが甘いかもしれない。\u003c/p\u003e\n\n\u003cp\u003eしかしこれは早い、Homebrew Caskは是非ともオススメしたい。かつては各種サイトからインストーラをダウンロードして個別に展開していたので隔世の感がある。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eこういったプロビジョニングを見直し育てることもまた楽しみのひとつだ。あとはこの新しい相棒と共に励み、戦い、稼ぐだけである。以上。\u003c/p\u003e\n","body":"@armorik83です。新MacBook Pro 15\"が発売され、長らくの相棒MacBook Proも6年選手だったため、めでたく引退となった。今日は個人の日記レベルで新しいMacをセットアップしていく。\n\nOSを丸ごと再インストールする機会自体あまりないが、私は儀式的にOS Xをアップグレードする度にクリーン・インストールする癖があり、次の機会に備えてメモを残す。（未だにクリーン・インストール儀式を執り行うが、周りはどうなんだろう）\n\n# 購入時点の環境\n2015年5月28日、開封直後の状態。\n\n- MacBook Pro 15\" Mid 2015\n- 2.8GHz Core i7\n- 16GB DDR3\n- 500GB Storage\n\n# 電源投入\n\n- `cmd-R`を押しっぱなし\n- Disk Utilityでプリインストールを削除\n- Yosemite再インストール（要Wifi）\n\n# 確認\n「Yosemite 10.10.3だとこうなってるのかーなるほどー」などと言いながら。\n\n```\nbash --version\n# 3.2.57\n\nruby -v\n# 2.0.0p481\n\npython -V\n# 2.7.6\n\nphp -v\n# 5.5.20\n\nnode -v\n# node: command not found そりゃそうだ\n\ngit --version\n# この辺からXcodeを求められる\n```\n\n## Xcode必須\n`command line developer tools`の兼ね合いでOS X, iOSエンジニアでなくともXcodeは必須。App Storeからサクっと落とす。これがまた長い。待ってる間に他の作業を進める。\n\n# Dropbox\n色々自動化したいところだが、この記事を旧Macで書いている都合でデータのやりとりが必要だったので、Dropboxは手動インストールで妥協した。2段階認証の端末が手元にないと詰む。\n\n\n# システム環境設定\n**Mission Control**\n- Mission Control: F12\n- Application windows: F13\n- Show Desktop: F11\n- Show Dashboard: -\n\n手癖。\n\n**Keyboard**\n\n- Use all F1, F2…\n- ControlとCaps lockを入れ替え\n- Show Spotlight searchのショートカットを`ctrl-A`に\n\nUS配列なのでControlをAの左隣に入れ替える。これも手癖。\n\n**Trackpad**\n\n追加でONにするもの。\n- Tap to click\n\n3本指ドラッグが無いじゃないか! と憤慨しかけたが、ちゃんと機能自体は残っていた。\n\n## Yosemiteでの3本指ドラッグ\nここにあった、よかった。\n\n![Shot](https://qiita-image-store.s3.amazonaws.com/0/17959/6e1785eb-985c-30d6-d8e7-5d0e8c003a8a.png)\n![Screen Shot 2015-05-28 at 2.00.20 PM.png](https://qiita-image-store.s3.amazonaws.com/0/17959/da7024d4-448d-8ff7-8236-bce2a6324774.png)\n\n# Xcode command line developer tools\n\n## 認証\nXcodeのインストールが終わったので続き。Xcodeのライセンス認証はTerminalで。\n\n```\nsudo xcodebuild -license\n```\n\n```\nBy typing 'agree' you are agreeing to the terms of the software license agreements. Type 'print' to print them or anything else to cancel, [agree, print, cancel] \n```\n\n何度か`space`連打して、これが表示されたら`agree`と入力。\n\n## command line developer tools\n\n```\nxcode-select --install\n```\n\ncommand line developer toolsをインストール、しばし待つ。インストールが完了したら確認。\n\n```\ngit --version\n# 2.3.2\n```\n\n# Homebrew\nHomebrewを入れる。コマンドはおなじみのやつ。\n\n```\nruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n\nbrew -v\n# Homebrew 0.9.5\n```\n\n```\nbrew doctor\nbrew update\n```\n\n`doctor`, `update`は慣習だが、真っさらなので何も起こらなかった（珍しい）。\n\n# Ansible\n\n今回、@t_wada氏の『[Mac の開発環境構築を自動化する (2015 年初旬編)](http://t-wada.hatenablog.jp/entry/mac-provisioning-by-ansible)』を実践すべくこの記事を書いているため、Ansibleに初挑戦する。\n\n```\nbrew install ansible\nansible --version\n# ansible 1.9.1\n```\n\n# 自動化開始\n\n元の記事に従ってプロビジョニング用のディレクトリを作る。\n\n```\nmkdir .mac-provisioning; cd $_\n```\n\n## inventoryファイル作成\nansible用のinventoryファイル（実行対象ホスト指定ファイル）を作る。この辺も元の記事に従う。\n\n```\necho 'localhost' \u003e hosts\n```\n\n## playbookファイル作成\n次にplaybook（プロビジョニングの内容）を書く…って、ずっと元記事をなぞってますよ。これは面倒だったので旧Macの方で作成。\n\n```yaml:localhost.yml\n- hosts: localhost\n  connection: local\n  gather_facts: no\n  sudo: no\n  vars:\n    homebrew_taps:\n      - caskroom/cask\n    homebrew_packages:\n      - { name: nodebrew }\n      - { name: ansible }\n      - { name: git }\n      - { name: zsh, install_options: disable-etcdir }\n      - { name: wget }\n      - { name: curl }\n      - { name: tree }\n      - { name: phantomjs }\n    homebrew_cask_packages:\n      - { name: 0xed }\n      - { name: mongochef }\n      - { name: atom }\n      - { name: clamxav }\n      - { name: cleanarchiver }\n      - { name: cyberduck }\n      - { name: daisydisk }\n      - { name: easyfind }\n      - { name: firefox }\n      - { name: flux }\n      - { name: google-chrome }\n      - { name: google-japanese-ime }\n      - { name: imageoptim }\n      - { name: iterm2 }\n      - { name: kobito }\n      - { name: skim }\n      - { name: skype }\n      - { name: slack }\n      - { name: teamviewer }\n      - { name: timemachineeditor }\n      - { name: vagrant }\n      - { name: virtualbox }\n\n  tasks:\n    - name: add tap repos\n      homebrew_tap: tap={{ item }} state=present\n      with_items: homebrew_taps\n\n    - name: update homebrew\n      homebrew: update_homebrew=yes\n\n    # brew\n    - name: install brew packages\n      homebrew: \u003e\n        name={{ item.name }}\n        state={{ item.state | default('latest') }}\n        install_options={{\n          item.install_options | default() | join(',')\n          if item.install_options is not string\n          else item.install_options\n        }}\n      with_items: homebrew_packages\n      register: brew_result\n    - name: make package info dir\n      file: path=brew_info state=directory\n    - name: save package info\n      shell: brew info {{ item }} \u003e brew_info/{{ item }}\n      with_items: brew_result.results | selectattr('changed') | map(attribute='item') | map(attribute='name') | list\n\n    # cask\n    - name: install homebrew-cask\n      homebrew: name=brew-cask state=latest\n    - name: install packages\n      homebrew_cask: name={{ item.name }} state={{ item.state|default('installed') }}\n      with_items: homebrew_cask_packages\n      register: cask_result\n    - name: make package info dir\n      file: path=cask_info state=directory\n    - name: save package info\n      shell: brew cask info {{ item }} \u003e cask_info/{{ item }}\n      with_items: cask_result.results | selectattr('changed') | map(attribute='item') | map(attribute='name') | list\n\n    # oh-my-zsh\n    - name: install oh-my-zsh\n      shell: curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh\n      args:\n        creates: ~/.oh-my-zsh/\n\n  handlers:\n    - name: run fc-cache\n      shell: fc-cache -vf\n```\n\nGUI依存率高し、黒い画面に詳しくないのでこんな量。オススメがあったら教えてください。\n\n## 実行\n\n```\nHOMEBREW_CASK_OPTS=\"--appdir=/Applications\" ansible-playbook -i hosts -vv localhost.yml\n```\n\nあとは:coffee:しながら眺める。`HOMEBREW_CASK_OPTS`は入れたほうがいいみたいだ。Caskのインストール先が`~/Applications`にならないようにするため。\n\n## いくつかコケてた\nCaskでコケてるのがあった。もう今回は原因追求せず手動で入れることにした。\n\n# nodebrew\n\nフロントエンドで`node`必須なので。Node.js, io,jsのバージョン管理は[nodebrew](https://github.com/hokaccha/nodebrew)で行う。\n\n```\nnodebrew ls-remote\n# 最新版のバージョンを確認\nnodebrew install-binary v0.12.4\nnodebrew install-binary io@v2.1.0\nnodebrew use io@v2.1.0\n\nnode -v\n# v2.1.0\n# パスは通っている前提\n```\n\n## npm i -g\n\n```\nnpm i -g npm\nnpm i -g babel browserify mocha fixpack\n```\n\n`npm i -g`は、あまり入れない。\n\n# 残りは手作業\nあとはどうしても手作業的な部分があるので、それはチマチマと。今回の自動化も詳しく分かっていないまま試みているので詰めが甘いかもしれない。\n\nしかしこれは早い、Homebrew Caskは是非ともオススメしたい。かつては各種サイトからインストーラをダウンロードして個別に展開していたので隔世の感がある。\n\n---\n\nこういったプロビジョニングを見直し育てることもまた楽しみのひとつだ。あとはこの新しい相棒と共に励み、戦い、稼ぐだけである。以上。\n","coediting":false,"created_at":"2015-05-28T16:04:40+09:00","id":"8a8c35dfe3b943632ca7","private":false,"tags":[{"name":"OSX","versions":["10.10.3"]},{"name":"homebrew","versions":["0.9.5"]},{"name":"Ansible","versions":["1.9.1"]}],"title":"俺流MacBook Proインストールまとめ","updated_at":"2015-05-28T16:04:40+09:00","url":"http://qiita.com/armorik83/items/8a8c35dfe3b943632ca7","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003eこんにちは、\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。私のAngularJS歴は2年弱で、これまでAngularJSに関する記事はQiitaにたくさん書いてきました。例えば次のような記事です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"http://qiita.com/armorik83/items/b00818ecaf2e93734b36\"\u003eAngularJSアンチパターン集\u003c/a\u003e 2014.9\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://qiita.com/armorik83/items/72f12cb3a6f040fb8364\"\u003eここらでDirective Scopeの@=\u0026amp;をまとめておきたいと思う\u003c/a\u003e 2014.9\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://qiita.com/armorik83/items/0778d757c46e953f3fdf\"\u003eTypeScriptで書くAngularJSのMVC\u003c/a\u003e 2014.2\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://qiita.com/armorik83/items/38fe685cc76163c7e8ce\"\u003eAngularJS Directiveの処理順を網羅してみた\u003c/a\u003e 2014.12\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e他にもニッチなものやイマイチだったものも含めてけっこうな数となってきました。また、こういった記事の縁で勉強会でも登壇させて頂きました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"http://www.slideshare.net/armorik83/angularjs-141206\"\u003eモダンAngularJS\u003c/a\u003e 2014.12 GDG中国\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://www.slideshare.net/armorik83/gdgkobe-angularjs-2\"\u003eTypeScriptで書くAngularJS\u003c/a\u003e 2014.8 GDG神戸\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://www.slideshare.net/armorik83/angular3-gdgkobe150429\"\u003eイベント駆動AngularJS\u003c/a\u003e 2015.4 GDG神戸\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eたくさん書いてくると、古い記事は粗が目立ち、そして世界の技術からみても鮮度が落ちていくため、どうしても有用性が失われていきます。そこで今回改めてこれまでのけじめとして、そして控えているAngular 2を捉えながら2015年にAngularJS 1.xをどう書いていくべきか、まとめていきます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eおことわり\u003c/strong\u003e: 客観的に見てベストプラクティスと呼ぶには個人的な好みが含まれすぎているため、モダンプラクティスと称しています。以下の書き方や使い方は、AngularJSが公式に強制または推奨しているものではなく、個人的にAngular 2を考慮して提案しているものです。ご了承ください。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e執筆時点\u003c/strong\u003e: 本稿は2015年5月に執筆しています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAngularJS: \u003ccode\u003e1.3.15\u003c/code\u003e、1.4に言及する時は\u003ccode\u003e1.4.0-rc.2\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eAngular 2: \u003ccode\u003e2.0.0-alpha.24\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eBabel: 最新版\u003c/li\u003e\n\u003cli\u003eTypeScript: \u003ccode\u003e1.5.0-beta\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"0-イントロダクション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#0-%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e§0 イントロダクション\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"現状の何に問題があるのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8F%BE%E7%8A%B6%E3%81%AE%E4%BD%95%E3%81%AB%E5%95%8F%E9%A1%8C%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e現状の何に問題があるのか\u003c/h2\u003e\n\n\u003cp\u003eヒトコトで言うと、\u003ca href=\"https://angular.io/\"\u003eAngular 2\u003c/a\u003eのリリースが控えている、これが障壁とされます。AngularJSは素敵なライブラリです。ただ出るのが少し早すぎたか、開発陣がこのユーザ規模を想定していなかったか、多くの粗を探され多くの後発と比較されました。Angular 2はここに挑戦しており改革に大きな痛みを伴っています。\u003c/p\u003e\n\n\u003cp\u003e「AngularJSはAngular 2と互換性がほとんど無いんだろ?」\u003cbr\u003e\n「今から始めるならReactを…」\u003cbr\u003e\n「jQueryの方が知ってるし簡単にできる」\u003c/p\u003e\n\n\u003cp\u003e有り得る意見です。でもちょっとまって、AngularJSに対して誤解がありませんか。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"対象読者\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E8%B1%A1%E8%AA%AD%E8%80%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対象読者\u003c/h2\u003e\n\n\u003cp\u003eこの記事は、既にAngularJSをたくさん書いている方々、ちょっと始めてみたけど今のうちに止めた方がいい?と不安になってる方々など、幅広く現在のAngularJSユーザに向けて書いています。ただ、申し訳ありませんが全く使ったことのない方に対する第一歩の手引きとはなっておりません、ご了承ください。\u003c/p\u003e\n\n\u003cp\u003e以下の章からは、AngularJSをどう書いていくべきかを具体的に述べます。幅広い力量に向けて対象にしているため、どうしても長めになっております。序文で自分は知っている話題だと感じたら次々と読み飛ばしてもらって構いません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"オススメ度\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%82%B9%E3%82%B9%E3%83%A1%E5%BA%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオススメ度\u003c/h2\u003e\n\n\u003cp\u003e各節には、習熟度や利便性などから筆者が独断で表現したオススメ度を表示していますので、ご参考にしてください。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e★★★: AngularJS習熟度に関わらずお勧めしたい内容\u003c/li\u003e\n\u003cli\u003e★★☆: AngularJSに対して多少の経験があり、困難とも遭遇している方向け\u003c/li\u003e\n\u003cli\u003e★☆☆: AngularJSをより使いこなし、最新のJavaScriptの潮流も勘案しておきたい方向け\u003c/li\u003e\n\u003cli\u003e☆☆☆: 筆者による挑戦的で実験的な内容、お勧めはしませんが参考までに\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1-class構文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-class%E6%A7%8B%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e§1 Class構文\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"es6が近づいている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#es6%E3%81%8C%E8%BF%91%E3%81%A5%E3%81%84%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eES6が近づいている\u003c/h2\u003e\n\n\u003cp\u003eES6をご存知でしょうか。ES6のESとは\u003ca href=\"http://ja.wikipedia.org/wiki/ECMAScript\"\u003eECMAScript\u003c/a\u003eの略称で、これは我々がJavaScriptと呼んでいる言語の正式な標準規格のことです。JavaScriptといっても実際にはブラウザ毎に差異があるため、標準化が必要となりました。\u003c/p\u003e\n\n\u003cp\u003eES6は簡単に言うとJavaScriptの次世代規格ということです。\u003c/p\u003e\n\n\u003cp\u003e現在の最新ブラウザは全てESのバージョン5をサポートしていますが、\u003ca href=\"https://kangax.github.io/compat-table/es6/\"\u003eES6の仕様を全て満たすブラウザはまだ現れていません\u003c/a\u003e。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://yoshiko-pg.github.io/slides/20150425-jsfes/\"\u003eHELLO, ES6 〜これから迎えるJSのミライ〜\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eES6は、ES5と比べて簡便に記述するための新構文が多く含まれているほか、新しいAPIも複数追加されています。Angular 2はTypeScriptでの使用を前提に開発されており（従わずにES5やCoffeeで書くこともできます）ES6についての知識もぜひ知っておくべきです。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"typescriptとes6の関係\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#typescript%E3%81%A8es6%E3%81%AE%E9%96%A2%E4%BF%82\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTypeScriptとES6の関係\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"http://www.typescriptlang.org/\"\u003eTypeScript\u003c/a\u003eとはプログラミング言語のひとつで、バージョンは執筆時点で1.5.0-beta\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"stableは1.4.1ですが、標準でインストールされる最新バージョンが1.5.0-betaとなっています。\"\u003e1\u003c/a\u003e\u003c/sup\u003eです。TypeScriptはJavaScriptのスーパーセット言語として策定されており、早くから「ES6の構文で書いてブラウザで動作するJavaScriptを生成する」というアプローチを取っていました。Angular 2はこの\u003ca href=\"http://blogs.msdn.com/b/typescript/archive/2015/03/05/angular-2-0-built-on-typescript.aspx\"\u003eTypeScriptで開発され\u003c/a\u003e、ユーザがAngular 2を用いる際にもTypeScriptで書けるよう設計されています。\u003c/p\u003e\n\n\u003cp\u003eTypeScriptはES6の構文を積極的に採用しているため、ES6の知識とTypeScriptの知識は重複する部分が多いです。そしてもちろん最大の特徴はコンパイラによる静的型検証です。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"babel\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#babel\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBabel\u003c/h3\u003e\n\n\u003cp\u003eTypeScriptを使う方法以外に、ES6構文を含むJavaScriptをES5で動くように変換するトランスパイラというものがあります。そのうちのひとつの\u003ca href=\"https://babeljs.io/\"\u003eBabel\u003c/a\u003eは開発がとても盛んで、\u003ca href=\"https://babeljs.io/repl/#?experimental=false\u0026amp;evaluate=false\u0026amp;loose=false\u0026amp;spec=false\u0026amp;playground=true\u0026amp;code=class%20Hello%20%7B%0A%20%20constructor()%20%7B%0A%20%20%20%20this.message%20%3D%20'Hello%20ES6!'%3B%0A%20%20%7D%0A%7D\"\u003e公式サイト内で気軽に試すこともできる\u003c/a\u003e筆者オススメのトランスパイラです。実際の開発では\u003ca href=\"http://gulpjs.com/\"\u003egulp\u003c/a\u003eなどのタスクランナーでBabelの変換処理を自動化して利用します。\u003c/p\u003e\n\n\u003cp\u003eこのほかに、\u003ca href=\"https://github.com/google/traceur-compiler\"\u003etraceur-compiler\u003c/a\u003eというものもあります。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"class構文の例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class%E6%A7%8B%E6%96%87%E3%81%AE%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass構文の例\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"angularjs--class構文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs--class%E6%A7%8B%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS + Class構文\u003c/h3\u003e\n\n\u003cp\u003e次の例は、実際に\u003ca href=\"https://github.com/likr/interactive-sem\"\u003e業務でAngularJSを用いて書いたコード\u003c/a\u003eを見本用に整形したものです。Class構文はES6からの大きな特徴で、不慣れな方には別言語に見えるかもしれません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003econtroller.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$rootScope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$timeout\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edisposer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edisposer\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edisposer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eStore\u003c/span\u003e   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estoreChangeHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edisposer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erenderer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erendererChangeHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// snip\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"angular-2でのclass構文の使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular-2%E3%81%A7%E3%81%AEclass%E6%A7%8B%E6%96%87%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngular 2でのClass構文の使い方\u003c/h3\u003e\n\n\u003cp\u003e次の例はAngular 2チュートリアルの断片です。公式のチュートリアルが最初からClass構文の使用を想定して紹介しているのです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eangular2-example.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c1\"\u003e// snip\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyAppComponent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Alice'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eMyAppComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e@\u003c/code\u003eを使った\u003ca href=\"http://qiita.com/armorik83/items/e3a0ce67f569ddc4b432\"\u003eDecorators構文\u003c/a\u003eを省略していることに気付いた読者もおられるでしょうが、今回は触れません。\u003ca href=\"https://angular.io/docs/js/latest/api/annotations/\"\u003eAngular 2 Annotations\u003c/a\u003eはalpha版で絶賛開発中なため、また日を改めて紹介します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularjsでclass構文を導入する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs%E3%81%A7class%E6%A7%8B%E6%96%87%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJSでClass構文を導入する\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"一番ダメな例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%80%E7%95%AA%E3%83%80%E3%83%A1%E3%81%AA%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e一番ダメな例\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003emainCtrl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"mainCtrl\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eHello, {{user}}!\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e変数\u003ccode\u003emainCtrl\u003c/code\u003eに対して無名関数を与えてControllerを定義する例です。最もやってはいけない書き方。AngularJS 1.3以降はそもそも禁止されたので、さすがにこのコードで運用することはありません。しかしこう書くチュートリアルを見てAngularJSを始められる方が今日も残っている以上、ここに記しておきます。当時このようなチュートリアルを許してしまった開発陣はやや残念です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"scopeは使わない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scope%E3%81%AF%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e$scopeは使わない\u003c/h3\u003e\n\n\u003cp\u003e前項を改善したのが次の例です。よく見る感じになりました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'mainCtrl'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"mainCtrl\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eHello, {{user}}!\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまだ改善箇所があります。minify対策として\u003ccode\u003e['$scope', function($scope){...}]\u003c/code\u003eにしたほうがいい…それも正しいのですが、ここでは『\u003ccode\u003e$scope\u003c/code\u003e自体を使わないこと』がより良い実践でしょう。\u003c/p\u003e\n\n\u003cp\u003e理由は2つあります。ひとつはAngularJS 1.xでClass構文を取り入れていくならば、\u003ccode\u003e$scope\u003c/code\u003eを使わないほうが身軽だから。もうひとつは、Angular 2では\u003ccode\u003e$scope\u003c/code\u003eが廃止されるからです。AngularJS 1.3以降を使うならば\u003ccode\u003e$scope\u003c/code\u003eを使わない選択は十分にメジャー、Angular 2も視野に入れるとそろそろ不安材料ですよ。\u003c/p\u003e\n\n\u003cp\u003eご心配なく、\u003ccode\u003e$scope.$watch\u003c/code\u003eや\u003ccode\u003e$scope.$broadcast\u003c/code\u003eについては§5で扱います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"functionを独立させる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#function%E3%82%92%E7%8B%AC%E7%AB%8B%E3%81%95%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efunctionを独立させる\u003c/h3\u003e\n\n\u003cp\u003e前項から\u003ccode\u003e$scope\u003c/code\u003eを外したものが次の例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'mainCtrl'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"mainCtrl as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eHello, {{main.user}}!\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e$scope\u003c/code\u003eは\u003ccode\u003ethis\u003c/code\u003eになりました。JavaScriptの\u003ccode\u003ethis\u003c/code\u003eはややこしい…そんなことはない、この先にはClass構文が待っています!\u003c/p\u003e\n\n\u003cp\u003eHTML側では、\u003ccode\u003eng-controller\u003c/code\u003eは\u003ccode\u003e\"mainCtrl as main\"\u003c/code\u003eとなりました。\u003ccode\u003eas\u003c/code\u003eは\u003ccode\u003eコントローラ名 as コントローラを格納する変数名\u003c/code\u003eというAngularJSの独自構文です。\u003ccode\u003econtrollerAs\u003c/code\u003eというAPIも今後出てくるので、あわせて覚えておきましょう。\u003c/p\u003e\n\n\u003cp\u003eここから次の改善として、Class構文を導入しやすくするため\u003ccode\u003efunction(){}\u003c/code\u003eを外に出します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"class構文を導入する準備が整った\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class%E6%A7%8B%E6%96%87%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B%E6%BA%96%E5%82%99%E3%81%8C%E6%95%B4%E3%81%A3%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass構文を導入する準備が整った\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003efunction mainCtrl()\u003c/code\u003eとして外に切り出しました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003emainCtrl\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'mainCtrl'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emainCtrl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"mainCtrl as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eHello, {{main.user}}!\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eangular\u003c/code\u003eへの登録では\u003ccode\u003e.controller('mainCtrl', mainCtrl)\u003c/code\u003eと指定します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"class化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass化\u003c/h3\u003e\n\n\u003cp\u003eあとは\u003ccode\u003eclass\u003c/code\u003e構文を用いて一気にいきましょう。Class名は慣習として大文字で始まるので、Controller名を小文字から始めているならば、この際直してもよいでしょう。\u003ccode\u003eCtrl\u003c/code\u003eは最近だと\u003ccode\u003eController\u003c/code\u003eと書く例をよく見かけます。Angular 2の例だと\u003ccode\u003eFooComponent\u003c/code\u003eや\u003ccode\u003eFooCmp\u003c/code\u003eと安定していません。（追記: 先日Angular 2開発者から直々に貰ったサンプルでは\u003ccode\u003eComponent\u003c/code\u003eとなっていました）\u003c/p\u003e\n\n\u003cp\u003e非Controller・非Componentと混同したくないため、個人的には\u003ccode\u003eMain\u003c/code\u003eとせず\u003ccode\u003eMainController\u003c/code\u003eとします。ここは好みですので、チーム内規約などに沿って進めてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'MainController'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainController as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eHello, {{main.user}}!\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"http://jsfiddle.net/8gvc02ju/\"\u003e実際に動作するサンプル\u003c/a\u003eです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eas\u003c/code\u003e以下は変数名なので、そのままにしています。DIアノテーション（minify対策）は、次の節にて説明します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"いくつかのメソッドがある場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいくつかのメソッドがある場合\u003c/h2\u003e\n\n\u003cp\u003e複数のメソッドがあった場合にどうClass構文を導入していくか、補足しておきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"scopeにいくつかのメソッドがある例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scope%E3%81%AB%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E3%81%82%E3%82%8B%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e$scopeにいくつかのメソッドがある例\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoCtrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditedTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esaveEdits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/controllers/todoCtrl.js\"\u003eTodoMVC\u003c/a\u003eを例に取り上げます。\u003ccode\u003e$scope\u003c/code\u003eに\u003ccode\u003efunction\u003c/code\u003eがたくさん生えたよくある構造です。これをES6 Class化していきましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"メソッドとプロパティで分ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%A8%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%A7%E5%88%86%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメソッドとプロパティで分ける\u003c/h3\u003e\n\n\u003cp\u003eまず\u003ccode\u003e$scope\u003c/code\u003eのプロパティに格納されるものが関数型かそれ以外かで分けます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoCtrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditedTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// 以下は関数型、Classのメソッドとなる\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esaveEdits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"classを用意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClassを用意する\u003c/h3\u003e\n\n\u003cp\u003e次に\u003ccode\u003eclass\u003c/code\u003eを用意します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026lt;- ここに同じものを\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// それぞれ保持\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoCtrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026lt;- 使うService名はconstructorへ\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditedTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esaveEdits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003econstructor\u003c/code\u003eの引数はDIするService名です。TypeScriptの場合だとconstructorの引数名の前に\u003ccode\u003epublic\u003c/code\u003eなど\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" title=\"privateでも可。\"\u003e2\u003c/a\u003e\u003c/sup\u003eと書くことでthisへの格納を省略できます。ES6ならば律儀に書く必要があります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"プロパティをconstructorへ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%82%92constructor%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロパティをconstructorへ\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// +\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditedTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// +\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoCtrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esaveEdits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e関数以外の\u003ccode\u003e$scope\u003c/code\u003eプロパティは全て\u003ccode\u003econstructor\u003c/code\u003eに移します。\u003ccode\u003e$scope\u003c/code\u003eは\u003ccode\u003ethis\u003c/code\u003eに書き換えます。\u003c/p\u003e\n\n\u003cp\u003eTypeScriptだと次のように書くことができます。型情報は省略していますので、本来は型も記述します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// この辺がちょっと違う\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eeditedTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"kr\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// publicと付けるとthis代入を省略できる\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// noop\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoCtrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esaveEdits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"scope関数をメソッドへ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scope%E9%96%A2%E6%95%B0%E3%82%92%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e$scope関数をメソッドへ\u003c/h3\u003e\n\n\u003cp\u003e最後に\u003ccode\u003e$scope\u003c/code\u003eの各関数をClassのメソッドとして書き換えます。この時、出てくる\u003ccode\u003e$scope\u003c/code\u003eを\u003ccode\u003ethis\u003c/code\u003eに置き換えることを忘れずに。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditedTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eeditTodo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003esaveEdits\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etodo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eひとつだけ例として\u003ccode\u003eaddTodo()\u003c/code\u003eの中身を書いてみます。\u003ca href=\"https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/controllers/todoCtrl.js#L32-L50\"\u003e元ソースはこちら\u003c/a\u003e。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrim\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ecompleted\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esaving\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003efinally\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esaving\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e要注意ポイントとして、\u003ccode\u003e$scope\u003c/code\u003eを\u003ccode\u003ethis\u003c/code\u003eに置き換えるならば、\u003ccode\u003ethis\u003c/code\u003eの束縛を揃えるために\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/arrow_functions\"\u003eアロー関数\u003c/a\u003eを使う必要があります。ES6の新構文であるアロー関数は単なる\u003ca href=\"https://ja.wikipedia.org/wiki/%E7%B3%96%E8%A1%A3%E6%A7%8B%E6%96%87\"\u003e糖衣構文\u003c/a\u003eではなく\u003ccode\u003ethis\u003c/code\u003eの束縛を上のブロックと揃える大事な性質があります。ES6でもTypeScriptでも使え、なにより短くて済むので積極的に採用したい構文です。\u003c/p\u003e\n\n\u003cp\u003e変数宣言\u003ccode\u003evar\u003c/code\u003eは、筆者は\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/let\"\u003e\u003ccode\u003elet\u003c/code\u003e#\u003c/a\u003eや\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/const\"\u003e\u003ccode\u003econst\u003c/code\u003e#\u003c/a\u003eに積極的に置き換えています。この2つもES6から導入された新たな仕様です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"diアノテーションを記述\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#di%E3%82%A2%E3%83%8E%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E8%A8%98%E8%BF%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDIアノテーションを記述\u003c/h3\u003e\n\n\u003cp\u003eよく言及される話題で、ユーザ間では\u003cstrong\u003eminify対策\u003c/strong\u003eとも呼ばれます。AngularJSでは各Service, Controllerで使う別のServiceを列挙する必要があり、これを欠かすとminify変換時に正常に動作しなくなる問題が存在します。\u003c/p\u003e\n\n\u003cp\u003eDIアノテーションを自動で付与してくれるツール\u003ca href=\"https://github.com/olov/ng-annotate\"\u003eng-annotate\u003c/a\u003eを使ってもよいです。ただしAngular 2ではDIの仕組みが変わり機械的な記述がしにくい構造となったため、AngularJS 1.xでも手書きでよいと考えています。Angular 2に関しては\u003ca href=\"https://angular.io/docs/js/latest/api/di_annotations/Inject-class.html\"\u003e\u003ccode\u003e@Inject\u003c/code\u003eアノテーション\u003c/a\u003eなどを参照してください。\u003c/p\u003e\n\n\u003cp\u003eAngularJSにおけるDIアノテーションは、\u003ccode\u003e自身のClass名.$inject\u003c/code\u003eで記述できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etodoCtrl.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eTodoController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$routeParams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$filter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enewTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eeditedTodo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eTodoController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$inject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'$scope'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'$routeParams'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'$filter'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'store'\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eaddTodo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれで\u003ccode\u003e$scope\u003c/code\u003eに\u003ccode\u003efunction\u003c/code\u003eがたくさん生えたControllerをClass化できました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-directive指向\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-directive%E6%8C%87%E5%90%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e§2 Directive指向\u003c/h1\u003e\n\n\u003cp\u003e本章では、前章でClass構文を導入したControllerからDirectiveに切り替えていく方法について解説します。\u003c/p\u003e\n\n\u003cp\u003eDirectiveというと「AngularJSの中でも複雑で難しいやつ」とか「入れ子にすると混乱する」などの意見をよく目にしますが、恐れることはありません。これから挙げるAPI以外は\u003cstrong\u003e無視しても大丈夫です\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003eそして重要なのは、Angular 2はComponent指向で、Angular 2 Component ≒ AngularJS 1 Directiveだということです。\u003ccode\u003eng-controller\u003c/code\u003eはAngular 2では\u003cstrong\u003e廃止されます\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使うapi\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%86api\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使うAPI\u003c/h2\u003e\n\n\u003cp\u003eここでいうAPIとはDDO - \u003ca href=\"https://docs.angularjs.org/api/ng/service/%24compile#directive-definition-object\"\u003eDirective Definition Object\u003c/a\u003eのプロパティのことを指します。使わないAPIの方が多いです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003erestrict\u003c/code\u003e: 基本的に\u003ccode\u003eE\u003c/code\u003eのみ、稀に\u003ccode\u003eA\u003c/code\u003e、あとは不要\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003etemplateUrl\u003c/code\u003e: HTMLが1行程度と短ければ\u003ccode\u003etemplate\u003c/code\u003eプロパティを使ってもよい\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003escope\u003c/code\u003e: \u003cstrong\u003eIsolate scope\u003c/strong\u003eを生成させるため常に\u003ccode\u003e{...}\u003c/code\u003eで記述する\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003econtroller\u003c/code\u003e: \u003ccode\u003econtrollerAs\u003c/code\u003eも併記すること\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebindToController\u003c/code\u003e: 1.4.0以降ならば\u003ccode\u003escope\u003c/code\u003eより扱いの楽なこちらが便利\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eあとは覚える必要がないです。ここで、AngularJSのDirectiveをフル活用している方からは疑問が上がるかもしれません。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"compile-linkはどうするの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#compile-link%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecompile, linkはどうするの?\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eQ.\u003c/strong\u003e \u003ccode\u003ecompile\u003c/code\u003e, \u003ccode\u003elink\u003c/code\u003eを多用していますが不要ですか?\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e Angular 2ではこのフック方法が変更されるので、依存しすぎないよう注意してください。\u003ccode\u003ecompile\u003c/code\u003e, \u003ccode\u003eprelink\u003c/code\u003e, \u003ccode\u003epostlink\u003c/code\u003eの移行方法は現時点（2015/5）では明示されていませんが、ソースを読む限りAngularJSと同等のAPIは提供されないことが分かっています。Angular 2はDOMの直接書き換えを推奨していないので、こうなっているのかもしれません。\u003c/p\u003e\n\n\u003cp\u003eもし\u003ccode\u003ecompile\u003c/code\u003e内でjQueryを多用している場合、慎重に置き換える必要があります。jQueryとの付き合い方は§4にて後述します。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"requireはどうするの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#require%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erequireはどうするの?\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eQ.\u003c/strong\u003e \u003ccode\u003erequire\u003c/code\u003eで親Directive Controllerに依存しています。\u003ccode\u003elink\u003c/code\u003eが廃止されると困りますが、どうすればいいですか?\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e Angular 2では\u003ca href=\"https://angular.io/docs/js/latest/api/annotations/Parent-class.html\"\u003e\u003ccode\u003e@Parent\u003c/code\u003e#\u003c/a\u003eや\u003ca href=\"https://angular.io/docs/js/latest/api/annotations/Ancestor-class.html\"\u003e\u003ccode\u003e@Ancestor\u003c/code\u003e#\u003c/a\u003eといった新しいアノテーションが採用されます。このAPIを活用することを念頭において、\u003ccode\u003elink\u003c/code\u003e内ではあまり複雑なことをせず、さっさとControllerに渡すのが賢明です。\u003c/p\u003e\n\n\u003cp\u003e筆者の例を掲載します。（TypeScriptで実装していたので、例もTypeScriptです）\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/likr/interactive-sem/blob/master/app/src/views/dialogs/add-latent-variable.ts#L83-L89\"\u003ehttps://github.com/likr/interactive-sem/blob/master/app/src/views/dialogs/add-latent-variable.ts#L83-L89\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eScope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e__\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003econtrollers\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// controllers引数にはrequire配列と同じ順序で格納されている\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ecwModal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtrollers\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtrollers\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edialog\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecwModal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edialog\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのときはダイアログのプラグインを使っていたので、そのインスタンスを取得する必要がありました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Controller'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'^cwModal'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edirectiveName\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026lt;- requireを配列にする\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'E'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elocale\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u0026amp;isemIoLocale'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etemplateUrl\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eviewsDir\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edialogs\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'add-latent-variable.html'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのように\u003ccode\u003erequire\u003c/code\u003eを\u003ccode\u003eArray\u0026lt;string\u0026gt;\u003c/code\u003e型の配列にすることで、複数のControllerを指定できます。この時自身のDirective名（ここでは\u003ccode\u003edirectiveName\u003c/code\u003e変数に格納済）を与えると自身のControllerが取得できるのです。\u003c/p\u003e\n\n\u003cp\u003eDirective Controllerの生成タイミングは\u003ccode\u003elink\u003c/code\u003e実行\u003cstrong\u003e前\u003c/strong\u003eなので、別途\u003ccode\u003elink\u003c/code\u003eから\u003ccode\u003einit()\u003c/code\u003eを呼んで初期化処理のタイミングを\u003ccode\u003elink\u003c/code\u003e実行後にさせています。\u003ccode\u003elink\u003c/code\u003e関数内とControllerを繋ぐ手段が\u003ccode\u003e$scope\u003c/code\u003e (Isolate scope)なので、\u003ccode\u003e$scope.dialog = cwModal.dialog;\u003c/code\u003eとして渡します。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★☆☆\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"restrictはeのみ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#restrict%E3%81%AFe%E3%81%AE%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erestrictはEのみ?\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eQ.\u003c/strong\u003e restrictは\u003ccode\u003eA, C, E, M\u003c/code\u003eの4種とそれらの組み合わせですが、\u003ccode\u003eE\u003c/code\u003e以外は使いませんか?\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e はい、基本的には\u003ccode\u003eE\u003c/code\u003eしか使わないと覚えてください。\u003ccode\u003erestrict\u003c/code\u003e APIは不必要に混乱を招いたと考えています。\u003c/p\u003e\n\n\u003cp\u003eそもそも各所で喧伝されている4種のうち\u003ccode\u003eM\u003c/code\u003eはドキュメントから省かれています（APIとしては現存）。そして\u003ccode\u003eC\u003c/code\u003eの用途ですが、これはIE8以前の非HTML5に対応するためのもので、現代では不必要となっています。\u003c/p\u003e\n\n\u003cp\u003e残る\u003ccode\u003eA, E\u003c/code\u003eについては、基本的には\u003cstrong\u003eタグ名をDirectiveとする\u003c/strong\u003e\u003ccode\u003eE\u003c/code\u003eを使えば間違いなく、より応用的にDirectiveを利用する場合のみ属性名をDirectiveとする\u003ccode\u003eA\u003c/code\u003eを考慮してもよいでしょう。\u003ccode\u003eAE\u003c/code\u003eという同時指定はプロジェクト内検索を困難にしチーム内にも混乱をもたらすため、使うべきではありません。\u003c/p\u003e\n\n\u003cp\u003eAngular 2では\u003ccode\u003erestrict\u003c/code\u003eは廃止され\u003ca href=\"https://angular.io/docs/js/latest/api/annotations/Component-class.html\"\u003e\u003ccode\u003e@Component\u003c/code\u003e#\u003c/a\u003eと\u003ca href=\"https://angular.io/docs/js/latest/api/annotations/Directive-class.html\"\u003e\u003ccode\u003e@Directive\u003c/code\u003e#\u003c/a\u003eに分かれ\u003ccode\u003eselector\u003c/code\u003eプロパティで指定するため、明確となっています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eE\u003c/code\u003e: タグ名 -\u0026gt; Angular 2では\u003ccode\u003e@Component\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eA\u003c/code\u003e: 属性名 -\u0026gt; Angular 2では\u003ccode\u003e@Directive\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAE\u003c/code\u003e: 使わない!\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eC\u003c/code\u003e: 使わない!\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"replaceは使ってもいいですか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#replace%E3%81%AF%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%82%E3%81%84%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ereplaceは使ってもいいですか?\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eQ.\u003c/strong\u003e Directive自身を\u003ccode\u003etemplate\u003c/code\u003eと置換してレンダリングする\u003ccode\u003ereplace\u003c/code\u003eは使ってもいいですか?\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e \u003ca href=\"https://github.com/angular/angular.js/blob/bab474aa8b146f6732857c3af1a8b3b010fda8b0/src/ng/compile.js#L300\"\u003eDEPRECATED\u003c/a\u003eです、使うべきではありません。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003esvg\u003c/code\u003e内では独自タグ名が使えないため\u003ccode\u003ereplace\u003c/code\u003eを採用されることがあるかもしれません。廃止は次期メジャーバージョンとされていますが、今のうちからDEPRECATEDだと意識しておくとよいでしょう。\u003ccode\u003esvg\u003c/code\u003e内で自作のDirectiveを適用したい際には、\u003ccode\u003erestrict: A\u003c/code\u003eに設定した上で工夫してください。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★☆☆\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"isolate-scopeとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#isolate-scope%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIsolate scopeとは?\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eQ.\u003c/strong\u003e Isolate scopeとは何ですか? \u003ccode\u003escope\u003c/code\u003eの指定は\u003ccode\u003e@=\u0026amp;\u003c/code\u003eなどの指示子があってややこしいです。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e Isolate scopeとは親子でScopeを共有しない\u003cstrong\u003eDirectiveの独立したScope\u003c/strong\u003eのことです。AngularJS公式の提供が複雑でいまいち理解されていませんが、Isolate scope以外を使うべきではありません。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003escope\u003c/code\u003eプロパティには、自身に無ければ親を参照しにいくという複雑極まりない仕様があり、これはグローバル変数が起こす副作用と混乱に等しい問題でした。筆者は「親子共有問題」と呼んでいます。これは\u003ccode\u003econtrollerAs\u003c/code\u003eが普及しプロパティ元が明記されるにつれ緩和しましたが、根本的解決にはなりません。\u003c/p\u003e\n\n\u003cp\u003eこの問題を解決するにはIsolate scope（分離スコープ）を導入します。これは\u003ccode\u003escope: {}\u003c/code\u003eのようにObjectリテラルを与えて使います。この時、値の継承方法として\u003ccode\u003e@=\u0026amp;\u003c/code\u003eという3種の指示子が提供されており、これについては\u003ca href=\"http://qiita.com/armorik83/items/72f12cb3a6f040fb8364\"\u003e以前まとめました\u003c/a\u003e。結論として筆者は\u003ccode\u003e\u0026amp;\u003c/code\u003e以外不要と考えています。\u003c/p\u003e\n\n\u003cp\u003e「\u003ccode\u003e\u0026amp;\u003c/code\u003eはfunction として結び付ける」という解説があり、これではあまりピンときません。そこで「\u003ccode\u003e\u0026amp;\u003c/code\u003eはReadonlyだ」と置き換えれば解釈しやすいでしょう。\u003ccode\u003e\u0026amp;\u003c/code\u003eの対比としてバインド可能な\u003ccode\u003e=\u003c/code\u003eがありますが、これは隠蔽せず共有してしまうので、なるべく使わない方針です。React経験者ならば\u003ccode\u003eprops\u003c/code\u003eに近い一方向のフローと言えばイメージしやすいでしょうか。\u003c/p\u003e\n\n\u003cp\u003eプロジェクト内のDirectiveをIsolate scopeにするならば、全て統一して用いるのがベターです。レガシーなソースに段階的に導入するならば仕方ないのですが、スクラッチで実装する場合は一律でIsolate scopeにした方が、混乱も少なく、後々の拡張性や差し替えを容易にします。ひとつ注意としてプロパティが一つもないDirectiveの場合は\u003ccode\u003escope: {}\u003c/code\u003eと空のObjectを与える必要があります。こうしなかった場合、親子共有されるただのScopeが生成されます。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"scopeの命名は\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scope%E3%81%AE%E5%91%BD%E5%90%8D%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eScopeの命名は?\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eQ.\u003c/strong\u003e \u003ccode\u003escope\u003c/code\u003eはHTML属性名もプロパティ名も同名でかまいませんか?\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e これは注意してください。よく迷うのが\u003ccode\u003escope\u003c/code\u003eの命名です。\u003ccode\u003e{prop: '\u0026amp;'}\u003c/code\u003eと書けば\u003ccode\u003e\u0026lt;mydir prop=\"\"\u0026gt;\u003c/code\u003eのように同名のHTML属性として扱えます。ただし筆者の経験では、プロジェクト内検索の利便性と視認性の両側面から、多少冗長でもプロジェクト毎の接頭辞を付けることをおすすめします。別途、独自プラグインを作成しそのDirectivereの\u003ccode\u003estrict\u003c/code\u003eが\u003ccode\u003eA\u003c/code\u003eだった場合に、その属性名がどのプロジェクト or プラグインに属すのか、混乱が起きやすいのです。\u003c/p\u003e\n\n\u003cp\u003e接頭辞を扱うためには、\u003ccode\u003e{prop: '\u0026amp;myProp'}\u003c/code\u003eといったキャメルケース形式で記述し、使用時は\u003ccode\u003e\u0026lt;mydir my-prop=\"\"\u0026gt;\u003c/code\u003eと記述します。AngularJSでは\u003ccode\u003eng\u003c/code\u003eが用いられていますね。この話題も\u003ca href=\"http://qiita.com/armorik83/items/72f12cb3a6f040fb8364#1-3\"\u003e以前の記事\u003c/a\u003eで触れています。\u003c/p\u003e\n\n\u003cp\u003eAngular 2ではHTML内にAngular独自の構文が導入されるため、判別がつきやすいようになっています。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"bindtocontrollerは使ってもいいですか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bindtocontroller%E3%81%AF%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%82%E3%81%84%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebindToControllerは使ってもいいですか?\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eQ.\u003c/strong\u003e \u003ccode\u003ebindToController\u003c/code\u003eを最近よく見かけますが、使ってもいいですか?\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e はい、積極的に使っていきましょう。ただ個人的には1.3以前で\u003ccode\u003escope\u003c/code\u003eを使っているなら\u003ccode\u003ebindToController\u003c/code\u003eに急いで置き換える必要はないと考えています。余裕があったらついでに、くらいで。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ebindToController\u003c/code\u003eは\u003ccode\u003escope\u003c/code\u003eとよく似たAPIですが、Controllerの\u003ccode\u003e$scope\u003c/code\u003eに格納されず、Controllerの\u003ccode\u003ethis\u003c/code\u003eに直接格納されるという仕組みです。筆者はこの新APIをAngular 2移行への段階的な導入と解釈しています。HTML側で\u003ccode\u003e{{controller.$scope.prop}}\u003c/code\u003eと冗長に書く必要があったところを\u003ccode\u003e{{controller.prop}}\u003c/code\u003eと書ける点がメリットです。\u003c/p\u003e\n\n\u003cp\u003eAngularJS 1.3.0から導入されていたこのAPIは、初期はあまり話題になったと感じていません。1.4.0からは直接\u003ccode\u003ebindToController\u003c/code\u003eにプロパティ\u003ccode\u003e{}\u003c/code\u003eを記述できるようになったため、利便性が向上しました。このAPIの紹介は本稿では煩雑になるため、別の機会にします。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ng-controllerベースからdirectiveベースへ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ng-controller%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89directive%E3%83%99%E3%83%BC%E3%82%B9%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eng-controllerベースからDirectiveベースへ\u003c/h2\u003e\n\n\u003cp\u003eAPIへの理解が整ったところで、\u003ccode\u003eng-controller\u003c/code\u003eから脱却する手順について解説します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'MainController'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainController as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eHello, {{main.user}}!\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e§1の例をベースに進めていきましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"directive-definition-objectの定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#directive-definition-object%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDirective Definition Objectの定義\u003c/h3\u003e\n\n\u003cp\u003eDDO - Directive Definition Objectを返す関数\u003ccode\u003emainDDO()\u003c/code\u003eを定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'E'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Classを与える\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 使わない場合も空ObjectでIsolate scope化\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e次に\u003ccode\u003e\u0026lt;main\u0026gt;\u003c/code\u003eタグの中身を定義する\u003ccode\u003etemplate\u003c/code\u003eを記述しましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"templateの定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#template%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTemplateの定義\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'E'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u0026lt;p\u0026gt;Hello, {{main.user}}!\u0026lt;/p\u0026gt;'\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 追加\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainController as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"c\"\u003e\u0026lt;!-- この\u0026lt;p\u0026gt;をtemplateにする --\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eHello, {{main.user}}!\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIsolate scopeを使うので、\u003ccode\u003etemplate\u003c/code\u003eまたは\u003ccode\u003etemplateUrl\u003c/code\u003eを\u003cstrong\u003e必ず\u003c/strong\u003e導入する必要があります。Isolate scope利用時は、そのDirective内にHTMLを記述することはできません。つまり、\u003ccode\u003e\u0026lt;main\u0026gt;...いろいろ...\u0026lt;/main\u0026gt;\u003c/code\u003eとならず、常に\u003ccode\u003e\u0026lt;main\u0026gt;\u0026lt;/main\u0026gt;\u003c/code\u003eのみとなります。これによって\u003ccode\u003etransclude\u003c/code\u003eオプションも使用できなくなりますが、\u003ccode\u003etransclude\u003c/code\u003eは挙動がとにかく取っ付きづらく、筆者は一度も活用できたことがないので、気にすることはないでしょう。自作Directiveはタグ内に何も書かず、属性とIsolate scopeをインタフェースとして使うものと覚えるとシンプルです。\u003c/p\u003e\n\n\u003cp\u003e筆者は個人的好みで\u003ccode\u003etemplateUrl\u003c/code\u003eを使い、2行以上ならば全てHTMLファイルに記述しています。最近はES6の新構文\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/template_strings\"\u003eTemplate strings\u003c/a\u003eの有用性も認められてきたので、望むならば\u003ccode\u003etemplate\u003c/code\u003eに全てのHTMLを記述するスタイルでも構わないです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"作成したdirectiveをhtmlに導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9Fdirective%E3%82%92html%E3%81%AB%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作成したDirectiveをHTMLに導入\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'E'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u0026lt;p\u0026gt;Hello, {{main.user}}!\u0026lt;/p\u0026gt;'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;main\u0026gt;\u0026lt;/main\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eHTML側を\u003ccode\u003e\u0026lt;main\u0026gt;\u0026lt;/main\u0026gt;\u003c/code\u003eにして完成! お疲れ様でした。\u003ccode\u003eng-controller\u003c/code\u003eから移行するとき、\u003ccode\u003eng-controller=\"as\"\u003c/code\u003eが未導入で\u003ccode\u003e$scope\u003c/code\u003eが入り混じってる状態だと\u003ccode\u003e\u0026lt;main\u0026gt;\u003c/code\u003eが持つIsolate Scopeとごちゃ混ぜになり\u003cstrong\u003eとてもつらい\u003c/strong\u003eので、先に\u003ccode\u003eas\u003c/code\u003eの導入、次にClassへの移行と、順次済ますのが得策です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"compileやlinkはどこに記述するか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#compile%E3%82%84link%E3%81%AF%E3%81%A9%E3%81%93%E3%81%AB%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecompileやlinkはどこに記述するか\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003ecompile\u003c/code\u003e, \u003ccode\u003elink\u003c/code\u003eはAngular 2への移行を阻害するため縮小方向が望ましいですが、いきなり無くすわけにもいきません。筆者はこのケースを次のようにまとめています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainDefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003epostLink\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eiElement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eiAttrs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"kr\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'E'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epostLink\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eddo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003efunctionを並べずにexport classで括った理由は、まとまった単位のほうがテストで扱いやすかったためです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ところでなんでdirectiveがいいの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E3%81%93%E3%82%8D%E3%81%A7%E3%81%AA%E3%82%93%E3%81%A7directive%E3%81%8C%E3%81%84%E3%81%84%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eところでなんでDirectiveがいいの\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eng-controller\u003c/code\u003eはAngular 2で廃止されると述べましたが、なぜ筆者が現段階でDirective化を勧めているか補足しておきます。\u003c/p\u003e\n\n\u003cp\u003eDirective化促進の理由はいくつかあります。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e1.\u003c/strong\u003e テンプレートを小さく保ちたいという動機が大きいです。筆者は長らくJavaScriptよりHTML + PHPを書いてきた背景があり、HTML内のリファクタリングの困難さを痛感していたため、とにかくHTMLの部品は小さく、汎用性を高く、という願いがありました。HTMLの見通しがよくないことは、肥大したHTMLを扱うほど実感されると思います。Bootstrapなどを扱っていて\u003ccode\u003e\u0026lt;div\u0026gt;\u003c/code\u003eが増えすぎることをDirectiveでセマンティックに隠蔽できる利点も大きい。可読性を引き上げ事故を防げるDirective、これを用いない理由はないというのが持論です。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e2.\u003c/strong\u003e 次に、Isolate scopeを積極的に使いたい動機です。前述したようにScopeの親子共有問題というのが厄介で、Child scopeの生成されない要素は、親Scopeではなく兄弟のChild scopeを引き継ぐという\u003ca href=\"http://qiita.com/armorik83/items/38fe685cc76163c7e8ce#scope%E3%81%AF%E3%83%9B%E3%83%B3%E3%83%88%E3%82%84%E3%82%84%E3%81%93%E3%81%97%E3%81%84%E3%81%8B%E3%82%89%E6%B0%97%E3%82%92%E3%81%A4%E3%81%91%E3%82%88%E3%81%86%E3%81%AA\"\u003e不可解な仕様\u003c/a\u003eに悩まされるくらいなら、もう単純明快なIsolate scopeだけ使っていれば混乱しないのでは。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e3.\u003c/strong\u003e そして、やはりAngular 2への移行を段階的にしたい思いがあります。Angular 2はComponent指向で、独自タグと\u003ccode\u003etemplate\u003c/code\u003eを中心にした実装となっていきます。AngularJSとAngular 2の距離を縮めることを考える時、AngularJSのDirective化が整っている方が大幅な設計見直しをせずAngular 2に向けてステップアップできると睨んでいます。\u003c/p\u003e\n\n\u003cp\u003e分割は不便、面倒だと感じる方もおられるでしょうが、モダンなComponent指向のフレームワークならば全てこうなっており、ReactのJSXも同様です。汎用性が上がり、差分管理が容易になることで可読性、保守性も高まる。メリットは大きいです。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3-es6-moduleとangularjs-di\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-es6-module%E3%81%A8angularjs-di\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e§3 ES6 moduleとAngularJS DI\u003c/h1\u003e\n\n\u003cp\u003e本章ではAngularJSの特徴として挙げられるDIを考察し、Angular 2で採用されるES6 moduleについて触れながら、現段階の付き合い方や今後の実践について紹介します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularjsのdiとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs%E3%81%AEdi%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJSのDIとは?\u003c/h2\u003e\n\n\u003cp\u003eDIとはDependency Injectionの略語で、日本語では依存性注入です。かの\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%9E%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%83%BB%E3%83%95%E3%82%A1%E3%82%A6%E3%83%A9%E3%83%BC\"\u003eMartin Fowler\u003c/a\u003eが提唱しました。ディペンデンシー・インジェクションというと大層な感じですが、積極的に実践すべき設計で、特殊なものだと思わないでください。以下はJavaの事情などは含めず「AngularJSにおける」DIの話です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"angularjs-diの例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs-di%E3%81%AE%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS DIの例\u003c/h3\u003e\n\n\u003cp\u003eAngularJS DIの解説によくある\u003ccode\u003econstructor\u003c/code\u003e内で\u003ccode\u003enew\u003c/code\u003eする例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eStore\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erenderer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコードの問題は、テストの際も本物の\u003ccode\u003eStore\u003c/code\u003eと\u003ccode\u003eRenderer\u003c/code\u003eを必要とする点です。\u003ccode\u003eStore\u003c/code\u003eがもし通信を必要とするモジュールならば、テスト毎に待たなければなりません。ここでモック・テストを行うためには、\u003ccode\u003eRootController\u003c/code\u003eに向かって\u003ccode\u003eMockStore\u003c/code\u003eを「注入」する必要があります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"diを導入すると\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#di%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDIを導入すると\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erenderer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003erootController\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eStore\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n  \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003emockRootController\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eMockStore\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n  \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eMockRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003econstructor\u003c/code\u003eに引数を設けるとモックへ差し替える余地が生まれました。DI自体はこれだけのことで簡単に実践できます。AngularJSでは\u003ccode\u003evar rootController = new RootController(...)\u003c/code\u003eに相当する処理を内部でうまいことやってくれるので、そのために必要な定義がDIアノテーション、ということになります。自力で準備、実装することを「オレオレDI」と呼ぶこともあります\u003csup id=\"fnref3\"\u003e\u003ca href=\"#fn3\" title=\"オレオレDIはテスト困難なモジュールに対して暫定的に強引に導入する性質が強く、毎回やるべきではないと考えます。\"\u003e3\u003c/a\u003e\u003c/sup\u003e。\u003c/p\u003e\n\n\u003cp\u003eAngularJSはこのDIを当初から提供したことで疎なテストを行いやすくし、\u003ca href=\"http://karma-runner.github.io/0.12/index.html\"\u003eKarma\u003c/a\u003eや\u003ca href=\"http://angular.github.io/protractor/#/\"\u003eProtractor\u003c/a\u003eの提供をもってテストの重要性を説きました。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularjsのcommonjs採用そしてangular-2へ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs%E3%81%AEcommonjs%E6%8E%A1%E7%94%A8%E3%81%9D%E3%81%97%E3%81%A6angular-2%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJSのCommonJS採用、そしてAngular 2へ\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"commonjs-browserify\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#commonjs-browserify\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCommonJS, Browserify\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://nodejs.org/\"\u003eNode.js\u003c/a\u003eではCommonJSという、1ファイル1モジュールとしてインタフェースや依存性を記述するモジュール管理を採用しています。一方、ブラウザ上ではHTMLに\u003ccode\u003e\u0026lt;script src=\"\"\u0026gt;\u0026lt;/script\u0026gt;\u003c/code\u003eをいくつも並べるローディングが長らく主流で、\u003ccode\u003eCommonJS\u003c/code\u003eはサーバサイドのものという印象が強めでした。\u003c/p\u003e\n\n\u003cp\u003eそれが2014年頃から\u003ca href=\"http://browserify.org/\"\u003eBrowserify\u003c/a\u003e、\u003ca href=\"http://webpack.github.io/\"\u003ewebpack\u003c/a\u003eを用いてブラウザ上でも\u003ccode\u003eCommonJS\u003c/code\u003eスタイルで記述し、HTMLには生成物である\u003ccode\u003e\u0026lt;script src=\"bundle.js\"\u0026gt;\u0026lt;/script\u0026gt;\u003c/code\u003eを1行記述するだけというスタイルも現れ、少しずつ浸透しています。複数回の\u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003eローディングによる通信の遅れを減らせ、\u003ca href=\"https://www.npmjs.com/\"\u003enpm\u003c/a\u003e, \u003ca href=\"http://bower.io/\"\u003eBower\u003c/a\u003eとパッケージ管理が分散せずに簡潔に済むことが利点だと筆者は認識しています。\u003ca href=\"/teppeis\" class=\"user-mention\" title=\"teppeis\"\u003e@teppeis\u003c/a\u003e氏の\u003ca href=\"http://teppeis.hatenablog.com/entry/2015/05/es6-modules-and-http2\"\u003eこちらの記事\u003c/a\u003eも参考になります。\u003c/p\u003e\n\n\u003cp\u003eAngularJSはこれまでCommonJSに対応せず、\u003ccode\u003e\u0026lt;script src=\"angular.js\"\u0026gt;\u003c/code\u003eでの読み込みとグローバル変数\u003ccode\u003eangular\u003c/code\u003eを使って実装する従来のスタイルでした。それが1.3.14からはCommonJSに正式に対応し、次のようなコードで参照できるよう改良されています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'angular'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAngularJSには\u003ccode\u003eangular.module('moduleName', ['requires'])\u003c/code\u003eというAngularJS独自のモジュール機構があります。この機構とCommonJS、そしてAngular 2に採用されるES6 moduleとはどのように付き合っていくべきでしょうか、次の節で解説します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"es6-module\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#es6-module\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eES6 module\u003c/h3\u003e\n\n\u003cp\u003eES6 moduleとはCommonJS module (\u003ccode\u003erequire\u003c/code\u003e, \u003ccode\u003emodule.exports\u003c/code\u003e)の仕組みに近いモジュール機構で、ES6の\u003cstrong\u003e言語レベルで備える\u003c/strong\u003e点が最大の特徴です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecommonjs.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eotherModule\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'other-module'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003emymodule\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ees6.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eotherModule\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'other-module'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003emymodule\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e比較すると概ねこのようになります。厳密にはES6には\u003ccode\u003edefault\u003c/code\u003eなどの仕様が加わるため、全てCommonJSの仕様と一致するわけではありません。TypeScriptでは1.4からES6 moduleの構文で記述が可能となりました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"angularjs-module\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs-module\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS module\u003c/h3\u003e\n\n\u003cp\u003eAngularJSには\u003ccode\u003emodule\u003c/code\u003eや\u003ccode\u003eservice\u003c/code\u003e, \u003ccode\u003edirective\u003c/code\u003e, \u003ccode\u003econtroller\u003c/code\u003e…とても用語が多く用途も似ているので大変混乱しやすいです。\u003c/p\u003e\n\n\u003cp\u003e筆者は次のように考えています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eangular.module()\u003c/code\u003e: アプリケーション名、または提供するプラグイン名（まとめてプロジェクト名と称する）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eangular.module().service()\u003c/code\u003e: そのプロジェクト内の肥大化を避けるために適宜分割する単位\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAngularJS moduleは粒度がだいぶ大きく、これまでに述べたCommonJS/ES6 moduleとは性質が違うので、混同しないよう注意してください。CommonJS/ES6 moduleに相当するものとしてはAngularJS Serviceが近いです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"移行を見据えたangularjsでの考え方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A7%BB%E8%A1%8C%E3%82%92%E8%A6%8B%E6%8D%AE%E3%81%88%E3%81%9Fangularjs%E3%81%A7%E3%81%AE%E8%80%83%E3%81%88%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e移行を見据えたAngularJSでの考え方\u003c/h2\u003e\n\n\u003cp\u003eここまで、AngularJSを取り巻くいくつかのモジュール機構（AngularJS module, CommonJS module, ES6 module）とAngularJSの特徴であるDIを紹介しました。AngularJSのmoduleが先行していたため、後発の仕組みと食い違い、複雑なものとなってしまいました。\u003c/p\u003e\n\n\u003cp\u003e一旦整理し、何をどう扱うか説明しましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"angularjs-moduleはアプリケーション内にひとつ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs-module%E3%81%AF%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%86%85%E3%81%AB%E3%81%B2%E3%81%A8%E3%81%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS moduleはアプリケーション内にひとつ\u003c/h3\u003e\n\n\u003cp\u003e前述のとおり、AngularJS moduleは粒度が大きい単位なので、アプリケーション内でいくつも用いることはアンチパターンだと捉えています。可搬性を考えると、ひとつのアプリケーションにはそのアプリ名を与えた単独のAngularJS moduleで運用すべきです。\u003c/p\u003e\n\n\u003cp\u003e他のユーザにAngularJSプラグインを配布する場合は、ここにはプラグイン名が入ります。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"移行に向けての分割\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A7%BB%E8%A1%8C%E3%81%AB%E5%90%91%E3%81%91%E3%81%A6%E3%81%AE%E5%88%86%E5%89%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e移行に向けての分割\u003c/h3\u003e\n\n\u003cp\u003eAngular 2はES6 moduleを積極的に活用する設計となっており、今からES6 moduleに関心を持つのは良いことです。ただ、今すぐAngularJSをES6 moduleに書き換えるべきかといえばそうとも限りません。いずれAngular 2で適合するように再度修正する作業は発生します。\u003c/p\u003e\n\n\u003cp\u003eただし、各種Service, Controller, Direcitiveを1ファイル内にひとつにしていくリファクタリングは、早めに意識しておくべきです。1ファイル内にいくつも定義している方はAngular 2での移行コストにES6 module導入の手間も加わるので、早めに段階的に分けて備えましょう。\u003c/p\u003e\n\n\u003cp\u003eなお、\u003ccode\u003eangular.module('myApp')\u003c/code\u003eはチェーンにせず毎回書くべきという方針です。筆者の場合、1ファイルに1\u003ccode\u003eangular.module('myApp').*\u003c/code\u003eという方針にしており、1ファイル内にあれこれ定義しません。例外的に複数書くのは\u003ccode\u003eangular.module().run()\u003c/code\u003eと\u003ccode\u003eangular.module().config()\u003c/code\u003eのみです。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"commonjs--browserifyスタイルを好む方は\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#commonjs--browserify%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%82%92%E5%A5%BD%E3%82%80%E6%96%B9%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCommonJS + Browserifyスタイルを好む方は\u003c/h3\u003e\n\n\u003cp\u003eAngularJS 1.3.14からCommonJSが採用されたことで、Browserify\u003csup id=\"fnref4\"\u003e\u003ca href=\"#fn4\" title=\"webpack派はwebpackと読み替えて結構です。\"\u003e4\u003c/a\u003e\u003c/sup\u003eの導入が容易になりました。Browserifyに詳しくない方は無理して導入する必要はありません。そして知識や経験がある方ならば、現時点からCommonJS化、Browserify対応を始めることは間違っていません。\u003c/p\u003e\n\n\u003cp\u003e筆者はBrowserifyに対応したスタイルでAngularJSを\u003ca href=\"https://github.com/likr/interactive-sem/blob/master/app/src/scripts/app.ts#L11\"\u003e書いています\u003c/a\u003e。そして「1ファイル1Service」はそのまま「1ファイル1module\u003csup id=\"fnref5\"\u003e\u003ca href=\"#fn5\" title=\"CommonJSのmoduleを指します。\"\u003e5\u003c/a\u003e\u003c/sup\u003e」と置き換えられるので、Service自体を一切使わないようになりました。\u003ccode\u003eangular.module().service()\u003c/code\u003eや\u003ccode\u003e.factory()\u003c/code\u003eを使うことでAngularJS DIを利用できるというメリットは、\u003ca href=\"http://qiita.com/armorik83/items/46781adda80e9d53f7ee\"\u003eproxyquire\u003c/a\u003eを使うことで保っています。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★☆☆\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"proxyquireの実験\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#proxyquire%E3%81%AE%E5%AE%9F%E9%A8%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eproxyquireの実験\u003c/h3\u003e\n\n\u003cp\u003eAngularJSのDIはテスト利便性のためという性質が強いので、ここが維持できるならばAngularJSが提供するDIにこだわる必要は無いと筆者は考えました。proxyquireを併用すると、\u003ccode\u003e$inject\u003c/code\u003eの記述を少なくでき、ブラウザのローディングでどうしても実行が遅いKarmaから、高速なNode.js + \u003ca href=\"http://mochajs.org/\"\u003eMocha\u003c/a\u003eに切り替えられる点をメリットと捉え実践してみました。\u003c/p\u003e\n\n\u003cp\u003e筆者の\u003ca href=\"https://github.com/likr/interactive-sem/blob/master/test/unit/views/network-diagram/root-spec.js#L21-L30\"\u003e実際に運用したテスト\u003c/a\u003eです。実はこのときはまだproxyquireに気付いておらず、自力で似たような機構を実装していたためコード量が増えてしまっています。方向性としては同じです。\u003c/p\u003e\n\n\u003cp\u003eこのproxyquireで複数のモジュールをモック化しているだけでなく、AngularJS DIを用いる\u003ccode\u003e$rootscope\u003c/code\u003eや\u003ccode\u003e$timeout\u003c/code\u003eもL21-L30でモック化して与えています。例にはありませんが、\u003ccode\u003e$resource\u003c/code\u003eなどのモック化も同様に行えます。\u003c/p\u003e\n\n\u003cp\u003eただしこれは尖ったアプローチで、一般的ではないと自覚して試みています。過度にやりすぎると今度はテスト自体が負債となる恐れもあり、筆者自身もまだバランスを確かめている段階です。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ☆☆☆\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angular-2のdi\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular-2%E3%81%AEdi\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngular 2のDI\u003c/h2\u003e\n\n\u003cp\u003eAngular 2では、ServiceとFactoryの違いに悩まずに済むDI機構や、ES6 moduleと親和性の高い\u003ca href=\"https://github.com/systemjs/systemjs\"\u003eSystemJS\u003c/a\u003eというモジュール管理機構を推奨しています。SystemJSはあまり馴染みがないですが「郷に入っては郷に従え」となるのかもしれません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4-jquery\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-jquery\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e§4 jQuery\u003c/h1\u003e\n\n\u003cp\u003e事を荒立てる前に言うならば、jQueryから完全脱却できない話は止むを得ないことだと感じています。そして意見に流されすぎるのもよくありません。主観的には様々な感情論があることでしょうが、それは置いておきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"dom操作に対する時代の変化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dom%E6%93%8D%E4%BD%9C%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E6%99%82%E4%BB%A3%E3%81%AE%E5%A4%89%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDOM操作に対する時代の変化\u003c/h2\u003e\n\n\u003cp\u003e仮想DOMの登場はjQuery主流だったWeb制作からすると新たな潮流です。仮想DOMの詳説は別の記事に譲ります。仮想DOMは差分検出を主としているため、jQueryを通じて──もちろん他の手段でもですが──DOMを直接操作すると仮想DOMの情報と実際のDOMに食い違いが発生します。そのため仮想DOMを用いるViewライブラリではjQuery等による手動DOM操作はご法度とされるようになりました。\u003c/p\u003e\n\n\u003cp\u003eまたjQueryは、もともとはゼロ年代のブラウザ間差異を吸収する目的で普及が進み、jQuery 2系の方針からも分かるように、現代ではレガシーブラウザはサポートされない方向に進んでいます。どうしても意図的に直接HTML要素を操作する場合も、現在は\u003ca href=\"https://developer.mozilla.org/ja/docs/DOM\"\u003eDOM\u003c/a\u003e APIが提供する範囲で十分賄えると感じます。ここでどうしてもjQueryの力が必要というときに使えばよいでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"負の遺産と嗅覚\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B2%A0%E3%81%AE%E9%81%BA%E7%94%A3%E3%81%A8%E5%97%85%E8%A6%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e負の遺産と嗅覚\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003e身元の怪しい\u003c/strong\u003ejQueryプラグインから脱却できない事情は、負の遺産にしかなりえないと考えており、筆者はまったく賛同しません。これはjQueryに限らず何のライブラリ、フレームワークにおいても同様で、AngularJS向けのプラグインについても言えます。\u003c/p\u003e\n\n\u003cp\u003e代表的なAngularJSプラグインに\u003ca href=\"http://angular-ui.github.io/bootstrap/\"\u003eAngularUI\u003c/a\u003eがあります。これはAngularJS 1.4が控えてる今になってようやく1.3に対応したので、決して早い対応ではありませんでした。このようにプラグインを採り入れることは自らに足枷をはめることと同義になりかねないため、開発コミュニティの体力や活性度、採用することで得られるメリット、負の遺産としないための疎な設計、これらを十分に考慮すべきです。\u003c/p\u003e\n\n\u003cp\u003e低品質なプラグインに対する嗅覚は常日頃養いたいものです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angular-2は脱jquery\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular-2%E3%81%AF%E8%84%B1jquery\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngular 2は脱jQuery\u003c/h2\u003e\n\n\u003cp\u003e誤解をされている方がいるようですが、AngularJS 1.xはむしろjQueryとの親和性を意識して設計されました。それは今日になっても変わっていません。AngularJSのロードより前に\u003ccode\u003e$\u003c/code\u003eグローバル変数が存在した場合、自動的にmixinして\u003ccode\u003eangular.element()\u003c/code\u003eで使えるようになっています。\u003c/p\u003e\n\n\u003cp\u003eただし、親和性が高いからといって無頓着に増やし続けると、それはAngular 2への移行を困難にします。Angular 2では逆にjQueryを\u003cstrong\u003e推奨していません\u003c/strong\u003e。これは前述した仮想DOMの事情に近く、Change Detection（\u003ca\u003e開発者の記事\u003c/a\u003e）を正しく動作させるためには直接DOMを操作すべきでないからです。Change DetectionはAngular 2の高速化に寄与しており、これは1系から2に移行する最大のメリットとなるでしょう。\u003c/p\u003e\n\n\u003cp\u003e§2で\u003ccode\u003ecompile\u003c/code\u003e, \u003ccode\u003elink\u003c/code\u003eには依存しすぎないよう注意せよと述べました。これはjQueryを極力控えるべき事情と通じています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularjsとjqueryの付き合い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs%E3%81%A8jquery%E3%81%AE%E4%BB%98%E3%81%8D%E5%90%88%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJSとjQueryの付き合い方\u003c/h2\u003e\n\n\u003cp\u003eではjQueryを多用しているAngularJSプロジェクトはどのように乗りこなすべきでしょうか。答えは\u003ca href=\"https://docs.angularjs.org/api/ng/directive/ngIf\"\u003e\u003ccode\u003engIf\u003c/code\u003e#\u003c/a\u003eや\u003ca href=\"https://docs.angularjs.org/api/ng/directive/ngShow\"\u003e\u003ccode\u003engShow\u003c/code\u003e#\u003c/a\u003e, \u003ca href=\"https://docs.angularjs.org/api/ng/directive/ngHide\"\u003e\u003ccode\u003engHide\u003c/code\u003e#\u003c/a\u003eの駆使にあります。\u003c/p\u003e\n\n\u003cp\u003e多くの場合、ダイナミックなHTML要素の追加には\u003ccode\u003engIf\u003c/code\u003eを使用してください。\u003ccode\u003engIf\u003c/code\u003eは\u003ccode\u003eboolean\u003c/code\u003eに従いDOMをその都度生成・削除します。どうしてもこの生成パフォーマンスが気になった場合には\u003ccode\u003engShow/ngHide\u003c/code\u003eを使えます。これは\u003ccode\u003edisplay: none\u003c/code\u003eによって要素は残しながら非表示とします。\u003c/p\u003e\n\n\u003cp\u003eリッチなUIを実現するとき、しばしばアニメーション効果が望まれます。これは\u003ca href=\"https://docs.angularjs.org/api/ngAnimate\"\u003e\u003ccode\u003engAnimate\u003c/code\u003e#\u003c/a\u003eと\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/Guide/CSS/Using_CSS_transitions\"\u003eCSS Transitions\u003c/a\u003eにて表現可能です。フェードイン・アウトはCSS Transitionsで制御する都合上\u003ccode\u003engShow/ngHide\u003c/code\u003eの方が扱いやすいです。ダイアログ、プルダウンメニュー、リストや通知の挿入、削除は\u003ccode\u003engAnimate\u003c/code\u003eで十分対応可能です。\u003c/p\u003e\n\n\u003cp\u003e申し訳ないのですが筆者はあまり過度のアニメーション装飾を好まないため、これ以上複雑な動きには必然性を感じていません。どうしてもそういった動きを実現するのにjQueryが必要と考えるならば、同時にAngularJSが本当に必要かどうかについても検討できるでしょう。そこでAngularJSが必要ならば、これはCSS Transitionsの可能性を拡げるきっかけにも繋がります。\u003c/p\u003e\n\n\u003cp\u003e適材適所と言ってしまえばそれまでですが、世の流れを窺いながら適切に付き合っていきましょう。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"5-angularjsの気になるところ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-angularjs%E3%81%AE%E6%B0%97%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%A8%E3%81%93%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e§5 AngularJSの気になるところ\u003c/h1\u003e\n\n\u003cp\u003e本章では、まとまり切らないながら重要である疑問について扱います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"scopeをcontrollerasに置き換えるとwatchはどうすれば\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scope%E3%82%92controlleras%E3%81%AB%E7%BD%AE%E3%81%8D%E6%8F%9B%E3%81%88%E3%82%8B%E3%81%A8watch%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e$scopeをcontrollerAsに置き換えると$watchはどうすれば?\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e 問題なく使用できます。\u003c/p\u003e\n\n\u003cp\u003e§1で\u003ccode\u003e$scope\u003c/code\u003eはControllerの\u003ccode\u003ethis\u003c/code\u003eに置き換える手法を紹介しました。そうなると\u003ccode\u003e$scope.$watch\u003c/code\u003eはどう扱えばいいのか疑問が起こります。\u003c/p\u003e\n\n\u003cp\u003eこれは全く問題がなく、\u003ccode\u003e$scope\u003c/code\u003eを、Controllerのプロパティを生やすためのServiceとして捉えずに「\u003ccode\u003e$scope\u003c/code\u003eは\u003ccode\u003e$watch\u003c/code\u003eを提供するためのServiceである」と認識を改めるとよいでしょう。なので他のService、例えば\u003ccode\u003e$resource\u003c/code\u003eをDIするのと同じ感覚で\u003ccode\u003e$scope\u003c/code\u003eをDIしてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'John'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$watch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'main.user'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewVal\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewVal\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$inject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'$scope'\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'E'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMainController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econtrollerAs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u0026lt;input type=\"text\" ng-model=\"main.user\"\u0026gt;\u0026lt;p\u0026gt;Hello, {{main.user}}!\u0026lt;/p\u0026gt;'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'myApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emainDDO\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"http://jsfiddle.net/c9ufb5sg/\"\u003e動作サンプル\u003c/a\u003eです。意外かもしれませんが、\u003ccode\u003e$watch\u003c/code\u003e対象は\u003ccode\u003e$scope\u003c/code\u003eに格納されたプロパティに限っておらず\u003ccode\u003e$watch('ここに書かれた式')\u003c/code\u003eによって解決されています。式はHTMLの\u003ccode\u003e{{main.user}}\u003c/code\u003eと同等のものです。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"broadcast-emit-onは使ってもいいですか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#broadcast-emit-on%E3%81%AF%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%82%E3%81%84%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e$broadcast, $emit, $onは使ってもいいですか?\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e 答えに詰まりますが、Angular 2では別の機構に置き換えられ\u003ca href=\"http://qiita.com/armorik83/items/d3d93ee1e4454e01d2a3\"\u003e互換性のあるAPIは用意されない\u003c/a\u003eため、これを理解した上で用いるなら可です。\u003c/p\u003e\n\n\u003cp\u003eStackOverflowを眺めていても気付くところで、\u003ccode\u003e$broadcast\u003c/code\u003eには誤解があるようです。筆者もその一人で、どうやら\u003ccode\u003e$broadcast\u003c/code\u003eを\u003ca href=\"https://nodejs.org/api/events.html\"\u003eEventEmitter\u003c/a\u003eと同じように扱うことは開発陣は想定していないようでした。AngularJSとしては、むしろこのAPIを\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent\"\u003eMouse Event\u003c/a\u003eといったWeb APIに対して使うものと想定していたようで、その証拠にAngular 2に\u003ccode\u003e$broadcast\u003c/code\u003eに替わるものとして用意された\u003ca href=\"https://angular.io/docs/js/latest/api/annotations/Directive-class.html\"\u003ehostListeners\u003c/a\u003eの機構は、マウスやウインドウのイベント取得に向けて設計されています。\u003c/p\u003e\n\n\u003cp\u003eではAngularJS内で\u003ccode\u003e$broadcast\u003c/code\u003eをEventEmitter的に使ってはダメかというと、そうではありませんが、推奨されていないと認識すべきです。Angular 2で同等の機構を実現するならば、Reactと同様にEventEmitterを継承して使えばよいようです。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"filterはどのように扱っていますか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#filter%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E6%89%B1%E3%81%A3%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFilterはどのように扱っていますか?\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e 内蔵されているもの以外は使っていません。\u003c/p\u003e\n\n\u003cp\u003e筆者はあまり自作Filterを量産しようとは考えておらず、極力汎用ライブラリの処理結果をbindさせる手段をとっています。これはAngularJSから他社フレームワークに乗り換える必要が生じた際への対策といえます。汎用ライブラリの例は§6にて扱います。\u003c/p\u003e\n\n\u003cp\u003eところで、Angular 2には\u003ca href=\"https://angular.io/docs/js/latest/api/pipes/\"\u003ePipes\u003c/a\u003eというAPIが備わっており、これがAngularJSでいうFilterに相当します。Angular 2のPipesに関する情報は\u003ca href=\"/laco0416\" class=\"user-mention\" title=\"laco0416\"\u003e@laco0416\u003c/a\u003e氏の\u003ca href=\"http://qiita.com/laco0416/items/ae426eeb07db207dda44\"\u003eこちらの記事\u003c/a\u003eをお勧めします。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★☆☆\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ルータの最適解はcomponent-routerですか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%82%BF%E3%81%AE%E6%9C%80%E9%81%A9%E8%A7%A3%E3%81%AFcomponent-router%E3%81%A7%E3%81%99%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルータの最適解はComponent Routerですか?\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eA.\u003c/strong\u003e 残念ながら\u003ca href=\"https://angular.github.io/router/\"\u003eComponent Router\u003c/a\u003eを使う時期はまだ来ていません。\u003c/p\u003e\n\n\u003cp\u003eComponent Routerとは、2015年3月にNew Routerとして発表されたAngularチームが開発している新しいRouterです。New Routerの名称は陳腐化すると指摘があり、現在は（通称）Component Routerと呼ばれています。これはAPIがまだ安定しておらず、AngularJS 1.4.0にも間に合わないとアナウンスされている\u003csup id=\"fnref6\"\u003e\u003ca href=\"#fn6\" title=\"Angular Weekly Meeting議事録、開発者向けの情報です。\"\u003e6\u003c/a\u003e\u003c/sup\u003eため、今急いで導入する必要は無いでしょう。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/likr/gdgkobe20150429/tree/master/step3\"\u003eComponent Routerを実際に使う例\u003c/a\u003eが2015年4月のGDG神戸 Angular勉強会#3でありましたので、紹介しておきます。\u003c/p\u003e\n\n\u003cp\u003e筆者はDirective化を強く進めた結果、\u003ca href=\"https://github.com/angular-ui/ui-router\"\u003eui-router\u003c/a\u003eを必要とすることなく\u003ca href=\"https://docs.angularjs.org/api/ngRoute\"\u003engRoute\u003c/a\u003eで落ち着いてしまいました。ui-routerの有用性は認めているので、これは純粋に好みによるものです。ヒントを期待されていたならば、ごめんなさい。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★☆☆\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"6-armorik83流モダン開発環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-armorik83%E6%B5%81%E3%83%A2%E3%83%80%E3%83%B3%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e§6 armorik83流モダン開発環境\u003c/h1\u003e\n\n\u003cp\u003e最後の章では、筆者がモダンだと考えているAngularJSの開発環境について記しておきます。Angular 2を意識してはいますが、入門者から熟練者まで幅広く受け容れられる構成とは思っておらず、参考にされる程度で構いません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"汎用ライブラリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B1%8E%E7%94%A8%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e汎用ライブラリ\u003c/h2\u003e\n\n\u003cp\u003eライブラリはできるだけ少なめにしたいという指針をもって選んでいます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://lodash.com/docs\"\u003elodash\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://stringjs.com/\"\u003estring.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://momentjs.com/\"\u003eMoment.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://mikemcl.github.io/decimal.js/\"\u003edecimal.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://d3js.org/\"\u003eD3.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/jakearchibald/es6-promise\"\u003ees6-promise\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/api/events.html\"\u003eEventEmitter\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eオススメ度: ★★☆〜★★★\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"言語\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%80%E8%AA%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e言語\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eTypeScript\u003c/strong\u003e\u003cbr\u003e\nまずは\u003ca href=\"http://www.typescriptlang.org/\"\u003eTypeScript\u003c/a\u003eです。TypeScriptとの付き合いもAngularJS歴と同じ2年弱で、強固な相棒でした。\u003c/p\u003e\n\n\u003cp\u003eかつてJavaScriptでClass構文を使いたいならばTypeScriptしか選択肢がありませんでした。これもTypeScriptを選択した大きな理由です。最近は次に挙げるBabelも使います。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eBabel\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://babeljs.io/\"\u003eBabel\u003c/a\u003eはもう手放せない存在です。AngularJSアプリケーションの場合、型を重視したいためTypeScriptを用いますが、シンプルに1000行程度で収まるライブラリはBabelで書くようになりました。2015年はBabelが急成長しており、TypeScriptでなくともClass構文を採り入れやすくなっています。Babelで書く場合でも、TypeScriptの\u003ccode\u003e.d.ts\u003c/code\u003eは用意しており、これは下手なドキュメントより優秀です。\u003c/p\u003e\n\n\u003cp\u003eそのほか、テストではモックへの型検証がかえって邪魔になることがあるので、TypeScriptを使わず、すべてES6 + Babelで書いています。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003edtsm\u003c/strong\u003e\u003cbr\u003e\n型定義\u003ccode\u003e.d.ts\u003c/code\u003eのインストールと管理は\u003ca href=\"/vvakame\" class=\"user-mention\" title=\"vvakame\"\u003e@vvakame\u003c/a\u003e氏の\u003ca href=\"http://qiita.com/vvakame/items/38b953ab0f4de63cce8b\"\u003edtsm\u003c/a\u003eで行います。\u003ca href=\"https://github.com/DefinitelyTyped/tsd\"\u003etsd\u003c/a\u003eと違い、コマンドがシンプルで複数のリポジトリに分散した型定義も管理しやすいだけでなく、やはり国産でバグ報告と修正が円滑という強みがあります。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eESLint\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"http://eslint.org/\"\u003eESLint\u003c/a\u003eは\u003ca href=\"http://qiita.com/armorik83/items/861e8b883ea5893a3320\"\u003e最近使い始めたら\u003c/a\u003eとても気に入ったので、今後もBabelで書く際は併用したいと考えています。一方、\u003ca href=\"https://github.com/palantir/tslint\"\u003eTSLint\u003c/a\u003eは残念ながら処理待ちが長いため使っていません。これはコーディング・スタイル以外はtscが警告してくれるものと考え妥協しています。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eLess\u003c/strong\u003e\u003cbr\u003e\nCSS自体あまり書きたくないのですが、そうも言えないため\u003ca href=\"http://less-ja.studiomohawk.com/\"\u003eLESS\u003c/a\u003eを使っています。以前流行りだしてすぐの頃は\u003ca href=\"http://sass-lang.com/\"\u003eSass\u003c/a\u003eと\u003ca href=\"http://compass-style.org/\"\u003eCompass\u003c/a\u003eでした。Rubyってのがどうにも馴染まず。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★☆☆\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"タスクランナーとビルドツール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%82%B9%E3%82%AF%E3%83%A9%E3%83%B3%E3%83%8A%E3%83%BC%E3%81%A8%E3%83%93%E3%83%AB%E3%83%89%E3%83%84%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eタスクランナーとビルドツール\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003egulp\u003c/strong\u003e\u003cbr\u003e\nタスクランナーは、今は専ら\u003ca href=\"http://gulpjs.com/\"\u003egulp\u003c/a\u003eを使っています。単純なものは\u003ccode\u003enpm scripts\u003c/code\u003eに記述し、残りの大半は\u003ccode\u003egulpfile.js\u003c/code\u003eに記述しています。以前\u003ca href=\"http://qiita.com/armorik83/items/0860dc097d11f18b9973\"\u003e記事を書きました\u003c/a\u003eので、gulpについてはそちらを。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eBrowserify\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"http://browserify.org/\"\u003eBrowserify\u003c/a\u003eは§3のCommonJS moduleの節でも触れました。AngularJSがCommonJSに対応したことでBrowserify導入の契機となりました。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"テスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテスト\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eMocha\u003c/strong\u003e\u003cbr\u003e\nAngularJSはテストの実行に\u003ca href=\"http://jasmine.github.io/\"\u003eJasmine\u003c/a\u003eを用いて解説していますが、筆者はJasmineから\u003ca href=\"http://mochajs.org/\"\u003eMocha\u003c/a\u003eに乗り換え現在も使い続けています。\u003ccode\u003edescribe, it\u003c/code\u003eスタイルでJasmineとよく似ています。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSinon.JS\u003c/strong\u003e\u003cbr\u003e\nモックの強い味方\u003ca href=\"http://sinonjs.org/\"\u003eSinon.JS\u003c/a\u003eです。AngularJSのDirectiveやControllerのテストは大半をSinon.JS併用で行い、最後の網掛けとして本物を使ったe2eで埋めています。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eNightmare\u003c/strong\u003e\u003cbr\u003e\nそのe2eは紆余曲折があり、Angularチームが開発している\u003ca href=\"http://angular.github.io/protractor/#/\"\u003eProtractor\u003c/a\u003eやGrouponの\u003ca href=\"https://github.com/groupon/testium\"\u003eTestium\u003c/a\u003eなど、いろいろ試してきました。\u003c/p\u003e\n\n\u003cp\u003e世の中がまだPhantomJS 2に向かいきってないのが歯痒いですが、現在は\u003ca href=\"http://www.nightmarejs.org/\"\u003eNightmare\u003c/a\u003eになんとか落ち着いています。なお、残念ながらAngular 2 alphaではe2e周りがとても弱く、今後改善されることを期待しています。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★☆\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eproxyquire\u003c/strong\u003e\u003cbr\u003e\n§3のDIの節にて紹介した\u003ca href=\"https://github.com/thlorenz/proxyquire\"\u003eproxyquire\u003c/a\u003e、AngularJS DIをあえて用いない、かなり尖った構成です。\u003ca href=\"http://qiita.com/armorik83/items/46781adda80e9d53f7ee\"\u003e詳細はこちら\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★☆☆\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003epower-assert\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"/t_wada\" class=\"user-mention\" title=\"t_wada\"\u003e@t_wada\u003c/a\u003e氏を中心に開発されている\u003ca href=\"https://github.com/power-assert-js/power-assert\"\u003epower-assert\u003c/a\u003eも最前線。コンソールデバッグの手間を大幅に減らせて心強い味方です。余談ですがこのプロダクトの\u003ca href=\"https://github.com/power-assert-js/power-assert-js-logo\"\u003eロゴマーク\u003c/a\u003eをデザインさせていただきました。\u003c/p\u003e\n\n\u003cp\u003eオススメ度: ★★★\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003ecw-log\u003c/strong\u003e\u003cbr\u003e\n手前味噌で\u003ca href=\"http://qiita.com/armorik83/items/733ba1a41cf9aec0b382\"\u003ecw-log\u003c/a\u003eも多用しました。AngularJSで複数のClassを組み合わせると処理順を確かめたい場合が多く、本番環境でもログの出力をコントロールでき重宝しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"rip\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rip\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRIP\u003c/h2\u003e\n\n\u003cp\u003e最後に、使っていたものの今は離れたライブラリを供養して締めくくります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eYeoman Generator\u003c/strong\u003e: 保守が面倒すぎて、どんどん陳腐化した\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eGrunt\u003c/strong\u003e: このJSの速さについてきていない、各種プラグインが負債化\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eBower\u003c/strong\u003e: npmとBrowserifyですべて管理するので不要に\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eJasmine\u003c/strong\u003e: そこまで悪いわけではないが、Mocha + SinonJS + power-assertを考えるともう戻れない\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eProtractor\u003c/strong\u003e: Jasmineに依存しているため同上の理由\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eUnderscore.js\u003c/strong\u003e: lodashを使っている\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ejQuery\u003c/strong\u003e: §4参照\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"謝辞\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AC%9D%E8%BE%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e謝辞\u003c/h1\u003e\n\n\u003cp\u003e本稿のためにたくさんの方々のご協力をいただきました。\u003c/p\u003e\n\n\u003cp\u003e私がAngularJSに真摯に向き合う機会をくださり、長時間の相談と推敲にも付き合っていただいた\u003ca href=\"/_likr\" class=\"user-mention\" title=\"_likr\"\u003e@_likr\u003c/a\u003e氏、AngularJSを使い始め入門者の視点から沢山の指摘を寄せてくださった\u003ca href=\"/shinsukeimai\" class=\"user-mention\" title=\"shinsukeimai\"\u003e@shinsukeimai\u003c/a\u003e氏に感謝いたします。\u003c/p\u003e\n\n\u003cp\u003e本稿のレビューを引き受けていただき、貴重な視点や指摘、理解の深まる質問を寄せてくださった\u003ca href=\"/Quramy\" class=\"user-mention\" title=\"Quramy\"\u003e@Quramy\u003c/a\u003e氏、\u003ca href=\"/izumin5210\" class=\"user-mention\" title=\"izumin5210\"\u003e@izumin5210\u003c/a\u003e氏、Angular 2の情報収集の際にとても支えとなっている\u003ca href=\"/shuhei\" class=\"user-mention\" title=\"shuhei\"\u003e@shuhei\u003c/a\u003e氏、\u003ca href=\"/laco0416\" class=\"user-mention\" title=\"laco0416\"\u003e@laco0416\u003c/a\u003e氏に感謝いたします。それぞれのAngularへの熱意がこの記事を押し上げました。\u003ca href=\"/vvakame\" class=\"user-mention\" title=\"vvakame\"\u003e@vvakame\u003c/a\u003e氏には私がAngularJSとTypeScriptを使い始めて間もない頃から、数々のアドバイスをいただけましたこと感謝いたします。\u003c/p\u003e\n\n\u003cp\u003e最後に、本稿を最後までお読みいただいた皆様へ心より御礼申し上げます。本稿が皆様の役に立ち、Angularユーザがより豊かになることを願っています。\u003c/p\u003e\n\n\u003cp\u003e2015年5月 Crescware 奥野賢太郎 \u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003estableは1.4.1ですが、標準でインストールされる最新バージョンが1.5.0-betaとなっています。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003e\u003ccode\u003eprivate\u003c/code\u003eでも可。 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn3\"\u003e\n\u003cp\u003eオレオレDIはテスト困難なモジュールに対して暫定的に強引に導入する性質が強く、毎回やるべきではないと考えます。 \u003ca href=\"#fnref3\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn4\"\u003e\n\u003cp\u003ewebpack派はwebpackと読み替えて結構です。 \u003ca href=\"#fnref4\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn5\"\u003e\n\u003cp\u003eCommonJSのmoduleを指します。 \u003ca href=\"#fnref5\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn6\"\u003e\n\u003cp\u003e\u003ca href=\"https://docs.google.com/document/d/150lerb1LmNLuau_a_EznPV1I1UHMTbEl61t4hZ7ZpS0/mobilebasic?pli=1\"\u003eAngular Weekly Meeting\u003c/a\u003e議事録、開発者向けの情報です。 \u003ca href=\"#fnref6\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"こんにちは、@armorik83です。私のAngularJS歴は2年弱で、これまでAngularJSに関する記事はQiitaにたくさん書いてきました。例えば次のような記事です。\n\n- [AngularJSアンチパターン集](http://qiita.com/armorik83/items/b00818ecaf2e93734b36) 2014.9\n- [ここらでDirective Scopeの@=\u0026をまとめておきたいと思う](http://qiita.com/armorik83/items/72f12cb3a6f040fb8364) 2014.9\n- [TypeScriptで書くAngularJSのMVC](http://qiita.com/armorik83/items/0778d757c46e953f3fdf) 2014.2\n- [AngularJS Directiveの処理順を網羅してみた](http://qiita.com/armorik83/items/38fe685cc76163c7e8ce) 2014.12\n\n他にもニッチなものやイマイチだったものも含めてけっこうな数となってきました。また、こういった記事の縁で勉強会でも登壇させて頂きました。\n\n- [モダンAngularJS](http://www.slideshare.net/armorik83/angularjs-141206) 2014.12 GDG中国\n- [TypeScriptで書くAngularJS](http://www.slideshare.net/armorik83/gdgkobe-angularjs-2) 2014.8 GDG神戸\n- [イベント駆動AngularJS](http://www.slideshare.net/armorik83/angular3-gdgkobe150429) 2015.4 GDG神戸\n\nたくさん書いてくると、古い記事は粗が目立ち、そして世界の技術からみても鮮度が落ちていくため、どうしても有用性が失われていきます。そこで今回改めてこれまでのけじめとして、そして控えているAngular 2を捉えながら2015年にAngularJS 1.xをどう書いていくべきか、まとめていきます。\n\n**おことわり**: 客観的に見てベストプラクティスと呼ぶには個人的な好みが含まれすぎているため、モダンプラクティスと称しています。以下の書き方や使い方は、AngularJSが公式に強制または推奨しているものではなく、個人的にAngular 2を考慮して提案しているものです。ご了承ください。\n\n**執筆時点**: 本稿は2015年5月に執筆しています。\n\n- AngularJS: `1.3.15`、1.4に言及する時は`1.4.0-rc.2`\n- Angular 2: `2.0.0-alpha.24`\n- Babel: 最新版\n- TypeScript: `1.5.0-beta`\n\n# §0 イントロダクション\n## 現状の何に問題があるのか\nヒトコトで言うと、[Angular 2](https://angular.io/)のリリースが控えている、これが障壁とされます。AngularJSは素敵なライブラリです。ただ出るのが少し早すぎたか、開発陣がこのユーザ規模を想定していなかったか、多くの粗を探され多くの後発と比較されました。Angular 2はここに挑戦しており改革に大きな痛みを伴っています。\n\n「AngularJSはAngular 2と互換性がほとんど無いんだろ?」\n「今から始めるならReactを…」\n「jQueryの方が知ってるし簡単にできる」\n\n有り得る意見です。でもちょっとまって、AngularJSに対して誤解がありませんか。\n\n## 対象読者\nこの記事は、既にAngularJSをたくさん書いている方々、ちょっと始めてみたけど今のうちに止めた方がいい?と不安になってる方々など、幅広く現在のAngularJSユーザに向けて書いています。ただ、申し訳ありませんが全く使ったことのない方に対する第一歩の手引きとはなっておりません、ご了承ください。\n\n以下の章からは、AngularJSをどう書いていくべきかを具体的に述べます。幅広い力量に向けて対象にしているため、どうしても長めになっております。序文で自分は知っている話題だと感じたら次々と読み飛ばしてもらって構いません。\n\n## オススメ度\n各節には、習熟度や利便性などから筆者が独断で表現したオススメ度を表示していますので、ご参考にしてください。\n\n- ★★★: AngularJS習熟度に関わらずお勧めしたい内容\n- ★★☆: AngularJSに対して多少の経験があり、困難とも遭遇している方向け\n- ★☆☆: AngularJSをより使いこなし、最新のJavaScriptの潮流も勘案しておきたい方向け\n- ☆☆☆: 筆者による挑戦的で実験的な内容、お勧めはしませんが参考までに\n\n# §1 Class構文\n## ES6が近づいている\nES6をご存知でしょうか。ES6のESとは[ECMAScript](http://ja.wikipedia.org/wiki/ECMAScript)の略称で、これは我々がJavaScriptと呼んでいる言語の正式な標準規格のことです。JavaScriptといっても実際にはブラウザ毎に差異があるため、標準化が必要となりました。\n\nES6は簡単に言うとJavaScriptの次世代規格ということです。\n\n現在の最新ブラウザは全てESのバージョン5をサポートしていますが、[ES6の仕様を全て満たすブラウザはまだ現れていません](https://kangax.github.io/compat-table/es6/)。\n\n- [HELLO, ES6 〜これから迎えるJSのミライ〜](http://yoshiko-pg.github.io/slides/20150425-jsfes/)\n\nES6は、ES5と比べて簡便に記述するための新構文が多く含まれているほか、新しいAPIも複数追加されています。Angular 2はTypeScriptでの使用を前提に開発されており（従わずにES5やCoffeeで書くこともできます）ES6についての知識もぜひ知っておくべきです。\n\nオススメ度: ★★★\n\n### TypeScriptとES6の関係\n[TypeScript](http://www.typescriptlang.org/)とはプログラミング言語のひとつで、バージョンは執筆時点で1.5.0-beta[^1]です。TypeScriptはJavaScriptのスーパーセット言語として策定されており、早くから「ES6の構文で書いてブラウザで動作するJavaScriptを生成する」というアプローチを取っていました。Angular 2はこの[TypeScriptで開発され](http://blogs.msdn.com/b/typescript/archive/2015/03/05/angular-2-0-built-on-typescript.aspx)、ユーザがAngular 2を用いる際にもTypeScriptで書けるよう設計されています。\n\nTypeScriptはES6の構文を積極的に採用しているため、ES6の知識とTypeScriptの知識は重複する部分が多いです。そしてもちろん最大の特徴はコンパイラによる静的型検証です。\n\nオススメ度: ★★★\n\n### Babel\nTypeScriptを使う方法以外に、ES6構文を含むJavaScriptをES5で動くように変換するトランスパイラというものがあります。そのうちのひとつの[Babel](https://babeljs.io/)は開発がとても盛んで、[公式サイト内で気軽に試すこともできる](https://babeljs.io/repl/#?experimental=false\u0026evaluate=false\u0026loose=false\u0026spec=false\u0026playground=true\u0026code=class%20Hello%20%7B%0A%20%20constructor()%20%7B%0A%20%20%20%20this.message%20%3D%20'Hello%20ES6!'%3B%0A%20%20%7D%0A%7D)筆者オススメのトランスパイラです。実際の開発では[gulp](http://gulpjs.com/)などのタスクランナーでBabelの変換処理を自動化して利用します。\n\nこのほかに、[traceur-compiler](https://github.com/google/traceur-compiler)というものもあります。\n\nオススメ度: ★★☆\n\n## Class構文の例\n\n### AngularJS + Class構文\n\n次の例は、実際に[業務でAngularJSを用いて書いたコード](https://github.com/likr/interactive-sem)を見本用に整形したものです。Class構文はES6からの大きな特徴で、不慣れな方には別言語に見えるかもしれません。\n\n```js:controller.js\nexport class Controller {\n  constructor($rootScope, $scope, $timeout) {\n    this.subscribe();\n  }\n\n  subscribe() {\n    this.disposer = this.disposer || {};\n    this.disposer.store    = Store   .addListener(this.storeChangeHandler.bind(this));\n    this.disposer.renderer = Renderer.addListener(this.rendererChangeHandler.bind(this));\n  }\n\n  // snip\n}\n```\n\n### Angular 2でのClass構文の使い方\n\n次の例はAngular 2チュートリアルの断片です。公式のチュートリアルが最初からClass構文の使用を想定して紹介しているのです。\n\n```js:angular2-example.js\n// snip\nclass MyAppComponent {\n  constructor() {\n    this.name = 'Alice';\n  }\n}\n\nbootstrap(MyAppComponent);\n```\n\n`@`を使った[Decorators構文](http://qiita.com/armorik83/items/e3a0ce67f569ddc4b432)を省略していることに気付いた読者もおられるでしょうが、今回は触れません。[Angular 2 Annotations](https://angular.io/docs/js/latest/api/annotations/)はalpha版で絶賛開発中なため、また日を改めて紹介します。\n\n## AngularJSでClass構文を導入する\n### 一番ダメな例\n\n```js\nvar mainCtrl = function($scope) {\n  $scope.user = 'John';\n};\n```\n\n```html\n\u003cdiv ng-controller=\"mainCtrl\"\u003e\n  \u003cp\u003eHello, {{user}}!\u003c/p\u003e\n\u003c/div\u003e\n```\n\n変数`mainCtrl`に対して無名関数を与えてControllerを定義する例です。最もやってはいけない書き方。AngularJS 1.3以降はそもそも禁止されたので、さすがにこのコードで運用することはありません。しかしこう書くチュートリアルを見てAngularJSを始められる方が今日も残っている以上、ここに記しておきます。当時このようなチュートリアルを許してしまった開発陣はやや残念です。\n\n### $scopeは使わない\n\n前項を改善したのが次の例です。よく見る感じになりました。\n\n```js\nangular.module('myApp', []);\nangular.module('myApp').controller('mainCtrl', function($scope) {\n  $scope.user = 'John';\n});\n```\n\n```html\n\u003cdiv ng-controller=\"mainCtrl\"\u003e\n  \u003cp\u003eHello, {{user}}!\u003c/p\u003e\n\u003c/div\u003e\n```\n\nまだ改善箇所があります。minify対策として`['$scope', function($scope){...}]`にしたほうがいい…それも正しいのですが、ここでは『`$scope`自体を使わないこと』がより良い実践でしょう。\n\n理由は2つあります。ひとつはAngularJS 1.xでClass構文を取り入れていくならば、`$scope`を使わないほうが身軽だから。もうひとつは、Angular 2では`$scope`が廃止されるからです。AngularJS 1.3以降を使うならば`$scope`を使わない選択は十分にメジャー、Angular 2も視野に入れるとそろそろ不安材料ですよ。\n\nご心配なく、`$scope.$watch`や`$scope.$broadcast`については§5で扱います。\n\n### functionを独立させる\n\n前項から`$scope`を外したものが次の例です。\n\n```js\nangular.module('myApp', []);\nangular.module('myApp').controller('mainCtrl', function() {\n  this.user = 'John';\n});\n```\n\n```html\n\u003cdiv ng-controller=\"mainCtrl as main\"\u003e\n  \u003cp\u003eHello, {{main.user}}!\u003c/p\u003e\n\u003c/div\u003e\n```\n\n`$scope`は`this`になりました。JavaScriptの`this`はややこしい…そんなことはない、この先にはClass構文が待っています!\n\nHTML側では、`ng-controller`は`\"mainCtrl as main\"`となりました。`as`は`コントローラ名 as コントローラを格納する変数名`というAngularJSの独自構文です。`controllerAs`というAPIも今後出てくるので、あわせて覚えておきましょう。\n\nここから次の改善として、Class構文を導入しやすくするため`function(){}`を外に出します。\n\n### Class構文を導入する準備が整った\n\n`function mainCtrl()`として外に切り出しました。\n\n```js\nfunction mainCtrl() {\n  this.user = 'John';\n}\n\nangular.module('myApp', []);\nangular.module('myApp').controller('mainCtrl', mainCtrl);\n```\n\n```html\n\u003cdiv ng-controller=\"mainCtrl as main\"\u003e\n  \u003cp\u003eHello, {{main.user}}!\u003c/p\u003e\n\u003c/div\u003e\n```\n\n`angular`への登録では`.controller('mainCtrl', mainCtrl)`と指定します。\n\n### Class化\nあとは`class`構文を用いて一気にいきましょう。Class名は慣習として大文字で始まるので、Controller名を小文字から始めているならば、この際直してもよいでしょう。`Ctrl`は最近だと`Controller`と書く例をよく見かけます。Angular 2の例だと`FooComponent`や`FooCmp`と安定していません。（追記: 先日Angular 2開発者から直々に貰ったサンプルでは`Component`となっていました）\n\n非Controller・非Componentと混同したくないため、個人的には`Main`とせず`MainController`とします。ここは好みですので、チーム内規約などに沿って進めてください。\n\n```js\nclass MainController {\n  constructor() {\n    this.user = 'John';\n  }\n}\n\nangular.module('myApp', []);\nangular.module('myApp').controller('MainController', MainController);\n```\n\n```html\n\u003cdiv ng-controller=\"MainController as main\"\u003e\n  \u003cp\u003eHello, {{main.user}}!\u003c/p\u003e\n\u003c/div\u003e\n```\n\n[実際に動作するサンプル](http://jsfiddle.net/8gvc02ju/)です。\n\n`as`以下は変数名なので、そのままにしています。DIアノテーション（minify対策）は、次の節にて説明します。\n\n## いくつかのメソッドがある場合\n\n複数のメソッドがあった場合にどうClass構文を導入していくか、補足しておきます。\n\n### $scopeにいくつかのメソッドがある例\n```js:todoCtrl.js\nfunction TodoCtrl($scope, $routeParams, $filter, store) {\n  $scope.newTodo = '';\n  $scope.editedTodo = null;\n  $scope.addTodo = function () {};\n  $scope.editTodo = function (todo) {};\n  $scope.saveEdits = function (todo, event) {};\n}\n```\n\n[TodoMVC](https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/controllers/todoCtrl.js)を例に取り上げます。`$scope`に`function`がたくさん生えたよくある構造です。これをES6 Class化していきましょう。\n\n### メソッドとプロパティで分ける\nまず`$scope`のプロパティに格納されるものが関数型かそれ以外かで分けます。\n\n```js:todoCtrl.js\nfunction TodoCtrl($scope, $routeParams, $filter, store) {\n  $scope.newTodo = '';\n  $scope.editedTodo = null;\n\n  // 以下は関数型、Classのメソッドとなる\n  $scope.addTodo = function () {};\n  $scope.editTodo = function (todo) {};\n  $scope.saveEdits = function (todo, event) {};\n}\n```\n\n### Classを用意する\n次に`class`を用意します。\n\n```js:todoCtrl.js\nclass TodoController {\n  constructor($scope, $routeParams, $filter, store) { // \u003c- ここに同じものを\n    // それぞれ保持\n    this.$scope = $scope;\n    this.$routeParams = $routeParams;\n    this.$filter = $filter;\n    this.store = store;\n  }\n}\n\nfunction TodoCtrl($scope, $routeParams, $filter, store) { // \u003c- 使うService名はconstructorへ\n  $scope.newTodo = '';\n  $scope.editedTodo = null;\n\n  $scope.addTodo = function () {};\n  $scope.editTodo = function (todo) {};\n  $scope.saveEdits = function (todo, event) {};\n}\n```\n\n`constructor`の引数はDIするService名です。TypeScriptの場合だとconstructorの引数名の前に`public`など[^2]と書くことでthisへの格納を省略できます。ES6ならば律儀に書く必要があります。\n\n### プロパティをconstructorへ\n```js:todoCtrl.js\nclass TodoController {\n  constructor($scope, $routeParams, $filter, store) {\n    this.$scope = $scope;\n    this.$routeParams = $routeParams;\n    this.$filter = $filter;\n    this.store = store;\n\n    this.newTodo = '';      // +\n    this.editedTodo = null; // +\n  }\n}\n\nfunction TodoCtrl($scope, $routeParams, $filter, store) {\n  $scope.addTodo = function () {};\n  $scope.editTodo = function (todo) {};\n  $scope.saveEdits = function (todo, event) {};\n}\n```\n\n関数以外の`$scope`プロパティは全て`constructor`に移します。`$scope`は`this`に書き換えます。\n\nTypeScriptだと次のように書くことができます。型情報は省略していますので、本来は型も記述します。\n\n```ts:todoCtrl.ts\nclass TodoController {\n  newTodo = '';      // この辺がちょっと違う\n  editedTodo = null;\n\n  constructor(\n    public $scope,\n    public $routeParams, // publicと付けるとthis代入を省略できる\n    public $filter,\n    public store\n  ) {\n    // noop\n  }\n}\n\nfunction TodoCtrl($scope, $routeParams, $filter, store) {\n  $scope.addTodo = function () {};\n  $scope.editTodo = function (todo) {};\n  $scope.saveEdits = function (todo, event) {};\n}\n```\n\n### $scope関数をメソッドへ\n\n最後に`$scope`の各関数をClassのメソッドとして書き換えます。この時、出てくる`$scope`を`this`に置き換えることを忘れずに。\n\n```js:todoCtrl.js\nclass TodoController {\n  constructor($scope, $routeParams, $filter, store) {\n    this.$scope = $scope;\n    this.$routeParams = $routeParams;\n    this.$filter = $filter;\n    this.store = store;\n\n    this.newTodo = '';\n    this.editedTodo = null;\n  }\n\n  addTodo() {\n    //\n  }\n\n  editTodo(todo) {\n    //\n  }\n\n  saveEdits(todo, event) {\n    //\n  }\n}\n```\n\nひとつだけ例として`addTodo()`の中身を書いてみます。[元ソースはこちら](https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/controllers/todoCtrl.js#L32-L50)。\n\n```js:todoCtrl.js\naddTodo() {\n  const newTodo = {\n    title: this.newTodo.trim(),\n    completed: false\n  };\n\n  if (!newTodo.title) {\n    return;\n  }\n\n  this.saving = true;\n  store\n    .insert(newTodo)\n    .then(() =\u003e {\n      this.newTodo = '';\n    })\n    .finally(() =\u003e {\n      this.saving = false;\n    });\n};\n```\n\n要注意ポイントとして、`$scope`を`this`に置き換えるならば、`this`の束縛を揃えるために[アロー関数](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/arrow_functions)を使う必要があります。ES6の新構文であるアロー関数は単なる[糖衣構文](https://ja.wikipedia.org/wiki/%E7%B3%96%E8%A1%A3%E6%A7%8B%E6%96%87)ではなく`this`の束縛を上のブロックと揃える大事な性質があります。ES6でもTypeScriptでも使え、なにより短くて済むので積極的に採用したい構文です。\n\n変数宣言`var`は、筆者は[`let`#](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/let)や[`const`#](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/const)に積極的に置き換えています。この2つもES6から導入された新たな仕様です。\n\n### DIアノテーションを記述\nよく言及される話題で、ユーザ間では**minify対策**とも呼ばれます。AngularJSでは各Service, Controllerで使う別のServiceを列挙する必要があり、これを欠かすとminify変換時に正常に動作しなくなる問題が存在します。\n\nDIアノテーションを自動で付与してくれるツール[ng-annotate](https://github.com/olov/ng-annotate)を使ってもよいです。ただしAngular 2ではDIの仕組みが変わり機械的な記述がしにくい構造となったため、AngularJS 1.xでも手書きでよいと考えています。Angular 2に関しては[`@Inject`アノテーション](https://angular.io/docs/js/latest/api/di_annotations/Inject-class.html)などを参照してください。\n\nAngularJSにおけるDIアノテーションは、`自身のClass名.$inject`で記述できます。\n\n```js:todoCtrl.js\nclass TodoController {\n  constructor($scope, $routeParams, $filter, store) {\n    this.$scope = $scope;\n    this.$routeParams = $routeParams;\n    this.$filter = $filter;\n    this.store = store;\n\n    this.newTodo = '';\n    this.editedTodo = null;\n\n    TodoController.$inject = ['$scope', '$routeParams', '$filter', 'store'];\n  }\n\n  addTodo() {\n    //\n  }\n}\n```\n\nこれで`$scope`に`function`がたくさん生えたControllerをClass化できました。\n\n# §2 Directive指向\n本章では、前章でClass構文を導入したControllerからDirectiveに切り替えていく方法について解説します。\n\nDirectiveというと「AngularJSの中でも複雑で難しいやつ」とか「入れ子にすると混乱する」などの意見をよく目にしますが、恐れることはありません。これから挙げるAPI以外は**無視しても大丈夫です**。\n\nそして重要なのは、Angular 2はComponent指向で、Angular 2 Component ≒ AngularJS 1 Directiveだということです。`ng-controller`はAngular 2では**廃止されます**。\n\n## 使うAPI\nここでいうAPIとはDDO - [Directive Definition Object](https://docs.angularjs.org/api/ng/service/$compile#directive-definition-object)のプロパティのことを指します。使わないAPIの方が多いです。\n\n- `restrict`: 基本的に`E`のみ、稀に`A`、あとは不要\n- `templateUrl`: HTMLが1行程度と短ければ`template`プロパティを使ってもよい\n- `scope`: **Isolate scope**を生成させるため常に`{...}`で記述する\n- `controller`: `controllerAs`も併記すること\n- `bindToController`: 1.4.0以降ならば`scope`より扱いの楽なこちらが便利\n\nあとは覚える必要がないです。ここで、AngularJSのDirectiveをフル活用している方からは疑問が上がるかもしれません。\n\nオススメ度: ★★★\n\n### compile, linkはどうするの?\n**Q.** `compile`, `link`を多用していますが不要ですか?\n\n**A.** Angular 2ではこのフック方法が変更されるので、依存しすぎないよう注意してください。`compile`, `prelink`, `postlink`の移行方法は現時点（2015/5）では明示されていませんが、ソースを読む限りAngularJSと同等のAPIは提供されないことが分かっています。Angular 2はDOMの直接書き換えを推奨していないので、こうなっているのかもしれません。\n\nもし`compile`内でjQueryを多用している場合、慎重に置き換える必要があります。jQueryとの付き合い方は§4にて後述します。\n\nオススメ度: ★★☆\n\n### requireはどうするの?\n**Q.** `require`で親Directive Controllerに依存しています。`link`が廃止されると困りますが、どうすればいいですか?\n\n**A.** Angular 2では[`@Parent`#](https://angular.io/docs/js/latest/api/annotations/Parent-class.html)や[`@Ancestor`#](https://angular.io/docs/js/latest/api/annotations/Ancestor-class.html)といった新しいアノテーションが採用されます。このAPIを活用することを念頭において、`link`内ではあまり複雑なことをせず、さっさとControllerに渡すのが賢明です。\n\n筆者の例を掲載します。（TypeScriptで実装していたので、例もTypeScriptです）\n\n\u003e https://github.com/likr/interactive-sem/blob/master/app/src/views/dialogs/add-latent-variable.ts#L83-L89\n\n```js\nstatic link($scope: Scope, _: any, __: any, controllers: any) {\n  // controllers引数にはrequire配列と同じ順序で格納されている\n  var cwModal = controllers[0];\n  var self    = controllers[1];\n\n  $scope.dialog = cwModal.dialog;\n  self.init();\n}\n```\n\nこのときはダイアログのプラグインを使っていたので、そのインスタンスを取得する必要がありました。\n\n```js\n{\n  controller: Controller,\n  controllerAs: 'Controller',\n  link: link,\n  require: ['^cwModal', directiveName], // \u003c- requireを配列にする\n  restrict: 'E',\n  scope: {\n    locale: '\u0026isemIoLocale'\n  },\n  templateUrl: app.viewsDir.dialogs + 'add-latent-variable.html'\n}\n```\n\nこのように`require`を`Array\u003cstring\u003e`型の配列にすることで、複数のControllerを指定できます。この時自身のDirective名（ここでは`directiveName`変数に格納済）を与えると自身のControllerが取得できるのです。\n\nDirective Controllerの生成タイミングは`link`実行**前**なので、別途`link`から`init()`を呼んで初期化処理のタイミングを`link`実行後にさせています。`link`関数内とControllerを繋ぐ手段が`$scope` (Isolate scope)なので、`$scope.dialog = cwModal.dialog;`として渡します。\n\nオススメ度: ★☆☆\n\n### restrictはEのみ?\n**Q.** restrictは`A, C, E, M`の4種とそれらの組み合わせですが、`E`以外は使いませんか?\n\n**A.** はい、基本的には`E`しか使わないと覚えてください。`restrict` APIは不必要に混乱を招いたと考えています。\n\nそもそも各所で喧伝されている4種のうち`M`はドキュメントから省かれています（APIとしては現存）。そして`C`の用途ですが、これはIE8以前の非HTML5に対応するためのもので、現代では不必要となっています。\n\n残る`A, E`については、基本的には**タグ名をDirectiveとする**`E`を使えば間違いなく、より応用的にDirectiveを利用する場合のみ属性名をDirectiveとする`A`を考慮してもよいでしょう。`AE`という同時指定はプロジェクト内検索を困難にしチーム内にも混乱をもたらすため、使うべきではありません。\n\nAngular 2では`restrict`は廃止され[`@Component`#](https://angular.io/docs/js/latest/api/annotations/Component-class.html)と[`@Directive`#](https://angular.io/docs/js/latest/api/annotations/Directive-class.html)に分かれ`selector`プロパティで指定するため、明確となっています。\n\n- `E`: タグ名 -\u003e Angular 2では`@Component`\n- `A`: 属性名 -\u003e Angular 2では`@Directive`\n- `AE`: 使わない!\n- `C`: 使わない!\n\nオススメ度: ★★★\n\n### replaceは使ってもいいですか?\n**Q.** Directive自身を`template`と置換してレンダリングする`replace`は使ってもいいですか?\n\n**A.** [DEPRECATED](https://github.com/angular/angular.js/blob/bab474aa8b146f6732857c3af1a8b3b010fda8b0/src/ng/compile.js#L300)です、使うべきではありません。\n\n`svg`内では独自タグ名が使えないため`replace`を採用されることがあるかもしれません。廃止は次期メジャーバージョンとされていますが、今のうちからDEPRECATEDだと意識しておくとよいでしょう。`svg`内で自作のDirectiveを適用したい際には、`restrict: A`に設定した上で工夫してください。\n\nオススメ度: ★☆☆\n\n### Isolate scopeとは?\n**Q.** Isolate scopeとは何ですか? `scope`の指定は`@=\u0026`などの指示子があってややこしいです。\n\n**A.** Isolate scopeとは親子でScopeを共有しない**Directiveの独立したScope**のことです。AngularJS公式の提供が複雑でいまいち理解されていませんが、Isolate scope以外を使うべきではありません。\n\n`scope`プロパティには、自身に無ければ親を参照しにいくという複雑極まりない仕様があり、これはグローバル変数が起こす副作用と混乱に等しい問題でした。筆者は「親子共有問題」と呼んでいます。これは`controllerAs`が普及しプロパティ元が明記されるにつれ緩和しましたが、根本的解決にはなりません。\n\nこの問題を解決するにはIsolate scope（分離スコープ）を導入します。これは`scope: {}`のようにObjectリテラルを与えて使います。この時、値の継承方法として`@=\u0026`という3種の指示子が提供されており、これについては[以前まとめました](http://qiita.com/armorik83/items/72f12cb3a6f040fb8364)。結論として筆者は`\u0026`以外不要と考えています。\n\n「`\u0026`はfunction として結び付ける」という解説があり、これではあまりピンときません。そこで「`\u0026`はReadonlyだ」と置き換えれば解釈しやすいでしょう。`\u0026`の対比としてバインド可能な`=`がありますが、これは隠蔽せず共有してしまうので、なるべく使わない方針です。React経験者ならば`props`に近い一方向のフローと言えばイメージしやすいでしょうか。\n\nプロジェクト内のDirectiveをIsolate scopeにするならば、全て統一して用いるのがベターです。レガシーなソースに段階的に導入するならば仕方ないのですが、スクラッチで実装する場合は一律でIsolate scopeにした方が、混乱も少なく、後々の拡張性や差し替えを容易にします。ひとつ注意としてプロパティが一つもないDirectiveの場合は`scope: {}`と空のObjectを与える必要があります。こうしなかった場合、親子共有されるただのScopeが生成されます。\n\nオススメ度: ★★☆\n\n### Scopeの命名は?\n**Q.** `scope`はHTML属性名もプロパティ名も同名でかまいませんか?\n\n**A.** これは注意してください。よく迷うのが`scope`の命名です。`{prop: '\u0026'}`と書けば`\u003cmydir prop=\"\"\u003e`のように同名のHTML属性として扱えます。ただし筆者の経験では、プロジェクト内検索の利便性と視認性の両側面から、多少冗長でもプロジェクト毎の接頭辞を付けることをおすすめします。別途、独自プラグインを作成しそのDirectivereの`strict`が`A`だった場合に、その属性名がどのプロジェクト or プラグインに属すのか、混乱が起きやすいのです。\n\n接頭辞を扱うためには、`{prop: '\u0026myProp'}`といったキャメルケース形式で記述し、使用時は`\u003cmydir my-prop=\"\"\u003e`と記述します。AngularJSでは`ng`が用いられていますね。この話題も[以前の記事](http://qiita.com/armorik83/items/72f12cb3a6f040fb8364#1-3)で触れています。\n\nAngular 2ではHTML内にAngular独自の構文が導入されるため、判別がつきやすいようになっています。\n\nオススメ度: ★★☆\n\n### bindToControllerは使ってもいいですか?\n**Q.** `bindToController`を最近よく見かけますが、使ってもいいですか?\n\n**A.** はい、積極的に使っていきましょう。ただ個人的には1.3以前で`scope`を使っているなら`bindToController`に急いで置き換える必要はないと考えています。余裕があったらついでに、くらいで。\n\n`bindToController`は`scope`とよく似たAPIですが、Controllerの`$scope`に格納されず、Controllerの`this`に直接格納されるという仕組みです。筆者はこの新APIをAngular 2移行への段階的な導入と解釈しています。HTML側で`{{controller.$scope.prop}}`と冗長に書く必要があったところを`{{controller.prop}}`と書ける点がメリットです。\n\nAngularJS 1.3.0から導入されていたこのAPIは、初期はあまり話題になったと感じていません。1.4.0からは直接`bindToController`にプロパティ`{}`を記述できるようになったため、利便性が向上しました。このAPIの紹介は本稿では煩雑になるため、別の機会にします。\n\nオススメ度: ★★☆\n\n## ng-controllerベースからDirectiveベースへ\nAPIへの理解が整ったところで、`ng-controller`から脱却する手順について解説します。\n\n```js\nclass MainController {\n  constructor() {\n    this.user = 'John';\n  }\n}\n\nangular.module('myApp', []);\nangular.module('myApp').controller('MainController', MainController);\n```\n\n```html\n\u003cdiv ng-controller=\"MainController as main\"\u003e\n  \u003cp\u003eHello, {{main.user}}!\u003c/p\u003e\n\u003c/div\u003e\n```\n\n§1の例をベースに進めていきましょう。\n\n### Directive Definition Objectの定義\n\nDDO - Directive Definition Objectを返す関数`mainDDO()`を定義します。\n\n```js\nclass MainController {\n  constructor() {\n    this.user = 'John';\n  }\n}\n\nfunction mainDDO() {\n  return {\n    restrict: 'E',\n    controller: MainController, // Classを与える\n    controllerAs: 'main',\n    scope: {} // 使わない場合も空ObjectでIsolate scope化\n  };\n}\n\nangular.module('myApp', []);\nangular.module('myApp').directive('main', mainDDO);\n```\n\n次に`\u003cmain\u003e`タグの中身を定義する`template`を記述しましょう。\n\n### Templateの定義\n\n```js\nclass MainController {\n  constructor() {\n    this.user = 'John';\n  }\n}\n\nfunction mainDDO() {\n  return {\n    restrict: 'E',\n    controller: MainController,\n    controllerAs: 'main',\n    scope: {},\n    template: '\u003cp\u003eHello, {{main.user}}!\u003c/p\u003e' // 追加\n  };\n}\n\nangular.module('myApp', []);\nangular.module('myApp').directive('main', mainDDO);\n```\n\n```html\n\u003cdiv ng-controller=\"MainController as main\"\u003e\n  \u003c!-- この\u003cp\u003eをtemplateにする --\u003e\n  \u003cp\u003eHello, {{main.user}}!\u003c/p\u003e\n\u003c/div\u003e\n```\n\nIsolate scopeを使うので、`template`または`templateUrl`を**必ず**導入する必要があります。Isolate scope利用時は、そのDirective内にHTMLを記述することはできません。つまり、`\u003cmain\u003e...いろいろ...\u003c/main\u003e`とならず、常に`\u003cmain\u003e\u003c/main\u003e`のみとなります。これによって`transclude`オプションも使用できなくなりますが、`transclude`は挙動がとにかく取っ付きづらく、筆者は一度も活用できたことがないので、気にすることはないでしょう。自作Directiveはタグ内に何も書かず、属性とIsolate scopeをインタフェースとして使うものと覚えるとシンプルです。\n\n筆者は個人的好みで`templateUrl`を使い、2行以上ならば全てHTMLファイルに記述しています。最近はES6の新構文[Template strings](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/template_strings)の有用性も認められてきたので、望むならば`template`に全てのHTMLを記述するスタイルでも構わないです。\n\n### 作成したDirectiveをHTMLに導入\n\n```js\nclass MainController {\n  constructor() {\n    this.user = 'John';\n  }\n}\n\nfunction mainDDO() {\n  return {\n    restrict: 'E',\n    controller: MainController,\n    controllerAs: 'main',\n    scope: {},\n    template: '\u003cp\u003eHello, {{main.user}}!\u003c/p\u003e'\n  };\n}\n\nangular.module('myApp', []);\nangular.module('myApp').directive('main', mainDDO);\n```\n\n```html\n\u003cmain\u003e\u003c/main\u003e\n```\n\nHTML側を`\u003cmain\u003e\u003c/main\u003e`にして完成! お疲れ様でした。`ng-controller`から移行するとき、`ng-controller=\"as\"`が未導入で`$scope`が入り混じってる状態だと`\u003cmain\u003e`が持つIsolate Scopeとごちゃ混ぜになり**とてもつらい**ので、先に`as`の導入、次にClassへの移行と、順次済ますのが得策です。\n\n### compileやlinkはどこに記述するか\n`compile`, `link`はAngular 2への移行を阻害するため縮小方向が望ましいですが、いきなり無くすわけにもいきません。筆者はこのケースを次のようにまとめています。\n\n```js\nexport class MainController {\n  constructor() {\n    this.user = 'John';\n  }\n}\n\nexport class MainDefinition {\n  static postLink(scope, iElement, iAttrs) {\n    // ...\n  }\n\n  static ddo() {\n    return {\n      restrict: 'E',\n      controller: MainController,\n      controllerAs: 'main',\n      link: MainDefinition.postLink,\n      scope: {}\n    };\n  }\n}\n\nangular.module('myApp').directive('main', MainDefinition.ddo);\n```\n\nfunctionを並べずにexport classで括った理由は、まとまった単位のほうがテストで扱いやすかったためです。\n\n## ところでなんでDirectiveがいいの\n`ng-controller`はAngular 2で廃止されると述べましたが、なぜ筆者が現段階でDirective化を勧めているか補足しておきます。\n\nDirective化促進の理由はいくつかあります。\n\n**1.** テンプレートを小さく保ちたいという動機が大きいです。筆者は長らくJavaScriptよりHTML + PHPを書いてきた背景があり、HTML内のリファクタリングの困難さを痛感していたため、とにかくHTMLの部品は小さく、汎用性を高く、という願いがありました。HTMLの見通しがよくないことは、肥大したHTMLを扱うほど実感されると思います。Bootstrapなどを扱っていて`\u003cdiv\u003e`が増えすぎることをDirectiveでセマンティックに隠蔽できる利点も大きい。可読性を引き上げ事故を防げるDirective、これを用いない理由はないというのが持論です。\n\n**2.** 次に、Isolate scopeを積極的に使いたい動機です。前述したようにScopeの親子共有問題というのが厄介で、Child scopeの生成されない要素は、親Scopeではなく兄弟のChild scopeを引き継ぐという[不可解な仕様](http://qiita.com/armorik83/items/38fe685cc76163c7e8ce#scope%E3%81%AF%E3%83%9B%E3%83%B3%E3%83%88%E3%82%84%E3%82%84%E3%81%93%E3%81%97%E3%81%84%E3%81%8B%E3%82%89%E6%B0%97%E3%82%92%E3%81%A4%E3%81%91%E3%82%88%E3%81%86%E3%81%AA)に悩まされるくらいなら、もう単純明快なIsolate scopeだけ使っていれば混乱しないのでは。\n\n**3.** そして、やはりAngular 2への移行を段階的にしたい思いがあります。Angular 2はComponent指向で、独自タグと`template`を中心にした実装となっていきます。AngularJSとAngular 2の距離を縮めることを考える時、AngularJSのDirective化が整っている方が大幅な設計見直しをせずAngular 2に向けてステップアップできると睨んでいます。\n\n分割は不便、面倒だと感じる方もおられるでしょうが、モダンなComponent指向のフレームワークならば全てこうなっており、ReactのJSXも同様です。汎用性が上がり、差分管理が容易になることで可読性、保守性も高まる。メリットは大きいです。\n\nオススメ度: ★★☆\n\n# §3 ES6 moduleとAngularJS DI\n本章ではAngularJSの特徴として挙げられるDIを考察し、Angular 2で採用されるES6 moduleについて触れながら、現段階の付き合い方や今後の実践について紹介します。\n\n## AngularJSのDIとは?\nDIとはDependency Injectionの略語で、日本語では依存性注入です。かの[Martin Fowler](https://ja.wikipedia.org/wiki/%E3%83%9E%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%83%BB%E3%83%95%E3%82%A1%E3%82%A6%E3%83%A9%E3%83%BC)が提唱しました。ディペンデンシー・インジェクションというと大層な感じですが、積極的に実践すべき設計で、特殊なものだと思わないでください。以下はJavaの事情などは含めず「AngularJSにおける」DIの話です。\n\n### AngularJS DIの例\n\nAngularJS DIの解説によくある`constructor`内で`new`する例です。\n\n```js\nclass RootController {\n  constructor() {\n    this.store    = new Store();\n    this.renderer = new Renderer();\n  }\n}\n```\n\nこのコードの問題は、テストの際も本物の`Store`と`Renderer`を必要とする点です。`Store`がもし通信を必要とするモジュールならば、テスト毎に待たなければなりません。ここでモック・テストを行うためには、`RootController`に向かって`MockStore`を「注入」する必要があります。\n\n### DIを導入すると\n\n```js\nclass RootController {\n  constructor(store, renderer) {\n    this.store    = store;\n    this.renderer = renderer;\n  }\n}\n```\n\n```js\nvar rootController = new RootController(\n  new Store(),\n  new Renderer()\n);\n\nvar mockRootController = new RootController(\n  new MockStore(),\n  new MockRenderer()\n);\n```\n\n`constructor`に引数を設けるとモックへ差し替える余地が生まれました。DI自体はこれだけのことで簡単に実践できます。AngularJSでは`var rootController = new RootController(...)`に相当する処理を内部でうまいことやってくれるので、そのために必要な定義がDIアノテーション、ということになります。自力で準備、実装することを「オレオレDI」と呼ぶこともあります[^3]。\n\nAngularJSはこのDIを当初から提供したことで疎なテストを行いやすくし、[Karma](http://karma-runner.github.io/0.12/index.html)や[Protractor](http://angular.github.io/protractor/#/)の提供をもってテストの重要性を説きました。\n\nオススメ度: ★★★\n\n## AngularJSのCommonJS採用、そしてAngular 2へ\n### CommonJS, Browserify\n[Node.js](https://nodejs.org/)ではCommonJSという、1ファイル1モジュールとしてインタフェースや依存性を記述するモジュール管理を採用しています。一方、ブラウザ上ではHTMLに`\u003cscript src=\"\"\u003e\u003c/script\u003e`をいくつも並べるローディングが長らく主流で、`CommonJS`はサーバサイドのものという印象が強めでした。\n\nそれが2014年頃から[Browserify](http://browserify.org/)、[webpack](http://webpack.github.io/)を用いてブラウザ上でも`CommonJS`スタイルで記述し、HTMLには生成物である`\u003cscript src=\"bundle.js\"\u003e\u003c/script\u003e`を1行記述するだけというスタイルも現れ、少しずつ浸透しています。複数回の`\u003cscript\u003e`ローディングによる通信の遅れを減らせ、[npm](https://www.npmjs.com/), [Bower](http://bower.io/)とパッケージ管理が分散せずに簡潔に済むことが利点だと筆者は認識しています。@teppeis氏の[こちらの記事](http://teppeis.hatenablog.com/entry/2015/05/es6-modules-and-http2)も参考になります。\n\nAngularJSはこれまでCommonJSに対応せず、`\u003cscript src=\"angular.js\"\u003e`での読み込みとグローバル変数`angular`を使って実装する従来のスタイルでした。それが1.3.14からはCommonJSに正式に対応し、次のようなコードで参照できるよう改良されています。\n\n```js\nvar angular = require('angular');\n```\n\nAngularJSには`angular.module('moduleName', ['requires'])`というAngularJS独自のモジュール機構があります。この機構とCommonJS、そしてAngular 2に採用されるES6 moduleとはどのように付き合っていくべきでしょうか、次の節で解説します。\n\n### ES6 module\n\nES6 moduleとはCommonJS module (`require`, `module.exports`)の仕組みに近いモジュール機構で、ES6の**言語レベルで備える**点が最大の特徴です。\n\n```js:commonjs.js\nvar otherModule = require('other-module');\n\nmodule.exports = function mymodule() {\n  // ...\n};\n```\n\n```js:es6.js\nimport otherModule from 'other-module';\n\nexport function mymodule() {\n  // ...\n};\n```\n\n比較すると概ねこのようになります。厳密にはES6には`default`などの仕様が加わるため、全てCommonJSの仕様と一致するわけではありません。TypeScriptでは1.4からES6 moduleの構文で記述が可能となりました。\n\n### AngularJS module\n\nAngularJSには`module`や`service`, `directive`, `controller`…とても用語が多く用途も似ているので大変混乱しやすいです。\n\n筆者は次のように考えています。\n\n- `angular.module()`: アプリケーション名、または提供するプラグイン名（まとめてプロジェクト名と称する）\n- `angular.module().service()`: そのプロジェクト内の肥大化を避けるために適宜分割する単位\n\nAngularJS moduleは粒度がだいぶ大きく、これまでに述べたCommonJS/ES6 moduleとは性質が違うので、混同しないよう注意してください。CommonJS/ES6 moduleに相当するものとしてはAngularJS Serviceが近いです。\n\n## 移行を見据えたAngularJSでの考え方\nここまで、AngularJSを取り巻くいくつかのモジュール機構（AngularJS module, CommonJS module, ES6 module）とAngularJSの特徴であるDIを紹介しました。AngularJSのmoduleが先行していたため、後発の仕組みと食い違い、複雑なものとなってしまいました。\n\n一旦整理し、何をどう扱うか説明しましょう。\n\n### AngularJS moduleはアプリケーション内にひとつ\n前述のとおり、AngularJS moduleは粒度が大きい単位なので、アプリケーション内でいくつも用いることはアンチパターンだと捉えています。可搬性を考えると、ひとつのアプリケーションにはそのアプリ名を与えた単独のAngularJS moduleで運用すべきです。\n\n他のユーザにAngularJSプラグインを配布する場合は、ここにはプラグイン名が入ります。\n\nオススメ度: ★★★\n\n### 移行に向けての分割\nAngular 2はES6 moduleを積極的に活用する設計となっており、今からES6 moduleに関心を持つのは良いことです。ただ、今すぐAngularJSをES6 moduleに書き換えるべきかといえばそうとも限りません。いずれAngular 2で適合するように再度修正する作業は発生します。\n\nただし、各種Service, Controller, Direcitiveを1ファイル内にひとつにしていくリファクタリングは、早めに意識しておくべきです。1ファイル内にいくつも定義している方はAngular 2での移行コストにES6 module導入の手間も加わるので、早めに段階的に分けて備えましょう。\n\nなお、`angular.module('myApp')`はチェーンにせず毎回書くべきという方針です。筆者の場合、1ファイルに1`angular.module('myApp').*`という方針にしており、1ファイル内にあれこれ定義しません。例外的に複数書くのは`angular.module().run()`と`angular.module().config()`のみです。\n\nオススメ度: ★★☆\n\n### CommonJS + Browserifyスタイルを好む方は\nAngularJS 1.3.14からCommonJSが採用されたことで、Browserify[^4]の導入が容易になりました。Browserifyに詳しくない方は無理して導入する必要はありません。そして知識や経験がある方ならば、現時点からCommonJS化、Browserify対応を始めることは間違っていません。\n\n筆者はBrowserifyに対応したスタイルでAngularJSを[書いています](https://github.com/likr/interactive-sem/blob/master/app/src/scripts/app.ts#L11)。そして「1ファイル1Service」はそのまま「1ファイル1module[^5]」と置き換えられるので、Service自体を一切使わないようになりました。`angular.module().service()`や`.factory()`を使うことでAngularJS DIを利用できるというメリットは、[proxyquire](http://qiita.com/armorik83/items/46781adda80e9d53f7ee)を使うことで保っています。\n\nオススメ度: ★☆☆\n\n### proxyquireの実験\nAngularJSのDIはテスト利便性のためという性質が強いので、ここが維持できるならばAngularJSが提供するDIにこだわる必要は無いと筆者は考えました。proxyquireを併用すると、`$inject`の記述を少なくでき、ブラウザのローディングでどうしても実行が遅いKarmaから、高速なNode.js + [Mocha](http://mochajs.org/)に切り替えられる点をメリットと捉え実践してみました。\n\n筆者の[実際に運用したテスト](https://github.com/likr/interactive-sem/blob/master/test/unit/views/network-diagram/root-spec.js#L21-L30)です。実はこのときはまだproxyquireに気付いておらず、自力で似たような機構を実装していたためコード量が増えてしまっています。方向性としては同じです。\n\nこのproxyquireで複数のモジュールをモック化しているだけでなく、AngularJS DIを用いる`$rootscope`や`$timeout`もL21-L30でモック化して与えています。例にはありませんが、`$resource`などのモック化も同様に行えます。\n\nただしこれは尖ったアプローチで、一般的ではないと自覚して試みています。過度にやりすぎると今度はテスト自体が負債となる恐れもあり、筆者自身もまだバランスを確かめている段階です。\n\nオススメ度: ☆☆☆\n\n## Angular 2のDI\nAngular 2では、ServiceとFactoryの違いに悩まずに済むDI機構や、ES6 moduleと親和性の高い[SystemJS](https://github.com/systemjs/systemjs)というモジュール管理機構を推奨しています。SystemJSはあまり馴染みがないですが「郷に入っては郷に従え」となるのかもしれません。\n\n# §4 jQuery\n\n事を荒立てる前に言うならば、jQueryから完全脱却できない話は止むを得ないことだと感じています。そして意見に流されすぎるのもよくありません。主観的には様々な感情論があることでしょうが、それは置いておきます。\n\n## DOM操作に対する時代の変化\n仮想DOMの登場はjQuery主流だったWeb制作からすると新たな潮流です。仮想DOMの詳説は別の記事に譲ります。仮想DOMは差分検出を主としているため、jQueryを通じて──もちろん他の手段でもですが──DOMを直接操作すると仮想DOMの情報と実際のDOMに食い違いが発生します。そのため仮想DOMを用いるViewライブラリではjQuery等による手動DOM操作はご法度とされるようになりました。\n\nまたjQueryは、もともとはゼロ年代のブラウザ間差異を吸収する目的で普及が進み、jQuery 2系の方針からも分かるように、現代ではレガシーブラウザはサポートされない方向に進んでいます。どうしても意図的に直接HTML要素を操作する場合も、現在は[DOM](https://developer.mozilla.org/ja/docs/DOM) APIが提供する範囲で十分賄えると感じます。ここでどうしてもjQueryの力が必要というときに使えばよいでしょう。\n\n## 負の遺産と嗅覚\n**身元の怪しい**jQueryプラグインから脱却できない事情は、負の遺産にしかなりえないと考えており、筆者はまったく賛同しません。これはjQueryに限らず何のライブラリ、フレームワークにおいても同様で、AngularJS向けのプラグインについても言えます。\n\n代表的なAngularJSプラグインに[AngularUI](http://angular-ui.github.io/bootstrap/)があります。これはAngularJS 1.4が控えてる今になってようやく1.3に対応したので、決して早い対応ではありませんでした。このようにプラグインを採り入れることは自らに足枷をはめることと同義になりかねないため、開発コミュニティの体力や活性度、採用することで得られるメリット、負の遺産としないための疎な設計、これらを十分に考慮すべきです。\n\n低品質なプラグインに対する嗅覚は常日頃養いたいものです。\n\n## Angular 2は脱jQuery\n誤解をされている方がいるようですが、AngularJS 1.xはむしろjQueryとの親和性を意識して設計されました。それは今日になっても変わっていません。AngularJSのロードより前に`$`グローバル変数が存在した場合、自動的にmixinして`angular.element()`で使えるようになっています。\n\nただし、親和性が高いからといって無頓着に増やし続けると、それはAngular 2への移行を困難にします。Angular 2では逆にjQueryを**推奨していません**。これは前述した仮想DOMの事情に近く、Change Detection（[開発者の記事]((http://victorsavkin.com/post/110170125256/change-detection-in-angular-2))）を正しく動作させるためには直接DOMを操作すべきでないからです。Change DetectionはAngular 2の高速化に寄与しており、これは1系から2に移行する最大のメリットとなるでしょう。\n\n§2で`compile`, `link`には依存しすぎないよう注意せよと述べました。これはjQueryを極力控えるべき事情と通じています。\n\n## AngularJSとjQueryの付き合い方\nではjQueryを多用しているAngularJSプロジェクトはどのように乗りこなすべきでしょうか。答えは[`ngIf`#](https://docs.angularjs.org/api/ng/directive/ngIf)や[`ngShow`#](https://docs.angularjs.org/api/ng/directive/ngShow), [`ngHide`#](https://docs.angularjs.org/api/ng/directive/ngHide)の駆使にあります。\n\n多くの場合、ダイナミックなHTML要素の追加には`ngIf`を使用してください。`ngIf`は`boolean`に従いDOMをその都度生成・削除します。どうしてもこの生成パフォーマンスが気になった場合には`ngShow/ngHide`を使えます。これは`display: none`によって要素は残しながら非表示とします。\n\nリッチなUIを実現するとき、しばしばアニメーション効果が望まれます。これは[`ngAnimate`#](https://docs.angularjs.org/api/ngAnimate)と[CSS Transitions](https://developer.mozilla.org/ja/docs/Web/Guide/CSS/Using_CSS_transitions)にて表現可能です。フェードイン・アウトはCSS Transitionsで制御する都合上`ngShow/ngHide`の方が扱いやすいです。ダイアログ、プルダウンメニュー、リストや通知の挿入、削除は`ngAnimate`で十分対応可能です。\n\n申し訳ないのですが筆者はあまり過度のアニメーション装飾を好まないため、これ以上複雑な動きには必然性を感じていません。どうしてもそういった動きを実現するのにjQueryが必要と考えるならば、同時にAngularJSが本当に必要かどうかについても検討できるでしょう。そこでAngularJSが必要ならば、これはCSS Transitionsの可能性を拡げるきっかけにも繋がります。\n\n適材適所と言ってしまえばそれまでですが、世の流れを窺いながら適切に付き合っていきましょう。\n\nオススメ度: ★★☆\n\n# §5 AngularJSの気になるところ\n本章では、まとまり切らないながら重要である疑問について扱います。\n\n## $scopeをcontrollerAsに置き換えると$watchはどうすれば?\n**A.** 問題なく使用できます。\n\n§1で`$scope`はControllerの`this`に置き換える手法を紹介しました。そうなると`$scope.$watch`はどう扱えばいいのか疑問が起こります。\n\nこれは全く問題がなく、`$scope`を、Controllerのプロパティを生やすためのServiceとして捉えずに「`$scope`は`$watch`を提供するためのServiceである」と認識を改めるとよいでしょう。なので他のService、例えば`$resource`をDIするのと同じ感覚で`$scope`をDIしてください。\n\n```js\nclass MainController {\n  constructor($scope) {\n    this.$scope = $scope;\n    this.user = 'John';\n\n    this.$scope.$watch('main.user', (newVal) =\u003e {\n      console.log(newVal);\n    });\n\n    MainController.$inject = ['$scope'];\n  }\n}\n\nfunction mainDDO() {\n  return {\n    restrict: 'E',\n    controller: MainController,\n    controllerAs: 'main',\n    scope: {},\n    template: '\u003cinput type=\"text\" ng-model=\"main.user\"\u003e\u003cp\u003eHello, {{main.user}}!\u003c/p\u003e'\n  };\n}\n\nangular.module('myApp', []);\nangular.module('myApp').directive('main', mainDDO);\n```\n\n[動作サンプル](http://jsfiddle.net/c9ufb5sg/)です。意外かもしれませんが、`$watch`対象は`$scope`に格納されたプロパティに限っておらず`$watch('ここに書かれた式')`によって解決されています。式はHTMLの`{{main.user}}`と同等のものです。\n\nオススメ度: ★★★\n\n## $broadcast, $emit, $onは使ってもいいですか?\n**A.** 答えに詰まりますが、Angular 2では別の機構に置き換えられ[互換性のあるAPIは用意されない](http://qiita.com/armorik83/items/d3d93ee1e4454e01d2a3)ため、これを理解した上で用いるなら可です。\n\nStackOverflowを眺めていても気付くところで、`$broadcast`には誤解があるようです。筆者もその一人で、どうやら`$broadcast`を[EventEmitter](https://nodejs.org/api/events.html)と同じように扱うことは開発陣は想定していないようでした。AngularJSとしては、むしろこのAPIを[Mouse Event](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent)といったWeb APIに対して使うものと想定していたようで、その証拠にAngular 2に`$broadcast`に替わるものとして用意された[hostListeners](https://angular.io/docs/js/latest/api/annotations/Directive-class.html)の機構は、マウスやウインドウのイベント取得に向けて設計されています。\n\nではAngularJS内で`$broadcast`をEventEmitter的に使ってはダメかというと、そうではありませんが、推奨されていないと認識すべきです。Angular 2で同等の機構を実現するならば、Reactと同様にEventEmitterを継承して使えばよいようです。\n\nオススメ度: ★★☆\n\n## Filterはどのように扱っていますか?\n**A.** 内蔵されているもの以外は使っていません。\n\n筆者はあまり自作Filterを量産しようとは考えておらず、極力汎用ライブラリの処理結果をbindさせる手段をとっています。これはAngularJSから他社フレームワークに乗り換える必要が生じた際への対策といえます。汎用ライブラリの例は§6にて扱います。\n\nところで、Angular 2には[Pipes](https://angular.io/docs/js/latest/api/pipes/)というAPIが備わっており、これがAngularJSでいうFilterに相当します。Angular 2のPipesに関する情報は@laco0416氏の[こちらの記事](http://qiita.com/laco0416/items/ae426eeb07db207dda44)をお勧めします。\n\nオススメ度: ★☆☆\n\n## ルータの最適解はComponent Routerですか?\n**A.** 残念ながら[Component Router](https://angular.github.io/router/)を使う時期はまだ来ていません。\n\nComponent Routerとは、2015年3月にNew Routerとして発表されたAngularチームが開発している新しいRouterです。New Routerの名称は陳腐化すると指摘があり、現在は（通称）Component Routerと呼ばれています。これはAPIがまだ安定しておらず、AngularJS 1.4.0にも間に合わないとアナウンスされている[^6]ため、今急いで導入する必要は無いでしょう。\n\n[Component Routerを実際に使う例](https://github.com/likr/gdgkobe20150429/tree/master/step3)が2015年4月のGDG神戸 Angular勉強会#3でありましたので、紹介しておきます。\n\n筆者はDirective化を強く進めた結果、[ui-router](https://github.com/angular-ui/ui-router)を必要とすることなく[ngRoute](https://docs.angularjs.org/api/ngRoute)で落ち着いてしまいました。ui-routerの有用性は認めているので、これは純粋に好みによるものです。ヒントを期待されていたならば、ごめんなさい。\n\nオススメ度: ★☆☆\n\n# §6 armorik83流モダン開発環境 \n最後の章では、筆者がモダンだと考えているAngularJSの開発環境について記しておきます。Angular 2を意識してはいますが、入門者から熟練者まで幅広く受け容れられる構成とは思っておらず、参考にされる程度で構いません。\n\n## 汎用ライブラリ\nライブラリはできるだけ少なめにしたいという指針をもって選んでいます。\n\n- [lodash](https://lodash.com/docs)\n- [string.js](http://stringjs.com/)\n- [Moment.js](http://momentjs.com/)\n- [decimal.js](http://mikemcl.github.io/decimal.js/)\n- [D3.js](http://d3js.org/)\n- [es6-promise](https://github.com/jakearchibald/es6-promise)\n- [EventEmitter](https://nodejs.org/api/events.html)\n\nオススメ度: ★★☆〜★★★\n\n## 言語\n**TypeScript**\nまずは[TypeScript](http://www.typescriptlang.org/)です。TypeScriptとの付き合いもAngularJS歴と同じ2年弱で、強固な相棒でした。\n\nかつてJavaScriptでClass構文を使いたいならばTypeScriptしか選択肢がありませんでした。これもTypeScriptを選択した大きな理由です。最近は次に挙げるBabelも使います。\n\nオススメ度: ★★★\n\n**Babel**\n[Babel](https://babeljs.io/)はもう手放せない存在です。AngularJSアプリケーションの場合、型を重視したいためTypeScriptを用いますが、シンプルに1000行程度で収まるライブラリはBabelで書くようになりました。2015年はBabelが急成長しており、TypeScriptでなくともClass構文を採り入れやすくなっています。Babelで書く場合でも、TypeScriptの`.d.ts`は用意しており、これは下手なドキュメントより優秀です。\n\nそのほか、テストではモックへの型検証がかえって邪魔になることがあるので、TypeScriptを使わず、すべてES6 + Babelで書いています。\n\nオススメ度: ★★☆\n\n**dtsm**\n型定義`.d.ts`のインストールと管理は@vvakame氏の[dtsm](http://qiita.com/vvakame/items/38b953ab0f4de63cce8b)で行います。[tsd](https://github.com/DefinitelyTyped/tsd)と違い、コマンドがシンプルで複数のリポジトリに分散した型定義も管理しやすいだけでなく、やはり国産でバグ報告と修正が円滑という強みがあります。\n\nオススメ度: ★★★\n\n**ESLint**\n[ESLint](http://eslint.org/)は[最近使い始めたら](http://qiita.com/armorik83/items/861e8b883ea5893a3320)とても気に入ったので、今後もBabelで書く際は併用したいと考えています。一方、[TSLint](https://github.com/palantir/tslint)は残念ながら処理待ちが長いため使っていません。これはコーディング・スタイル以外はtscが警告してくれるものと考え妥協しています。\n\nオススメ度: ★★☆\n\n**Less**\nCSS自体あまり書きたくないのですが、そうも言えないため[LESS](http://less-ja.studiomohawk.com/)を使っています。以前流行りだしてすぐの頃は[Sass](http://sass-lang.com/)と[Compass](http://compass-style.org/)でした。Rubyってのがどうにも馴染まず。\n\nオススメ度: ★☆☆\n\n## タスクランナーとビルドツール\n**gulp**\nタスクランナーは、今は専ら[gulp](http://gulpjs.com/)を使っています。単純なものは`npm scripts`に記述し、残りの大半は`gulpfile.js`に記述しています。以前[記事を書きました](http://qiita.com/armorik83/items/0860dc097d11f18b9973)ので、gulpについてはそちらを。\n\nオススメ度: ★★☆\n\n**Browserify**\n[Browserify](http://browserify.org/)は§3のCommonJS moduleの節でも触れました。AngularJSがCommonJSに対応したことでBrowserify導入の契機となりました。\n\nオススメ度: ★★☆\n\n## テスト\n**Mocha**\nAngularJSはテストの実行に[Jasmine](http://jasmine.github.io/)を用いて解説していますが、筆者はJasmineから[Mocha](http://mochajs.org/)に乗り換え現在も使い続けています。`describe, it`スタイルでJasmineとよく似ています。\n\nオススメ度: ★★★\n\n**Sinon.JS**\nモックの強い味方[Sinon.JS](http://sinonjs.org/)です。AngularJSのDirectiveやControllerのテストは大半をSinon.JS併用で行い、最後の網掛けとして本物を使ったe2eで埋めています。\n\nオススメ度: ★★☆\n\n**Nightmare**\nそのe2eは紆余曲折があり、Angularチームが開発している[Protractor](http://angular.github.io/protractor/#/)やGrouponの[Testium](https://github.com/groupon/testium)など、いろいろ試してきました。\n\n世の中がまだPhantomJS 2に向かいきってないのが歯痒いですが、現在は[Nightmare](http://www.nightmarejs.org/)になんとか落ち着いています。なお、残念ながらAngular 2 alphaではe2e周りがとても弱く、今後改善されることを期待しています。\n\nオススメ度: ★★☆\n\n**proxyquire**\n§3のDIの節にて紹介した[proxyquire](https://github.com/thlorenz/proxyquire)、AngularJS DIをあえて用いない、かなり尖った構成です。[詳細はこちら](http://qiita.com/armorik83/items/46781adda80e9d53f7ee)。\n\nオススメ度: ★☆☆\n\n**power-assert**\n@t_wada氏を中心に開発されている[power-assert](https://github.com/power-assert-js/power-assert)も最前線。コンソールデバッグの手間を大幅に減らせて心強い味方です。余談ですがこのプロダクトの[ロゴマーク](https://github.com/power-assert-js/power-assert-js-logo)をデザインさせていただきました。\n\nオススメ度: ★★★\n\n**cw-log**\n手前味噌で[cw-log](http://qiita.com/armorik83/items/733ba1a41cf9aec0b382)も多用しました。AngularJSで複数のClassを組み合わせると処理順を確かめたい場合が多く、本番環境でもログの出力をコントロールでき重宝しています。\n\n## RIP\n最後に、使っていたものの今は離れたライブラリを供養して締めくくります。\n\n- **Yeoman Generator**: 保守が面倒すぎて、どんどん陳腐化した\n- **Grunt**: このJSの速さについてきていない、各種プラグインが負債化\n- **Bower**: npmとBrowserifyですべて管理するので不要に\n- **Jasmine**: そこまで悪いわけではないが、Mocha + SinonJS + power-assertを考えるともう戻れない\n- **Protractor**: Jasmineに依存しているため同上の理由\n- **Underscore.js**: lodashを使っている\n- **jQuery**: §4参照\n\n# 謝辞\n本稿のためにたくさんの方々のご協力をいただきました。\n\n私がAngularJSに真摯に向き合う機会をくださり、長時間の相談と推敲にも付き合っていただいた@_likr氏、AngularJSを使い始め入門者の視点から沢山の指摘を寄せてくださった@shinsukeimai氏に感謝いたします。\n\n本稿のレビューを引き受けていただき、貴重な視点や指摘、理解の深まる質問を寄せてくださった@Quramy氏、@izumin5210氏、Angular 2の情報収集の際にとても支えとなっている@shuhei氏、@laco0416氏に感謝いたします。それぞれのAngularへの熱意がこの記事を押し上げました。@vvakame氏には私がAngularJSとTypeScriptを使い始めて間もない頃から、数々のアドバイスをいただけましたこと感謝いたします。\n\n最後に、本稿を最後までお読みいただいた皆様へ心より御礼申し上げます。本稿が皆様の役に立ち、Angularユーザがより豊かになることを願っています。\n\n2015年5月 Crescware 奥野賢太郎 @armorik83\n\n---\n\n[^1]: stableは1.4.1ですが、標準でインストールされる最新バージョンが1.5.0-betaとなっています。\n[^2]: `private`でも可。\n[^3]: オレオレDIはテスト困難なモジュールに対して暫定的に強引に導入する性質が強く、毎回やるべきではないと考えます。\n[^4]: webpack派はwebpackと読み替えて結構です。\n[^5]: CommonJSのmoduleを指します。\n[^6]: [Angular Weekly Meeting](https://docs.google.com/document/d/150lerb1LmNLuau_a_EznPV1I1UHMTbEl61t4hZ7ZpS0/mobilebasic?pli=1)議事録、開発者向けの情報です。\n","coediting":false,"created_at":"2015-05-22T10:47:14+09:00","id":"5542daed0c408cb9f605","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"TypeScript","versions":["1.5.0-beta"]},{"name":"AngularJS","versions":["1.3.15"]},{"name":"angular","versions":["2.0.0-alpha.24"]}],"title":"AngularJSモダンプラクティス","updated_at":"2015-06-01T11:08:34+09:00","url":"http://qiita.com/armorik83/items/5542daed0c408cb9f605","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003e150521現在、Angular 2.0.0-alpha.24がリリースされています。\u003cdel\u003e数版前にDeveloper Previewと銘打ったのは何だったのか\u003c/del\u003eAPI変更がけっこう多いので、覚えている限りのAPI変更を記しておきます。記憶から抜けているものがあったら下のコメント欄で補足願います。\u003c/p\u003e\n\n\u003cp\u003e以下についての変更は煩雑なので追いません。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e内部API\u003c/li\u003e\n\u003cli\u003eエラーハンドリング用API\u003c/li\u003e\n\u003cli\u003ealpha.14以前\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e見出し名が執筆時・記事修正時の最新のAPI名です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"view\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#view\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e@View\u003c/code\u003e\n\u003c/h1\u003e\n\n\u003cp\u003ealpha.19より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/pull/1285\"\u003eBig rename. Part of #1244 #1285\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a\"\u003e\u003ccode\u003ebf79337\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e@Template\u003c/code\u003e\u003cbr\u003e\nプロパティも改名\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e旧\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003eTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'my_app.html'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003einline\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e新\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003eView\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etemplateUrl\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'my_app.html'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"廃止になったもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BB%83%E6%AD%A2%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e廃止になったもの\u003c/h2\u003e\n\n\u003cp\u003ealpha.22より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/8faf6364dc344d53c619a1bdfc1ed4d856375f82\"\u003e\u003ccode\u003e8faf636\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e廃止: \u003ccode\u003e@DynamicComponent\u003c/code\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"directive\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#directive\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e@Directive\u003c/code\u003e\n\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/pull/1615\"\u003erefactor(compiler): rename decorator directives into directive #1615\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/issues/1536\"\u003eRemove concept of Viewport directives? #1536\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/f75a50c1ddb542d3898def5464629c1f13540ee2\"\u003e\u003ccode\u003ef75a50c\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/3aac2fefd7f93c74abfa5ee58aa0ea8d4840b519\"\u003e\u003ccode\u003e3aac2fe\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e@Decorator\u003c/code\u003e\u003cbr\u003e\n旧称: \u003ccode\u003e@Viewport\u003c/code\u003e（統合）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e旧\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003eDecorator\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'[house]'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003eViewport\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'[house]'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e新\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003eDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'[house]'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"directiveproperties\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#directiveproperties\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e@Directive.properties\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003ealpha.26より\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eproperties\u003c/code\u003eがObjectリテラルからArrayに変更されるという大規模なBreaking Changeが入ったため注意。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eBefore\n@Directive(properties: {\n  'sameName': 'sameName',\n  'directiveProp': 'elProp | pipe'\n})\n\nAfter\n@Directive(properties: [\n  'sameName',\n  'directiveProp: elProp | pipe'\n])\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/issues/2013\"\u003ehttps://github.com/angular/angular/issues/2013\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/d7df853bde30ffe97045eff649240284ae6ffdf8\"\u003e\u003ccode\u003ed7df853\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ealpha.19より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a#diff-4c0123a05552194ca61867261e4bafd7L70\"\u003e\u003ccode\u003ebf79337\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e@Decorator.bind -\u0026gt; @Decorator.properties\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"directivehostlisteners\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#directivehostlisteners\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e@Directive.hostListeners\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003ealpha.19より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a#diff-4c0123a05552194ca61867261e4bafd7L73\"\u003e\u003ccode\u003ebf79337\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e@Decorator.events -\u0026gt; @Decorator.hostListeners\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ng-if\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ng-if\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e*ng-if\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003ealpha.24より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/issues/1295\"\u003eCompiler should not request setters for @Viewport bindings #1295\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/issues/1598\"\u003eShould the best practice be to prefix Component and Directive selectors, but not properties of components. #1598\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/pull/1827\"\u003eIssue 1598: All @Directive need to have a prefix #1827\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/d310a9c0b466407ddce0babdf36d7e4c2476cae3#diff-3818fe897c7a5e7d204961e2cf4d7f8dL30\"\u003e\u003ccode\u003ed310a9c\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e*if\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ng-non-bindable\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ng-non-bindable\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e*ng-non-bindable\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003ealpha.24より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/78d3f62b6a38b00f1ef3dec4c1d31e8ceebdedcb#diff-424613311e4377f93494247b6dfe521aL19\"\u003e\u003ccode\u003e78d3f62\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e*non-bindable\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ng-switch\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ng-switch\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e*ng-switch\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003ealpha.24より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/e9f236b70f7e6228a16d3d93bb1ab225c9682978#diff-3eed935d2a641fa803d808d574fa6632L54\"\u003e\u003ccode\u003ee9f236b\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e*switch\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ng-for-ng-for-of\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ng-for-ng-for-of\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e*ng-for\u003c/code\u003e, \u003ccode\u003eng-for-of\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003ealpha.24より\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/111fa60a9352b2ccd064793494def9338b84d537#diff-3037c1b9244afa234b625b5475a8a16bL40\"\u003e\u003ccode\u003e111fa60\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e*for\u003c/code\u003e, \u003ccode\u003eof\u003c/code\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"componentappinjector\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#componentappinjector\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e@Component.appInjector\u003c/code\u003e\n\u003c/h1\u003e\n\n\u003cp\u003ealpha.24より\u003cbr\u003e\n【注意】\u003ccode\u003ehostInjector\u003c/code\u003e, \u003ccode\u003eviewInjector\u003c/code\u003eに分割する準備段階のため\u003ccode\u003eappInjector\u003c/code\u003eは\u003ca href=\"https://github.com/angular/angular/commit/7b511462afcd5ea011715d624611ffa4260cec61#commitcomment-11269365\"\u003eじきに廃止される可能性あり\u003c/a\u003e。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/issues/2015\"\u003eMerge injectables when creating ElementInjector #2015\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/issues/711\"\u003eRemove ligthDomServices from Directive and shadowDomServices from Component #711\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/7b511462afcd5ea011715d624611ffa4260cec61\"\u003erefactor(core): renamed injectables into appInjector  \u003ccode\u003e7b51146\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/dd3e6271c259d1fb3e150a4a43bf2f3dac1413e8\"\u003echore(services): rename services. \u003ccode\u003edd3e627\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a#diff-4c0123a05552194ca61867261e4bafd7L234\"\u003echore(rename): rename View and Template concepts for #1244 \u003ccode\u003ebf79337\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e旧称: \u003ccode\u003e@Component.componentServices -\u0026gt; @Component.services -\u0026gt; @Component.injectables\u003c/code\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eほとんど自分用。もしAngular 2に特攻する方がいたら、有るはずのAPIが無い…という時にここでまとめてある! みたいな感じで。\u003c/p\u003e\n","body":"150521現在、Angular 2.0.0-alpha.24がリリースされています。~~数版前にDeveloper Previewと銘打ったのは何だったのか~~API変更がけっこう多いので、覚えている限りのAPI変更を記しておきます。記憶から抜けているものがあったら下のコメント欄で補足願います。\n\n以下についての変更は煩雑なので追いません。\n\n- 内部API\n- エラーハンドリング用API\n- alpha.14以前\n\n見出し名が執筆時・記事修正時の最新のAPI名です。\n\n# `@View`\n\nalpha.19より\n\n- [Big rename. Part of #1244 #1285](https://github.com/angular/angular/pull/1285)\n- [`bf79337`](https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a)\n\n旧称: `@Template`\nプロパティも改名\n\n```js:旧\n@Template({\n  url: 'my_app.html',\n  inline: '\u003cp\u003e\u003c/p\u003e'\n})\n```\n\n```js:新\n@View({\n  templateUrl: 'my_app.html',\n  template: '\u003cp\u003e\u003c/p\u003e'\n})\n```\n\n## 廃止になったもの\n\nalpha.22より\n\n- [`8faf636`](https://github.com/angular/angular/commit/8faf6364dc344d53c619a1bdfc1ed4d856375f82)\n\n廃止: `@DynamicComponent`\n\n# `@Directive`\n- [refactor(compiler): rename decorator directives into directive #1615](https://github.com/angular/angular/pull/1615)\n- [Remove concept of Viewport directives? #1536](https://github.com/angular/angular/issues/1536)\n- [`f75a50c`](https://github.com/angular/angular/commit/f75a50c1ddb542d3898def5464629c1f13540ee2)\n- [`3aac2fe`](https://github.com/angular/angular/commit/3aac2fefd7f93c74abfa5ee58aa0ea8d4840b519)\n\n旧称: `@Decorator`\n旧称: `@Viewport`（統合）\n\n```js:旧\n@Decorator({\n  selector: '[house]'\n})\n\n@Viewport({\n  selector: '[house]'\n})\n```\n\n```js:新\n@Directive({\n  selector: '[house]'\n})\n```\n\n## `@Directive.properties`\n\nalpha.26より\n\n`properties`がObjectリテラルからArray\u003cstring\u003eに変更されるという大規模なBreaking Changeが入ったため注意。\n\n```\nBefore\n@Directive(properties: {\n  'sameName': 'sameName',\n  'directiveProp': 'elProp | pipe'\n})\n\nAfter\n@Directive(properties: [\n  'sameName',\n  'directiveProp: elProp | pipe'\n])\n```\n\n- https://github.com/angular/angular/issues/2013\n- [`d7df853`] (https://github.com/angular/angular/commit/d7df853bde30ffe97045eff649240284ae6ffdf8)\n\nalpha.19より\n\n- [`bf79337`](https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a#diff-4c0123a05552194ca61867261e4bafd7L70)\n\n旧称: `@Decorator.bind -\u003e @Decorator.properties`\n\n## `@Directive.hostListeners`\n\nalpha.19より\n\n- [`bf79337`](https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a#diff-4c0123a05552194ca61867261e4bafd7L73)\n\n旧称: `@Decorator.events -\u003e @Decorator.hostListeners`\n\n## `*ng-if`\n\nalpha.24より\n\n- [Compiler should not request setters for @Viewport bindings #1295](https://github.com/angular/angular/issues/1295)\n- [Should the best practice be to prefix Component and Directive selectors, but not properties of components. #1598](https://github.com/angular/angular/issues/1598)\n- [Issue 1598: All @Directive need to have a prefix #1827](https://github.com/angular/angular/pull/1827)\n- [`d310a9c`](https://github.com/angular/angular/commit/d310a9c0b466407ddce0babdf36d7e4c2476cae3#diff-3818fe897c7a5e7d204961e2cf4d7f8dL30)\n\n旧称: `*if`\n\n## `*ng-non-bindable`\n\nalpha.24より\n\n- [`78d3f62`](https://github.com/angular/angular/commit/78d3f62b6a38b00f1ef3dec4c1d31e8ceebdedcb#diff-424613311e4377f93494247b6dfe521aL19)\n\n旧称: `*non-bindable`\n\n## `*ng-switch`\n\nalpha.24より\n\n- [`e9f236b`](https://github.com/angular/angular/commit/e9f236b70f7e6228a16d3d93bb1ab225c9682978#diff-3eed935d2a641fa803d808d574fa6632L54)\n\n旧称: `*switch`\n\n## `*ng-for`, `ng-for-of`\n\nalpha.24より\n\n- [`111fa60`](https://github.com/angular/angular/commit/111fa60a9352b2ccd064793494def9338b84d537#diff-3037c1b9244afa234b625b5475a8a16bL40)\n\n旧称: `*for`, `of`\n\n# `@Component.appInjector`\n\nalpha.24より\n【注意】`hostInjector`, `viewInjector`に分割する準備段階のため`appInjector`は[じきに廃止される可能性あり](https://github.com/angular/angular/commit/7b511462afcd5ea011715d624611ffa4260cec61#commitcomment-11269365)。\n\n- [Merge injectables when creating ElementInjector #2015](https://github.com/angular/angular/issues/2015)\n- [Remove ligthDomServices from Directive and shadowDomServices from Component #711](https://github.com/angular/angular/issues/711)\n- [refactor(core): renamed injectables into appInjector  `7b51146`](https://github.com/angular/angular/commit/7b511462afcd5ea011715d624611ffa4260cec61)\n- [chore(services): rename services. `dd3e627`](https://github.com/angular/angular/commit/dd3e6271c259d1fb3e150a4a43bf2f3dac1413e8)\n- [chore(rename): rename View and Template concepts for #1244 `bf79337`](https://github.com/angular/angular/commit/bf7933714a884e10124ce43aa27d63791fc37e6a#diff-4c0123a05552194ca61867261e4bafd7L234)\n\n旧称: `@Component.componentServices -\u003e @Component.services -\u003e @Component.injectables`\n\n---\n\nほとんど自分用。もしAngular 2に特攻する方がいたら、有るはずのAPIが無い…という時にここでまとめてある! みたいな感じで。\n","coediting":false,"created_at":"2015-05-13T12:41:56+09:00","id":"7ba4bb34a819f2801ff4","private":false,"tags":[{"name":"angular","versions":[]},{"name":"Angular2","versions":[]}],"title":"Angular 2 alpha版のAPI変更についてメモ","updated_at":"2015-06-19T03:40:54+09:00","url":"http://qiita.com/armorik83/items/7ba4bb34a819f2801ff4","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003eこんにちは、\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。タイムリーな話題で、ついさっきの\u003ca href=\"/Jxck_\" class=\"user-mention\" title=\"Jxck_\"\u003e@Jxck_\u003c/a\u003eさんのつぶやきが気になったので調べてみました。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\" lang=\"en\"\u003e\n\u003cp lang=\"ja\"\u003eあれ？久しぶりに power-assert じゃない普通の assert 使ったら、表示が改善してる。こんなにわかりやすかったっけ？\u003c/p\u003e— Jxck (\u003ca href=\"/Jxck_\" class=\"user-mention\" title=\"Jxck_\"\u003e@Jxck_\u003c/a\u003e) \u003ca href=\"https://twitter.com/Jxck_/status/597987303387111424\"\u003eMay 12, 2015\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\n\n\u003ch1\u003e\n\u003cspan id=\"mocha-223から賢くなっていた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mocha-223%E3%81%8B%E3%82%89%E8%B3%A2%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMocha 2.2.3から賢くなっていた\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/mochajs/mocha/compare/2.2.1...2.2.3\"\u003ehttps://github.com/mochajs/mocha/compare/2.2.1...2.2.3\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eどうもこれを見るに、\u003ccode\u003ereporter/base\u003c/code\u003eという箇所に手が入ったようで、これによって\u003ccode\u003eassert\u003c/code\u003eの出力が賢くなっていました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"比較してみよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AF%94%E8%BC%83%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e比較してみよう\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003eソース\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003espec.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'assert'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test1 strictEqual'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcde'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcdf'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estrictEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test1 eqeqeq'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcde'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcdf'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test2'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ehoge\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e12\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ehoge\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003efuga\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e56\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edeepEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"assert--mocha-221\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#assert--mocha-221\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eassert + Mocha 2.2.1\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003enpm i mocha@2.2.1 \u0026amp;\u0026amp; $(npm bin)/mocha spec.js\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  1) test1 strictEqual\n  2) test1 eqeqeq\n  3) test2\n\n  0 passing (15ms)\n  3 failing\n\n  1)  test1 strictEqual:\n     AssertionError: 'abcde' === 'abcdf'\n      at Context.\u0026lt;anonymous\u0026gt; (/Users/armorik83/Desktop/mochasandbox/spec.js:6:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  2)  test1 eqeqeq:\n     AssertionError: false == true\n      at Context.\u0026lt;anonymous\u0026gt; (/Users/armorik83/Desktop/mochasandbox/spec.js:12:3)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  3)  test2:\n     AssertionError: { hoge: 12 } deepEqual { hoge: 13, fuga: 56 }\n      at Context.\u0026lt;anonymous\u0026gt; (/Users/armorik83/Desktop/mochasandbox/spec.js:23:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eよく見る感じのやつです。なお、2.2.2は欠番です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"assert--mocha-223\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#assert--mocha-223\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eassert + Mocha 2.2.3\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003enpm i mocha@2.2.3 \u0026amp;\u0026amp; $(npm bin)/mocha spec.js\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  1) test1 strictEqual\n  2) test1 eqeqeq\n  3) test2\n\n  0 passing (19ms)\n  3 failing\n\n  1)  test1 strictEqual:\n\n      AssertionError: 'abcde' === 'abcdf'\n      + expected - actual\n\n      +\"abcdf\"\n      -\"abcde\"\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec.js:6:10)\n\n  2)  test1 eqeqeq:\n\n      AssertionError: false == true\n      + expected - actual\n\n      +true\n      -false\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec.js:12:3)\n\n  3)  test2:\n\n      AssertionError: { hoge: 12 } deepEqual { hoge: 13, fuga: 56 }\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec.js:23:10)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eおおおっ!? \u003ccode\u003eassert(a === b)\u003c/code\u003eより\u003ccode\u003eassert.strictEqual(a, b)\u003c/code\u003eの方が情報量が多いことが分かります。個人的にはタイプ量の好みで\u003ccode\u003eassert()\u003c/code\u003eを使っていたんですが、Mochaと標準assertの組み合わせでは\u003ccode\u003estrictEqual()\u003c/code\u003eがよさ気なことに気付けました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"power-assert--mocha-223\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#power-assert--mocha-223\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epower-assert + Mocha 2.2.3\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/twada/power-assert\"\u003epower-assert\u003c/a\u003eとも比較しておきます。1行目のみ書き換えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003espec.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'power-assert'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003enpm i power-assert espower-cli mocha@2.2.3\n$(npm bin)/espower spec.js \u0026gt; spec-esp.js \u0026amp;\u0026amp; $(npm bin)/mocha spec-esp.js\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  1) test1 strictEqual\n  2) test1 eqeqeq\n  3) test2\n\n  0 passing (49ms)\n  3 failing\n\n  1)  test1 strictEqual:\n\n      AssertionError:   # spec.js:6\n\n  assert.strictEqual(a, b)\n                     |  |\n                     |  \"abcdf\"\n                     \"abcde\"\n\n      + expected - actual\n\n      +\"abcdf\"\n      -\"abcde\"\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec-esp.js:5:12)\n\n  2)  test1 eqeqeq:\n\n      AssertionError:   # spec.js:12\n\n  assert(a === b)\n         | |   |\n         | |   \"abcdf\"\n         | false\n         \"abcde\"\n\n  --- [string] b\n  +++ [string] a\n  @@ -1,5 +1,5 @@\n   abcd\n  -f\n  +e\n\n\n      + expected - actual\n\n      +true\n      -false\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec-esp.js:18:5)\n\n  3)  test2:\n\n      AssertionError:   # spec.js:23\n\n  assert.deepEqual(a, b)\n                   |  |\n                   |  Object{hoge:13,fuga:56}\n                   Object{hoge:12}\n\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec-esp.js:30:12)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003epower-assertでは、\u003ccode\u003eassert(a === b)\u003c/code\u003e使用時の情報量の方が豊富ですので、何を使うかはテスト対象や好みによります。標準のassertログが強力になるのは嬉しい事ですね!\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"補足-chai--mocha-221\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3-chai--mocha-221\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e補足 Chai + Mocha 2.2.1\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"/t_wada\" class=\"user-mention\" title=\"t_wada\"\u003e@t_wada\u003c/a\u003eさんから\u003ca href=\"http://chaijs.com/\"\u003eChai\u003c/a\u003e等のAssertionユーティリティについて補足を頂きました。Chaiは使ったことがないので、この際検証してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003espec-chai.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003echai\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'chai'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003echai\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003echai\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test1 chai should'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003echai\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshould\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcde'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcdf'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshould\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test1 chai expect'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcde'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcdf'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test1 chai assert'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcde'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'abcdf'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eequal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test2'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ehoge\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e12\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ehoge\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003efuga\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e56\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edeepEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003enpm i chai mocha@2.2.1 \u0026amp;\u0026amp; $(npm bin)/mocha spec-chai.js\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  1) test1 chai should\n  2) test1 chai expect\n  3) test1 chai assert\n  4) test2\n\n  0 passing (17ms)\n  4 failing\n\n  1)  test1 chai should:\n     AssertionError: abcdf: expected 'abcde' to be an abcde\n      at Context.\u0026lt;anonymous\u0026gt; (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:9:15)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  2)  test1 chai expect:\n\n      AssertionError: expected 'abcde' to equal 'abcdf'\n      + expected - actual\n\n      +abcdf\n      -abcde\n\n      at Context.\u0026lt;anonymous\u0026gt; (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:15:16)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  3)  test1 chai assert:\n     AssertionError: expected 'abcde' to equal 'abcdf'\n      at Context.\u0026lt;anonymous\u0026gt; (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:21:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  4)  test2:\n\n      AssertionError: expected { hoge: 12 } to deeply equal { hoge: 13, fuga: 56 }\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Function.assert.deepEqual (/Users/armorik83/Desktop/mochasandbox/node_modules/chai/lib/chai/interface/assert.js:205:32)\n      at Context.\u0026lt;anonymous\u0026gt; (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:32:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eStack traceが長いものの、Mocha 2.2.1時点で優秀ですね! 知りませんでした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"補足-chai--mocha-223\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3-chai--mocha-223\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e補足 Chai + Mocha 2.2.3\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003enpm i chai mocha@2.2.3 \u0026amp;\u0026amp; $(npm bin)/mocha spec-chai.js\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  1) test1 chai should\n  2) test1 chai expect\n  3) test1 chai assert\n  4) test2\n\n  0 passing (24ms)\n  4 failing\n\n  1)  test1 chai should:\n     AssertionError: abcdf: expected 'abcde' to be an abcde\n      at Context.\u0026lt;anonymous\u0026gt; (spec-chai.js:9:15)\n\n  2)  test1 chai expect:\n\n      AssertionError: expected 'abcde' to equal 'abcdf'\n      + expected - actual\n\n      +\"abcdf\"\n      -\"abcde\"\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec-chai.js:15:16)\n\n  3)  test1 chai assert:\n     AssertionError: expected 'abcde' to equal 'abcdf'\n      at Context.\u0026lt;anonymous\u0026gt; (spec-chai.js:21:10)\n\n  4)  test2:\n\n      AssertionError: expected { hoge: 12 } to deeply equal { hoge: 13, fuga: 56 }\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Context.\u0026lt;anonymous\u0026gt; (spec-chai.js:32:10)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなるほど、Chaiを使うなら\u003ccode\u003eexpect(a).to.equal(b)\u003c/code\u003eが一番情報量が豊富な結果となりました。かつて使い慣れたテストフレームワークがあったり、タイプ量、読みやすさ等、好みかと思います。\u003c/p\u003e\n\n\u003cp\u003eChai以外は割愛します。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e期せずしてAssertionユーティリティの比較記事となりました。色々ありますね! タイトルは若干モニョってますが、もう最初のままで。\u003c/p\u003e\n\n\u003cp\u003e以上です。\u003c/p\u003e\n","body":"こんにちは、@armorik83です。タイムリーな話題で、ついさっきの@Jxck_さんのつぶやきが気になったので調べてみました。\n\n\u003cblockquote class=\"twitter-tweet\" lang=\"en\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eあれ？久しぶりに power-assert じゃない普通の assert 使ったら、表示が改善してる。こんなにわかりやすかったっけ？\u003c/p\u003e\u0026mdash; Jxck (@Jxck_) \u003ca href=\"https://twitter.com/Jxck_/status/597987303387111424\"\u003eMay 12, 2015\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n# Mocha 2.2.3から賢くなっていた\n- https://github.com/mochajs/mocha/compare/2.2.1...2.2.3\n\nどうもこれを見るに、`reporter/base`という箇所に手が入ったようで、これによって`assert`の出力が賢くなっていました。\n\n# 比較してみよう\n**ソース**\n\n```js:spec.js\nvar assert = require('assert');\n\nit('test1 strictEqual', function() {\n  var a = 'abcde';\n  var b = 'abcdf';\n  assert.strictEqual(a, b);\n});\n\nit('test1 eqeqeq', function() {\n  var a = 'abcde';\n  var b = 'abcdf';\n  assert(a === b);\n});\n\nit('test2', function() {\n  var a = {\n    hoge: 12\n  };\n  var b = {\n    hoge: 13,\n    fuga: 56\n  };\n  assert.deepEqual(a, b);\n});\n```\n\n## assert + Mocha 2.2.1\n```\nnpm i mocha@2.2.1 \u0026\u0026 $(npm bin)/mocha spec.js\n```\n\n```\n  1) test1 strictEqual\n  2) test1 eqeqeq\n  3) test2\n\n  0 passing (15ms)\n  3 failing\n\n  1)  test1 strictEqual:\n     AssertionError: 'abcde' === 'abcdf'\n      at Context.\u003canonymous\u003e (/Users/armorik83/Desktop/mochasandbox/spec.js:6:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  2)  test1 eqeqeq:\n     AssertionError: false == true\n      at Context.\u003canonymous\u003e (/Users/armorik83/Desktop/mochasandbox/spec.js:12:3)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  3)  test2:\n     AssertionError: { hoge: 12 } deepEqual { hoge: 13, fuga: 56 }\n      at Context.\u003canonymous\u003e (/Users/armorik83/Desktop/mochasandbox/spec.js:23:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n```\n\nよく見る感じのやつです。なお、2.2.2は欠番です。\n\n## assert + Mocha 2.2.3\n```\nnpm i mocha@2.2.3 \u0026\u0026 $(npm bin)/mocha spec.js\n```\n\n```\n  1) test1 strictEqual\n  2) test1 eqeqeq\n  3) test2\n\n  0 passing (19ms)\n  3 failing\n\n  1)  test1 strictEqual:\n\n      AssertionError: 'abcde' === 'abcdf'\n      + expected - actual\n\n      +\"abcdf\"\n      -\"abcde\"\n\n      at Context.\u003canonymous\u003e (spec.js:6:10)\n\n  2)  test1 eqeqeq:\n\n      AssertionError: false == true\n      + expected - actual\n\n      +true\n      -false\n\n      at Context.\u003canonymous\u003e (spec.js:12:3)\n\n  3)  test2:\n\n      AssertionError: { hoge: 12 } deepEqual { hoge: 13, fuga: 56 }\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Context.\u003canonymous\u003e (spec.js:23:10)\n```\n\nおおおっ!? `assert(a === b)`より`assert.strictEqual(a, b)`の方が情報量が多いことが分かります。個人的にはタイプ量の好みで`assert()`を使っていたんですが、Mochaと標準assertの組み合わせでは`strictEqual()`がよさ気なことに気付けました。\n\n## power-assert + Mocha 2.2.3\n[power-assert](https://github.com/twada/power-assert)とも比較しておきます。1行目のみ書き換えます。\n\n```js:spec.js\nvar assert = require('power-assert');\n```\n\n```\nnpm i power-assert espower-cli mocha@2.2.3\n$(npm bin)/espower spec.js \u003e spec-esp.js \u0026\u0026 $(npm bin)/mocha spec-esp.js\n```\n\n```\n  1) test1 strictEqual\n  2) test1 eqeqeq\n  3) test2\n\n  0 passing (49ms)\n  3 failing\n\n  1)  test1 strictEqual:\n\n      AssertionError:   # spec.js:6\n\n  assert.strictEqual(a, b)\n                     |  |\n                     |  \"abcdf\"\n                     \"abcde\"\n\n      + expected - actual\n\n      +\"abcdf\"\n      -\"abcde\"\n\n      at Context.\u003canonymous\u003e (spec-esp.js:5:12)\n\n  2)  test1 eqeqeq:\n\n      AssertionError:   # spec.js:12\n\n  assert(a === b)\n         | |   |\n         | |   \"abcdf\"\n         | false\n         \"abcde\"\n\n  --- [string] b\n  +++ [string] a\n  @@ -1,5 +1,5 @@\n   abcd\n  -f\n  +e\n\n\n      + expected - actual\n\n      +true\n      -false\n\n      at Context.\u003canonymous\u003e (spec-esp.js:18:5)\n\n  3)  test2:\n\n      AssertionError:   # spec.js:23\n\n  assert.deepEqual(a, b)\n                   |  |\n                   |  Object{hoge:13,fuga:56}\n                   Object{hoge:12}\n\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Context.\u003canonymous\u003e (spec-esp.js:30:12)\n```\n\npower-assertでは、`assert(a === b)`使用時の情報量の方が豊富ですので、何を使うかはテスト対象や好みによります。標準のassertログが強力になるのは嬉しい事ですね!\n\n## 補足 Chai + Mocha 2.2.1\n@t_wadaさんから[Chai](http://chaijs.com/)等のAssertionユーティリティについて補足を頂きました。Chaiは使ったことがないので、この際検証してみます。\n\n```spec-chai.js\nvar chai = require('chai');\nvar expect = chai.expect;\nvar assert = chai.assert;\n\nit('test1 chai should', function() {\n  chai.should();\n  var a = 'abcde';\n  var b = 'abcdf';\n  a.should.be.a(a, b);\n});\n\nit('test1 chai expect', function() {\n  var a = 'abcde';\n  var b = 'abcdf';\n  expect(a).to.equal(b);\n});\n\nit('test1 chai assert', function() {\n  var a = 'abcde';\n  var b = 'abcdf';\n  assert.equal(a, b);\n});\n\nit('test2', function() {\n  var a = {\n    hoge: 12\n  };\n  var b = {\n    hoge: 13,\n    fuga: 56\n  };\n  assert.deepEqual(a, b);\n});\n```\n\n```\nnpm i chai mocha@2.2.1 \u0026\u0026 $(npm bin)/mocha spec-chai.js\n```\n\n```\n  1) test1 chai should\n  2) test1 chai expect\n  3) test1 chai assert\n  4) test2\n\n  0 passing (17ms)\n  4 failing\n\n  1)  test1 chai should:\n     AssertionError: abcdf: expected 'abcde' to be an abcde\n      at Context.\u003canonymous\u003e (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:9:15)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  2)  test1 chai expect:\n\n      AssertionError: expected 'abcde' to equal 'abcdf'\n      + expected - actual\n\n      +abcdf\n      -abcde\n\n      at Context.\u003canonymous\u003e (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:15:16)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  3)  test1 chai assert:\n     AssertionError: expected 'abcde' to equal 'abcdf'\n      at Context.\u003canonymous\u003e (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:21:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n\n  4)  test2:\n\n      AssertionError: expected { hoge: 12 } to deeply equal { hoge: 13, fuga: 56 }\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Function.assert.deepEqual (/Users/armorik83/Desktop/mochasandbox/node_modules/chai/lib/chai/interface/assert.js:205:32)\n      at Context.\u003canonymous\u003e (/Users/armorik83/Desktop/mochasandbox/spec-chai.js:32:10)\n      at callFn (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:266:21)\n      at Test.Runnable.run (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runnable.js:259:7)\n      at Runner.runTest (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:387:10)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:470:12\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:312:14)\n      at /Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:322:7\n      at next (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:257:23)\n      at Immediate._onImmediate (/Users/armorik83/Desktop/mochasandbox/node_modules/mocha/lib/runner.js:289:5)\n      at processImmediate [as _immediateCallback] (timers.js:357:17)\n```\n\nStack traceが長いものの、Mocha 2.2.1時点で優秀ですね! 知りませんでした。\n\n## 補足 Chai + Mocha 2.2.3\n\n```\nnpm i chai mocha@2.2.3 \u0026\u0026 $(npm bin)/mocha spec-chai.js\n```\n\n```\n  1) test1 chai should\n  2) test1 chai expect\n  3) test1 chai assert\n  4) test2\n\n  0 passing (24ms)\n  4 failing\n\n  1)  test1 chai should:\n     AssertionError: abcdf: expected 'abcde' to be an abcde\n      at Context.\u003canonymous\u003e (spec-chai.js:9:15)\n\n  2)  test1 chai expect:\n\n      AssertionError: expected 'abcde' to equal 'abcdf'\n      + expected - actual\n\n      +\"abcdf\"\n      -\"abcde\"\n\n      at Context.\u003canonymous\u003e (spec-chai.js:15:16)\n\n  3)  test1 chai assert:\n     AssertionError: expected 'abcde' to equal 'abcdf'\n      at Context.\u003canonymous\u003e (spec-chai.js:21:10)\n\n  4)  test2:\n\n      AssertionError: expected { hoge: 12 } to deeply equal { hoge: 13, fuga: 56 }\n      + expected - actual\n\n       {\n      +  \"fuga\": 56\n      +  \"hoge\": 13\n      -  \"hoge\": 12\n       }\n\n      at Context.\u003canonymous\u003e (spec-chai.js:32:10)\n```\n\nなるほど、Chaiを使うなら`expect(a).to.equal(b)`が一番情報量が豊富な結果となりました。かつて使い慣れたテストフレームワークがあったり、タイプ量、読みやすさ等、好みかと思います。\n\nChai以外は割愛します。\n\n---\n\n期せずしてAssertionユーティリティの比較記事となりました。色々ありますね! タイトルは若干モニョってますが、もう最初のままで。\n\n以上です。\n","coediting":false,"created_at":"2015-05-12T14:54:31+09:00","id":"6cc05085071ba1fbf968","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"mocha","versions":[]},{"name":"power-assert","versions":[]},{"name":"chai","versions":[]}],"title":"Mochaを使うときはassert.strictEqualを使ったほうがいいな?という話","updated_at":"2015-05-12T19:14:59+09:00","url":"http://qiita.com/armorik83/items/6cc05085071ba1fbf968","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"ng-repeatで表とか作る時カスタムフィルタとかでフィルタリングした後の合計値とかを使いたい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ng-repeat%E3%81%A7%E8%A1%A8%E3%81%A8%E3%81%8B%E4%BD%9C%E3%82%8B%E6%99%82%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%81%A8%E3%81%8B%E3%81%A7%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%97%E3%81%9F%E5%BE%8C%E3%81%AE%E5%90%88%E8%A8%88%E5%80%A4%E3%81%A8%E3%81%8B%E3%82%92%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eng-repeatで表とか作る時、カスタムフィルタとかでフィルタリングした後の合計値とかを使いたい。\u003c/h1\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/65209b91-0c5a-6952-e7b4-64d138a2993e.png\" alt=\"Untitled.png\"\u003e\u003c/p\u003e\n\n\u003cp\u003eまあ、そんなに難しくなくて、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u0026lt;tr ng-repeat=\"item in filteredItems=(main.items | filter:q)\"\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eっていうのかキモかな。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainCtrl as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003eng-model=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"q\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;table\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;tr\u003c/span\u003e \u003cspan class=\"na\"\u003eng-repeat=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"item in filteredItems=(main.items | filter:q)\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;td\u0026gt;\u003c/span\u003e{{item.text}}\u003cspan class=\"nt\"\u003e\u0026lt;/td\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;td\u0026gt;\u003c/span\u003e{{item.amount}}\u003cspan class=\"nt\"\u003e\u0026lt;/td\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;/tr\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;tr\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;td\u0026gt;\u003c/span\u003esum\u003cspan class=\"nt\"\u003e\u0026lt;/td\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;td\u0026gt;\u003c/span\u003e{{filteredItems|sumFilter}}\u003cspan class=\"nt\"\u003e\u0026lt;/td\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;/tr\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/table\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s2\"\u003e\"use strict\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//値を発生させる\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"MainCtrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eitems\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"item\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003eamount\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eround\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erandom\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//合計値計算フィルタ\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"sumFilter\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003esum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eamount\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003esum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esum\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eamount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003esum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://jsfiddle.net/wk3wjkjx/2/\"\u003ehttps://jsfiddle.net/wk3wjkjx/2/\u003c/a\u003e\u003cbr\u003e\nこんな感じ。\u003cbr\u003e\n業務用アプリとかでこういうことしている人はすでにいるでしょうかね。\u003cbr\u003e\nもっといいやり方あったら教えて。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"as\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#as\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eas\u003c/h2\u003e\n\n\u003cp\u003eng-repeatでasの記法を使うことができる。ということを\u003ca href=\"/Quramy\" class=\"user-mention\" title=\"Quramy\"\u003e@Quramy\u003c/a\u003eさんからコメントいただきました。\u003cbr\u003e\n1.3.xから使えるのかな\u003ca href=\"https://docs.angularjs.org/api/ng/directive/ngRepeat\"\u003ehttps://docs.angularjs.org/api/ng/directive/ngRepeat\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://jsfiddle.net/wk3wjkjx/3/\"\u003ehttps://jsfiddle.net/wk3wjkjx/3/\u003c/a\u003e\u003cbr\u003e\n書き直して見ました。\u003cbr\u003e\nこっちの方が見やすいですね。\u003c/p\u003e\n","body":"#ng-repeatで表とか作る時、カスタムフィルタとかでフィルタリングした後の合計値とかを使いたい。\n\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58613/65209b91-0c5a-6952-e7b4-64d138a2993e.png)\n\nまあ、そんなに難しくなくて、\n\n```\n\u003ctr ng-repeat=\"item in filteredItems=(main.items | filter:q)\"\u003e\n```\n\nっていうのかキモかな。\n\n```index.html\n\u003cdiv ng-app=\"myApp\"\u003e\n  \u003cdiv ng-controller=\"MainCtrl as main\"\u003e\n      \u003cinput ng-model=\"q\"/\u003e\n    \u003ctable\u003e\n        \u003cbody\u003e\n            \u003ctr ng-repeat=\"item in filteredItems=(main.items | filter:q)\"\u003e\n                \u003ctd\u003e{{item.text}}\u003c/td\u003e\n                \u003ctd\u003e{{item.amount}}\u003c/td\u003e\n            \u003c/tr\u003e\n            \u003ctr\u003e\n                \u003ctd\u003esum\u003c/td\u003e\n                \u003ctd\u003e{{filteredItems|sumFilter}}\u003c/td\u003e\n            \u003c/tr\u003e\n        \u003c/body\u003e\n    \u003c/table\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n```js\n\"use strict\";\n\nangular.module(\"myApp\", []);\n\n//値を発生させる\nangular.module(\"myApp\").controller(\"MainCtrl\", function(){\n    this.items = [];\n    for(var i = 0; i \u003c 10; i++){\n        this.items[i] = {\n            text: \"item\" + i,\n            amount: Math.round(1000 * Math.random())\n        }\n    }\n});\n\n//合計値計算フィルタ\nangular.module(\"myApp\").filter(\"sumFilter\", function(){\n    return function(input){\n        var sum = 0;\n        input.forEach(function(i){\n            if(i.amount){\n                sum = sum + i.amount;\n            }\n        });\n        return sum;\n    }\n});\n```\n\nhttps://jsfiddle.net/wk3wjkjx/2/\nこんな感じ。\n業務用アプリとかでこういうことしている人はすでにいるでしょうかね。\nもっといいやり方あったら教えて。\n\n##as\nng-repeatでasの記法を使うことができる。ということを@Quramyさんからコメントいただきました。\n1.3.xから使えるのかなhttps://docs.angularjs.org/api/ng/directive/ngRepeat\nhttps://jsfiddle.net/wk3wjkjx/3/\n書き直して見ました。\nこっちの方が見やすいですね。\n","coediting":false,"created_at":"2015-05-11T22:37:19+09:00","id":"86c4f106aa4930a75d87","private":false,"tags":[{"name":"HTML","versions":[]},{"name":"JavaScript","versions":[]},{"name":"AngularJS","versions":[]}],"title":"AngularJSで表とか作る時に、フィルタされた後の合計値とかも表示させたい時。","updated_at":"2015-05-14T10:57:40+09:00","url":"http://qiita.com/shinsukeimai/items/86c4f106aa4930a75d87","user":{"description":null,"facebook_id":null,"followees_count":11,"followers_count":6,"github_login_name":"shinsukeimai","id":"shinsukeimai","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":58613,"profile_image_url":"https://avatars.githubusercontent.com/u/7425556?v=2","twitter_screen_name":"shin_v1","website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"angularでいい感じにfaviconを操作するお話\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular%E3%81%A7%E3%81%84%E3%81%84%E6%84%9F%E3%81%98%E3%81%ABfavicon%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8A%E8%A9%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularでいい感じにfaviconを操作するお話。\u003c/h1\u003e\n\n\u003cp\u003e完成図↓\u003cbr\u003e\n\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/852410fc-f7ea-cec3-ea49-c17f01960041.png\" alt=\"Untitled 4.png\"\u003e\u003c/p\u003e\n\n\u003cp\u003efaviconとは。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003efavicon（ファビコン）は、ウェブサイトのシンボルマーク・イメージとして、ウェブサイト運営者がウェブサイトやウェブページに配置するアイコンの俗称である。favorite icon（フェイバリット・アイコン：お気に入りアイコン）という英語の語句を縮約したものである。(wikipediaより)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003efaviconってめんどくさいねん。\u003cbr\u003e\n今の時代apple-touch-iconとかなんとかいっぱいあるし。。。\u003cbr\u003e\nsvgを使えるようになったらええんやけど、今んところサポートしてるんはFirefoxだけ。 → \u003ca href=\"http://caniuse.com/#feat=link-icon-svg\"\u003ehttp://caniuse.com/#feat=link-icon-svg\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"余談\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e余談\u003c/h2\u003e\n\n\u003cp\u003efavicon一括生成サイトというものがあるそうで → \u003ca href=\"http://realfavicongenerator.net/\"\u003ehttp://realfavicongenerator.net/\u003c/a\u003e\u003cbr\u003e\nこいつはfaviconはもちろん、iPhoneやandroid、windows8とかとかいい感じに一括生成してくれる超便利サイト。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/d63fd1b8-941c-1e0d-32e2-00b9378fbd0a.png\" alt=\"Untitled.png\" title=\"Untitled.png\"\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"序論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BA%8F%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e序論\u003c/h2\u003e\n\n\u003cp\u003e余談はさておき、今回はangularでfaviconをいい感じに操作するお話をします。\u003cbr\u003e\nその名も \u003cstrong\u003e\u003cem\u003efavico.js\u003c/em\u003e\u003c/strong\u003e → \u003ca href=\"http://lab.ejci.net/favico.js/\"\u003ehttp://lab.ejci.net/favico.js/\u003c/a\u003e\u003cbr\u003e\nfaviconにバッチをつけたり、アニメーションさせたり、入れ替えたり、音量バッチとかとか。\u003cbr\u003e\nwebcamでインカメの動画をfaviconで再生したり(←何に使うねん)\u003cbr\u003e\n↓↓↓\u003cbr\u003e\n\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/b2536043-37af-0dbd-07f7-a66da944359d.png\" alt=\"Untitled.png\" title=\"Untitled.png\"\u003e\u003c/p\u003e\n\n\u003cp\u003eWorks on Chrome, Firefox, Opera and IE11+ らしい。\u003cbr\u003e\n僕はチャットツールを作ろうとしてて、未読の数を出すのにいいのないかなって思ってたら、favicon.jsを耳に挟んだので触ってみたことを書いていく。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e導入\u003c/h2\u003e\n\n\u003cp\u003eメッセージの未読を検出する方法については以下に書きましたので、これを読んでください。\u003cbr\u003e\n\u003ca href=\"http://qiita.com/shinsukeimai/items/dd1e96456b7b51e32cce\"\u003ehttp://qiita.com/shinsukeimai/items/dd1e96456b7b51e32cce\u003c/a\u003e\u003cbr\u003e\nここでのスクリブトを元に書いていきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"初期状態\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E6%9C%9F%E7%8A%B6%E6%85%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初期状態\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"app.css\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainCtrl as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;ul\u003c/span\u003e \u003cspan class=\"na\"\u003eng-repeat=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"message in main.messages\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003emsg\u003c/span\u003e \u003cspan class=\"na\"\u003econtent=\u003c/span\u003e\u003cspan class=\"s\"\u003emessage\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{message: message.read }\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e{{message.text}}\u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/ul\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./angular.min.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./favico.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s2\"\u003e\"use strict\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"msg\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"$window\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"=\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'scroll'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffsetTop\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epageTop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epageYOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epageBottom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epageYOffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerHeight\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epageTop\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epageBottom\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eread\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$apply\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}]);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"MainCtrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"message\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eread\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"css\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.css\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nc\"\u003e.message\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ered\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eここからスタートしていきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003efaviconを用意します。\u003c/li\u003e\n\u003cli\u003eangularを用意します。\u003c/li\u003e\n\u003cli\u003efavico.jsを用意します。(githubから落として下さい。)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h2\u003e\n\n\u003cp\u003eindex.htmlを書いていきます。\u003cbr\u003e\nlinkにfaviconを設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;meta\u003c/span\u003e \u003cspan class=\"na\"\u003echarset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e\u0026lt;!-- ここ！！！--\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"shortcut icon\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"favicon32.ico\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"app.css\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainCtrl\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;ul\u003c/span\u003e \u003cspan class=\"na\"\u003eng-repeat=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"message in messages\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003emsg\u003c/span\u003e \u003cspan class=\"na\"\u003econtent=\u003c/span\u003e\u003cspan class=\"s\"\u003emessage\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{message: message.read }\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e{{message.text}}\u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/ul\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./angular.min.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./favico.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003efavico.js用にService(factory)を書いていきます。\u003cbr\u003e\n詳しい動きを設定したい時は\u003ca href=\"http://lab.ejci.net/favico.js/\"\u003ehttp://lab.ejci.net/favico.js/\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"faviconService\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003efavicon\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFavico\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//animationを切る\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eanimation\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"none\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003efavicon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003econtrollerを書き足します。\u003cbr\u003e\nスクロールした時にfaviconのbadgeの値を変えていきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"MainCtrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"$scope\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$window\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$timeout\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"faviconService\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$timeout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003efaviconService\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//初期値設定\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"message\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eread\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003efaviconService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//スクロール時の動き\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'scroll'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//スクロール中の時の動きで100msの間を空けます。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$timeout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecancel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$timeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e//メッセージの既読を確認します。\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003efaviconService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}]);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまとめますと。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s2\"\u003e\"use strict\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"msg\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"$window\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"=\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'scroll'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffsetTop\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epageTop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epageYOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epageBottom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epageYOffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerHeight\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epageTop\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epageBottom\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eread\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$apply\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}]);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"MainCtrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"$scope\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$window\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$timeout\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"faviconService\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$timeout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003efaviconService\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//初期値設定\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"message\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eread\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003efaviconService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//スクロール時の動き\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'scroll'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//スクロール中の時の動きで100msの間を空けます。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$timeout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecancel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003escrollTimer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$timeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$scope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003efaviconService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enewNum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}]);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"faviconService\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003efavicon\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFavico\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eanimation\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"none\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003efavicon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ebadge\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこんな感じです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"初期状態-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E6%9C%9F%E7%8A%B6%E6%85%8B-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初期状態\u003c/h3\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/08c380ae-3762-f5c2-2a25-d92348b8ccd6.png\" alt=\"Untitled.png\" title=\"Untitled.png\"\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"スクロールすると\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクロールすると\u003c/h3\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/2b522bbf-49a0-45be-93a3-f87c685a9c29.png\" alt=\"Untitled 2.png\" title=\"Untitled 2.png\"\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"faviconは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#favicon%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efaviconは\u003c/h3\u003e\n\n\u003cp\u003eこういう感じです。\u003cbr\u003e\n\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/775e1851-ad5b-4d8f-f29b-69da1b960a2d.png\" alt=\"Untitled 3.png\" title=\"Untitled 3.png\"\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h2\u003e\n\n\u003cp\u003eそんなにangularって感じでもなかったかな。\u003cbr\u003e\n同じことしたい人には参考になるかも。\u003cbr\u003e\nこれ、ページを開いておくと、ブックマークバーにあるアイコンにもこのbadgeが現れて、増減を出してくれる。\u003cbr\u003e\nおもろ\u003cbr\u003e\nお試しアレ。\u003cbr\u003e\n\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/852410fc-f7ea-cec3-ea49-c17f01960041.png\" alt=\"Untitled 4.png\"\u003e\u003c/p\u003e\n","body":"#Angularでいい感じにfaviconを操作するお話。\n\n完成図↓\n![Untitled 4.png](https://qiita-image-store.s3.amazonaws.com/0/58613/852410fc-f7ea-cec3-ea49-c17f01960041.png)\n\nfaviconとは。\n\u003efavicon（ファビコン）は、ウェブサイトのシンボルマーク・イメージとして、ウェブサイト運営者がウェブサイトやウェブページに配置するアイコンの俗称である。favorite icon（フェイバリット・アイコン：お気に入りアイコン）という英語の語句を縮約したものである。(wikipediaより)\n\nfaviconってめんどくさいねん。\n今の時代apple-touch-iconとかなんとかいっぱいあるし。。。\nsvgを使えるようになったらええんやけど、今んところサポートしてるんはFirefoxだけ。 → http://caniuse.com/#feat=link-icon-svg\n\n##余談\nfavicon一括生成サイトというものがあるそうで → http://realfavicongenerator.net/\nこいつはfaviconはもちろん、iPhoneやandroid、windows8とかとかいい感じに一括生成してくれる超便利サイト。\n\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58613/d63fd1b8-941c-1e0d-32e2-00b9378fbd0a.png \"Untitled.png\")\n\n##序論\n余談はさておき、今回はangularでfaviconをいい感じに操作するお話をします。\nその名も ***favico.js*** → http://lab.ejci.net/favico.js/\nfaviconにバッチをつけたり、アニメーションさせたり、入れ替えたり、音量バッチとかとか。\nwebcamでインカメの動画をfaviconで再生したり(←何に使うねん)\n↓↓↓\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58613/b2536043-37af-0dbd-07f7-a66da944359d.png \"Untitled.png\")\n\nWorks on Chrome, Firefox, Opera and IE11+ らしい。\n僕はチャットツールを作ろうとしてて、未読の数を出すのにいいのないかなって思ってたら、favicon.jsを耳に挟んだので触ってみたことを書いていく。\n\n##導入\nメッセージの未読を検出する方法については以下に書きましたので、これを読んでください。\nhttp://qiita.com/shinsukeimai/items/dd1e96456b7b51e32cce\nここでのスクリブトを元に書いていきます。\n\n###初期状態\n\n```index.html\n\u003c!DOCTYPE html\u003e\n\u003chead\u003e\n    \u003clink rel=\"stylesheet\" href=\"app.css\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cdiv ng-app=\"myApp\"\u003e\n    \u003cdiv ng-controller=\"MainCtrl as main\"\u003e\n        \u003cul ng-repeat=\"message in main.messages\"\u003e\n            \u003cli msg content=message ng-class=\"{message: message.read }\"\u003e{{message.text}}\u003c/li\u003e\n        \u003c/ul\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n\u003cscript src=\"./angular.min.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"./favico.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"app.js\"\u003e\u003c/script\u003e\n\u003c/body\u003e\n```\n\n```app.js\n\"use strict\";\n\nangular.module(\"myApp\", []);\n\nangular.module(\"myApp\").directive(\"msg\", [\"$window\", function($window){\n  return {\n    restrict: \"A\",\n    scope: {\n      content: \"=\"\n    },\n    link: function(scope, element){\n      angular.element($window).bind('scroll', function () {\n        var elementY = element[0].offsetTop;\n        var pageTop = this.pageYOffset;\n        var pageBottom = this.pageYOffset + this.innerHeight - 50;\n        if(elementY \u003e pageTop \u0026\u0026 elementY \u003c pageBottom){\n          scope.content.read = true;\n          scope.$apply();\n        }\n      });\n    }\n  }\n}]);\n\nangular.module(\"myApp\").controller(\"MainCtrl\", function(){\n  this.messages = [];\n  for(var i = 0; i \u003c 100; i++){\n    this.messages[i] = {\n      text: \"message\" + i,\n      read: false\n    }\n  }\n});\n\n```\n\n```app.css\n.message{\n    color: red;\n}\n```\n\nここからスタートしていきます。\n\n##環境\n- faviconを用意します。\n- angularを用意します。\n- favico.jsを用意します。(githubから落として下さい。)\n\n##実装\nindex.htmlを書いていきます。\nlinkにfaviconを設定します。\n\n```index.html\n\u003c!DOCTYPE html\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"utf-8\"\u003e\n    \u003c!-- ここ！！！--\u003e\n    \u003clink rel=\"shortcut icon\" href=\"favicon32.ico\"\u003e\n    \u003clink rel=\"stylesheet\" href=\"app.css\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cdiv ng-app=\"myApp\"\u003e\n    \u003cdiv ng-controller=\"MainCtrl\"\u003e\n        \u003cul ng-repeat=\"message in messages\"\u003e\n            \u003cli msg content=message ng-class=\"{message: message.read }\"\u003e{{message.text}}\u003c/li\u003e\n        \u003c/ul\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n\u003cscript src=\"./angular.min.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"./favico.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"app.js\"\u003e\u003c/script\u003e\n\u003c/body\u003e\n```\n\nfavico.js用にService(factory)を書いていきます。\n詳しい動きを設定したい時はhttp://lab.ejci.net/favico.js/\n\n```app.js\nangular.module(\"myApp\").factory(\"faviconService\", function(){\n  var favicon = new Favico({\n    //animationを切る\n    animation: \"none\"\n  });\n  var badge = function(num){\n    favicon.badge(num);\n  };\n\n  return {\n    badge: badge\n  };\n});\n```\n\ncontrollerを書き足します。\nスクロールした時にfaviconのbadgeの値を変えていきます。\n\n```app.js\n\nangular.module(\"myApp\").controller(\"MainCtrl\", [\"$scope\", \"$window\", \"$timeout\", \"faviconService\", function($scope, $window, $timeout, faviconService){\n  //初期値設定\n  var num, scrollTimer;\n  scrollTimer = false;\n  $scope.messages = [];\n\n  for(var i = 0; i \u003c 100; i++){\n    $scope.messages[i] = {\n      text: \"message\" + i,\n      read: false\n    }\n  }\n  num = $scope.messages.length;\n  faviconService.badge(num);\n  //スクロール時の動き\n  angular.element($window).bind('scroll', function () {\n    //スクロール中の時の動きで100msの間を空けます。\n    if(scrollTimer){\n      $timeout.cancel(scrollTimer);\n    }\n    scrollTimer = $timeout(function(){\n      var newNum = 0;\n      //メッセージの既読を確認します。\n      $scope.messages.forEach(function(message){\n        if(!message.read){newNum++; }\n      });\n      if(num !== newNum){\n        faviconService.badge(newNum);\n        num = newNum;\n      }\n    },100);\n  });\n}]);\n```\n\nまとめますと。\n\n```app.js\n\"use strict\";\n\nangular.module(\"myApp\", []);\n\nangular.module(\"myApp\").directive(\"msg\", [\"$window\", function($window){\n  return {\n    restrict: \"A\",\n    scope: {\n      content: \"=\"\n    },\n    link: function(scope, element){\n      angular.element($window).bind('scroll', function () {\n        var elementY = element[0].offsetTop;\n        var pageTop = this.pageYOffset;\n        var pageBottom = this.pageYOffset + this.innerHeight - 30;\n        if(elementY \u003e pageTop \u0026\u0026 elementY \u003c pageBottom){\n          scope.content.read = true;\n          scope.$apply();\n        }\n      });\n    }\n  }\n}]);\n\nangular.module(\"myApp\").controller(\"MainCtrl\", [\"$scope\", \"$window\", \"$timeout\", \"faviconService\", function($scope, $window, $timeout, faviconService){\n  //初期値設定\n  var num, scrollTimer;\n  scrollTimer = false;\n  $scope.messages = [];\n\n  for(var i = 0; i \u003c 100; i++){\n    $scope.messages[i] = {\n      text: \"message\" + i,\n      read: false\n    }\n  }\n  num = $scope.messages.length;\n  faviconService.badge(num);\n  //スクロール時の動き\n  angular.element($window).bind('scroll', function () {\n    //スクロール中の時の動きで100msの間を空けます。\n    if(scrollTimer){\n      $timeout.cancel(scrollTimer);\n    }\n    scrollTimer = $timeout(function(){\n      var newNum = 0;\n      $scope.messages.forEach(function(message){\n        if(!message.read){newNum++; }\n      });\n      if(num !== newNum){\n        faviconService.badge(newNum);\n        num = newNum;\n      }\n    },100);\n  });\n}]);\n\nangular.module(\"myApp\").factory(\"faviconService\", function(){\n  var favicon = new Favico({\n    animation: \"none\"\n  });\n  var badge = function(num){\n    favicon.badge(num);\n  };\n\n  return {\n    badge: badge\n  };\n});\n```\n\nこんな感じです。\n\n##結果\n\n###初期状態\n\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58613/08c380ae-3762-f5c2-2a25-d92348b8ccd6.png \"Untitled.png\")\n\n###スクロールすると\n![Untitled 2.png](https://qiita-image-store.s3.amazonaws.com/0/58613/2b522bbf-49a0-45be-93a3-f87c685a9c29.png \"Untitled 2.png\")\n\n###faviconは\nこういう感じです。\n![Untitled 3.png](https://qiita-image-store.s3.amazonaws.com/0/58613/775e1851-ad5b-4d8f-f29b-69da1b960a2d.png \"Untitled 3.png\")\n\n##感想\nそんなにangularって感じでもなかったかな。\n同じことしたい人には参考になるかも。\nこれ、ページを開いておくと、ブックマークバーにあるアイコンにもこのbadgeが現れて、増減を出してくれる。\nおもろ\nお試しアレ。\n![Untitled 4.png](https://qiita-image-store.s3.amazonaws.com/0/58613/852410fc-f7ea-cec3-ea49-c17f01960041.png)\n","coediting":false,"created_at":"2015-05-10T20:15:23+09:00","id":"65a2ce642d1f3355d473","private":false,"tags":[{"name":"HTML","versions":[]},{"name":"JavaScript","versions":[]},{"name":"HTML5","versions":[]},{"name":"favicon","versions":[]},{"name":"AngularJS","versions":[]}],"title":"Angularでいい感じにfaviconを操作するお話。","updated_at":"2015-05-11T15:07:23+09:00","url":"http://qiita.com/shinsukeimai/items/65a2ce642d1f3355d473","user":{"description":null,"facebook_id":null,"followees_count":11,"followers_count":6,"github_login_name":"shinsukeimai","id":"shinsukeimai","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":58613,"profile_image_url":"https://avatars.githubusercontent.com/u/7425556?v=2","twitter_screen_name":"shin_v1","website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"ユーザーさんもうこのdomエレメント既読済みですかangularで\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%95%E3%82%93%E3%82%82%E3%81%86%E3%81%93%E3%81%AEdom%E3%82%A8%E3%83%AC%E3%83%A1%E3%83%B3%E3%83%88%E6%97%A2%E8%AA%AD%E6%B8%88%E3%81%BF%E3%81%A7%E3%81%99%E3%81%8Bangular%E3%81%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eユーザーさん。もうこのDOMエレメント既読済みですか？(Angularで)\u003c/h1\u003e\n\n\u003cp\u003eメッセージアプリをangularjsを利用して作っているのですが、ユーザーがメッセージを既読したかどうかって、どうやって読み取ればいいのか探していて以下の結論に至りました。\u003c/p\u003e\n\n\u003cp\u003eサンプルはこちら↓↓↓\u003cbr\u003e\n\u003ca href=\"https://jsfiddle.net/h54sn6o7/1/\"\u003ehttps://jsfiddle.net/h54sn6o7/1/\u003c/a\u003e\u003cbr\u003e\n※AngularJS 1.2.1\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h2\u003e\n\n\u003cp\u003eスクロールしたときに、DOMエレメントがWindow内に入ったどうかを検出して、既読済みのメッセージを{read: true}にしていく。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"html\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#html\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ehtml\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainCtrl as main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;ul\u003c/span\u003e \u003cspan class=\"na\"\u003eng-repeat=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"message in main.messages\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003emsg\u003c/span\u003e \u003cspan class=\"na\"\u003econtent=\u003c/span\u003e\u003cspan class=\"s\"\u003emessage\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{message: message.read }\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e{{message.text}}\u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/ul\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"css\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#css\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecss\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"css\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nc\"\u003e.message\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ered\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"js\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#js\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ejs\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s2\"\u003e\"use strict\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"msg\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"$window\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erestrict\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"=\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$window\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'scroll'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffsetTop\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epageTop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epageYOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epageBottom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epageYOffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerHeight\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epageTop\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epageBottom\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n                    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eread\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"nx\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$apply\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}]);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"myApp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"MainCtrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"message\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003eread\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"考察\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%80%83%E5%AF%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e考察\u003c/h2\u003e\n\n\u003cp\u003eそんなに難しいことではないので、どっかに同じこと書いてる人いそう。\u003cbr\u003e\n記法でまずいところがあったら教えてください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"angularではパフォーマンスを意識しなければいけない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular%E3%81%A7%E3%81%AF%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%82%92%E6%84%8F%E8%AD%98%E3%81%97%E3%81%AA%E3%81%91%E3%82%8C%E3%81%B0%E3%81%84%E3%81%91%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularではパフォーマンスを意識しなければいけない。\u003c/h2\u003e\n\n\u003cp\u003eAngularって、すんなりやりたいことを書けてしまう反面、裏で何が行われているかしっかり理解しとかないとパフォーマンスが落ちてきますよね。\u003cbr\u003e\n私自身、パフォーマンスまで意識が回らず、まずい書き方をしてしまう。\u003cbr\u003e\n今回、\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eパイセンから助言をいただきました。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003escrollやresizeといったウインドウイベント系はlodash.throttle()辺りでイベント発生を間引くのがベターで、そのままでは処理負荷がけっこう大きいです。\u003cbr\u003e\n今回の例ではマウスホイールを少し転がすだけで数百イベントが発行され、ng-class=\"{message: message.read}\"の時点で数百のDOM操作が発生しているので、数千msオーダーでパフォーマンスが悪化します。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eなるほど。実際に実装する時は$timeoutとかで間引いいていたのですが、lodashを使う方法もあると。こっちの方がコード量が減りますね。\u003cbr\u003e\n\u003ca href=\"https://lodash.com/docs#throttle\"\u003ehttps://lodash.com/docs#throttle\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://jsfiddle.net/h54sn6o7/3/\"\u003ehttps://jsfiddle.net/h54sn6o7/3/\u003c/a\u003e\u003cbr\u003e\nこんな感じでしょうか。\u003cbr\u003e\nパイセン。いつもお世話になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"と思いきや\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E6%80%9D%E3%81%84%E3%81%8D%E3%82%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eと思いきや\u003c/h2\u003e\n\n\u003cp\u003eこのやり方は少し違っているようで\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eウインドウイベントをlodash.throttle()辺りで逃がすのは常套句なんですが、今回のケースだとmsgDirectiveのlink()で全要素に対してscrollがbindされていて、逃がす逃がさないの問題とすこしワケが違ったので、書き直しました。\u003cbr\u003e\nちなみに、挙動を確認したところ今回の例ではthrottle()は実は適していなくて、スクロールしているのに既読にならないメッセージと既読になるメッセージとバラつきがありました。あまり読まずにコメントしたものだから、すいません。\u003cbr\u003e\n\u003ca href=\"https://jsfiddle.net/h54sn6o7/5/\"\u003ehttps://jsfiddle.net/h54sn6o7/5/\u003c/a\u003e\u003cbr\u003e\n'throttle()'で逃さず全スクロールイベントを拾っているので、スクロールごとに処理は発生してますが、単純に、既読判定が不要なDirectiveはifで逃してます。この1行でパフォーマンスは4倍程度改善しました。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eとのこと。\u003c/p\u003e\n","body":"#ユーザーさん。もうこのDOMエレメント既読済みですか？(Angularで)\nメッセージアプリをangularjsを利用して作っているのですが、ユーザーがメッセージを既読したかどうかって、どうやって読み取ればいいのか探していて以下の結論に至りました。\n\nサンプルはこちら↓↓↓\nhttps://jsfiddle.net/h54sn6o7/1/\n※AngularJS 1.2.1\n\n##やりたいこと\nスクロールしたときに、DOMエレメントがWindow内に入ったどうかを検出して、既読済みのメッセージを\b{read: true}にしていく。\n\n##コード\n###html\n\n```html\n\u003cdiv ng-app=\"myApp\"\u003e\n  \u003cdiv ng-controller=\"MainCtrl as main\"\u003e\n    \u003cul ng-repeat=\"message in main.messages\"\u003e\n      \u003cli msg content=message ng-class=\"{message: message.read }\"\u003e{{message.text}}\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n###css\n\n```css\n.message{\n    color: red;\n}\n```\n\n###js\n\n```js\n\"use strict\";\n\nangular.module(\"myApp\", []);\n\nangular.module(\"myApp\").directive(\"msg\", [\"$window\", function($window){\n    return {\n        restrict: \"A\",\n        scope: {\n            content: \"=\"\n        },\n        link: function(scope, element){\n            angular.element($window).bind('scroll', function () {\n                var elementY = element[0].offsetTop;\n                var pageTop = this.pageYOffset;\n                var pageBottom = this.pageYOffset + this.innerHeight - 50;\n                if(elementY \u003e pageTop \u0026\u0026 elementY \u003c pageBottom){\n                    scope.content.read = true;\n                    scope.$apply();\n                }\n            });\n        }\n    }\n}]);\n\nangular.module(\"myApp\").controller(\"MainCtrl\", function(){\n    this.messages = [];\n    for(var i = 0; i \u003c 100; i++){\n        this.messages[i] = {\n            text: \"message\" + i,\n            read: false\n        }\n    }\n});\n\n```\n\n##考察\nそんなに難しいことではないので、どっかに同じこと書いてる人いそう。\n記法でまずいところがあったら教えてください。\n\n##Angularではパフォーマンスを意識しなければいけない。\nAngularって、すんなりやりたいことを書けてしまう反面、裏で何が行われているかしっかり理解しとかないとパフォーマンスが落ちてきますよね。\n私自身、パフォーマンスまで意識が回らず、まずい書き方をしてしまう。\n今回、@armorik83パイセンから助言をいただきました。\n\u003escrollやresizeといったウインドウイベント系はlodash.throttle()辺りでイベント発生を間引くのがベターで、そのままでは処理負荷がけっこう大きいです。\n今回の例ではマウスホイールを少し転がすだけで数百イベントが発行され、ng-class=\"{message: message.read}\"の時点で数百のDOM操作が発生しているので、数千msオーダーでパフォーマンスが悪化します。\n\nなるほど。実際に実装する時は$timeoutとかで間引いいていたのですが、lodashを使う方法もあると。こっちの方がコード量が減りますね。\nhttps://lodash.com/docs#throttle\nhttps://jsfiddle.net/h54sn6o7/3/\nこんな感じでしょうか。\nパイセン。いつもお世話になります。\n\n##と思いきや\nこのやり方は少し違っているようで\n\u003eウインドウイベントをlodash.throttle()辺りで逃がすのは常套句なんですが、今回のケースだとmsgDirectiveのlink()で全要素に対してscrollがbindされていて、逃がす逃がさないの問題とすこしワケが違ったので、書き直しました。\nちなみに、挙動を確認したところ今回の例ではthrottle()は実は適していなくて、スクロールしているのに既読にならないメッセージと既読になるメッセージとバラつきがありました。あまり読まずにコメントしたものだから、すいません。\nhttps://jsfiddle.net/h54sn6o7/5/\n'throttle()'で逃さず全スクロールイベントを拾っているので、スクロールごとに処理は発生してますが、単純に、既読判定が不要なDirectiveはifで逃してます。この1行でパフォーマンスは4倍程度改善しました。\n\nとのこと。\n","coediting":false,"created_at":"2015-05-10T16:58:43+09:00","id":"dd1e96456b7b51e32cce","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"HTML5","versions":[]},{"name":"AngularJS","versions":[]}],"title":"ユーザーさん。もうこのDOMエレメント既読済みですか？(angularで)","updated_at":"2015-05-12T13:04:04+09:00","url":"http://qiita.com/shinsukeimai/items/dd1e96456b7b51e32cce","user":{"description":null,"facebook_id":null,"followees_count":11,"followers_count":6,"github_login_name":"shinsukeimai","id":"shinsukeimai","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":58613,"profile_image_url":"https://avatars.githubusercontent.com/u/7425556?v=2","twitter_screen_name":"shin_v1","website_url":null}},{"rendered_body":"\u003cp\u003eどうも\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。ESLintのオプションを全部読んで吟味したので応酬を載せます。TypeScriptを辞めたというより、単機能ライブラリならES6の方が早く書けたという程度です。まさかりはブコメから。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"小分け\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B0%8F%E5%88%86%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e小分け\u003c/h1\u003e\n\n\u003cp\u003eまずは小分けにして。見出し名は\u003ca href=\"http://eslint.org/docs/rules/\"\u003e公式サイト\u003c/a\u003eと同じにしてあります。2が\u003ccode\u003eexit code 1\u003c/code\u003e投げるやつ、1はログのみ、0が無視。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"possible-errors\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#possible-errors\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePossible Errors\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-reserved-keys\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\"no-console\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-constant-condition\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-debugger\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-extra-parens\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\"no-extra-boolean-cast\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e初期値がキツめなのでそのまま\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-reserved-keys\u003c/code\u003eは、パッと見たときの脳の引っ掛かりが嫌いなので2\u003c/li\u003e\n\u003cli\u003e1は「まあ分かってるけどさ…見逃してよ…」みたいなの\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-extra-boolean-cast\u003c/code\u003eは普通に使うから0\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003evalid-jsdoc\u003c/code\u003eは1にしたかったけど、WebStorm向けのゆるふわが許されなかったため初期値0のまま\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"best-practices\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#best-practices\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBest Practices\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"block-scoped-var\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"curly\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"all\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"default-case\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-div-regex\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-else-return\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-eq-null\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-floating-decimal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-multi-spaces\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"exceptions\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"Property\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"ImportDeclaration\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"VariableDeclarator\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"AssignmentExpression\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-self-compare\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"wrap-iife\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"inside\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\"complexity\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"dot-notation\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"guard-for-in\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-extend-native\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-iterator\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-loop-func\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-multi-str\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-process-env\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-proto\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-throw-literal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-unused-expressions\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"radix\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\"no-alert\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-extra-bind\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"yoda\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eblock-scoped-var\u003c/code\u003e: \u003ccode\u003elet\u003c/code\u003e, \u003ccode\u003econst\u003c/code\u003e縛りをしているので関係ないっちゃないが、2\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003edefault-case\u003c/code\u003e: 基本的にswitch構文が大嫌いなのでなんでもいい\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-else-return\u003c/code\u003e: 早期returnで無用な深さは避けようという意志\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-eq-null\u003c/code\u003e: \u003ccode\u003e==\u003c/code\u003eがとにかく嫌いで、たとえ長くても\u003ccode\u003efoo === void 0 || foo === null\u003c/code\u003e使ってくれ頼む! という意志\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ecomplexity\u003c/code\u003eが1なのは「わかってはいるんだ…（吐血」みたいな状況\u003c/li\u003e\n\u003cli\u003eその他、あまり行儀良くはないけど使うことあるなーみたいなものが1\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://en.wikipedia.org/wiki/Yoda_conditions\"\u003eyoda\u003c/a\u003eってまだやってる人いますか\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"strict-mode\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#strict-mode\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStrict Mode\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"strict\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e使います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"variables\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#variables\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVariables\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-catch-shadow\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\"no-undefined\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-unused-vars\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"vars\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"all\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"args\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"after-used\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-undef-init\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eno-catch-shadow\u003c/code\u003e: catch節を漏らしたくないという好み\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-undefined\u003c/code\u003e: 長らく\u003ccode\u003evoid 0\u003c/code\u003eを使っているのでその流れ\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-unused-vars\u003c/code\u003e: やむを得ず使わない引数を宣言することがあるので（だいたい引数名を\u003ccode\u003e_\u003c/code\u003eにして、lodashは\u003ccode\u003elodash\u003c/code\u003eにしてる）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-undef-init\u003c/code\u003e: 禁止するほどでもないか、というところ\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"nodejs\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nodejs\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNode.js\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-path-concat\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-sync\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eno-path-concat\u003c/code\u003e: 横着することがあっても落とされるとストレス…みたいなやつ\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eno-sync\u003c/code\u003e: テストを簡便に書きたいときに使ったりするので\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"stylistic-issues\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stylistic-issues\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStylistic Issues\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"indent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"comma-style\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"last\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"consistent-this\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"_this\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"func-style\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"declaration\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-nested-ternary\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"padded-blocks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"quotes\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"single\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-before-blocks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-before-function-paren\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-in-brackets\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-in-parens\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-return-throw-case\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-unary-ops\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"words\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"nonwords\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\"brace-style\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"1tbs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"allowSingleLine\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"comma-spacing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"before\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"after\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"func-names\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"key-spacing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"align\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"value\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"beforeColon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"afterColon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"max-nested-callbacks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"new-cap\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"newIsCap\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"capIsNew\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-lonely-if\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-multiple-empty-lines\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"max\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-trailing-spaces\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"operator-linebreak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"before\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"semi\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"semi-spacing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"before\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"after\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-after-keywords\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"space-infix-ops\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\"no-underscore-dangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの辺はもう見たまんま。1は横着を許容するやつとか、\u003ccode\u003enew-cap\u003c/code\u003eのような止むに止まれぬ事情とか、見つけ次第直したいけど毎回落とされるとストレス溜まるやつとか。\u003ccode\u003eno-underscore-dangle\u003c/code\u003eは使うので0なんですが、もしかしてマズかったりしますか。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ecmascript-6\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ecmascript-6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eECMAScript 6\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"no-var\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eもう\u003ccode\u003elet\u003c/code\u003eと\u003ccode\u003econst\u003c/code\u003eしか使ってないので\u003ccode\u003eno-var\u003c/code\u003eを1に。\u003ccode\u003egenerator-star-spacing\u003c/code\u003eは書いた経験が（写経を除いて）無いので、勝手が分かってない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"legacy\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#legacy\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLegacy\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"max-len\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"max-params\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"max-statements\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003emax-len\u003c/code\u003e: 80を目安にしていて、そこから20許容する程度。画面内には120入る\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emax-params\u003c/code\u003e: 4くらいはやむを得ない、5は考え直すよな? みたいな境目\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emax-statements\u003c/code\u003e: ちょっとチキンな数字。16くらいまでは耐えても、内心モヤモヤするのは14前後\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emax-depth\u003c/code\u003e: \u003ccode\u003ecomplexity\u003c/code\u003eにお任せ\u003c/li\u003e\n\u003cli\u003eどれも2にしたら生産性が落ちるので1で許して😜\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"全文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A8%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e全文\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.eslintrc\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"env\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"es6\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"node\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"rules\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-reserved-keys\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-console\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-constant-condition\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-debugger\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-extra-parens\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-extra-boolean-cast\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"block-scoped-var\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"curly\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"all\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"default-case\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-div-regex\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-else-return\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-eq-null\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-floating-decimal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-multi-spaces\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"exceptions\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"Property\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"ImportDeclaration\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"VariableDeclarator\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"AssignmentExpression\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-self-compare\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"wrap-iife\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"inside\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"complexity\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"dot-notation\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"guard-for-in\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-extend-native\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-iterator\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-loop-func\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-multi-str\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-process-env\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-proto\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-throw-literal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-unused-expressions\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"radix\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-alert\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-extra-bind\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"yoda\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"strict\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-catch-shadow\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-undefined\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-unused-vars\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"vars\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"all\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"args\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"after-used\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-undef-init\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-path-concat\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-sync\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"indent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"comma-style\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"last\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"consistent-this\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"_this\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"func-style\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"declaration\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-nested-ternary\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"padded-blocks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"quotes\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"single\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-before-blocks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-before-function-paren\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-in-brackets\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-in-parens\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-return-throw-case\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-unary-ops\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"words\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"nonwords\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"brace-style\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"1tbs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"allowSingleLine\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"comma-spacing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"before\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"after\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"func-names\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"key-spacing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"align\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"value\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"beforeColon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"afterColon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"max-nested-callbacks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"new-cap\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"newIsCap\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"capIsNew\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-lonely-if\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-multiple-empty-lines\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"max\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"no-trailing-spaces\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"operator-linebreak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"before\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"semi\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"semi-spacing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\"before\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"after\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-after-keywords\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"space-infix-ops\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-underscore-dangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"no-var\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\"max-len\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"max-params\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"max-statements\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"ecmaFeatures\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"modules\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこんな感じで。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://havelog.ayumusato.com/develop/javascript/e660-eslint_with_babel.html\"\u003ehavelog.ayumusato.com - babel な ESLint の設定をがんばった\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://hail2u.net/blog/coding/come-into-eslint.html\"\u003ehail2u.net - よろしくESLint\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"どうも@armorik83です。ESLintのオプションを全部読んで吟味したので応酬を載せます。TypeScriptを辞めたというより、単機能ライブラリならES6の方が早く書けたという程度です。まさかりはブコメから。\n\n# 小分け\nまずは小分けにして。見出し名は[公式サイト](http://eslint.org/docs/rules/)と同じにしてあります。2が`exit code 1`投げるやつ、1はログのみ、0が無視。\n\n## Possible Errors\n```json\n{\n  \"no-reserved-keys\": 2,\n\n  \"no-console\": 1,\n  \"no-constant-condition\": 1,\n  \"no-debugger\": 1,\n  \"no-extra-parens\": 1,\n\n  \"no-extra-boolean-cast\": 0\n}\n```\n\n- 初期値がキツめなのでそのまま\n- `no-reserved-keys`は、パッと見たときの脳の引っ掛かりが嫌いなので2\n- 1は「まあ分かってるけどさ…見逃してよ…」みたいなの\n- `no-extra-boolean-cast`は普通に使うから0\n- `valid-jsdoc`は1にしたかったけど、WebStorm向けのゆるふわが許されなかったため初期値0のまま\n\n## Best Practices\n```json\n{\n  \"block-scoped-var\": 2,\n  \"curly\": [2, \"all\"],\n  \"default-case\": 2,\n  \"no-div-regex\": 2,\n  \"no-else-return\": 2,\n  \"no-eq-null\": 2,\n  \"no-floating-decimal\": 2,\n  \"no-multi-spaces\": [2, {\"exceptions\": {\"Property\": true, \"ImportDeclaration\": true, \"VariableDeclarator\": true, \"AssignmentExpression\": true}}],\n  \"no-self-compare\": 2,\n  \"wrap-iife\": [2, \"inside\"],\n\n  \"complexity\": [1, 3],\n  \"dot-notation\": 1,\n  \"guard-for-in\": 1,\n  \"no-extend-native\": 1,\n  \"no-iterator\": 1,\n  \"no-loop-func\": 1,\n  \"no-multi-str\": 1,\n  \"no-process-env\": 1,\n  \"no-proto\": 1,\n  \"no-throw-literal\": 1,\n  \"no-unused-expressions\": 1,\n  \"radix\": 1,\n\n  \"no-alert\": 0,\n  \"no-extra-bind\": 0,\n  \"yoda\": 0,\n}\n```\n\n- `block-scoped-var`: `let`, `const`縛りをしているので関係ないっちゃないが、2\n- `default-case`: 基本的にswitch構文が大嫌いなのでなんでもいい\n- `no-else-return`: 早期returnで無用な深さは避けようという意志\n- `no-eq-null`: `==`がとにかく嫌いで、たとえ長くても`foo === void 0 || foo === null`使ってくれ頼む! という意志\n- `complexity`が1なのは「わかってはいるんだ…（吐血」みたいな状況\n- その他、あまり行儀良くはないけど使うことあるなーみたいなものが1\n- [yoda](http://en.wikipedia.org/wiki/Yoda_conditions)ってまだやってる人いますか\n\n## Strict Mode\n\n```json\n{\n  \"strict\": 2\n}\n```\n\n使います。\n\n## Variables\n\n```json\n{\n  \"no-catch-shadow\": 2,\n\n  \"no-undefined\": 1,\n  \"no-unused-vars\": [1, {\"vars\": \"all\", \"args\": \"after-used\"}],\n  \"no-undef-init\": 1\n}\n```\n\n- `no-catch-shadow`: catch節を漏らしたくないという好み\n- `no-undefined`: 長らく`void 0`を使っているのでその流れ\n- `no-unused-vars`: やむを得ず使わない引数を宣言することがあるので（だいたい引数名を`_`にして、lodashは`lodash`にしてる）\n- `no-undef-init`: 禁止するほどでもないか、というところ\n\n## Node.js\n\n```json\n{\n  \"no-path-concat\": 1,\n  \"no-sync\": 1\n}\n```\n\n- `no-path-concat`: 横着することがあっても落とされるとストレス…みたいなやつ\n- `no-sync`: テストを簡便に書きたいときに使ったりするので\n\n## Stylistic Issues\n```json\n{\n  \"indent\": [2, 2],\n  \"comma-style\": [2, \"last\"],\n  \"consistent-this\": [2, \"_this\"],\n  \"func-style\": [2, \"declaration\"],\n  \"no-nested-ternary\": 2,\n  \"padded-blocks\": [2, \"never\"],\n  \"quotes\": [2, \"single\"],\n  \"space-before-blocks\": [2, \"always\"],\n  \"space-before-function-paren\": [2, \"never\"],\n  \"space-in-brackets\": [2, \"never\"],\n  \"space-in-parens\": [2, \"never\"],\n  \"space-return-throw-case\": 2,\n  \"space-unary-ops\": [2, {\"words\": true, \"nonwords\": false}],\n  \n  \"brace-style\": [1, \"1tbs\", {\"allowSingleLine\": true}],\n  \"comma-spacing\": [1, {\"before\": false, \"after\": true}],\n  \"func-names\": 1,\n  \"key-spacing\": [1, {\"align\": \"value\", \"beforeColon\": false, \"afterColon\": true}],\n  \"max-nested-callbacks\": [1, 3],\n  \"new-cap\": [1, {\"newIsCap\": true, \"capIsNew\": true}],\n  \"no-lonely-if\": 1,\n  \"no-multiple-empty-lines\": [1, {\"max\": 2}],\n  \"no-trailing-spaces\": 1,\n  \"operator-linebreak\": [1, \"before\"],\n  \"semi\": [1, \"always\"],\n  \"semi-spacing\": [1, {\"before\": false, \"after\": true}],\n  \"space-after-keywords\": [1, \"always\"],\n  \"space-infix-ops\": [1, \"always\"],\n  \n  \"no-underscore-dangle\": 0\n}\n```\n\nこの辺はもう見たまんま。1は横着を許容するやつとか、`new-cap`のような止むに止まれぬ事情とか、見つけ次第直したいけど毎回落とされるとストレス溜まるやつとか。`no-underscore-dangle`は使うので0なんですが、もしかしてマズかったりしますか。\n\n## ECMAScript 6\n\n```json\n{\n  \"no-var\": 1\n}\n```\n\nもう`let`と`const`しか使ってないので`no-var`を1に。`generator-star-spacing`は書いた経験が（写経を除いて）無いので、勝手が分かってない。\n\n## Legacy\n\n```json\n{\n  \"max-len\": [1, 100, 2],\n  \"max-params\": [1, 4],\n  \"max-statements\": [1, 12]\n}\n```\n\n- `max-len`: 80を目安にしていて、そこから20許容する程度。画面内には120入る\n- `max-params`: 4くらいはやむを得ない、5は考え直すよな? みたいな境目\n- `max-statements`: ちょっとチキンな数字。16くらいまでは耐えても、内心モヤモヤするのは14前後\n- `max-depth`: `complexity`にお任せ\n- どれも2にしたら生産性が落ちるので1で許して😜\n\n# 全文\n\n```json:.eslintrc\n{\n  \"env\": {\n    \"es6\": true,\n    \"node\": true\n  },\n  \"rules\": {\n    \"no-reserved-keys\": 2,\n\n    \"no-console\": 1,\n    \"no-constant-condition\": 1,\n    \"no-debugger\": 1,\n    \"no-extra-parens\": 1,\n\n    \"no-extra-boolean-cast\": 0,\n\n    \"block-scoped-var\": 2,\n    \"curly\": [2, \"all\"],\n    \"default-case\": 2,\n    \"no-div-regex\": 2,\n    \"no-else-return\": 2,\n    \"no-eq-null\": 2,\n    \"no-floating-decimal\": 2,\n    \"no-multi-spaces\": [2, {\"exceptions\": {\"Property\": true, \"ImportDeclaration\": true, \"VariableDeclarator\": true, \"AssignmentExpression\": true}}],\n    \"no-self-compare\": 2,\n    \"wrap-iife\": [2, \"inside\"],\n\n    \"complexity\": [1, 3],\n    \"dot-notation\": 1,\n    \"guard-for-in\": 1,\n    \"no-extend-native\": 1,\n    \"no-iterator\": 1,\n    \"no-loop-func\": 1,\n    \"no-multi-str\": 1,\n    \"no-process-env\": 1,\n    \"no-proto\": 1,\n    \"no-throw-literal\": 1,\n    \"no-unused-expressions\": 1,\n    \"radix\": 1,\n\n    \"no-alert\": 0,\n    \"no-extra-bind\": 0,\n    \"yoda\": 0,\n\n    \"strict\": 2,\n\n    \"no-catch-shadow\": 2,\n\n    \"no-undefined\": 1,\n    \"no-unused-vars\": [1, {\"vars\": \"all\", \"args\": \"after-used\"}],\n    \"no-undef-init\": 1,\n\n    \"no-path-concat\": 1,\n    \"no-sync\": 1,\n\n    \"indent\": [2, 2],\n    \"comma-style\": [2, \"last\"],\n    \"consistent-this\": [2, \"_this\"],\n    \"func-style\": [2, \"declaration\"],\n    \"no-nested-ternary\": 2,\n    \"padded-blocks\": [2, \"never\"],\n    \"quotes\": [2, \"single\"],\n    \"space-before-blocks\": [2, \"always\"],\n    \"space-before-function-paren\": [2, \"never\"],\n    \"space-in-brackets\": [2, \"never\"],\n    \"space-in-parens\": [2, \"never\"],\n    \"space-return-throw-case\": 2,\n    \"space-unary-ops\": [2, {\"words\": true, \"nonwords\": false}],\n\n    \"brace-style\": [1, \"1tbs\", {\"allowSingleLine\": true}],\n    \"comma-spacing\": [1, {\"before\": false, \"after\": true}],\n    \"func-names\": 1,\n    \"key-spacing\": [1, {\"align\": \"value\", \"beforeColon\": false, \"afterColon\": true}],\n    \"max-nested-callbacks\": [1, 3],\n    \"new-cap\": [1, {\"newIsCap\": true, \"capIsNew\": true}],\n    \"no-lonely-if\": 1,\n    \"no-multiple-empty-lines\": [1, {\"max\": 2}],\n    \"no-trailing-spaces\": 1,\n    \"operator-linebreak\": [1, \"before\"],\n    \"semi\": [1, \"always\"],\n    \"semi-spacing\": [1, {\"before\": false, \"after\": true}],\n    \"space-after-keywords\": [1, \"always\"],\n    \"space-infix-ops\": [1, \"always\"],\n\n    \"no-underscore-dangle\": 0,\n\n    \"no-var\": 1,\n\n    \"max-len\": [1, 100, 2],\n    \"max-params\": [1, 4],\n    \"max-statements\": [1, 12]\n  },\n  \"ecmaFeatures\": {\n    \"modules\": true\n  }\n}\n```\n\nこんな感じで。\n\n# 参考\n- [havelog.ayumusato.com - babel な ESLint の設定をがんばった](http://havelog.ayumusato.com/develop/javascript/e660-eslint_with_babel.html)\n- [hail2u.net - よろしくESLint](http://hail2u.net/blog/coding/come-into-eslint.html)\n","coediting":false,"created_at":"2015-05-09T09:51:33+09:00","id":"861e8b883ea5893a3320","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"ESLint","versions":[]}],"title":".eslintrc晒す","updated_at":"2015-05-09T10:28:05+09:00","url":"http://qiita.com/armorik83/items/861e8b883ea5893a3320","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"qangular使ってるけどユーザー認証とかもっと簡単にできないの-astormpathでできますよ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#qangular%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%91%E3%81%A9%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E8%AA%8D%E8%A8%BC%E3%81%A8%E3%81%8B%E3%82%82%E3%81%A3%E3%81%A8%E7%B0%A1%E5%8D%98%E3%81%AB%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%AE-astormpath%E3%81%A7%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%82%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eQ,Angular使ってるけど、ユーザー認証とかもっと簡単にできないの？ A,Stormpathでできますよ！\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"何をするか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%95%E3%82%92%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e何をするか\u003c/h2\u003e\n\n\u003cp\u003eangularを使ってて、サーバー側はnodejs、expressを使っていて、アプリケーションを作りたいのだけれども、ユーザー管理とか、データのアクセス権限を簡単に設定したい。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"stormpathとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stormpath%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStormpathとは\u003c/h2\u003e\n\n\u003cp\u003eユーザー認証、管理をするサービス。\u003cbr\u003e\n\u003ca href=\"https://stormpath.com/product/\"\u003ehttps://stormpath.com/product/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e-アカウント管理\u003cbr\u003e\n-パスワード管理\u003cbr\u003e\n-グループ管理\u003cbr\u003e\n-メールによる認証\u003cbr\u003e\n-OAuth etc...\u003c/p\u003e\n\n\u003cp\u003eangularを用いた利用ガイド\u003cbr\u003e\n\u003ca href=\"http://docs.stormpath.com/angularjs/guide/index.html\"\u003ehttp://docs.stormpath.com/angularjs/guide/index.html\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h2\u003e\n\n\u003cp\u003eangularでの利用を考えているので、簡単のためangular-fullstackを利用してどんな感じかを残します。(レガシーなので本番には採用しない。)\u003cbr\u003e\n\u003ca href=\"https://stormpath.com/blog/angular-node-15-minutes/\"\u003ehttps://stormpath.com/blog/angular-node-15-minutes/\u003c/a\u003e\u003cbr\u003e\nStormathではangular用のSDKも公開している模様。\u003cbr\u003e\n\u003ca href=\"https://github.com/stormpath/stormpath-sdk-angularjs\"\u003ehttps://github.com/stormpath/stormpath-sdk-angularjs\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手順\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"テンプレートの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテンプレートの作成\u003c/h3\u003e\n\n\u003cp\u003eインストール等の説明は省きます。ググれば一杯ある。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003emkdir stormpathSample\u003c/span\u003e\n\u003cspan class=\"go\"\u003ecd stormpathSample\u003c/span\u003e\n\u003cspan class=\"go\"\u003eyo anglar-fullstack stormpathSample\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"gp\"\u003e#\u003c/span\u003e Client\n\n\u003cspan class=\"go\"\u003e? What would you like to write scripts with? JavaScript\u003c/span\u003e\n\u003cspan class=\"go\"\u003e? What would you like to write markup with? HTML\u003c/span\u003e\n\u003cspan class=\"go\"\u003e? What would you like to write stylesheets with? CSS\u003c/span\u003e\n\u003cspan class=\"go\"\u003e? What Angular router would you like to use? uiRouter\u003c/span\u003e\n\u003cspan class=\"go\"\u003e? Would you like to include Bootstrap? Yes\u003c/span\u003e\n\u003cspan class=\"go\"\u003e? Would you like to include UI Bootstrap? No\u003c/span\u003e\n\n\u003cspan class=\"gp\"\u003e#\u003c/span\u003e Server\n\n\u003cspan class=\"go\"\u003e? Would you like to use mongoDB with Mongoose for data modeling? No\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003egrunt serve\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんな画面が出てくる。\u003cbr\u003e\n\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/0a6077e6-86fa-d2ac-bf34-af08d2c5f120.png\" alt=\"Untitled.png\" title=\"Untitled.png\"\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"stormpathのアカウント作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stormpath%E3%81%AE%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStormpathのアカウント作成\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://api.stormpath.com/register\"\u003ehttps://api.stormpath.com/register\u003c/a\u003e\u003cbr\u003e\nでアカウント作成。\u003cbr\u003e\nそしたらメールが来るので、アクティベートする。Tenantはそのままでいい。\u003cbr\u003e\nこんなダッシュボード画面がでる。\u003cbr\u003e\n\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/85a9b49a-f943-491f-4bd7-cd5b21dc8186.png\" alt=\"Untitled.png\" title=\"Untitled.png\"\u003e\u003cbr\u003e\nここでcreate API keyを押してkeyを生成する。ダウンロードされるidとsecretを後ほど利用する。\u003cbr\u003e\nダッシュボードからApplicationsをみたらMy Applicationというのが自動生成されている。\u003cbr\u003e\nこのMy ApplicationのページにREST URLが表示されているのでこれを使う。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"serverの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#server%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eServerの設定\u003c/h3\u003e\n\n\u003cp\u003eNode側でのStormpathの設定をする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eserver/config/local.env.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Use local.env.js for environment variables that grunt will set when the server starts locally.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Use for your api keys, secrets, etc. This file should not be tracked by git.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// You will need to set these on the server you deploy to.\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eDOMAIN\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'http://localhost:9000'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eSESSION_SECRET\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"stormpathsample-secret\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// Control debug level for modules using visionmedia/debug\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eDEBUG\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e//ここに先ほど入手したID等を入れる\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eSTORMPATH_API_KEY_ID\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'YOUR_KEY_ID'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eSTORMPATH_API_KEY_SECRET\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'YOUR_KEY_SECRET'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eSTORMPATH_APP_HREF\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'YOUR_APP_HREF'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eexpressをアップデートしておく。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003enpm i --save express@latest\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003estormpath-sdk-expressをインストールする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003enpm i -save stormpath-sdk-express\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003estormpath-sdk-expressをrequireする。\u003cbr\u003e\nexpressアプリと紐づけて、yeomanで作られたapi/thingにアクセスするのに認証が必要となるようにする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eserver/routes.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cm\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * Main application routes\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'./components/errors'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//追加\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003estormpathExpressSdk\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'stormpath-sdk-express'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//追加\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003espMiddleware\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estormpathExpressSdk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateMiddleware\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//追加\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003espMiddleware\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattachDefaults\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Insert routes below\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//変更\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/api/things'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003espMiddleware\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eauthenticate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'./api/thing'\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//app.use('/api/things', require('./api/thing'));\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// All undefined asset or api routes should return a 404\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eroute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/:url(api|auth|components|app|bower_components|assets)/*'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e404\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// All other routes should redirect to the index.html\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eroute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/*'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esendfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'appPath'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/index.html'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの状態だとclientからthingsは見れないようになっています。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/3a21974a-191e-3517-598a-06ce815d5840.png\" alt=\"Untitled.png\" title=\"Untitled.png\"\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"client側の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#client%E5%81%B4%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClient側の設定\u003c/h3\u003e\n\n\u003cp\u003eStormpathのangular用SDKをインストールします。(npmがない？。。。)\u003cbr\u003e\napiリファレンスはここ。\u003cbr\u003e\n\u003ca href=\"http://docs.stormpath.com/angularjs/sdk/#/api\"\u003ehttp://docs.stormpath.com/angularjs/sdk/#/api\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003ebower install --save stormpath-sdk-angularjs\u003c/span\u003e\n\u003cspan class=\"go\"\u003egrunt --force\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eangularへmoduleのインジェクションを行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eclient/app/app.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'stormpathSampleApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ngCookies'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ngResource'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ngSanitize'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ui.router'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//追記\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'stormpath'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//追記\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'stormpath.templates'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$stateProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$urlRouterProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$locationProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$urlRouterProvider\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eotherwise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003e$locationProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtml5Mode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eui-routerとのインテグレーションを行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eclient/app/app.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'stormpathSampleApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ngCookies'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ngResource'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ngSanitize'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'ui.router'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//追記\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'stormpath'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//追記\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'stormpath.templates'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$stateProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$urlRouterProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e$locationProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$urlRouterProvider\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eotherwise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003e$locationProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtml5Mode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//追記\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$stormpath\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$stormpath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euiRouter\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eloginState\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'login'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003edefaultPostLoginState\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'main'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eloginState\u003c/code\u003eはユーザーのアクセス権限ないページをリクエストした場合リダイレクトされる先です。ログイン後にリクエストしたページに戻されます。\u003cbr\u003e\n\u003ccode\u003edefaultPostLoginState\u003c/code\u003eはユーザーがログインページを直接リクエストした場合、ログイン後に飛ばされるページです。\u003cbr\u003e\n別の書き方もあるようですが、それは別記事で書こうと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"client側のユーザー登録画面\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#client%E5%81%B4%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E7%99%BB%E9%8C%B2%E7%94%BB%E9%9D%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClient側のユーザー登録画面\u003c/h3\u003e\n\n\u003cp\u003e設定はほとんど終わったので、ここからユーザー登録画面を作っていきます。\u003cbr\u003e\nまずはナビバーから。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eclient/components/navbar/navbar.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"navbar navbar-default navbar-static-top\"\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"NavbarCtrl as navbar\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"container\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"navbar-header\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"navbar-toggle\"\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"button\"\u003c/span\u003e \u003cspan class=\"na\"\u003eng-click=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"isCollapsed = !isCollapsed\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;span\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"sr-only\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eToggle navigation\u003cspan class=\"nt\"\u003e\u0026lt;/span\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;span\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"icon-bar\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/span\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;span\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"icon-bar\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/span\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;span\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"icon-bar\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/span\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"navbar-brand\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003estormpath-sample\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003ecollapse=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"isCollapsed\"\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"navbar-collapse collapse\"\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"navbar-main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;ul\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"nav navbar-nav\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003eng-repeat=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"item in menu\"\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{active: isActive(item.link)}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003eng-href=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{{item.link}}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e{{item.title}}\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n        //追記\n        \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003eif-user\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{active: isActive('/profile')}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003eng-href=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/profile\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eProfile\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n        //追記\n        \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003eif-not-user\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{active: isActive('/register')}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003eui-sref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"register\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eRegister\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n        //追記\n        \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003eif-not-user\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{active: isActive('/login')}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003eui-sref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"login\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eLogin\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n        //追記\n        \u003cspan class=\"nt\"\u003e\u0026lt;li\u003c/span\u003e \u003cspan class=\"na\"\u003eif-user\u003c/span\u003e \u003cspan class=\"na\"\u003eng-class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{active: isActive('/logout')}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003eui-sref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"main\"\u003c/span\u003e \u003cspan class=\"na\"\u003elogout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eLogout\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/ul\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eif-user\u003c/code\u003e\u003ccode\u003eif-not-user\u003c/code\u003eディレクティブを使うことでリンクを表示するか、しないかをコントロールできます。\u003cbr\u003e\n詳細はここら辺で。\u003ca href=\"http://docs.stormpath.com/angularjs/sdk/#/api/stormpath.ifUser:ifUser\"\u003ehttp://docs.stormpath.com/angularjs/sdk/#/api/stormpath.ifUser:ifUser\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eユーザー登録画面を作成していくので、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003eyo angular-fullstack:route register\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとしてルーティング先を作って、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eclient/app/register/register.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-include=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"'components/navbar/navbar.html'\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"container\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"row\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"col-xs-12\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;h3\u0026gt;\u003c/span\u003eRegistration\u003cspan class=\"nt\"\u003e\u0026lt;/h3\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;hr\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003esp-registration-form\u003c/span\u003e \u003cspan class=\"na\"\u003epost-login-state=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"main\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003esp-registration-form\u003c/code\u003eというディレクティブが用意されているのでそのままぶち込む。\u003cbr\u003e\n\u003ccode\u003epost-login-state\u003c/code\u003eはユーザー登録の終わった後に飛ばしたいページ先をオプションで設定出来る模様。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/4cf7e8ab-fb80-2851-ac1d-dcfe84d949c1.png\" alt=\"Untitled 2.png\" title=\"Untitled 2.png\"\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003elocalhost:9000/register\u003c/code\u003eをみるとこんな感じですね。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"メールアドレスによる認証\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%81%AB%E3%82%88%E3%82%8B%E8%AA%8D%E8%A8%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメールアドレスによる認証\u003c/h3\u003e\n\n\u003cp\u003eメールによる認証を作っていきます。\u003cbr\u003e\nルーティングを\u003ccode\u003e/register/verify\u003c/code\u003eにしておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eyo angular-fullstack:route emailVerification\n? Where would you like to create this route? client/app/\n? What will the url of your route be? /register/verify\n   create client/app/emailVerification/emailVerification.js\n   create client/app/emailVerification/emailVerification.controller.js\n   create client/app/emailVerification/emailVerification.controller.spec.js\n   create client/app/emailVerification/emailVerification.css\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eユーザーが送られてきたメールのリンクをクリックした時に飛ばしたいURLの設定をします。\u003cbr\u003e\n\u003ccode\u003esptoken\u003c/code\u003eというURLパラメータui-routerに伝えておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eclient/app/emailVerification/emailVerification.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'stormpathSampleApp'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$stateProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$stateProvider\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'emailVerification'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//変更\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/register/verify?sptoken'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003etemplateUrl\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'app/emailVerification/emailVerification.html'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'EmailVerificationCtrl as emailVerification'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ehtmlのページも変更していきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eclient/app/emailVerification/emailVerification.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-include=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"'components/navbar/navbar.html'\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"container\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"row\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"col-xs-12\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;h3\u0026gt;\u003c/span\u003eVerify Your Account\u003cspan class=\"nt\"\u003e\u0026lt;/h3\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;hr\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003esp-email-verification\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003esp-email-verification\u003c/code\u003eディレクティブにていい感じに用意されています。\u003cbr\u003e\n次に、stormpathに認証メールでの飛ばしたいリンクを伝えておきます。\u003cbr\u003e\nローカル開発環境の\u003ccode\u003ehttp://localhost:9000/register/verify\u003c/code\u003eを加えます。\u003cbr\u003e\n\u003ca href=\"https://api.stormpath.com/login\"\u003ehttps://api.stormpath.com/login\u003c/a\u003e\u003cbr\u003e\nDirectriesへ行ってworkflowに飛び、verificationをEnabledにし、Base link URLを\u003ccode\u003ehttp://localhost:9000/register/verify\u003c/code\u003eに変更しましょう。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/5b8261b9-7e40-0114-44f7-7f21bec07164.png\" alt=\"Untitled 4.png\" title=\"Untitled 4.png\"\u003e\u003c/p\u003e\n\n\u003cp\u003e送信されるメールの内容もここから編集することができます。\u003cbr\u003e\nsave changesを押して保存します。\u003c/p\u003e\n\n\u003cp\u003eフォームをカスタマイズしたい場合はここを参考にすればいいと思います。\u003cbr\u003e\n\u003ca href=\"http://docs.stormpath.com/angularjs/guide/register.html#customizing-the-form\"\u003ehttp://docs.stormpath.com/angularjs/guide/register.html#customizing-the-form\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"client側ログイン画面\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#client%E5%81%B4%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E7%94%BB%E9%9D%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eclient側ログイン画面\u003c/h3\u003e\n\n\u003cp\u003e登録画面を作れたので、ログイン画面を作成していきます。\u003cbr\u003e\n先ほどと同様に\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003eyo angular-fullstack:route login\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eclient/app/login/login.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-include=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"'components/navbar/navbar.html'\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"container\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"row\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"col-xs-12\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;h3\u0026gt;\u003c/span\u003eLogin\u003cspan class=\"nt\"\u003e\u0026lt;/h3\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;hr\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003esp-login-form\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれも\u003ccode\u003esp-login-form\u003c/code\u003eというディレクティブが用意されていますので、これを使います。\u003cbr\u003e\n詳細はここです。\u003ca href=\"http://docs.stormpath.com/angularjs/sdk/#/api/stormpath.spLoginForm:sp-login-form\"\u003ehttp://docs.stormpath.com/angularjs/sdk/#/api/stormpath.spLoginForm:sp-login-form\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u0026lt;ANY sp-login-form\n     template-url=\"{string}\"\u0026gt;\n   ...\n\u0026lt;/ANY\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etemplateURLを埋め込むこともできるようです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003elocalhost:9000/login\u003c/code\u003eをみると\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/c24fc020-4273-659c-c0de-7edabb47f3ac.png\" alt=\"Untitled 3.png\" title=\"Untitled 3.png\"\u003e\u003c/p\u003e\n\n\u003cp\u003eすごく楽だ！\u003c/p\u003e\n\n\u003cp\u003e実際にユーザー登録をしてみて、送られてくるメールにあるURLに飛ぶと以下のような画面にいくと成功です。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/36dd2951-ff1e-ed01-41d2-5a1439e0960b.png\" alt=\"Untitled 5.png\" title=\"Untitled 5.png\"\u003e\u003c/p\u003e\n\n\u003cp\u003e/api/thingsからthingsをgetすることができました。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/58613/753fd125-6c55-1d12-5219-ee2cd59487ab.png\" alt=\"Untitled 6.png\" title=\"Untitled 6.png\"\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"締め\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B7%A0%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e締め\u003c/h2\u003e\n\n\u003cp\u003eこのように簡単にユーザー認証フローを作ることができますし、アクセス認証も行えます。\u003cbr\u003e\nユーザー管理に時間を割かずにアプリケーションの開発ができるのですごく便利ですね。\u003cbr\u003e\nangularユーザーの私からすると、テンプレートを用意してくれていると嬉しいです。\u003cbr\u003e\n次は、ユーザーグループの管理方法について書きたいと思っています。\u003c/p\u003e\n","body":"#Q,Angular使ってるけど、ユーザー認証とかもっと簡単にできないの？ A,Stormpathでできますよ！\n\n##何をするか\nangularを使ってて、サーバー側はnodejs、expressを使っていて、アプリケーションを作りたいのだけれども、ユーザー管理とか、データのアクセス権限を簡単に設定したい。\n\n##Stormpathとは\nユーザー認証、管理をするサービス。\nhttps://stormpath.com/product/\n\n-アカウント管理\n-パスワード管理\n-グループ管理\n-メールによる認証\n-OAuth etc...\n\nangularを用いた利用ガイド\nhttp://docs.stormpath.com/angularjs/guide/index.html\n\n##環境\nangularでの利用を考えているので、簡単のためangular-fullstackを利用してどんな感じかを残します。(レガシーなので本番には採用しない。)\nhttps://stormpath.com/blog/angular-node-15-minutes/\nStormathではangular用のSDKも公開している模様。\nhttps://github.com/stormpath/stormpath-sdk-angularjs\n\n##手順\n###テンプレートの作成\nインストール等の説明は省きます。ググれば一杯ある。\n\n```console\nmkdir stormpathSample\ncd stormpathSample\nyo anglar-fullstack stormpathSample\n```\n\n```console\n# Client\n\n? What would you like to write scripts with? JavaScript\n? What would you like to write markup with? HTML\n? What would you like to write stylesheets with? CSS\n? What Angular router would you like to use? uiRouter\n? Would you like to include Bootstrap? Yes\n? Would you like to include UI Bootstrap? No\n\n# Server\n\n? Would you like to use mongoDB with Mongoose for data modeling? No\n```\n\n```console\ngrunt serve\n```\n\nこんな画面が出てくる。\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58613/0a6077e6-86fa-d2ac-bf34-af08d2c5f120.png \"Untitled.png\")\n\n\n###Stormpathのアカウント作成\nhttps://api.stormpath.com/register\nでアカウント作成。\nそしたらメールが来るので、アクティベートする。Tenantはそのままでいい。\nこんなダッシュボード画面がでる。\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58613/85a9b49a-f943-491f-4bd7-cd5b21dc8186.png \"Untitled.png\")\nここでcreate API keyを押してkeyを生成する。ダウンロードされるidとsecretを後ほど利用する。\nダッシュボードからApplicationsをみたらMy Applicationというのが自動生成されている。\nこのMy ApplicationのページにREST URLが表示されているのでこれを使う。\n\n###Serverの設定\nNode側でのStormpathの設定をする。\n\n```server/config/local.env.js\n'use strict';\n\n// Use local.env.js for environment variables that grunt will set when the server starts locally.\n// Use for your api keys, secrets, etc. This file should not be tracked by git.\n//\n// You will need to set these on the server you deploy to.\n\nmodule.exports = {\n  DOMAIN: 'http://localhost:9000',\n  SESSION_SECRET: \"stormpathsample-secret\",\n  // Control debug level for modules using visionmedia/debug\n  DEBUG: '',\n  \n  //ここに先ほど入手したID等を入れる\n  STORMPATH_API_KEY_ID: 'YOUR_KEY_ID',\n  STORMPATH_API_KEY_SECRET: 'YOUR_KEY_SECRET',\n  STORMPATH_APP_HREF: 'YOUR_APP_HREF'\n};\n\n```\n\nexpressをアップデートしておく。\n\n```console\nnpm i --save express@latest\n```\n\nstormpath-sdk-expressをインストールする。\n\n```console\nnpm i -save stormpath-sdk-express\n```\n\nstormpath-sdk-expressをrequireする。\nexpressアプリと紐づけて、yeomanで作られたapi/thingにアクセスするのに認証が必要となるようにする。\n\n```server/routes.js\n/**\n * Main application routes\n */\n\n'use strict';\n\nvar errors = require('./components/errors');\n//追加\nvar stormpathExpressSdk = require('stormpath-sdk-express');\n\nmodule.exports = function(app) {\n  //追加\n  var spMiddleware = stormpathExpressSdk.createMiddleware();\n  //追加\n  spMiddleware.attachDefaults(app);\n\n  // Insert routes below\n  //変更\n  app.use('/api/things', spMiddleware.authenticate, require('./api/thing'));\n  //app.use('/api/things', require('./api/thing'));\n  \n  // All undefined asset or api routes should return a 404\n  app.route('/:url(api|auth|components|app|bower_components|assets)/*')\n   .get(errors[404]);\n\n  // All other routes should redirect to the index.html\n  app.route('/*')\n    .get(function(req, res) {\n      res.sendfile(app.get('appPath') + '/index.html');\n    });\n};\n```\n\nこの状態だとclientからthingsは見れないようになっています。\n\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58613/3a21974a-191e-3517-598a-06ce815d5840.png \"Untitled.png\")\n\n\n###Client側の設定\nStormpathのangular用SDKをインストールします。(npmがない？。。。)\napiリファレンスはここ。\nhttp://docs.stormpath.com/angularjs/sdk/#/api\n\n\n```console\nbower install --save stormpath-sdk-angularjs\ngrunt --force\n```\n\nangularへmoduleのインジェクションを行います。\n\n```client/app/app.js\n'use strict';\n\nangular.module('stormpathSampleApp', [\n  'ngCookies',\n  'ngResource',\n  'ngSanitize',\n  'ui.router',\n  //追記\n  'stormpath',\n  //追記\n  'stormpath.templates'\n])\n  .config(function ($stateProvider, $urlRouterProvider, $locationProvider) {\n    $urlRouterProvider\n      .otherwise('/');\n\n    $locationProvider.html5Mode(true);\n  });\n```\n\nui-routerとのインテグレーションを行います。\n\n```client/app/app.js\n'use strict';\n\nangular.module('stormpathSampleApp', [\n  'ngCookies',\n  'ngResource',\n  'ngSanitize',\n  'ui.router',\n  //追記\n  'stormpath',\n  //追記\n  'stormpath.templates'\n])\n  .config(function ($stateProvider, $urlRouterProvider, $locationProvider) {\n    $urlRouterProvider\n      .otherwise('/');\n\n    $locationProvider.html5Mode(true);\n  })\n  //追記\n  .run(function($stormpath){\n    $stormpath.uiRouter({\n      loginState: 'login',\n      defaultPostLoginState: 'main'\n    });\n  });\n```\n\n`loginState`はユーザーのアクセス権限ないページをリクエストした場合リダイレクトされる先です。ログイン後にリクエストしたページに戻されます。\n`defaultPostLoginState`はユーザーがログインページを直接リクエストした場合、ログイン後に飛ばされるページです。\n別の書き方もあるようですが、それは別記事で書こうと思います。\n\n\n###Client側のユーザー登録画面\n設定はほとんど終わったので、ここからユーザー登録画面を作っていきます。\nまずはナビバーから。\n\n```client/components/navbar/navbar.html\n\u003cdiv class=\"navbar navbar-default navbar-static-top\" ng-controller=\"NavbarCtrl as navbar\"\u003e\n  \u003cdiv class=\"container\"\u003e\n    \u003cdiv class=\"navbar-header\"\u003e\n      \u003cbutton class=\"navbar-toggle\" type=\"button\" ng-click=\"isCollapsed = !isCollapsed\"\u003e\n        \u003cspan class=\"sr-only\"\u003eToggle navigation\u003c/span\u003e\n        \u003cspan class=\"icon-bar\"\u003e\u003c/span\u003e\n        \u003cspan class=\"icon-bar\"\u003e\u003c/span\u003e\n        \u003cspan class=\"icon-bar\"\u003e\u003c/span\u003e\n      \u003c/button\u003e\n      \u003ca href=\"/\" class=\"navbar-brand\"\u003estormpath-sample\u003c/a\u003e\n    \u003c/div\u003e\n    \u003cdiv collapse=\"isCollapsed\" class=\"navbar-collapse collapse\" id=\"navbar-main\"\u003e\n      \u003cul class=\"nav navbar-nav\"\u003e\n        \u003cli ng-repeat=\"item in menu\" ng-class=\"{active: isActive(item.link)}\"\u003e\n          \u003ca ng-href=\"{{item.link}}\"\u003e{{item.title}}\u003c/a\u003e\n        \u003c/li\u003e\n        //追記\n        \u003cli if-user ng-class=\"{active: isActive('/profile')}\"\u003e\n          \u003ca ng-href=\"/profile\"\u003eProfile\u003c/a\u003e\n        \u003c/li\u003e\n        //追記\n        \u003cli if-not-user ng-class=\"{active: isActive('/register')}\"\u003e\n          \u003ca ui-sref=\"register\"\u003eRegister\u003c/a\u003e\n        \u003c/li\u003e\n        //追記\n        \u003cli if-not-user ng-class=\"{active: isActive('/login')}\"\u003e\n          \u003ca ui-sref=\"login\"\u003eLogin\u003c/a\u003e\n        \u003c/li\u003e\n        //追記\n        \u003cli if-user ng-class=\"{active: isActive('/logout')}\"\u003e\n          \u003ca ui-sref=\"main\" logout\u003eLogout\u003c/a\u003e\n        \u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n```\n\n`if-user``if-not-user`ディレクティブを使うことでリンクを表示するか、しないかをコントロールできます。\n詳細はここら辺で。http://docs.stormpath.com/angularjs/sdk/#/api/stormpath.ifUser:ifUser\n\nユーザー登録画面を作成していくので、\n\n```console\nyo angular-fullstack:route register\n```\n\nとしてルーティング先を作って、\n\n```client/app/register/register.html\n\u003cdiv ng-include=\"'components/navbar/navbar.html'\"\u003e\u003c/div\u003e\n\n\u003cdiv class=\"container\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-xs-12\"\u003e\n            \u003ch3\u003eRegistration\u003c/h3\u003e\n            \u003chr\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n    \u003cdiv sp-registration-form post-login-state=\"main\"\u003e\u003c/div\u003e\n\u003c/div\u003e\n```\n\n`sp-registration-form `というディレクティブが用意されているのでそのままぶち込む。\n`post-login-state`はユーザー登録の終わった後に飛ばしたいページ先をオプションで設定出来る模様。\n\n![Untitled 2.png](https://qiita-image-store.s3.amazonaws.com/0/58613/4cf7e8ab-fb80-2851-ac1d-dcfe84d949c1.png \"Untitled 2.png\")\n\n`localhost:9000/register`をみるとこんな感じですね。\n\n###メールアドレスによる認証\nメールによる認証を作っていきます。\nルーティングを`/register/verify`にしておきます。\n\n```\nyo angular-fullstack:route emailVerification\n? Where would you like to create this route? client/app/\n? What will the url of your route be? /register/verify\n   create client/app/emailVerification/emailVerification.js\n   create client/app/emailVerification/emailVerification.controller.js\n   create client/app/emailVerification/emailVerification.controller.spec.js\n   create client/app/emailVerification/emailVerification.css\n```\n\nユーザーが送られてきたメールのリンクをクリックした時に飛ばしたいURLの設定をします。\n`sptoken`というURLパラメータui-routerに伝えておきます。\n\n```client/app/emailVerification/emailVerification.js\n'use strict';\n\nangular.module('stormpathSampleApp')\n  .config(function ($stateProvider) {\n    $stateProvider\n      .state('emailVerification', {\n      \t//変更\n        url: '/register/verify?sptoken',\n        templateUrl: 'app/emailVerification/emailVerification.html',\n        controller: 'EmailVerificationCtrl as emailVerification'\n      });\n  });\n\n```\n\nhtmlのページも変更していきます。\n\n\n```client/app/emailVerification/emailVerification.html\n\u003cdiv ng-include=\"'components/navbar/navbar.html'\"\u003e\u003c/div\u003e\n\n\u003cdiv class=\"container\"\u003e\n  \u003cdiv class=\"row\"\u003e\n    \u003cdiv class=\"col-xs-12\"\u003e\n      \u003ch3\u003eVerify Your Account\u003c/h3\u003e\n      \u003chr\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n  \u003cdiv sp-email-verification\u003e\u003c/div\u003e\n\u003c/div\u003e\n```\n\n`sp-email-verification`ディレクティブにていい感じに用意されています。\n次に、stormpathに認証メールでの飛ばしたいリンクを伝えておきます。\nローカル開発環境の`http://localhost:9000/register/verify`を加えます。\nhttps://api.stormpath.com/login\nDirectriesへ行ってworkflowに飛び、verificationをEnabledにし、Base link URLを`http://localhost:9000/register/verify`に変更しましょう。\n\n![Untitled 4.png](https://qiita-image-store.s3.amazonaws.com/0/58613/5b8261b9-7e40-0114-44f7-7f21bec07164.png \"Untitled 4.png\")\n\n送信されるメールの内容もここから編集することができます。\nsave changesを押して保存します。\n\n\nフォームをカスタマイズしたい場合はここを参考にすればいいと思います。\nhttp://docs.stormpath.com/angularjs/guide/register.html#customizing-the-form\n\n\n\n###client側ログイン画面\n登録画面を作れたので、ログイン画面を作成していきます。\n先ほどと同様に\n\n```console\nyo angular-fullstack:route login\n```\n\n```client/app/login/login.html\n\u003cdiv ng-include=\"'components/navbar/navbar.html'\"\u003e\u003c/div\u003e\n\n\u003cdiv class=\"container\"\u003e\n  \u003cdiv class=\"row\"\u003e\n    \u003cdiv class=\"col-xs-12\"\u003e\n      \u003ch3\u003eLogin\u003c/h3\u003e\n      \u003chr\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n  \u003cdiv sp-login-form\u003e\u003c/div\u003e\n\u003c/div\u003e\n```\n\nこれも`sp-login-form`というディレクティブが用意されていますので、これを使います。\n詳細はここです。http://docs.stormpath.com/angularjs/sdk/#/api/stormpath.spLoginForm:sp-login-form\n\n```\n\u003cANY sp-login-form\n     template-url=\"{string}\"\u003e\n   ...\n\u003c/ANY\u003e\n```\ntemplateURLを埋め込むこともできるようです。\n\n`localhost:9000/login`をみると\n\n![Untitled 3.png](https://qiita-image-store.s3.amazonaws.com/0/58613/c24fc020-4273-659c-c0de-7edabb47f3ac.png \"Untitled 3.png\")\n\nすごく楽だ！\n\n実際にユーザー登録をしてみて、送られてくるメールにあるURLに飛ぶと以下のような画面にいくと成功です。\n\n![Untitled 5.png](https://qiita-image-store.s3.amazonaws.com/0/58613/36dd2951-ff1e-ed01-41d2-5a1439e0960b.png \"Untitled 5.png\")\n\n/api/thingsからthingsをgetすることができました。\n\n![Untitled 6.png](https://qiita-image-store.s3.amazonaws.com/0/58613/753fd125-6c55-1d12-5219-ee2cd59487ab.png \"Untitled 6.png\")\n\n##締め\nこのように簡単にユーザー認証フローを作ることができますし、アクセス認証も行えます。\nユーザー管理に時間を割かずにアプリケーションの開発ができるのですごく便利ですね。\nangularユーザーの私からすると、テンプレートを用意してくれていると嬉しいです。\n次は、ユーザーグループの管理方法について書きたいと思っています。\n","coediting":false,"created_at":"2015-05-08T17:47:15+09:00","id":"766ac134930ee0fb4837","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"Node.js","versions":[]},{"name":"Heroku","versions":[]},{"name":"Express","versions":[]},{"name":"AngularJS","versions":[]}],"title":"Q, Angular使ってるけど、ユーザー認証とかもっと簡単にできないの？ A, Stormpathでできますよ！","updated_at":"2015-05-11T15:09:34+09:00","url":"http://qiita.com/shinsukeimai/items/766ac134930ee0fb4837","user":{"description":null,"facebook_id":null,"followees_count":11,"followers_count":6,"github_login_name":"shinsukeimai","id":"shinsukeimai","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":58613,"profile_image_url":"https://avatars.githubusercontent.com/u/7425556?v=2","twitter_screen_name":"shin_v1","website_url":null}},{"rendered_body":"\u003cp\u003eこんにちは、\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。みなさんテスト書いてますか。\u003c/p\u003e\n\n\u003cp\u003e今日は久々にテストの話を書きます。経緯を含めた流れで話を進めます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ブラウザ向けライブラリをnodejs--mochaでテストしたい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E5%90%91%E3%81%91%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92nodejs--mocha%E3%81%A7%E3%83%86%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eブラウザ向けライブラリをNode.js + Mochaでテストしたい\u003c/h1\u003e\n\n\u003cp\u003e今、AngularJS絡みのライブラリを開発中なんですが、そこで\u003ccode\u003edocument\u003c/code\u003eが出てくる点が問題となります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esample.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c1\"\u003e// 開発中のソースを見本用にいじってます\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e: \u003cspan class=\"kt\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires?\u003c/span\u003e: \u003cspan class=\"kt\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e[])\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eselector\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// この辺\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003edocument\u003c/code\u003eはグローバル変数で、これは\u003ccode\u003ewindow.document\u003c/code\u003eと同じことです。ブラウザ上で動かす際は\u003ccode\u003ewindow\u003c/code\u003eも\u003ccode\u003ewindow.document\u003c/code\u003eも値があるので問題ないですが、このソースをMochaで（Karmaなどを使わず）テストするときに、\u003ccode\u003ewindow\u003c/code\u003eが未定義として落ちます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eReferenceError: document is not defined\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ひとまずソース内に直に書かない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%B2%E3%81%A8%E3%81%BE%E3%81%9A%E3%82%BD%E3%83%BC%E3%82%B9%E5%86%85%E3%81%AB%E7%9B%B4%E3%81%AB%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eひとまずソース内に直に書かない\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esample.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../browser-dependencies'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 追加\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eFoo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e: \u003cspan class=\"kt\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires?\u003c/span\u003e: \u003cspan class=\"kt\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e[])\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eselector\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// このdocumentは'../browser-dependencies'の module.exports.document となる\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebrowser-dependencies.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDocument\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまだ密結合ですが、間にDIの余地を設けました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eReferenceError: window is not defined\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ewindow\u003c/code\u003eが残っているので怒られます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"isomorphicっぽい分岐\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#isomorphic%E3%81%A3%E3%81%BD%E3%81%84%E5%88%86%E5%B2%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eisomorphicっぽい分岐\u003c/h1\u003e\n\n\u003cp\u003eUMD (Universal Module Definition)の実装にあるような分岐でエラーを黙らせます。後述のスタブ化の際、これをしていないとスタブ化も出来なかったため（同じエラーが出たため）必須なようです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebrowser-dependencies.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDocument\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s1\"\u003e'object'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eDocument\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{});\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ブラウザでの動作時は{}が使われることはない\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ewindow\u003c/code\u003eが存在しない場合に逃がせるようにしました。TypeScriptの\u003ccode\u003e(\u0026lt;Document\u0026gt;{})\u003c/code\u003eキャストが醜悪ですが、どうせここはスタブ化されるので目をつぶります。今回はAngularJS向けライブラリで、Node.jsでは利用されることを想定していないため雑です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"proxyquireの出番\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#proxyquire%E3%81%AE%E5%87%BA%E7%95%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eproxyquireの出番\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://hexi.pics/items/d86013c878dd9223f327846b8f76632e\"\u003eテスト界のライオン\u003c/a\u003eこと\u003ca href=\"/t_wada\" class=\"user-mention\" title=\"t_wada\"\u003e@t_wada\u003c/a\u003e先生に教えてもらった\u003ca href=\"https://github.com/thlorenz/proxyquire\"\u003eproxyquire\u003c/a\u003eがもうとにかく便利だったので、ぜひとも広めたいと思ってます。今までオレオレInjectorを実装して\u003ccode\u003erequire()\u003c/code\u003eのスタブ化を実現していたんですが、もうその手間も無くなるので本当に嬉しい。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"書き方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9B%B8%E3%81%8D%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e書き方\u003c/h2\u003e\n\n\u003cp\u003eちょっとクセがあったのでメモ。テストソース\u003ccode\u003espec.js\u003c/code\u003eがあったとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etest/unit/spec.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eproxyquire\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'proxyquire'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emyLibrary\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eproxyquire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'../../src/mylibrary'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'./sub'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003egreet\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'hi!'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esrc/mylibrary.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003esub\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'./sub'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esrc/sub.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003egreet\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'hello!'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e'../../src/mylibrary'\u003c/code\u003eは\u003ccode\u003espec.js\u003c/code\u003eからみた\u003ccode\u003emylibrary.js\u003c/code\u003eのパスです。一方で\u003ccode\u003e'./sub'\u003c/code\u003eは「\u003ccode\u003emylibrary.js\u003c/code\u003eからみた」\u003ccode\u003esub.js\u003c/code\u003eのパスです。つまり\u003ccode\u003efrom './sub';\u003c/code\u003eの文字列と同じものが入ります（\u003ccode\u003e.js\u003c/code\u003eの有無など表記ぶれはダメ）。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e{}\u003c/code\u003eにはスタブなど、テスト時に\u003ccode\u003eimport sub from './sub';\u003c/code\u003eに取得させるオブジェクトを指定します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2段階のdi\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E6%AE%B5%E9%9A%8E%E3%81%AEdi\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2段階のDI\u003c/h2\u003e\n\n\u003cp\u003e具体的な話にします。現在このようなファイル構成があったとします。\u003ccode\u003emylibrary-spec.es6\u003c/code\u003eは\u003ccode\u003emylibrary.ts\u003c/code\u003eをテストしようとしています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"test\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etree\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e.\n├── src\n│   ├── browser-dependencies.ts\n│   ├── mylibrary.ts\n│   └── sub\n│       └── sub.ts\n└── test\n    └── unit\n        └── mylibrary-spec.es6\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e./src/mylibrary.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003esub\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'./sub/sub'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 略\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e./src/sub/sub.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../browser-dependencies'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eSub\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// 略\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e: \u003cspan class=\"kt\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires?\u003c/span\u003e: \u003cspan class=\"kt\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e[])\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eselector\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequires\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// 略\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"nx\"\u003eSub\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ts\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e./src/browser-dependencies.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDocument\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s1\"\u003e'object'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eDocument\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003edocument\u003c/code\u003eを必要とする実装は\u003ccode\u003esub.ts\u003c/code\u003e内だけです。テスト内の\u003ccode\u003eproxyquire\u003c/code\u003eは次のように書きます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e./test/unit/mylibrary-spec.es6\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emylibrary\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eproxyquire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'../../src/mylibrary'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'./sub/sub'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eproxyquire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'../../src/sub/sub'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'../browser-dependencies'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの書き方に辿り着くまで小一時間ハマったのですが、なんとか理想の動きをしてくれました。\u003cbr\u003e\n\u003ccode\u003e'../../src/mylibrary'\u003c/code\u003eはテストから見た\u003ccode\u003emylibrary\u003c/code\u003eのパス、\u003ccode\u003e'./sub/sub'\u003c/code\u003eは\u003ccode\u003emylibrary\u003c/code\u003eから見た\u003ccode\u003esub\u003c/code\u003eのパスです。\u003c/p\u003e\n\n\u003cp\u003e次がポイントで、多段DIの際は\u003ccode\u003e'../../src/sub/sub'\u003c/code\u003eと\u003cstrong\u003eまたテストから見た\u003ccode\u003esub\u003c/code\u003eのパス\u003c/strong\u003eを書きます。テスト側であらゆるproxyを全て生成してしまうのです。開発元のサンプルにこのケースが載ってなく、えらい迷ってしまいました。\u003c/p\u003e\n\n\u003cp\u003eこうするとテスト時に\u003ccode\u003emylibrary\u003c/code\u003eが依存している\u003ccode\u003esub\u003c/code\u003eは、ちゃんとモックの\u003ccode\u003edocument\u003c/code\u003eを使ってくれます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"sinonと合わせて使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sinon%E3%81%A8%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003esinonと合わせて使う\u003c/h1\u003e\n\n\u003cp\u003e実際はこのモックを使って検証していくので、\u003ca href=\"https://github.com/cjohansen/Sinon.JS/\"\u003esinon\u003c/a\u003eを併用します。sinonを使ったテスト例です。assertはもちろん\u003ca href=\"https://github.com/twada/power-assert\"\u003epower-assert\u003c/a\u003eですよ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e./test/unit/mylibrary-spec.es6\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'power-assert'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003esinon\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'sinon'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eproxyquire\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'proxyquire'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* モックの作成 */\u003c/span\u003e\n\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emock\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e \u003cspan class=\"c1\"\u003e// モックだからてきとう\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eversion\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003efull\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'1.3.14'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emajor\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eminor\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edot\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* スタブの定義 */\u003c/span\u003e\n\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003estub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003esinon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'bootstrap'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// テスト中は一律で'element'を返すように定義\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// querySelector自体にバグがあっても私の責任ではないのだ…\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003esinon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'querySelector'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ereturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'element'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eproxyquire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'../../src/mylibrary'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'./sub/sub'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eproxyquire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'../../src/sub/sub'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'../browser-dependencies'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ここでモックを注入\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emylibrary\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estaticFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003edescribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'My Library'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003edescribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'bootstrap'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'should be called an AngularJS original bootstrap'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eselector\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'selector'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003emylibrary\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ここでsub.tsが呼ばれると思ってください\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebootstrap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecallCount\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// たしかに呼ばれた!\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e今回proxyquireはとても強力な即戦力で、いきなり惚れました。sinonは前からずっと使ってますがこれもめちゃ便利ですよ。\u003c/p\u003e\n\n\u003cp\u003eそれでは快適なテストライフを。\u003c/p\u003e\n","body":"こんにちは、@armorik83です。みなさんテスト書いてますか。\n\n今日は久々にテストの話を書きます。経緯を含めた流れで話を進めます。\n\n# ブラウザ向けライブラリをNode.js + Mochaでテストしたい\n今、AngularJS絡みのライブラリを開発中なんですが、そこで`document`が出てくる点が問題となります。\n\n```ts:sample.ts\n// 開発中のソースを見本用にいじってます\nsample(controller: any, requires?: any[]) {\n  requires = requires || [];\n  requires.push(this.id);\n  const selector = controller.selector;\n  const element = document.querySelector(selector); // この辺\n  this.angular.bootstrap(element, requires);\n}\n```\n\n`document`はグローバル変数で、これは`window.document`と同じことです。ブラウザ上で動かす際は`window`も`window.document`も値があるので問題ないですが、このソースをMochaで（Karmaなどを使わず）テストするときに、`window`が未定義として落ちます。\n\n```\nReferenceError: document is not defined\n```\n\n# ひとまずソース内に直に書かない\n\n```ts:sample.ts\nimport {document} from '../browser-dependencies'; // 追加\n\nclass Foo {\n  sample(controller: any, requires?: any[]) {\n    requires = requires || [];\n    requires.push(this.id);\n    const selector = controller.selector;\n    const element = document.querySelector(selector);\n    // このdocumentは'../browser-dependencies'の module.exports.document となる\n    this.angular.bootstrap(element, requires);\n  }\n}\n```\n\n```ts:browser-dependencies.ts\n'use strict';\nexport var document: Document = window.document;\n```\n\nまだ密結合ですが、間にDIの余地を設けました。\n\n```\nReferenceError: window is not defined\n```\n\n`window`が残っているので怒られます。\n\n# isomorphicっぽい分岐\nUMD (Universal Module Definition)の実装にあるような分岐でエラーを黙らせます。後述のスタブ化の際、これをしていないとスタブ化も出来なかったため（同じエラーが出たため）必須なようです。\n\n```ts:browser-dependencies.ts\n'use strict';\nexport var document: Document = (typeof window === 'object')\n  ? window.document\n  : (\u003cDocument\u003e{}); // ブラウザでの動作時は{}が使われることはない\n```\n\n`window`が存在しない場合に逃がせるようにしました。TypeScriptの`(\u003cDocument\u003e{})`キャストが醜悪ですが、どうせここはスタブ化されるので目をつぶります。今回はAngularJS向けライブラリで、Node.jsでは利用されることを想定していないため雑です。\n\n# proxyquireの出番\n[テスト界のライオン](https://hexi.pics/items/d86013c878dd9223f327846b8f76632e)こと@t_wada先生に教えてもらった[proxyquire](https://github.com/thlorenz/proxyquire)がもうとにかく便利だったので、ぜひとも広めたいと思ってます。今までオレオレInjectorを実装して`require()`のスタブ化を実現していたんですが、もうその手間も無くなるので本当に嬉しい。\n\n## 書き方\nちょっとクセがあったのでメモ。テストソース`spec.js`があったとします。\n\n```js:test/unit/spec.js\nimport proxyquire from 'proxyquire';\n\nconst myLibrary = proxyquire('../../src/mylibrary', {\n  './sub': {\n    greet: 'hi!'\n  }\n});\n```\n\n```js:src/mylibrary.js\nimport sub from './sub';\n```\n\n```js:src/sub.js\nexport var greet = 'hello!';\n```\n\n`'../../src/mylibrary'`は`spec.js`からみた`mylibrary.js`のパスです。一方で`'./sub'`は「`mylibrary.js`からみた」`sub.js`のパスです。つまり`from './sub';`の文字列と同じものが入ります（`.js`の有無など表記ぶれはダメ）。\n\n`{}`にはスタブなど、テスト時に`import sub from './sub';`に取得させるオブジェクトを指定します。\n\n## 2段階のDI\n具体的な話にします。現在このようなファイル構成があったとします。`mylibrary-spec.es6`は`mylibrary.ts`をテストしようとしています。\n\n```test:tree\n.\n├── src\n│   ├── browser-dependencies.ts\n│   ├── mylibrary.ts\n│   └── sub\n│       └── sub.ts\n└── test\n    └── unit\n        └── mylibrary-spec.es6\n```\n\n```ts:./src/mylibrary.ts\n'use strict';\nimport sub from './sub/sub';\n\n// 略\n```\n\n```ts:./src/sub/sub.ts\n'use strict';\nimport {document} from '../browser-dependencies';\n\nclass Sub {\n  // 略\n  sample(controller: any, requires?: any[]) {\n    requires = requires || [];\n    requires.push(this.id);\n    const selector = controller.selector;\n    const element = document.querySelector(selector);\n    this.angular.bootstrap(element, requires);\n  }\n  // 略\n}\n\nexport default Sub;\n```\n\n```ts:./src/browser-dependencies.ts\n'use strict';\nexport var document: Document = (typeof window === 'object') ? window.document : (\u003cDocument\u003e{});\n```\n\n`document`を必要とする実装は`sub.ts`内だけです。テスト内の`proxyquire`は次のように書きます。\n\n```js:./test/unit/mylibrary-spec.es6\nconst mylibrary = proxyquire('../../src/mylibrary', {\n  './sub/sub': proxyquire('../../src/sub/sub', {\n    '../browser-dependencies': {\n      document: mock.document\n    }\n  })\n});\n```\n\nこの書き方に辿り着くまで小一時間ハマったのですが、なんとか理想の動きをしてくれました。\n`'../../src/mylibrary'`はテストから見た`mylibrary`のパス、`'./sub/sub'`は`mylibrary`から見た`sub`のパスです。\n\n次がポイントで、多段DIの際は`'../../src/sub/sub'`と**またテストから見た`sub`のパス**を書きます。テスト側であらゆるproxyを全て生成してしまうのです。開発元のサンプルにこのケースが載ってなく、えらい迷ってしまいました。\n\nこうするとテスト時に`mylibrary`が依存している`sub`は、ちゃんとモックの`document`を使ってくれます。\n\n# sinonと合わせて使う\n実際はこのモックを使って検証していくので、[sinon](https://github.com/cjohansen/Sinon.JS/)を併用します。sinonを使ったテスト例です。assertはもちろん[power-assert](https://github.com/twada/power-assert)ですよ。\n\n```js:./test/unit/mylibrary-spec.es6\nimport assert from 'power-assert';\nimport sinon from 'sinon';\nimport proxyquire from 'proxyquire';\n\n/* モックの作成 */\nconst mock = {\n  angular: {\n    bootstrap: () =\u003e {}, // モックだからてきとう\n    version: {full: '1.3.14', major: 1, minor: 3, dot: 14}\n  },\n  document: {\n    querySelector: () =\u003e {}\n  }\n};\n\n/* スタブの定義 */\nconst stub = {\n  angular: {\n    bootstrap: sinon.stub(mock.angular, 'bootstrap')\n  },\n  document: {\n    // テスト中は一律で'element'を返すように定義\n    // querySelector自体にバグがあっても私の責任ではないのだ…\n    querySelector: sinon.stub(mock.document, 'querySelector').returns('element')\n  }\n};\n\nconst m = proxyquire('../../src/mylibrary', {\n  './sub/sub': proxyquire('../../src/sub/sub', {\n    '../browser-dependencies': {\n      document: mock.document // ここでモックを注入\n    }\n  })\n});\n\nconst mylibrary = m.staticFunc(mock.angular);\n\ndescribe('My Library', () =\u003e {\n  describe('bootstrap', () =\u003e {\n    it('should be called an AngularJS original bootstrap', () =\u003e {\n      const controller = {};\n      controller.selector = 'selector';\n      mylibrary.bootstrap(controller); // ここでsub.tsが呼ばれると思ってください\n      assert(stub.angular.bootstrap.callCount === 1); // たしかに呼ばれた!\n    });\n  });\n});\n```\n\n今回proxyquireはとても強力な即戦力で、いきなり惚れました。sinonは前からずっと使ってますがこれもめちゃ便利ですよ。\n\nそれでは快適なテストライフを。\n","coediting":false,"created_at":"2015-05-02T23:00:20+09:00","id":"46781adda80e9d53f7ee","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"Node.js","versions":[]},{"name":"mocha","versions":[]},{"name":"Sinon.JS","versions":[]}],"title":"proxyquireでDI もっとモックテストしよう","updated_at":"2015-05-03T17:10:29+09:00","url":"http://qiita.com/armorik83/items/46781adda80e9d53f7ee","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003e追記150528: alpha.25よりTypeScript化が済み、ビルド方法が変わったので下記の手順は不要になりました。この記事は記録のために残します。\u003c/p\u003e\n\n\u003cp\u003e追記150509: alpha.22でこの方法が封じられたので現在は使えません。今後のバージョンでまた使えるようになる or 使わなくても済むようになるかも。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eどうしても今Angular 2をBabelとかBrowserifyで触りたい人って誰だよ? 俺だよ!\u003cbr\u003e\nどうも\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。\u003c/p\u003e\n\n\u003cp\u003e前回『\u003ca href=\"http://qiita.com/armorik83/items/7ece9e035536a6b230f9\"\u003eどうしても今Angular 2 with Babelを触ってみたい人のためのビルドスクリプト\u003c/a\u003e』って記事を書いたんですが、どうしても今それを全自動化する必要があったのでパッケージを作りました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003emkdir hoge \u0026amp;\u0026amp; cd $_\nnpm install commonjs-friendly-angular2\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eしばし待て\u003cimg class=\"emoji\" title=\":coffee:\" alt=\":coffee:\" src=\"https://cdn.qiita.com/emoji/unicode/2615.png\" height=\"20\" width=\"20\" align=\"absmiddle\"\u003e\u003c/p\u003e\n\n\u003cp\u003eしばらくすると処理が終わって\u003ccode\u003e./node_modules/commonjs-friendly-angular2/products/\u003c/code\u003eに必要なものが全部入ってるので、あとはそれをお好きなように。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"なぜ作ったのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%81%9C%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなぜ作ったのか\u003c/h1\u003e\n\n\u003cp\u003e現在のAngular 2 alpha.21はTraceurだったりSystemJSだったりと、とにかく優しくなく、使いにくく、我が道を突き進んでいます。幸い生のes6が含まれているので、ここを色々してBabelやBrowserifyで使えるように変換して\u003ccode\u003eproducts\u003c/code\u003eにまとめています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"誰が使うの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%B0%E3%81%8C%E4%BD%BF%E3%81%86%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e誰が使うの\u003c/h1\u003e\n\n\u003cp\u003e俺だよ!\u003c/p\u003e\n","body":"追記150528: alpha.25よりTypeScript化が済み、ビルド方法が変わったので下記の手順は不要になりました。この記事は記録のために残します。\n\n追記150509: alpha.22でこの方法が封じられたので現在は使えません。今後のバージョンでまた使えるようになる or 使わなくても済むようになるかも。\n\n---\n\nどうしても今Angular 2をBabelとかBrowserifyで触りたい人って誰だよ? 俺だよ!\nどうも@armorik83です。\n\n前回『[どうしても今Angular 2 with Babelを触ってみたい人のためのビルドスクリプト](http://qiita.com/armorik83/items/7ece9e035536a6b230f9)』って記事を書いたんですが、どうしても今それを全自動化する必要があったのでパッケージを作りました。\n\n# 使い方\n\n```\nmkdir hoge \u0026\u0026 cd $_\nnpm install commonjs-friendly-angular2\n```\n\nしばし待て:coffee:\n\nしばらくすると処理が終わって`./node_modules/commonjs-friendly-angular2/products/`に必要なものが全部入ってるので、あとはそれをお好きなように。\n\n# なぜ作ったのか\n\n現在のAngular 2 alpha.21はTraceurだったりSystemJSだったりと、とにかく優しくなく、使いにくく、我が道を突き進んでいます。幸い生のes6が含まれているので、ここを色々してBabelやBrowserifyで使えるように変換して`products`にまとめています。\n\n# 誰が使うの\n\n俺だよ!\n","coediting":false,"created_at":"2015-05-01T19:53:50+09:00","id":"9421570e7274fa79e720","private":false,"tags":[{"name":"angular","versions":["2.0.0-alpha.21"]},{"name":"Angular2","versions":["2.0.0-alpha.21"]}],"title":"どうしても今Angular 2をBabelとかBrowserifyで触りたい人のためのパッケージ","updated_at":"2015-05-28T10:33:08+09:00","url":"http://qiita.com/armorik83/items/9421570e7274fa79e720","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003e追記150528: alpha.25よりTypeScript化が済み、ビルド方法が変わったので下記の手順は不要になりました。この記事は記録のために残します。\u003c/p\u003e\n\n\u003cp\u003e追記150509: alpha.22でこの方法が封じられたので現在は使えません。今後のバージョンでまた使えるようになる or 使わなくても済むようになるかも。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sh\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c\"\u003e#!/bin/sh\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eNPM_BIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enode_modules/.bin\n\u003cspan class=\"nv\"\u003eBABEL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNPM_BIN\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e/babel\n\u003cspan class=\"nv\"\u003eBROWSERIFY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNPM_BIN\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e/browserify\n\nnpm i angular2 babel babel-core\n\u003cspan class=\"c\"\u003e#npm i browserify\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#mkdir public\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#${BABEL} --optional es7.decorators src --out-dir public\u003c/span\u003e\n\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eBABEL\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e node_modules/angular2/es6/dev --out-dir .tmp-angular2-to-es5\n\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eBABEL\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e node_modules/angular2/node_modules/rtts_assert/es6 --out-dir .tmp-rtts_assert-to-es5\nrm -f .tmp-rtts_assert-to-es5/es5build.js\n\u003cspan class=\"c\"\u003e#cp src/index.html public\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#cp node_modules/angular2/node_modules/zone.js/zone.js public\u003c/span\u003e\nmv node_modules/angular2 node_modules/angular2-original\nmv .tmp-angular2-to-es5 node_modules/angular2\nmv node_modules/angular2-original/node_modules/rtts_assert node_modules/angular2-original/node_modules/rtts_assert-original\nmv .tmp-rtts_assert-to-es5 node_modules/rtts_assert\nln -s ../../node_modules/angular2-original/node_modules node_modules/angular2/node_modules\n\u003cspan class=\"c\"\u003e#${BROWSERIFY} public/app.js -o public/bundle.js\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eMIT、無保証\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e./src\u003c/code\u003eに自分のアプリケーションソースを置いた場合\u003ccode\u003e#\u003c/code\u003eを外す。Angular 2ビルドのみならこのまま。インストールされる\u003ccode\u003ees6/dev/\u003c/code\u003e内のソースをビルドしているため、traceur-runtime不要でBrowserifyで結合可。たぶんwebpackでも出来るけど試してない。\u003c/p\u003e\n\n\u003cp\u003e20150425追記: angular 2.0.0-alpha.20でもこの手順が使えました。\u003cbr\u003e\n20150429追記: angular 2.0.0-alpha.21でもこの手順が使えますし、\u003ca href=\"https://angular.io/docs/js/latest/quickstart.html\"\u003eQuickstart\u003c/a\u003eが整備されたのでちょっと触る分にはそこがおすすめ。\u003c/p\u003e\n","body":"追記150528: alpha.25よりTypeScript化が済み、ビルド方法が変わったので下記の手順は不要になりました。この記事は記録のために残します。\n\n追記150509: alpha.22でこの方法が封じられたので現在は使えません。今後のバージョンでまた使えるようになる or 使わなくても済むようになるかも。\n\n---\n\n```sh\n#!/bin/sh\nNPM_BIN=node_modules/.bin\nBABEL=${NPM_BIN}/babel\nBROWSERIFY=${NPM_BIN}/browserify\n\nnpm i angular2 babel babel-core\n#npm i browserify\n#mkdir public\n#${BABEL} --optional es7.decorators src --out-dir public\n${BABEL} node_modules/angular2/es6/dev --out-dir .tmp-angular2-to-es5\n${BABEL} node_modules/angular2/node_modules/rtts_assert/es6 --out-dir .tmp-rtts_assert-to-es5\nrm -f .tmp-rtts_assert-to-es5/es5build.js\n#cp src/index.html public\n#cp node_modules/angular2/node_modules/zone.js/zone.js public\nmv node_modules/angular2 node_modules/angular2-original\nmv .tmp-angular2-to-es5 node_modules/angular2\nmv node_modules/angular2-original/node_modules/rtts_assert node_modules/angular2-original/node_modules/rtts_assert-original\nmv .tmp-rtts_assert-to-es5 node_modules/rtts_assert\nln -s ../../node_modules/angular2-original/node_modules node_modules/angular2/node_modules\n#${BROWSERIFY} public/app.js -o public/bundle.js\n```\n\nMIT、無保証\n\n`./src`に自分のアプリケーションソースを置いた場合`#`を外す。Angular 2ビルドのみならこのまま。インストールされる`es6/dev/`内のソースをビルドしているため、traceur-runtime不要でBrowserifyで結合可。たぶんwebpackでも出来るけど試してない。\n\n20150425追記: angular 2.0.0-alpha.20でもこの手順が使えました。\n20150429追記: angular 2.0.0-alpha.21でもこの手順が使えますし、[Quickstart](https://angular.io/docs/js/latest/quickstart.html)が整備されたのでちょっと触る分にはそこがおすすめ。\n","coediting":false,"created_at":"2015-04-15T21:25:20+09:00","id":"7ece9e035536a6b230f9","private":false,"tags":[{"name":"angular","versions":["2.0.0-alpha.21"]},{"name":"Angular2","versions":["2.0.0-alpha.21"]}],"title":"どうしても今Angular 2 with Babelを触ってみたい人のためのビルドスクリプト","updated_at":"2015-05-28T10:33:37+09:00","url":"http://qiita.com/armorik83/items/7ece9e035536a6b230f9","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003e\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。最近はAngular芸人とまで呼ばれ始めています\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"2015/4/29水祝 13:00 神戸 #GDGKobe Angular勉強会#3 やるよ、来てね!\"\u003e1\u003c/a\u003e\u003c/sup\u003e。最近の拙記事 (\u003ca href=\"http://qiita.com/armorik83/items/d4ef1f60b8b6a34f3cd5\"\u003e1\u003c/a\u003e, \u003ca href=\"http://qiita.com/armorik83/items/e3a0ce67f569ddc4b432\"\u003e2\u003c/a\u003e)を書くにあたって、AngularJS 1.x系、およびAngular 2の開発者について異様に詳しくなってしまったため、まとめて共有しておきます。\u003cdel\u003e誰得だろう。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e「主力」は主観で概ね2万行以上の関与。敬称略。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"angular全般\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular%E5%85%A8%E8%88%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngular全般\u003c/h1\u003e\n\n\u003cp\u003e印象としてはMiško Hevery氏とIgor Minar氏の二人は特筆すべきと感じました。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/mhevery\"\u003eMiško Hevery\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle\u003c/li\u003e\n\u003cli\u003eAngularJS立ち上げ時主力\n\n\u003cul\u003e\n\u003cli\u003eAngularDart立ち上げ\u003c/li\u003e\n\u003cli\u003eAngular 2立ち上げ、主力\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAtScriptの生みの親\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/IgorMinar\"\u003eIgor Minar\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle\u003c/li\u003e\n\u003cli\u003eng-japan登壇\u003c/li\u003e\n\u003cli\u003eAngularJS全期間の主力\u003c/li\u003e\n\u003cli\u003e最近Angular 2に参加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"angularjs-1系\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angularjs-1%E7%B3%BB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngularJS 1系\u003c/h1\u003e\n\n\u003cp\u003eこの半年ほどの1系最新版の開発者は非Googleも増えている印象ですが、これは取り上げ方が頻度重視なせいで、Googleノータッチというわけではありません。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/angular/angular.js/graphs/contributors?from=2014-09-14\u0026amp;to=2015-04-14\u0026amp;type=c\"\u003eangular/angular.js/graphs/contributors\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/petebacondarwin\"\u003ePete Bacon Darwin\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e非Google\u003c/li\u003e\n\u003cli\u003eAngularJS 1.4主力\n\n\u003cul\u003e\n\u003cli\u003eAngular 2も少し\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003edgeni\u003c/li\u003e\n\u003cli\u003eAngularUI\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/caitp\"\u003ecaitp\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e非Google\u003c/li\u003e\n\u003cli\u003eAngularJS 1.4\u003c/li\u003e\n\u003cli\u003eTypeScriptにも少々\u003c/li\u003e\n\u003cli\u003e美人（個人的感想）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/gkalpak\"\u003eGeorgios Kalpakas\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e非Google\u003c/li\u003e\n\u003cli\u003eAngularJS 1.4\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/pkozlowski-opensource\"\u003ePawel Kozlowski\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e非Google\u003c/li\u003e\n\u003cli\u003eAngularJS 1.4\n\n\u003cul\u003e\n\u003cli\u003eIssue管理でよく見かける\u003c/li\u003e\n\u003cli\u003eAngular 2も少し\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAngularUI\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/btford\"\u003eBrian Ford\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle\u003c/li\u003e\n\u003cli\u003eng-japan登壇\u003c/li\u003e\n\u003cli\u003eAngular 2関連プロジェクトを担当\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/angular/zone.js/\"\u003eZone.js\u003c/a\u003e主力（Angular 2 コア・アーキテクチャ）\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/angular/router\"\u003engNewRouter\u003c/a\u003e主力\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"angular-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngular 2\u003c/h1\u003e\n\n\u003cp\u003eAngularDartからのメンバーが多く、大半がGoogleの方々です。1系とは被っている人が少ないので、どちらかの保守でどちらかが停滞することは無さそう（その替わり移行面で連携が取れるのかも不安）。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/angular/angular/graphs/contributors?from=2014-09-14\u0026amp;to=2015-04-14\u0026amp;type=c\"\u003eangular/angular/graphs/contributors\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/tbosch\"\u003eTobias Bosch\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle\u003c/li\u003e\n\u003cli\u003eAngular 2主力\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/vsavkin\"\u003eVictor Savkin\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle\u003c/li\u003e\n\u003cli\u003eAngular 2主力\n\n\u003cul\u003e\n\u003cli\u003eAngularJS 1系にはいない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/vicb\"\u003eVictor Berchet\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e非Google\u003c/li\u003e\n\u003cli\u003eAngularDart主力\u003c/li\u003e\n\u003cli\u003eAngular 2\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/chirayuk\"\u003eChirayu Krishnappa\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle\u003c/li\u003e\n\u003cli\u003eng-japan登壇\u003c/li\u003e\n\u003cli\u003eAngularDart主力\n\n\u003cul\u003e\n\u003cli\u003eAngular 2も少し\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"その他気になる開発者\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E6%B0%97%E3%81%AB%E3%81%AA%E3%82%8B%E9%96%8B%E7%99%BA%E8%80%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他気になる開発者\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/sebmck\"\u003esebmck, Sebastian McKenzie\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e非Google\u003c/li\u003e\n\u003cli\u003eBabel\n\n\u003cul\u003e\n\u003cli\u003e異様に速い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eセブマック氏（と呼んでいるが）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/stefanpenner\"\u003eStefan Penner\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e米Yahoo!\u003c/li\u003e\n\u003cli\u003eember.js\u003c/li\u003e\n\u003cli\u003eBabel\u003c/li\u003e\n\u003cli\u003eやたらと見かける（個人的感想）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eこの辺の方々と仲良くなっておけば、いろいろ意見を言いやすいですね!\u003c/p\u003e\n\n\u003cp\u003eあーまた異様な記事を書いてしまった。\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e\u003ca href=\"http://www.zusaar.com/event/6007003\"\u003e2015/4/29水祝 13:00 神戸 #GDGKobe Angular勉強会#3\u003c/a\u003e やるよ、来てね! \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"@armorik83です。最近はAngular芸人とまで呼ばれ始めています[^1]。最近の拙記事 ([1](http://qiita.com/armorik83/items/d4ef1f60b8b6a34f3cd5), [2](http://qiita.com/armorik83/items/e3a0ce67f569ddc4b432))を書くにあたって、AngularJS 1.x系、およびAngular 2の開発者について異様に詳しくなってしまったため、まとめて共有しておきます。~~誰得だろう。~~\n\n「主力」は主観で概ね2万行以上の関与。敬称略。\n\n# Angular全般\n印象としてはMiško Hevery氏とIgor Minar氏の二人は特筆すべきと感じました。\n\n**[Miško Hevery](https://github.com/mhevery)**\n\n- Google\n- AngularJS立ち上げ時主力\n  - AngularDart立ち上げ\n  - Angular 2立ち上げ、主力\n- AtScriptの生みの親\n\n**[Igor Minar](https://github.com/IgorMinar)**\n\n- Google\n- ng-japan登壇\n- AngularJS全期間の主力\n- 最近Angular 2に参加\n\n# AngularJS 1系\nこの半年ほどの1系最新版の開発者は非Googleも増えている印象ですが、これは取り上げ方が頻度重視なせいで、Googleノータッチというわけではありません。\n\n[angular/angular.js/graphs/contributors](https://github.com/angular/angular.js/graphs/contributors?from=2014-09-14\u0026to=2015-04-14\u0026type=c)\n\n**[Pete Bacon Darwin](https://github.com/petebacondarwin)**\n\n- 非Google\n- AngularJS 1.4主力\n  - Angular 2も少し\n- dgeni\n- AngularUI\n\n**[caitp](https://github.com/caitp)**\n\n- 非Google\n- AngularJS 1.4\n- TypeScriptにも少々\n- 美人（個人的感想）\n\n**[Georgios Kalpakas](https://github.com/gkalpak)**\n\n- 非Google\n- AngularJS 1.4\n\n**[Pawel Kozlowski](https://github.com/pkozlowski-opensource)**\n\n- 非Google\n- AngularJS 1.4\n  - Issue管理でよく見かける\n  - Angular 2も少し\n- AngularUI\n\n**[Brian Ford](https://github.com/btford)**\n\n- Google\n- ng-japan登壇\n- Angular 2関連プロジェクトを担当\n  - [Zone.js](https://github.com/angular/zone.js/)主力（Angular 2 コア・アーキテクチャ）\n  - [ngNewRouter](https://github.com/angular/router)主力\n\n# Angular 2\nAngularDartからのメンバーが多く、大半がGoogleの方々です。1系とは被っている人が少ないので、どちらかの保守でどちらかが停滞することは無さそう（その替わり移行面で連携が取れるのかも不安）。\n\n[angular/angular/graphs/contributors](https://github.com/angular/angular/graphs/contributors?from=2014-09-14\u0026to=2015-04-14\u0026type=c)\n\n**[Tobias Bosch](https://github.com/tbosch)**\n\n- Google\n- Angular 2主力\n\n**[Victor Savkin](https://github.com/vsavkin)**\n\n- Google\n- Angular 2主力\n  - AngularJS 1系にはいない\n\n**[Victor Berchet](https://github.com/vicb)**\n\n- 非Google\n- AngularDart主力\n- Angular 2\n\n**[Chirayu Krishnappa](https://github.com/chirayuk)**\n\n- Google\n- ng-japan登壇\n- AngularDart主力\n  - Angular 2も少し\n\n# その他気になる開発者\n**[sebmck, Sebastian McKenzie](https://github.com/sebmck)**\n\n- 非Google\n- Babel\n  - 異様に速い\n- セブマック氏（と呼んでいるが）\n\n**[Stefan Penner](https://github.com/stefanpenner)**\n\n- 米Yahoo!\n- ember.js\n- Babel\n- やたらと見かける（個人的感想）\n\n---\n\nこの辺の方々と仲良くなっておけば、いろいろ意見を言いやすいですね!\n\nあーまた異様な記事を書いてしまった。\n\n[^1]: [2015/4/29水祝 13:00 神戸 #GDGKobe Angular勉強会#3](http://www.zusaar.com/event/6007003) やるよ、来てね!\n","coediting":false,"created_at":"2015-04-14T21:37:58+09:00","id":"33bb0c3b5a30e2c8091b","private":false,"tags":[{"name":"AngularJS","versions":["1.4"]},{"name":"angular","versions":["2.0.0"]}],"title":"Angular 1, 2の主力開発者まとめ","updated_at":"2015-04-14T22:55:31+09:00","url":"http://qiita.com/armorik83/items/33bb0c3b5a30e2c8091b","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003eJavaScript, TypeScript界隈におけるDecoratorsについて取り上げます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"javascriptとdecorators\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#javascript%E3%81%A8decorators\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJavaScriptとDecorators\u003c/h1\u003e\n\n\u003cp\u003eJavaScriptでは馴染みのなかったDecoratorsが目に触れるようになったのはAtScript発表の際だったと記憶しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"atscript\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#atscript\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAtScript\u003c/h2\u003e\n\n\u003cp\u003eAtScriptとは、2014年10月23日、\u003ca href=\"http://ngeurope.org/\"\u003eng-europe\u003c/a\u003eにて発表されたTypeScriptを包含する「新構文」です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.google.com/presentation/d/1hr2IM-8G-0RzpB-WY8pLHvxqNggKPzUO0KvEv1IKPws/edit?pli=1#slide=id.p\"\u003edocs.google.com | Keynote AtScript\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.youtube.com/watch?v=lGdnh8QSPPk\"\u003eYouTube | Miško Hevery - Keynote on AtScript at ng-europe 2014\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこのときの例文を引用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003eDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eselector\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'[blink]'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eBlink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n              \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n              \u003cspan class=\"nx\"\u003etimeout\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eselectors\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCssSelectors\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003esomeThirdPartyAPI\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eselectors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e','\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n           \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eapply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e@Directive()\u003c/code\u003eという箇所が彼らのいう（当初いっていた）AtScriptに該当する構文であり、本稿の題材でもあるDecoratorsです。\u003c/p\u003e\n\n\u003cp\u003e筆者の確認できた限りでは、この構文を用いられたJavaScriptソースが公になったのは2014年9月26日の\u003ca href=\"https://github.com/angular/angular/\"\u003eangular/angular\u003c/a\u003eにおける\u003ca href=\"https://github.com/angular/angular/commit/8afa421d75c95562060e35dbe8f576bd1e81c294\"\u003eコミット\u003c/a\u003eが初で、この時点ではまだ関連ソースも揃ってなく動作しないソースでした。Angular 2関連で範囲を広げると、さらに前の2014年9月3日にはAngular 2にDecoratorsを\u003ca href=\"https://github.com/angular/Angular2.design/blob/ee357b65ca840c1450b7c5e9c8fb33ccc3731d10/lib/annotations/directive.dart#L46\"\u003e採り入れる案\u003c/a\u003eがあったようです。\u003c/p\u003e\n\n\u003cp\u003eng-europeでの発表に向けて、既にこの時期には動き出していたことが推察できます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"typescript\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#typescript\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTypeScript\u003c/h2\u003e\n\n\u003cp\u003e2015年3月5日\u003ca href=\"http://www.ng-conf.org/\"\u003eng-conf\u003c/a\u003eにて、Microsoftの\u003ca href=\"https://github.com/jonathandturner\"\u003eJonathan Turner\u003c/a\u003e氏によってTypeScript 1.5にAnnotationsが加わると\u003ca href=\"https://www.youtube.com/watch?v=QHulaj5ZxbI\u0026amp;list=PLOETEcp3DkCoNnlhE-7fovYvqwVPrRiY7#t=23m36s\"\u003e発表\u003c/a\u003eされました。\u003c/p\u003e\n\n\u003cp\u003e翌3月6日にも同氏によって\u003ca href=\"https://www.youtube.com/watch?v=Xw93oketp18\"\u003eTypeScriptとAngular 2に関する講演\u003c/a\u003eが行われており、公式Twitterでも以下のような発言が掲載されています。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\" lang=\"en\"\u003e\n\u003cp\u003eAtScript is Typescript \u003ca href=\"https://twitter.com/hashtag/ngconf?src=hash\"\u003e#ngconf\u003c/a\u003e\u003c/p\u003e— ng-conf (\u003ca href=\"/ngconf\" class=\"user-mention\" title=\"ngconf\"\u003e@ngconf\u003c/a\u003e) \u003ca href=\"https://twitter.com/ngconf/status/573521849780305920\"\u003eMarch 5, 2015\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\n\n\u003cp\u003e事実上AtScriptはTypeScript言語仕様として\u003cdel\u003e落ち着いたという瞬間です。\u003c/del\u003e（追記、稿末に詳細あり）落ち着こうとしています。\u003c/p\u003e\n\n\u003cp\u003eその後、2015年3月27日にMicrosoftより\u003ca href=\"http://blogs.msdn.com/b/typescript/archive/2015/03/27/announcing-typescript-1-5-alpha.aspx\"\u003eTypeScript 1.5 Alpha\u003c/a\u003eの公式発表がなされ、予告されていたDecoratorsも併せてこの場で発表となりました。なお1.0以降、アルファ段階のTypeScriptが公式発表として取り上げられたのはこれが初です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"decoratorsの文化的背景\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#decorators%E3%81%AE%E6%96%87%E5%8C%96%E7%9A%84%E8%83%8C%E6%99%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDecoratorsの文化的背景\u003c/h1\u003e\n\n\u003cp\u003e筆者には馴染みのない構文だったため、そもそもこういった\u003ccode\u003e@\u003c/code\u003eで書き始める構文はどの言語から影響を受けたのか、という疑問がありました。元となった言語の使用者ではないため表面的な事実の羅列となりますが、確認した限りを並べてみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"c\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#\u003c/h2\u003e\n\n\u003cp\u003eC#には、\u003ccode\u003e@\u003c/code\u003eの構文ではありませんが\u003ca href=\"http://en.wikipedia.org/wiki/Metadata_(CLI)\"\u003eMetadata構文\u003c/a\u003eというものがあります。登場時期はC# 1.0と同じく2001年2月。深くは言及しませんが、メタデータを読み取るためのReflectionという概念がAngular 2の実装内にも確認できたため触れておきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"java\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava\u003c/h2\u003e\n\n\u003cp\u003eどうやら\u003ccode\u003e@\u003c/code\u003eで書き始めるこの構文の根元はJavaにあるようです。2004年9月30日に発表されたJ2SE 5.0に採用された\u003ca href=\"http://www.oracle.com/technetwork/articles/javase/j2se15-141062.html\"\u003eMetadata構文\u003c/a\u003e（アノテーション構文とも）が最初で、この機能も、Java最初期（1996年1月23日）から存在していたJavadocの\u003ccode\u003e@\u003c/code\u003eが由来で採用された経緯があるようです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eJ2SE 5.0（別名はTigerで、現在は2番目のベータ・リリースです）が入手できるようになるまでは、コアとしてのJava言語でメタデータ機能に最も近いものはJavadocによる手法でした。\u003cbr\u003e\n\u003ca href=\"http://www.ibm.com/developerworks/jp/java/library/j-annotate1/\"\u003ehttp://www.ibm.com/developerworks/jp/java/library/j-annotate1/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ccode\u003e@\u003c/code\u003e構文はJava由来なようですが、概念自体は前述のC#が先行しており、影響を与え合っていたと見る向きもあります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"python\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#python\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePython\u003c/h2\u003e\n\n\u003cp\u003ePythonは2004年11月30日の2.4から\u003ccode\u003e@\u003c/code\u003eで記述する\u003ccode\u003eDecorators\u003c/code\u003e構文を備えました。これはPEP (Python Enhancement Proposals)で提言された\u003ca href=\"https://www.python.org/dev/peps/pep-0318/\"\u003ePEP 318 - Decorators for Functions and Methods\u003c/a\u003eが源流のようです。資料にはJavaの影響を受けた旨が明記されています。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWhy @?\u003cbr\u003e\nThere is some history in Java using @ initially as a marker in Javadoc comments and later in Java 1.5 for annotations, which are similar to Python decorators.\u003cbr\u003e\n\u003ca href=\"https://www.python.org/dev/peps/pep-0318/#why\"\u003ehttps://www.python.org/dev/peps/pep-0318/#why\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eDecoratorsは、やはりGoFの\u003ca href=\"http://ja.wikipedia.org/wiki/Decorator_%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003eDecoratorパターン\u003c/a\u003eが由来で、JavaのMetadata構文を用途までそっくり取り込んだわけではないようです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eSome symbol options:\u003cbr\u003e\n@\u003cbr\u003e\n+ Java-like, so not completely unknown.\u003cbr\u003e\n+ Not confusable with any current Python symbol\u003cbr\u003e\n+ Makes syntax highlighting easy\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ccode\u003e@\u003c/code\u003e採用の経緯にJava風で既知の表記法だ、という旨が盛り込まれていました。\u003ca href=\"https://wiki.python.org/moin/PythonDecorators#What_is_a_Decorator\"\u003ePEP 318がまとまっていった様子の議事録\u003c/a\u003eはとても興味深いものです。\u003ca href=\"https://wiki.python.org/moin/PythonDecoratorLibrary\"\u003ePythonDecoratorLibrary\u003c/a\u003eというコンテンツは、JavaScriptにおいてDecoratorsを用いる際の着想として参考になるかもしれません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"dart\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dart\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDart\u003c/h2\u003e\n\n\u003cp\u003eDart（2011年10月登場、2014年6月に\u003ca href=\"http://www.ecma-international.org/publications/standards/Ecma-408.htm\"\u003eECMA-408\u003c/a\u003eとして規格化）にも\u003ca href=\"https://www.dartlang.org/docs/dart-up-and-running/ch02.html#metadata\"\u003eMetadata構文\u003c/a\u003eと呼ばれる構文が存在しており、これはJava, Pythonのように\u003ccode\u003e@\u003c/code\u003eで始まっています。登場時期からみても、Dartはこれら先行言語からの影響を受けている可能性が高いです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"javascriptにdecoratorsが持ち込まれた経緯\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#javascript%E3%81%ABdecorators%E3%81%8C%E6%8C%81%E3%81%A1%E8%BE%BC%E3%81%BE%E3%82%8C%E3%81%9F%E7%B5%8C%E7%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJavaScriptにDecoratorsが持ち込まれた経緯\u003c/h1\u003e\n\n\u003cp\u003eこれまで存在しなかったDecorators構文がなぜここへ来てJavaScriptに採り入れられるのか、客観的事実を元にした推察です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2013年10月-angulardartの存在\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2013%E5%B9%B410%E6%9C%88-angulardart%E3%81%AE%E5%AD%98%E5%9C%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2013年10月 AngularDartの存在\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://angulardart.org/\"\u003eAngularDart\u003c/a\u003eの初期リリースはタグ基準で\u003ca href=\"https://github.com/angular/angular.dart/releases/tag/v0.0.2\"\u003e2013年10月17日のv0.0.2\u003c/a\u003eです。AngularDartでは\u003cstrong\u003eDartの言語仕様をそのまま活用して\u003c/strong\u003e\u003ccode\u003e@\u003c/code\u003eで始まるAnnotationsを\u003ca href=\"https://docs.angulardart.org/#angular/angular-core-annotation.Component\"\u003e採用しています\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003eAngularJS 1.xをDartで再実装するとして動いていたようですが、Angular 2がAngularJS 2, AngularDart 2という名前ではなく\"Angular 2 for JavaScript|Dart\"となったことから一本化されたものと理解しています。事実、Angular 2には\u003ccode\u003e.es6\u003c/code\u003eと\u003ccode\u003e.dart\u003c/code\u003eという二つの拡張子のソースが\u003ca href=\"https://github.com/angular/angular/tree/master/modules/angular2/src/facade\"\u003eまとめて格納\u003c/a\u003eされており、一つのプロジェクトで2言語に対応しようと試みられています。\u003c/p\u003e\n\n\u003cp\u003eGoogleの\u003ca href=\"https://github.com/mhevery\"\u003eMiško Hevery\u003c/a\u003e氏が\u003ca href=\"https://github.com/angular/angular.dart/graphs/contributors\"\u003eAngularDartの立ち上げ人で最多コード記述者\u003c/a\u003eである点、\u003ca href=\"https://github.com/angular/Angular2.design/commits/master\"\u003eAngular 2草案リポジトリの中心人物\u003c/a\u003eである点、ng-europeでのAtScriptの発表者が同氏である点から総合的に判断して、Angular 2 for JavaScriptにDecoratorsが持ち込まれた経緯がAngularDart由来である、そして主要人物がMiško Hevery氏であることが分かります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2014年4月-tc39での議題に上る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2014%E5%B9%B44%E6%9C%88-tc39%E3%81%A7%E3%81%AE%E8%AD%B0%E9%A1%8C%E3%81%AB%E4%B8%8A%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2014年4月 TC39での議題に上る\u003c/h2\u003e\n\n\u003cp\u003eTC39というECMAのミーティングがあるのですが、TC39自体については日本国内でもウォッチしている方がおられるので、そちらに任せます。（\u003ca href=\"https://twitter.com/search?f=realtime\u0026amp;q=%23TC39MTG\u0026amp;src=typd\"\u003e参考\u003c/a\u003e）\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/tc39/agendas/blob/b98e8025188b5a19a775a11df662cdbd84a371a8/2014/04.md\"\u003e2014年4月のTC39\u003c/a\u003eで、\"ECMA-262 7th Edition\"、俗にいうES7の議論の際に\u003ca href=\"https://github.com/wycats\"\u003eYehuda Katz\u003c/a\u003e (wycats)氏によって案が提出されていたようです。\u003c/p\u003e\n\n\u003cp\u003e時系列としてはこの位置ですが、wycats氏がAngular事情と絡んでいたかは定かでなく、活動内容を見る限りその可能性は無さそうに見えます。TC39にて草案が提出されたことをAngular開発陣が観察していた可能性は有り得ます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2014年10月-atscriptの発表\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2014%E5%B9%B410%E6%9C%88-atscript%E3%81%AE%E7%99%BA%E8%A1%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2014年10月 AtScriptの発表\u003c/h2\u003e\n\n\u003cp\u003e前述のとおり、ng-europeにてAtScriptの発表が行われました。まだこの時はGoogle側の独自的な構文の範疇でしたが、ここから約半年で大きく動くことになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2015年3月-typescript-15への採用\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2015%E5%B9%B43%E6%9C%88-typescript-15%E3%81%B8%E3%81%AE%E6%8E%A1%E7%94%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2015年3月 TypeScript 1.5への採用\u003c/h2\u003e\n\n\u003cp\u003eさすがにGoogleとMicrosoft間のやりとりは窺い知れませんが、AtScript絡みで情報交換はしていたのだろうと想像しています。MSDN Blogsでは\u003ca href=\"http://blogs.msdn.com/b/somasegar/archive/2015/03/05/typescript-lt-3-angular.aspx\"\u003e大歓迎の模様\u003c/a\u003eです。\u003c/p\u003e\n\n\u003cp\u003eこの発表を行ったMicrosoftの\u003ca href=\"https://github.com/jonathandturner\"\u003eJonathan Turner\u003c/a\u003e氏は2015年3月29日にDecoratorsに関する\u003ca href=\"https://github.com/jonathandturner/decorators\"\u003eTC39 Proposal\u003c/a\u003eを立ち上げている件が非常に興味深く、ここに参加している\u003ca href=\"https://github.com/rbuckton\"\u003eRon Buckton\u003c/a\u003e氏はTypeScript開発者の一人です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"decoratorsのecma-262-7th-editionでの規格化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#decorators%E3%81%AEecma-262-7th-edition%E3%81%A7%E3%81%AE%E8%A6%8F%E6%A0%BC%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDecoratorsのECMA-262 7th Editionでの規格化\u003c/h1\u003e\n\n\u003cp\u003e語弊を含んで噛み砕いて言うと『JavaScript ES7でのDecoratorsの仕様策定』です。前述のとおりTC39ミーティングで進んでいるようです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/tc39/agendas/blob/master/2015/03.md\"\u003e2015年3月のTC39\u003c/a\u003eでは\u003ca href=\"https://github.com/wycats/javascript-decorators\"\u003ewycats氏のプロポーザル\u003c/a\u003eで議論が進んだようですが、Microsoft側もプロポーザルを準備しており、今後どのように絡んでくるのか非常に注目しています。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eTypeScript側のプロポーザル\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/jonathandturner/decorators\"\u003ehttps://github.com/jonathandturner/decorators\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/rbuckton/ReflectDecorators\"\u003ehttps://github.com/rbuckton/ReflectDecorators\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"babel\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#babel\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBabel\u003c/h2\u003e\n\n\u003cp\u003eES6, ES7 Proposalの構文をES5に変換することでおなじみの\u003ca href=\"https://babeljs.io/\"\u003eBabel\u003c/a\u003eには\u003ca href=\"https://babeljs.io/docs/usage/experimental/\"\u003eDecoratorsがすでに実装されています\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003eこのBabelの実装根拠がwycats氏のプロポーザルに限っているため、\u003ca href=\"http://qiita.com/armorik83/items/d4ef1f60b8b6a34f3cd5\"\u003eAngular 2がBabelで動かないという問題\u003c/a\u003eが起こりました。Angular, Microsoft側からも動きが出ると予想しており、動きにあわせてIssueも立つことでしょうから、この問題は時間が解決すると期待しています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"現時点での実装と挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8F%BE%E6%99%82%E7%82%B9%E3%81%A7%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A8%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e現時点での実装と挙動\u003c/h1\u003e\n\n\u003cp\u003e挙動に関して本稿で触れると冗長になるため今回は割愛します。この件についてはQiitaやその周辺にて以下の記事を確認しています。（敬称略）\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/Quramy/items/e3a43bb1734b8a7331e8\"\u003eQuramy | TypeScriptのDecoratorメモ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/takeshi@github/items/8a6b00686659668feba0\"\u003etakeshi@github | Decoratorの付与されたTypeScriptのクラスを書き換える\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/nana4gonta/items/9f6273ead66351705036\"\u003enana4gonta | TypeScript 1.5 Alphaに入ったDecoratorsは何をするのか\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://gist.github.com/vvakame/cfc603535f4fec35838e\"\u003eGitHub Gist | vvakame/decorators.ts\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cdel\u003e2015年4月13日現在、BabelとTypeScriptで挙動に差がでているという目撃情報があるので、これも時期尚早という印象がありました。\u003c/del\u003e\u003cbr\u003e\n（追記）執筆中に\u003ca href=\"https://github.com/babel/babel/commit/bbc951dfe191c3be507816b92c69e259c28cbdb2\"\u003e直っていた\u003c/a\u003eことに気付いていませんでした。Babel開発者の\u003ca href=\"https://github.com/sebmck\"\u003esebmck\u003c/a\u003e氏が日本（上記記事絡みの方々）での挙動指摘のツイートを検索・翻訳し、直してしまったようです。恐るべき情報収集力と速さに感服しました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"atscript--typescriptという誤解\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#atscript--typescript%E3%81%A8%E3%81%84%E3%81%86%E8%AA%A4%E8%A7%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAtScript ∈ TypeScriptという誤解\u003c/h1\u003e\n\n\u003cp\u003e（追記）本稿掲載後、さらに延長線上を調査していたところ、AtScript構文とTypeScriptに完全な互換性が無いことが明らかになりました。TypeScript 1.5 Alphaの\u003ccode\u003etsc\u003c/code\u003eでどうやっても通らない\u003ca href=\"https://github.com/angular/angular/blob/master/modules/angular2/src/core/annotations/annotations.js#L418\"\u003eこの構文\u003c/a\u003eが許容されている根拠は何かと調べていたところ、次の二つのIssues/PRsを発見しました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/issues/99\"\u003eAllow @CONST annotation on class\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/angular/pull/148\"\u003efeat(transpiler): allow @CONST annotation on class\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれらが意味するところを突き止めるためコミットの前後を追っていたところ、この構文は\u003ca href=\"https://github.com/angular/angular/tree/master/tools/transpiler\"\u003e/tools/transpiler\u003c/a\u003eのツールのみが処理できるようで、ここを深追いはしていませんがtraceurのランタイムを拡張して実現させているようでした。\u003c/p\u003e\n\n\u003cp\u003eつまり変換できないBabel、TypeScript 1.5 Alpha側に問題があるのではなく、Angular 2の独自実装構文が生き残っていたということになります。ng-confではまことしやかに「AtScriptはTypeScriptだ」と囁かれ筆者も当然そうなのだろうと信じていたのですが、Angular 2側は2015年4月現在、TypeScriptにまだ\u003cstrong\u003e移行\u003c/strong\u003eできておらず、TypeScript言語仕様に加えてもらうのか、この構文をAngular側が諦めるのか、traceur依存を続けるのか、まったく目が離せない状況です。ng-europeからng-confまでの約半年に前述したinvalid構文についても仕様策定しておけば…と些か片手落ち感があります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e@\u003c/code\u003eをデコレーション、アノテーションの構文として使う言語はJava, Python, Dartなど複数\u003c/li\u003e\n\u003cli\u003eAngularDartではDart言語にある\u003ccode\u003e@\u003c/code\u003eを使用している\u003c/li\u003e\n\u003cli\u003eAngular 2でJavaScript版とDart版を同時開発する上でJavaScriptにDecoratorsを持ち込んだ（発表当初のAtScript）\n\n\u003cul\u003e\n\u003cli\u003e2015年3月5日、TypeScript 1.5にDecoratorsを採用すると告知\u003c/li\u003e\n\u003cli\u003e2015年3月27日、TypeScript 1.5 AlphaにてDecoratorsが正式に発表\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eTC39にてES7規格化の動き\n\n\u003cul\u003e\n\u003cli\u003eプロポーザル提出はwycats氏のみだがTypeScript側にも準備がある\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"主要人物\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%BB%E8%A6%81%E4%BA%BA%E7%89%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e主要人物\u003c/h2\u003e\n\n\u003cp\u003e敬称略\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/mhevery\"\u003eMiško Hevery\u003c/a\u003e - Google, AngularDart, Angular 2\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/jonathandturner\"\u003eJonathan Turner\u003c/a\u003e - Microsoft, Angular 2 Demo\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/rbuckton\"\u003eRon Buckton\u003c/a\u003e - Microsoft, TypeScript\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/wycats\"\u003eYehuda Katz\u003c/a\u003e, wycats - TC39 Proposal, Ember.js\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"関連記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関連記事\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://azu.github.io/slide/es6talks/\"\u003e明日には使えなくなるES7トーク\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://azu.github.io/slide/typescript-sushi/decorators.html\"\u003eDecorators進捗\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"謝辞\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AC%9D%E8%BE%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e謝辞\u003c/h2\u003e\n\n\u003cp\u003e本稿の作成中、多くの方々を巻き込んでしまい、多大なる学びが得られました。ありがとうございました。お騒がせいたしました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h1\u003e\n\n\u003cp\u003eまだ早い。\u003c/p\u003e\n","body":"JavaScript, TypeScript界隈におけるDecoratorsについて取り上げます。\n\n# JavaScriptとDecorators\nJavaScriptでは馴染みのなかったDecoratorsが目に触れるようになったのはAtScript発表の際だったと記憶しています。\n\n## AtScript\nAtScriptとは、2014年10月23日、[ng-europe](http://ngeurope.org/)にて発表されたTypeScriptを包含する「新構文」です。\n\n- [docs.google.com | Keynote AtScript](https://docs.google.com/presentation/d/1hr2IM-8G-0RzpB-WY8pLHvxqNggKPzUO0KvEv1IKPws/edit?pli=1#slide=id.p)\n- [YouTube | Miško Hevery - Keynote on AtScript at ng-europe 2014](https://www.youtube.com/watch?v=lGdnh8QSPPk)\n\nこのときの例文を引用します。\n\n```js\n@Directive({\n  selector: ['[blink]']\n})\nclass Blink {\n  constructor(element:Element,\n              options:Options,\n              timeout:Timeout) {\n    var selectors:Array\u003cCssSelectors\u003e =\n        someThirdPartyAPI();\n    element.query(selectors.join(','))\n           .forEach(e =\u003e options.apply(e));\n   }\n}\n```\n\n`@Directive()`という箇所が彼らのいう（当初いっていた）AtScriptに該当する構文であり、本稿の題材でもあるDecoratorsです。\n\n筆者の確認できた限りでは、この構文を用いられたJavaScriptソースが公になったのは2014年9月26日の[angular/angular](https://github.com/angular/angular/)における[コミット](https://github.com/angular/angular/commit/8afa421d75c95562060e35dbe8f576bd1e81c294)が初で、この時点ではまだ関連ソースも揃ってなく動作しないソースでした。Angular 2関連で範囲を広げると、さらに前の2014年9月3日にはAngular 2にDecoratorsを[採り入れる案](https://github.com/angular/Angular2.design/blob/ee357b65ca840c1450b7c5e9c8fb33ccc3731d10/lib/annotations/directive.dart#L46)があったようです。\n\nng-europeでの発表に向けて、既にこの時期には動き出していたことが推察できます。\n\n## TypeScript\n2015年3月5日[ng-conf](http://www.ng-conf.org/)にて、Microsoftの[Jonathan Turner](https://github.com/jonathandturner)氏によってTypeScript 1.5にAnnotationsが加わると[発表](https://www.youtube.com/watch?v=QHulaj5ZxbI\u0026list=PLOETEcp3DkCoNnlhE-7fovYvqwVPrRiY7#t=23m36s)されました。\n\n翌3月6日にも同氏によって[TypeScriptとAngular 2に関する講演](https://www.youtube.com/watch?v=Xw93oketp18)が行われており、公式Twitterでも以下のような発言が掲載されています。\n\n\u003cblockquote class=\"twitter-tweet\" lang=\"en\"\u003e\u003cp\u003eAtScript is Typescript \u003ca href=\"https://twitter.com/hashtag/ngconf?src=hash\"\u003e#ngconf\u003c/a\u003e\u003c/p\u003e\u0026mdash; ng-conf (@ngconf) \u003ca href=\"https://twitter.com/ngconf/status/573521849780305920\"\u003eMarch 5, 2015\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n事実上AtScriptはTypeScript言語仕様として~~落ち着いたという瞬間です。~~（追記、稿末に詳細あり）落ち着こうとしています。\n\nその後、2015年3月27日にMicrosoftより[TypeScript 1.5 Alpha](http://blogs.msdn.com/b/typescript/archive/2015/03/27/announcing-typescript-1-5-alpha.aspx)の公式発表がなされ、予告されていたDecoratorsも併せてこの場で発表となりました。なお1.0以降、アルファ段階のTypeScriptが公式発表として取り上げられたのはこれが初です。\n\n# Decoratorsの文化的背景\n筆者には馴染みのない構文だったため、そもそもこういった`@`で書き始める構文はどの言語から影響を受けたのか、という疑問がありました。元となった言語の使用者ではないため表面的な事実の羅列となりますが、確認した限りを並べてみます。\n\n## C# \nC#には、`@`の構文ではありませんが[Metadata構文](http://en.wikipedia.org/wiki/Metadata_(CLI))というものがあります。登場時期はC# 1.0と同じく2001年2月。深くは言及しませんが、メタデータを読み取るためのReflectionという概念がAngular 2の実装内にも確認できたため触れておきます。\n\n## Java\nどうやら`@`で書き始めるこの構文の根元はJavaにあるようです。2004年9月30日に発表されたJ2SE 5.0に採用された[Metadata構文](http://www.oracle.com/technetwork/articles/javase/j2se15-141062.html)（アノテーション構文とも）が最初で、この機能も、Java最初期（1996年1月23日）から存在していたJavadocの`@`が由来で採用された経緯があるようです。\n\n\u003e J2SE 5.0（別名はTigerで、現在は2番目のベータ・リリースです）が入手できるようになるまでは、コアとしてのJava言語でメタデータ機能に最も近いものはJavadocによる手法でした。\nhttp://www.ibm.com/developerworks/jp/java/library/j-annotate1/\n\n`@`構文はJava由来なようですが、概念自体は前述のC#が先行しており、影響を与え合っていたと見る向きもあります。\n\n## Python\nPythonは2004年11月30日の2.4から`@`で記述する`Decorators`構文を備えました。これはPEP (Python Enhancement Proposals)で提言された[PEP 318 - Decorators for Functions and Methods](https://www.python.org/dev/peps/pep-0318/)が源流のようです。資料にはJavaの影響を受けた旨が明記されています。\n\n\u003e Why @?\nThere is some history in Java using @ initially as a marker in Javadoc comments and later in Java 1.5 for annotations, which are similar to Python decorators.\nhttps://www.python.org/dev/peps/pep-0318/#why\n\nDecoratorsは、やはりGoFの[Decoratorパターン](http://ja.wikipedia.org/wiki/Decorator_%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3)が由来で、JavaのMetadata構文を用途までそっくり取り込んだわけではないようです。\n\n\u003e Some symbol options:\n@\n+ Java-like, so not completely unknown.\n+ Not confusable with any current Python symbol\n+ Makes syntax highlighting easy\n\n`@`採用の経緯にJava風で既知の表記法だ、という旨が盛り込まれていました。[PEP 318がまとまっていった様子の議事録](https://wiki.python.org/moin/PythonDecorators#What_is_a_Decorator)はとても興味深いものです。[PythonDecoratorLibrary](https://wiki.python.org/moin/PythonDecoratorLibrary)というコンテンツは、JavaScriptにおいてDecoratorsを用いる際の着想として参考になるかもしれません。\n\n## Dart\nDart（2011年10月登場、2014年6月に[ECMA-408](http://www.ecma-international.org/publications/standards/Ecma-408.htm)として規格化）にも[Metadata構文](https://www.dartlang.org/docs/dart-up-and-running/ch02.html#metadata)と呼ばれる構文が存在しており、これはJava, Pythonのように`@`で始まっています。登場時期からみても、Dartはこれら先行言語からの影響を受けている可能性が高いです。\n\n# JavaScriptにDecoratorsが持ち込まれた経緯\nこれまで存在しなかったDecorators構文がなぜここへ来てJavaScriptに採り入れられるのか、客観的事実を元にした推察です。\n\n## 2013年10月 AngularDartの存在\n[AngularDart](https://angulardart.org/)の初期リリースはタグ基準で[2013年10月17日のv0.0.2](https://github.com/angular/angular.dart/releases/tag/v0.0.2)です。AngularDartでは**Dartの言語仕様をそのまま活用して**`@`で始まるAnnotationsを[採用しています](https://docs.angulardart.org/#angular/angular-core-annotation.Component)。\n\nAngularJS 1.xをDartで再実装するとして動いていたようですが、Angular 2がAngularJS 2, AngularDart 2という名前ではなく\"Angular 2 for JavaScript|Dart\"となったことから一本化されたものと理解しています。事実、Angular 2には`.es6`と`.dart`という二つの拡張子のソースが[まとめて格納](https://github.com/angular/angular/tree/master/modules/angular2/src/facade)されており、一つのプロジェクトで2言語に対応しようと試みられています。\n\nGoogleの[Miško Hevery](https://github.com/mhevery)氏が[AngularDartの立ち上げ人で最多コード記述者](https://github.com/angular/angular.dart/graphs/contributors)である点、[Angular 2草案リポジトリの中心人物](https://github.com/angular/Angular2.design/commits/master)である点、ng-europeでのAtScriptの発表者が同氏である点から総合的に判断して、Angular 2 for JavaScriptにDecoratorsが持ち込まれた経緯がAngularDart由来である、そして主要人物がMiško Hevery氏であることが分かります。\n\n## 2014年4月 TC39での議題に上る\nTC39というECMAのミーティングがあるのですが、TC39自体については日本国内でもウォッチしている方がおられるので、そちらに任せます。（[参考](https://twitter.com/search?f=realtime\u0026q=%23TC39MTG\u0026src=typd)）\n\n[2014年4月のTC39](https://github.com/tc39/agendas/blob/b98e8025188b5a19a775a11df662cdbd84a371a8/2014/04.md)で、\"ECMA-262 7th Edition\"、俗にいうES7の議論の際に[Yehuda Katz](https://github.com/wycats) (wycats)氏によって案が提出されていたようです。\n\n時系列としてはこの位置ですが、wycats氏がAngular事情と絡んでいたかは定かでなく、活動内容を見る限りその可能性は無さそうに見えます。TC39にて草案が提出されたことをAngular開発陣が観察していた可能性は有り得ます。\n\n## 2014年10月 AtScriptの発表\n前述のとおり、ng-europeにてAtScriptの発表が行われました。まだこの時はGoogle側の独自的な構文の範疇でしたが、ここから約半年で大きく動くことになります。\n\n## 2015年3月 TypeScript 1.5への採用\nさすがにGoogleとMicrosoft間のやりとりは窺い知れませんが、AtScript絡みで情報交換はしていたのだろうと想像しています。MSDN Blogsでは[大歓迎の模様](http://blogs.msdn.com/b/somasegar/archive/2015/03/05/typescript-lt-3-angular.aspx)です。\n\nこの発表を行ったMicrosoftの[Jonathan Turner](https://github.com/jonathandturner)氏は2015年3月29日にDecoratorsに関する[TC39 Proposal](https://github.com/jonathandturner/decorators)を立ち上げている件が非常に興味深く、ここに参加している[Ron Buckton](https://github.com/rbuckton)氏はTypeScript開発者の一人です。\n\n# DecoratorsのECMA-262 7th Editionでの規格化\n語弊を含んで噛み砕いて言うと『JavaScript ES7でのDecoratorsの仕様策定』です。前述のとおりTC39ミーティングで進んでいるようです。\n\n[2015年3月のTC39](https://github.com/tc39/agendas/blob/master/2015/03.md)では[wycats氏のプロポーザル](https://github.com/wycats/javascript-decorators)で議論が進んだようですが、Microsoft側もプロポーザルを準備しており、今後どのように絡んでくるのか非常に注目しています。\n\n**TypeScript側のプロポーザル**\n\n- https://github.com/jonathandturner/decorators\n- https://github.com/rbuckton/ReflectDecorators\n\n## Babel\nES6, ES7 Proposalの構文をES5に変換することでおなじみの[Babel](https://babeljs.io/)には[Decoratorsがすでに実装されています](https://babeljs.io/docs/usage/experimental/)。\n\nこのBabelの実装根拠がwycats氏のプロポーザルに限っているため、[Angular 2がBabelで動かないという問題](http://qiita.com/armorik83/items/d4ef1f60b8b6a34f3cd5)が起こりました。Angular, Microsoft側からも動きが出ると予想しており、動きにあわせてIssueも立つことでしょうから、この問題は時間が解決すると期待しています。\n\n# 現時点での実装と挙動\n挙動に関して本稿で触れると冗長になるため今回は割愛します。この件についてはQiitaやその周辺にて以下の記事を確認しています。（敬称略）\n\n- [Quramy | TypeScriptのDecoratorメモ](http://qiita.com/Quramy/items/e3a43bb1734b8a7331e8)\n- [takeshi@github | Decoratorの付与された\u001bTypeScriptのクラスを書き換える](http://qiita.com/takeshi@github/items/8a6b00686659668feba0)\n- [nana4gonta | TypeScript 1.5 Alphaに入ったDecoratorsは何をするのか](http://qiita.com/nana4gonta/items/9f6273ead66351705036)\n- [GitHub Gist | vvakame/decorators.ts](https://gist.github.com/vvakame/cfc603535f4fec35838e)\n\n~~2015年4月13日現在、BabelとTypeScriptで挙動に差がでているという目撃情報があるので、これも時期尚早という印象がありました。~~\n（追記）執筆中に[直っていた](https://github.com/babel/babel/commit/bbc951dfe191c3be507816b92c69e259c28cbdb2)ことに気付いていませんでした。Babel開発者の[sebmck](https://github.com/sebmck)氏が日本（上記記事絡みの方々）での挙動指摘のツイートを検索・翻訳し、直してしまったようです。恐るべき情報収集力と速さに感服しました。\n\n# AtScript ∈ TypeScriptという誤解\n（追記）本稿掲載後、さらに延長線上を調査していたところ、AtScript構文とTypeScriptに完全な互換性が無いことが明らかになりました。TypeScript 1.5 Alphaの`tsc`でどうやっても通らない[この構文](https://github.com/angular/angular/blob/master/modules/angular2/src/core/annotations/annotations.js#L418)が許容されている根拠は何かと調べていたところ、次の二つのIssues/PRsを発見しました。\n\n- [Allow @CONST annotation on class](https://github.com/angular/angular/issues/99)\n- [feat(transpiler): allow @CONST annotation on class](https://github.com/angular/angular/pull/148)\n\nこれらが意味するところを突き止めるためコミットの前後を追っていたところ、この構文は[/tools/transpiler](https://github.com/angular/angular/tree/master/tools/transpiler)のツールのみが処理できるようで、ここを深追いはしていませんがtraceurのランタイムを拡張して実現させているようでした。\n\nつまり変換できないBabel、TypeScript 1.5 Alpha側に問題があるのではなく、Angular 2の独自実装構文が生き残っていたということになります。ng-confではまことしやかに「AtScriptはTypeScriptだ」と囁かれ筆者も当然そうなのだろうと信じていたのですが、Angular 2側は2015年4月現在、TypeScriptにまだ**移行**できておらず、TypeScript言語仕様に加えてもらうのか、この構文をAngular側が諦めるのか、traceur依存を続けるのか、まったく目が離せない状況です。ng-europeからng-confまでの約半年に前述したinvalid構文についても仕様策定しておけば…と些か片手落ち感があります。\n\n# まとめ\n- `@`をデコレーション、アノテーションの構文として使う言語はJava, Python, Dartなど複数\n- AngularDartではDart言語にある`@`を使用している\n- Angular 2でJavaScript版とDart版を同時開発する上でJavaScriptにDecoratorsを持ち込んだ（発表当初のAtScript）\n  - 2015年3月5日、TypeScript 1.5にDecoratorsを採用すると告知\n  - 2015年3月27日、TypeScript 1.5 AlphaにてDecoratorsが正式に発表\n- TC39にてES7規格化の動き\n  - プロポーザル提出はwycats氏のみだがTypeScript側にも準備がある\n\n## 主要人物\n敬称略\n\n- [Miško Hevery](https://github.com/mhevery) - Google, AngularDart, Angular 2\n- [Jonathan Turner](https://github.com/jonathandturner) - Microsoft, Angular 2 Demo\n- [Ron Buckton](https://github.com/rbuckton) - Microsoft, TypeScript\n- [Yehuda Katz](https://github.com/wycats), wycats - TC39 Proposal, Ember.js\n\n## 関連記事\n\n- [明日には使えなくなるES7トーク](http://azu.github.io/slide/es6talks/)\n- [Decorators進捗](http://azu.github.io/slide/typescript-sushi/decorators.html)\n\n## 謝辞\n本稿の作成中、多くの方々を巻き込んでしまい、多大なる学びが得られました。ありがとうございました。お騒がせいたしました。\n\n#感想\nまだ早い。\n","coediting":false,"created_at":"2015-04-13T18:12:18+09:00","id":"e3a0ce67f569ddc4b432","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"TypeScript","versions":["1.5"]},{"name":"AngularJS","versions":[]},{"name":"AngularDart","versions":[]}],"title":"JavaScript Decorators","updated_at":"2015-04-14T23:09:15+09:00","url":"http://qiita.com/armorik83/items/e3a0ce67f569ddc4b432","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eAngularの1系2系両方に対応した新しいrouterとして開発が進められているNew Routerをさわってみました。\u003cbr\u003e\nドキュメントやサンプルがまだ整備中ということもあり、何が必須の要素で何が必須ではないのか読み取りにくかったので、実際にコードを足したり消したりで重箱の隅をつついてみました。\u003cbr\u003e\nドキュメントではまだ説明されていないnested routeも試してみます。\u003c/p\u003e\n\n\u003cp\u003e対象バージョンは執筆時点で最新の0.5.3、AngularJS本体は1.3.15とします。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"route設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#route%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoute設定\u003c/h1\u003e\n\n\u003cp\u003erouteの設定をするために2通りの方法が提供されています。\u003cbr\u003e\n1つは、controllerの\u003ccode\u003e$routeConfig\u003c/code\u003eプロパティで設定するパターン、もう1つはcontrollerにDIした\u003ccode\u003e$router\u003c/code\u003eで設定するパターンです。\u003cbr\u003e\nこれらの違いを説明する前に1点確認なのですが、New Routerではcontrollerはcontroller asでインスタンス化されて使用します。\u003cbr\u003e\nこのあたりのルールは既に \u003ca href=\"/Quramy\" class=\"user-mention\" title=\"Quramy\"\u003e@Quramy\u003c/a\u003e さん、albatrosaryさんがまとめてくれています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/Quramy/items/9a2ea71241b261028b6f\"\u003ehttp://qiita.com/Quramy/items/9a2ea71241b261028b6f\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://albatrosary.hateblo.jp/entry/2015/03/30/075952\"\u003ehttp://albatrosary.hateblo.jp/entry/2015/03/30/075952\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"routeconfig\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#routeconfig\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e$routeConfig\u003c/h2\u003e\n\n\u003cp\u003eさて、\u003ccode\u003e$routeConfig\u003c/code\u003eプロパティを使ったrouteの設定です。\u003cbr\u003e\n以下のように、ngNewRouterを読み込み、controllerを定義、そしてcontrollerの\u003ccode\u003e$routeConfig\u003c/code\u003eプロパティを設定しています（ngNewRouterはいずれ違う名前になるんじゃないかと思われます）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ngNewRouter'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'AppController'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$routeConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eredirectTo\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/home'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/home'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'home'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;meta\u003c/span\u003e \u003cspan class=\"na\"\u003echarset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;title\u0026gt;\u003c/span\u003erouter\u003cspan class=\"nt\"\u003e\u0026lt;/title\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"AppController as root\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-viewport\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"angular.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"router.es5.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eサンプルでは、controller定義がグローバルスコープに漏れ出ていたのが気になったので即時関数で包んでみましたが特に問題はありませんでした。\u003c/p\u003e\n\n\u003cp\u003eJavaScript上の関数名とAngularに伝えるcontroller名をあえて変更してみました。\u003cbr\u003e\n今現在は、ルーティング最上位のcontroller名はAppControllerにしないといけないという制約があるそうです。\u003cbr\u003e\nJavaScript上での関数名やcontroller asで受けるインスタンス名に制約はなさそうです。\u003cbr\u003e\nこの制約はバージョン0.6で解消予定だそうです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/angular/router/issues/187\"\u003ehttps://github.com/angular/router/issues/187\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eドキュメントやサンプルを見ると、\u003ccode\u003e$routeConfig\u003c/code\u003eでルート設定を行った上、controllerに\u003ccode\u003e$router\u003c/code\u003eをDIしている例が見られますが、\u003ccode\u003e$router\u003c/code\u003eをDIする必要はとくになさそうです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"routerconfig\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#routerconfig\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e$router.config\u003c/h2\u003e\n\n\u003cp\u003e今度は$routerを使ったroute設定です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ngNewRouter'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'AppController'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$router\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$router\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eredirectTo\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/home'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/home'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'home'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e$router\u003c/code\u003eをDIしてconfig関数を呼んでいるだけで、それほど大きな違いはありませんね。\u003cbr\u003e\nこちらの場合、\u003ccode\u003e$routeConfig\u003c/code\u003eのようなcontroller名の制約はありませんでした。\u003cbr\u003e\ncontrollerにあれこれDIして使うことを考えると、\u003ccode\u003e$routeConfig\u003c/code\u003eを使ったほうがコードはすっきりしそうです。\u003c/p\u003e\n\n\u003cp\u003eちなみに\u003ccode\u003e$routeConfig\u003c/code\u003eと\u003ccode\u003e$router.config\u003c/code\u003e両方使った場合は両方とも採用されるようですが、pathが重複した場合はエラーが出ます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"componentの定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#component%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecomponentの定義\u003c/h1\u003e\n\n\u003cp\u003eルーティングされるcomponentは以下のように記述します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/home/home.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'HomeController'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eHomeController\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eHomeController\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eheader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ハロー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/home/home.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;h1\u0026gt;\u003c/span\u003e{{home.header}}\u003cspan class=\"nt\"\u003e\u0026lt;/h1\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eサンプルでは、componentを\u003ccode\u003eangular.module('hoge.home', [])\u003c/code\u003eのように別モジュールに分けていましたが、分けなくても特に問題はないようです。\u003c/p\u003e\n\n\u003cp\u003eさらに、index.htmlにscriptタグを追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;meta\u003c/span\u003e \u003cspan class=\"na\"\u003echarset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;title\u0026gt;\u003c/span\u003erouter\u003cspan class=\"nt\"\u003e\u0026lt;/title\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"AppController as root\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-viewport\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"angular.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"router.es5.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"components/home/home.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ejsファイルをcomponents/componentName/componentName.jsに配置していますが、jsファイルの配置場所に関するルールはなくController名だけルールに従っていれば大丈夫です。\u003cbr\u003e\nそのためビルドパイプラインを通して単一のjsファイルにまとめたりしても特に問題はないでしょう。\u003c/p\u003e\n\n\u003cp\u003eまた、component名とcontroller、templateの対応ルールは\u003ccode\u003e$componentLoader\u003c/code\u003eで変更可能だそうです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nested-route\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nested-route\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enested route\u003c/h1\u003e\n\n\u003cp\u003e/homeの下のパスに/home/sub1、/home/sub2のように要素を追加してみます。\u003cbr\u003e\nまず、HomeComponentを以下のように変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/home/home.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'HomeController'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eHomeController\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eHomeController\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eheader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ハロー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eHomeController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$routeConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/sub1'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ecomponents\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003esub\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'sub1'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'sub1'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/sub2'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ecomponents\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003esub\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'sub2'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'sub2'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/home/home.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;h1\u0026gt;\u003c/span\u003e{{home.header}}\u003cspan class=\"nt\"\u003e\u0026lt;/h1\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003eng-link=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"sub1\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003esub1\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003eng-link=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"sub2\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003esub2\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-viewport=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"sub\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eHomeControllerに更にルーティング情報を追加し、HTMLに名前付きng-viewportを追加し子componentの表示場所を確保しています。\u003cbr\u003e\nまた、ng-linkでサブcomponentに遷移させるために、\u003ccode\u003e$routeConfig\u003c/code\u003eのasでrouteにaliasをつけています。\u003c/p\u003e\n\n\u003cp\u003e次にSub1ComponentとSub2Componentの定義です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;meta\u003c/span\u003e \u003cspan class=\"na\"\u003echarset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;title\u0026gt;\u003c/span\u003erouter\u003cspan class=\"nt\"\u003e\u0026lt;/title\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u003c/span\u003e \u003cspan class=\"na\"\u003eng-app=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e \u003cspan class=\"na\"\u003eng-controller=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"AppController as root\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eng-viewport\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"angular.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"router.es5.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"components/home/home.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"components/sub1/sub2.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"components/sub2/sub2.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/sub1/sub1.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'Sub1Controller'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eSub1Controller\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eSub1Controller\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/sub1/sub1.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;h2\u0026gt;\u003c/span\u003esub1\u003cspan class=\"nt\"\u003e\u0026lt;/h2\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/sub2/sub2.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'Sub2Controller'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eSub2Controller\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eSub2Controller\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecomponents/sub2/sub2.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nt\"\u003e\u0026lt;h2\u0026gt;\u003c/span\u003esub2\u003cspan class=\"nt\"\u003e\u0026lt;/h2\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e子componentもcomponentsディレクトリにフラットに配置すればよさそうでした。\u003c/p\u003e\n\n\u003cp\u003e/homeにアクセスするとエラーになるのでデフォルトのrouteも変更しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eangular\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ngNewRouter'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'AppController'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eRootController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e$routeConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eredirectTo\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/home/sub1'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/home'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'home'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003e少しだけNew Routerをさわってみた感触としては、ハマりどころは若干ありそうですが、既にそれなりの完成度になっていると思います。\u003cbr\u003e\ncomponentベースになっていたり、そのための標準的なディレクトリ構成が決まっていたりで、今のうちのこの構成に慣れておけば将来的にAngular2が安定した頃にはスムーズな移行ができるのではないでしょうか。\u003c/p\u003e\n\n\u003cp\u003e最後に宣伝ですが、2015年4月29日に開催される\u003ca href=\"http://www.zusaar.com/event/6007003\"\u003eGDG KobeのAngularJS勉強会\u003c/a\u003eでNew Routerを使ったハンズオンを担当させてもらいます。\u003cbr\u003e\n興味を持たれた方は是非お越しください。\u003c/p\u003e\n","body":"\n# はじめに\n\nAngularの1系2系両方に対応した新しいrouterとして開発が進められているNew Routerをさわってみました。\nドキュメントやサンプルがまだ整備中ということもあり、何が必須の要素で何が必須ではないのか読み取りにくかったので、実際にコードを足したり消したりで重箱の隅をつついてみました。\nドキュメントではまだ説明されていないnested routeも試してみます。\n\n対象バージョンは執筆時点で最新の0.5.3、AngularJS本体は1.3.15とします。\n\n# Route設定\n\nrouteの設定をするために2通りの方法が提供されています。\n1つは、controllerの`$routeConfig`プロパティで設定するパターン、もう1つはcontrollerにDIした`$router`で設定するパターンです。\nこれらの違いを説明する前に1点確認なのですが、New Routerではcontrollerはcontroller asでインスタンス化されて使用します。\nこのあたりのルールは既に @Quramy さん、albatrosaryさんがまとめてくれています。\n\n* http://qiita.com/Quramy/items/9a2ea71241b261028b6f\n* http://albatrosary.hateblo.jp/entry/2015/03/30/075952\n\n## $routeConfig\n\nさて、`$routeConfig`プロパティを使ったrouteの設定です。\n以下のように、ngNewRouterを読み込み、controllerを定義、そしてcontrollerの`$routeConfig`プロパティを設定しています（ngNewRouterはいずれ違う名前になるんじゃないかと思われます）。\n\n```javascript:app.js\n(function () {\n  'use strict';\n\n  angular.module('hoge', ['ngNewRouter'])\n    .controller('AppController', RootController);\n\n  function RootController() {\n  }\n\n  RootController.$routeConfig = [\n    {\n      path: '/',\n      redirectTo: '/home'\n    },\n    {\n      path: '/home',\n      component: 'home'\n    }\n  ];\n})();\n```\n\n```html:index.html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003erouter\u003c/title\u003e\n\u003c/head\u003e\n\u003cbody ng-app=\"hoge\" ng-controller=\"AppController as root\"\u003e\n\u003cdiv ng-viewport\u003e\u003c/div\u003e\n\u003cscript src=\"angular.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"router.es5.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"app.js\"\u003e\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\nサンプルでは、controller定義がグローバルスコープに漏れ出ていたのが気になったので即時関数で包んでみましたが特に問題はありませんでした。\n\nJavaScript上の関数名とAngularに伝えるcontroller名をあえて変更してみました。\n今現在は、ルーティング最上位のcontroller名はAppControllerにしないといけないという制約があるそうです。\nJavaScript上での関数名やcontroller asで受けるインスタンス名に制約はなさそうです。\nこの制約はバージョン0.6で解消予定だそうです。\n\n* https://github.com/angular/router/issues/187\n\nドキュメントやサンプルを見ると、`$routeConfig`でルート設定を行った上、controllerに`$router`をDIしている例が見られますが、`$router`をDIする必要はとくになさそうです。\n\n## $router.config\n\n今度は$routerを使ったroute設定です。\n\n```javascript:app.js\n(function () {\n  'use strict';\n\n  angular.module('hoge', ['ngNewRouter'])\n    .controller('AppController', RootController);\n\n  function RootController($router) {\n    $router.config([\n      {\n        path: '/',\n        redirectTo: '/home'\n      },\n      {\n        path: '/home',\n        component: 'home'\n      }\n    ]);\n  }\n})();\n\n```\n\n`$router`をDIしてconfig関数を呼んでいるだけで、それほど大きな違いはありませんね。\nこちらの場合、`$routeConfig`のようなcontroller名の制約はありませんでした。\ncontrollerにあれこれDIして使うことを考えると、`$routeConfig`を使ったほうがコードはすっきりしそうです。\n\nちなみに`$routeConfig`と`$router.config`両方使った場合は両方とも採用されるようですが、pathが重複した場合はエラーが出ます。\n\n# componentの定義\n\nルーティングされるcomponentは以下のように記述します。\n\n```javascript:components/home/home.js\n(function () {\n  'use strict';\n\n  angular.module('hoge')\n    .controller('HomeController', HomeController);\n\n  function HomeController() {\n    this.header = 'ハロー！';\n  }\n})();\n```\n\n```html:components/home/home.html\n\u003ch1\u003e{{home.header}}\u003c/h1\u003e\n```\n\nサンプルでは、componentを`angular.module('hoge.home', [])`のように別モジュールに分けていましたが、分けなくても特に問題はないようです。\n\nさらに、index.htmlにscriptタグを追加します。\n\n```html:index.html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003erouter\u003c/title\u003e\n\u003c/head\u003e\n\u003cbody ng-app=\"hoge\" ng-controller=\"AppController as root\"\u003e\n\u003cdiv ng-viewport\u003e\u003c/div\u003e\n\u003cscript src=\"angular.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"router.es5.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"app.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"components/home/home.js\"\u003e\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\njsファイルをcomponents/componentName/componentName.jsに配置していますが、jsファイルの配置場所に関するルールはなくController名だけルールに従っていれば大丈夫です。\nそのためビルドパイプラインを通して単一のjsファイルにまとめたりしても特に問題はないでしょう。\n\nまた、component名とcontroller、templateの対応ルールは`$componentLoader`で変更可能だそうです。\n\n# nested route\n\n/homeの下のパスに/home/sub1、/home/sub2のように要素を追加してみます。\nまず、HomeComponentを以下のように変更します。\n\n```javascript:components/home/home.js\n(function () {\n  'use strict';\n\n  angular.module('hoge')\n    .controller('HomeController', HomeController);\n\n  function HomeController() {\n    this.header = 'ハロー！';\n  }\n  \n  HomeController.$routeConfig = [\n    {\n      path: '/sub1',\n      components: {\n        sub: 'sub1'\n      },\n      as: 'sub1'\n    },\n    {\n      path: '/sub2',\n      components: {\n        sub: 'sub2'\n      },\n      as: 'sub2'\n    }\n  ];\n})();\n```\n\n```html:components/home/home.html\n\u003ch1\u003e{{home.header}}\u003c/h1\u003e\n\n\u003ca ng-link=\"sub1\"\u003esub1\u003c/a\u003e\n\u003ca ng-link=\"sub2\"\u003esub2\u003c/a\u003e\n\n\u003cdiv ng-viewport=\"sub\"\u003e\u003c/div\u003e\n```\n\nHomeControllerに更にルーティング情報を追加し、HTMLに名前付きng-viewportを追加し\b子componentの表示場所を確保しています。\nまた、ng-linkでサブcomponentに遷移させるために、`$routeConfig`のasでrouteにaliasをつけています。\n\n次にSub1ComponentとSub2Componentの定義です。\n\n\n```html:index.html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003erouter\u003c/title\u003e\n\u003c/head\u003e\n\u003cbody ng-app=\"hoge\" ng-controller=\"AppController as root\"\u003e\n\u003cdiv ng-viewport\u003e\u003c/div\u003e\n\u003cscript src=\"angular.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"router.es5.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"app.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"components/home/home.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"components/sub1/sub2.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"components/sub2/sub2.js\"\u003e\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\n```javascript:components/sub1/sub1.js\n(function() {\n  angular.module('hoge')\n    .controller('Sub1Controller', Sub1Controller);\n\n  function Sub1Controller() {\n  }\n})();\n```\n\n```html:components/sub1/sub1.html\n\u003ch2\u003esub1\u003c/h2\u003e\n```\n\n```javascript:components/sub2/sub2.js\n(function() {\n  angular.module('hoge')\n    .controller('Sub2Controller', Sub2Controller);\n\n  function Sub2Controller() {\n  }\n})();\n```\n\n```html:components/sub2/sub2.html\n\u003ch2\u003esub2\u003c/h2\u003e\n```\n\n子componentもcomponentsディレクトリにフラットに配置すればよさそうでした。\n\n/homeにアクセスするとエラーになるのでデフォルトのrouteも変更しておきます。\n\n```javascript:app.js\n(function () {\n  'use strict';\n\n  angular.module('hoge', ['ngNewRouter'])\n    .controller('AppController', RootController);\n\n  function RootController() {\n  }\n\n  RootController.$routeConfig = [\n    {\n      path: '/',\n      redirectTo: '/home/sub1'\n    },\n    {\n      path: '/home',\n      component: 'home'\n    }\n  ];\n})();\n```\n\n# おわりに\n\n少しだけNew Routerをさわってみた感触としては、ハマりどころは若干ありそうですが、既にそれなりの完成度になっていると思います。\ncomponentベースになっていたり、そのための標準的なディレクトリ構成が決まっていたりで、今のうちのこの構成に慣れておけば将来的にAngular2が安定した頃にはスムーズな移行ができるのではないでしょうか。\n\n最後に宣伝ですが、2015年4月29日に開催される[GDG KobeのAngularJS勉強会](http://www.zusaar.com/event/6007003)でNew Routerを使ったハンズオンを担当させてもらいます。\n興味を持たれた方は是非お越しください。\n","coediting":false,"created_at":"2015-04-11T10:26:17+09:00","id":"ae6e7f167056a2ce0655","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"AngularJS","versions":[]}],"title":"New Routerの重箱の隅をつつく","updated_at":"2015-04-11T10:33:37+09:00","url":"http://qiita.com/_likr/items/ae6e7f167056a2ce0655","user":{"description":"","facebook_id":"likr0","followees_count":4,"followers_count":40,"github_login_name":"likr","id":"_likr","items_count":11,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":4249,"profile_image_url":"https://pbs.twimg.com/profile_images/378800000702916456/deb12223849e944ee8298a858c593bff_normal.png","twitter_screen_name":"_likr","website_url":""}},{"rendered_body":"\u003cp\u003e「まだ早い!!」\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。時間ができたので\u003ca href=\"http://ngjapan.org/\"\u003eng-japan\u003c/a\u003e終了後、ようやくAngular 2を触ることができました。導入が想像以上にきつく、ES6やコンパイルといった昨今のJS事情に詳しくなければ、alpha段階で触るのは避けたほうがいい、というのが現段階での印象です。\u003c/p\u003e\n\n\u003cp\u003e足を踏み入れたのが早すぎるだけで、時間が解決するものだと思っています。\u003c/p\u003e\n\n\u003cp\u003e（150415追記: かなり解決されてきたので書きました → \u003ca href=\"http://qiita.com/armorik83/items/7ece9e035536a6b230f9\"\u003eどうしても今Angular 2 with Babelを触ってみたい人のためのビルドスクリプト\u003c/a\u003e）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"何が険しいか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%95%E3%81%8C%E9%99%BA%E3%81%97%E3%81%84%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e何が険しいか\u003c/h1\u003e\n\n\u003cp\u003e文章化する体力が残されていないので箇条書きで。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"traceur-compiler\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#traceur-compiler\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etraceur-compiler\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003enpm i angular2\u003c/code\u003eして落ちてくる\u003ca href=\"https://github.com/angular/angular\"\u003eAngular 2\u003c/a\u003eのJavaScriptソースがすべて\u003ca href=\"https://github.com/google/traceur-compiler/wiki/Getting-Started\"\u003etraceur-compiler\u003c/a\u003eのランタイムに依存している\n\n\u003cul\u003e\n\u003cli\u003eすでにES5化されているため\u003ca href=\"https://babeljs.io/\"\u003eBabel\u003c/a\u003eは使えない\u003c/li\u003e\n\u003cli\u003eBabel使いとしては、これは不採用\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/angular/quickstart\"\u003ehttps://github.com/angular/quickstart\u003c/a\u003eは遅いらしい（試してすらいない）\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/systemjs/systemjs\"\u003esystemjs\u003c/a\u003eの話全然聞かない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"node_modules内をコンパイルしてしまうのか問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#node_modules%E5%86%85%E3%82%92%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E3%81%AE%E3%81%8B%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enode_modules内をコンパイルしてしまうのか問題\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e./node_modules/angular2/es6/dev/\u003c/code\u003eにtraceur-compiler適用前のソースが入っている\n\n\u003cul\u003e\n\u003cli\u003e理屈ではこのソースをBabelでコンパイルすれば動く（はず）\u003c/li\u003e\n\u003cli\u003enode_modules内を変換するという抵抗感\u003c/li\u003e\n\u003cli\u003eAngular 2実装内に相対パスではなく、node_modules基準\u003ccode\u003efrom 'angular2/foobar'\u003c/code\u003eのパス表記があるため、単純なコンパイルではリンク切れを起こす\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"babel---blacklist-usestrict\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#babel---blacklist-usestrict\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebabel --blacklist useStrict\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/angular/angular/blob/6c60c3e547a66222c1a569118e294e4df72ac8c5/modules/angular2/src/change_detection/parser/ast.js#L5\"\u003eeval問題\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003eまさかの実装内\u003ccode\u003eeval()\u003c/code\u003e使用と、\u003ccode\u003e\"use strict\"\u003c/code\u003e必須にしてくるBabelが相性最悪\u003c/del\u003e\u003c/li\u003e\n\u003cli\u003e正しくは「strict下で予約語扱いのevalをAngular 2側がメソッド名に使っていたためBabelの\u003ccode\u003e'use strict'\u003c/code\u003eとバッティングする」でした\u003c/li\u003e\n\u003cli\u003eBabelの\u003ccode\u003e--blacklist useStrict\u003c/code\u003eで\u003ca href=\"https://github.com/babel/babel/issues/388\"\u003e回避可能\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e命名に\u003ccode\u003eeval\u003c/code\u003eを用いたことにいい印象は無いが、一応validなためBabel側のバグ\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"/shuhei\" class=\"user-mention\" title=\"shuhei\"\u003e@shuhei\u003c/a\u003e さんによって\u003ca href=\"https://github.com/babel/babel/issues/1232\"\u003eIssue\u003c/a\u003eが立てられた（ありがとうございます）\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/babel/babel/commit/edc2cd320c92a7322d264a086172d89b31bad1fa\"\u003e即座に直った\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"constructorがdecoratorにならない件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#constructor%E3%81%8Cdecorator%E3%81%AB%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003econstructorがdecoratorにならない件\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eAngular 2において\u003ccode\u003e@Component()\u003c/code\u003eというアノテーション (decorator) で使われている\u003ccode\u003eComponent\u003c/code\u003eは\u003ca href=\"https://github.com/angular/angular/blob/dbffa88dc2ba6ab49c706c6fe1e5dcb0f3b19ed9/modules/angular2/src/core/annotations/annotations.js#L483\"\u003eclass constructorなため\u003c/a\u003eBabelのランタイム\u003ccode\u003e_classCallCheck()\u003c/code\u003eで落ちる\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e_classCallCheck()\u003c/code\u003eとは「\u003ccode\u003econstructor\u003c/code\u003eは常に\u003ccode\u003enew\u003c/code\u003eを付けて呼べ」と怒るためのチェック\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003econstructor\u003c/code\u003eを直接decorator利用しているため怒られる\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/babel/babel/issues/1218\"\u003eダメ元でBabel開発者に確認していますが、\u003c/a\u003eたぶんBabel側が正しい挙動をしてそう\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"自分のappソースをtypescriptで書けない問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%88%86%E3%81%AEapp%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92typescript%E3%81%A7%E6%9B%B8%E3%81%91%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自分のAppソースをTypeScriptで書けない問題\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"http://www.typescriptlang.org/\"\u003eTypeScript\u003c/a\u003e 1.5-alphaでdecorator構文をコンパイルしたとき問題発生\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e--blacklist strict\u003c/code\u003eしないとTypeScriptが出力する\u003ccode\u003ethis.__decorator\u003c/code\u003eが\u003ccode\u003eundefined\u003c/code\u003eに置き換えられてしまう（参考: \u003ca href=\"https://babeljs.io/docs/faq/\"\u003eFAQ Why is this being remapped to undefined?\u003c/a\u003e）\u003c/li\u003e\n\u003cli\u003e根本的に前節『constructorがdecoratorにならない件』で落ちるから関係無かった\u003c/li\u003e\n\u003cli\u003e\n\u003cdel\u003eAtScriptはTypeScriptになりまぁす!\u003c/del\u003eこの件どうなってる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"自分のappソースをes6--babelで書けない問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%88%86%E3%81%AEapp%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92es6--babel%E3%81%A7%E6%9B%B8%E3%81%91%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自分のAppソースをes6 + Babelで書けない問題\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e『constructorがdecoratorにならない件』がやっぱり問題になる\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/shuhei/babel-plugin-angular2-at-annotation\"\u003ebabel-plugin-angular2-at-annotation\u003c/a\u003eを用いて\u003ccode\u003ebabel --plugins angular2-at-annotation --optional es7.decorators\u003c/code\u003eだと、なんとかコンパイルできる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"zonejsがbrowserifyに対応してない問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#zonejs%E3%81%8Cbrowserify%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%97%E3%81%A6%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ezone.jsがBrowserifyに対応してない問題\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/angular/zone.js/\"\u003ezone.js\u003c/a\u003e何者ですか\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ewindow.zone\u003c/code\u003eに対してグローバルに格納するので\u003ca href=\"http://browserify.org/\"\u003eBrowserify\u003c/a\u003eお手上げ\u003c/li\u003e\n\u003cli\u003e百歩譲って\u003ccode\u003e\u0026lt;script src=\"zone.js\"\u0026gt;\u0026lt;/script\u0026gt;\u003c/code\u003eにしたくてもbower非対応なので泥臭く手で記入\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/thlorenz/browserify-shim\"\u003ebrowserify-shim\u003c/a\u003eを使えばいけるかもしれないが、このライブラリ更新が止まっているのでもう避けたい\u003c/li\u003e\n\u003cli\u003eソースを読んだところ、\u003ca href=\"https://github.com/angular/zone.js/pull/73\"\u003eグローバル変数化のバグ\u003c/a\u003eを取り除けば動きそう\n\n\u003cul\u003e\n\u003cli\u003e手元の修正では動いたので、様子を見ながらPRを検討中\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結果大惨敗\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C%E5%A4%A7%E6%83%A8%E6%95%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果、大惨敗\u003c/h1\u003e\n\n\u003cp\u003eBabel + Browserifyで\u003ccode\u003ebootstrap()\u003c/code\u003eするところまで進めたものの、最後の最後で\u003ccode\u003ezone.js\u003c/code\u003e内のpromiseで落ちて原因が全く分からなかったので、この時点で挫折しました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"angular-2で遊びたいんだけど\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular-2%E3%81%A7%E9%81%8A%E3%81%B3%E3%81%9F%E3%81%84%E3%82%93%E3%81%A0%E3%81%91%E3%81%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngular 2で遊びたいんだけど\u003c/h1\u003e\n\n\u003cp\u003eご安心ください! そんなチャレンジャーな貴方のために、\u003ca href=\"/shuhei\" class=\"user-mention\" title=\"shuhei\"\u003e@shuhei\u003c/a\u003e先生によって\u003ca href=\"https://github.com/shuhei/babel-angular2-app\"\u003ehttps://github.com/shuhei/babel-angular2-app\u003c/a\u003eというスケルトンが作成されました!（全て克服されていて感動しました）\u003c/p\u003e\n\n\u003cp\u003eQiitaの『\u003ca href=\"http://qiita.com/shuhei/items/9764df592f8aeede75bf\"\u003eAngular 2 を試してみた感想とハマりどころ\u003c/a\u003e』も必読かと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"宣伝\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%A3%E4%BC%9D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e宣伝\u003c/h1\u003e\n\n\u003cp\u003eここで宣伝です。2015年4月29日に開催される\u003ca href=\"http://www.zusaar.com/event/6007003\"\u003eGDGKobe Angular勉強会#3\u003c/a\u003eでは、ちょっと早すぎる?Angular 2の導入法や、Angular 2 alphaで実際に動作するアプリケーションのサンプル（今作ってる）、これからAngular 1.3|1.4を使う我々にできることは何か、といったセッションを担当します。上のような険しい話は避けますが、中級者〜上級者にご満足いただける内容にするため果敢に体当たりを繰り返しているところです。\u003c/p\u003e\n\n\u003cp\u003e神戸ではありますが、ご興味がありましたら是非!\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに感想\u003c/h1\u003e\n\n\u003cp\u003e自力でHelloもできず、最終的に破棄してshuheiさんのスケルトンを使うまでに丸一日を費やした。ロトのしるし取るために毒沼を何往復もして死んだ感じです。\u003c/p\u003e\n\n\u003cp\u003e半年後に起こして。\u003c/p\u003e\n","body":"「まだ早い!!」\n\n@armorik83です。時間ができたので[ng-japan](http://ngjapan.org/)終了後、ようやくAngular 2を触ることができました。導入が想像以上にきつく、ES6やコンパイルといった昨今のJS事情に詳しくなければ、alpha段階で触るのは避けたほうがいい、というのが現段階での印象です。\n\n足を踏み入れたのが早すぎるだけで、時間が解決するものだと思っています。\n\n（150415追記: かなり解決されてきたので書きました → [どうしても今Angular 2 with Babelを触ってみたい人のためのビルドスクリプト](http://qiita.com/armorik83/items/7ece9e035536a6b230f9)）\n\n# 何が険しいか\n文章化する体力が残されていないので箇条書きで。\n\n## traceur-compiler\n- `npm i angular2`して落ちてくる[Angular 2](https://github.com/angular/angular)のJavaScriptソースがすべて[traceur-compiler](https://github.com/google/traceur-compiler/wiki/Getting-Started)のランタイムに依存している\n  - すでにES5化されているため[Babel](https://babeljs.io/)は使えない\n  - Babel使いとしては、これは不採用\n  - [https://github.com/angular/quickstart](https://github.com/angular/quickstart)は遅いらしい（試してすらいない）\n  - [systemjs](https://github.com/systemjs/systemjs)の話全然聞かない\n\n## node_modules内をコンパイルしてしまうのか問題\n- `./node_modules/angular2/es6/dev/`にtraceur-compiler適用前のソースが入っている\n  - 理屈ではこのソースをBabelでコンパイルすれば動く（はず）\n  - node_modules内を変換するという抵抗感\n  - Angular 2実装内に相対パスではなく、node_modules基準`from 'angular2/foobar'`のパス表記があるため、単純なコンパイルではリンク切れを起こす\n\n## babel --blacklist useStrict\n- [eval問題](https://github.com/angular/angular/blob/6c60c3e547a66222c1a569118e294e4df72ac8c5/modules/angular2/src/change_detection/parser/ast.js#L5)\n  - ~~まさかの実装内`eval()`使用と、`\"use strict\"`必須にしてくるBabelが相性最悪~~\n  - 正しくは「strict下で予約語扱いのevalをAngular 2側がメソッド名に使っていたためBabelの`'use strict'`とバッティングする」でした\n  - Babelの`--blacklist useStrict`で[回避可能](https://github.com/babel/babel/issues/388)\n- 命名に`eval`を用いたことにいい印象は無いが、一応validなためBabel側のバグ\n  - @shuhei さんによって[Issue](https://github.com/babel/babel/issues/1232)が立てられた（ありがとうございます）\n  - [即座に直った](https://github.com/babel/babel/commit/edc2cd320c92a7322d264a086172d89b31bad1fa)\n\n## constructorがdecoratorにならない件\n- Angular 2において`@Component()`というアノテーション (decorator) で使われている`Component`は[class constructorなため](https://github.com/angular/angular/blob/dbffa88dc2ba6ab49c706c6fe1e5dcb0f3b19ed9/modules/angular2/src/core/annotations/annotations.js#L483)Babelのランタイム`_classCallCheck()`で落ちる\n  - `_classCallCheck()`とは「`constructor`は常に`new`を付けて呼べ」と怒るためのチェック\n  - `constructor`を直接decorator利用しているため怒られる\n  - [ダメ元でBabel開発者に確認していますが、](https://github.com/babel/babel/issues/1218)たぶんBabel側が正しい挙動をしてそう\n\n## 自分のAppソースをTypeScriptで書けない問題\n- [TypeScript](http://www.typescriptlang.org/) 1.5-alphaでdecorator構文をコンパイルしたとき問題発生\n  - `--blacklist strict`しないとTypeScriptが出力する`this.__decorator`が`undefined`に置き換えられてしまう（参考: [FAQ Why is this being remapped to undefined?](https://babeljs.io/docs/faq/)）\n  - 根本的に前節『constructorがdecoratorにならない件』で落ちるから関係無かった\n  - ~~AtScriptはTypeScriptになりまぁす!~~この件どうなってる\n\n## 自分のAppソースをes6 + Babelで書けない問題\n- 『constructorがdecoratorにならない件』がやっぱり問題になる\n  - [babel-plugin-angular2-at-annotation](https://github.com/shuhei/babel-plugin-angular2-at-annotation)を用いて`babel --plugins angular2-at-annotation --optional es7.decorators`だと、なんとかコンパイルできる\n\n## zone.jsがBrowserifyに対応してない問題\n- [zone.js](https://github.com/angular/zone.js/)何者ですか\n  - `window.zone`に対してグローバルに格納するので[Browserify](http://browserify.org/)お手上げ\n  - 百歩譲って`\u003cscript src=\"zone.js\"\u003e\u003c/script\u003e`にしたくてもbower非対応なので泥臭く手で記入\n  - [browserify-shim](https://github.com/thlorenz/browserify-shim)を使えばいけるかもしれないが、このライブラリ更新が止まっているのでもう避けたい\n  - ソースを読んだところ、[グローバル変数化のバグ](https://github.com/angular/zone.js/pull/73)を取り除けば動きそう\n      - 手元の修正では動いたので、様子を見ながらPRを検討中\n\n# 結果、大惨敗\nBabel + Browserifyで`bootstrap()`するところまで進めたものの、最後の最後で`zone.js`内のpromiseで落ちて原因が全く分からなかったので、この時点で挫折しました。\n\n# Angular 2で遊びたいんだけど\nご安心ください! そんなチャレンジャーな貴方のために、@shuhei先生によって[https://github.com/shuhei/babel-angular2-app](https://github.com/shuhei/babel-angular2-app)というスケルトンが作成されました!（全て克服されていて感動しました）\n\nQiitaの『[Angular 2 を試してみた感想とハマりどころ](http://qiita.com/shuhei/items/9764df592f8aeede75bf)』も必読かと思います。\n\n# 宣伝\nここで宣伝です。2015年4月29日に開催される[GDGKobe Angular勉強会#3](http://www.zusaar.com/event/6007003)では、ちょっと早すぎる?Angular 2の導入法や、Angular 2 alphaで実際に動作するアプリケーションのサンプル（今作ってる）、これからAngular 1.3|1.4を使う我々にできることは何か、といったセッションを担当します。上のような険しい話は避けますが、中級者〜上級者にご満足いただける内容にするため果敢に体当たりを繰り返しているところです。\n\n神戸ではありますが、ご興味がありましたら是非!\n\n# さいごに感想\n自力でHelloもできず、最終的に破棄してshuheiさんのスケルトンを使うまでに丸一日を費やした。ロトのしるし取るために毒沼を何往復もして死んだ感じです。\n\n半年後に起こして。\n","coediting":false,"created_at":"2015-04-11T00:27:28+09:00","id":"d4ef1f60b8b6a34f3cd5","private":false,"tags":[{"name":"AngularJS","versions":["2.0.0-alpha.18"]},{"name":"angular","versions":["2.0.0-alpha.18"]}],"title":"Angular 2 alpha.18に挑んだら想像以上に険しかった","updated_at":"2015-04-15T22:26:50+09:00","url":"http://qiita.com/armorik83/items/d4ef1f60b8b6a34f3cd5","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003eこんにちは、\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。皆さん、\u003ca href=\"http://gruntjs.com/\"\u003eGrunt\u003c/a\u003e / \u003ca href=\"http://gulpjs.com/\"\u003egulp\u003c/a\u003e使ってますか。おなじみなので、ここでは説明はしません。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eこの記事の要点\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eなぜGrunt / gulpは憔悴に至るのか、\u003ca href=\"http://qiita.com/armorik83/items/0860dc097d11f18b9973#%E7%B5%8C%E7%B7%AF\"\u003e経緯\u003c/a\u003eと\u003ca href=\"http://qiita.com/armorik83/items/0860dc097d11f18b9973#%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e問題点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/armorik83/items/0860dc097d11f18b9973#npm-run-script%E5%AE%8C%E7%B5%90%E3%81%AB%E3%81%AF%E5%BC%B1%E3%81%95%E3%81%8C%E3%81%82%E3%82%8B\"\u003enpm run-scriptの仕組みについて\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003epackage.json\u003c/code\u003eに\u003ca href=\"http://qiita.com/armorik83/items/0860dc097d11f18b9973#npm-run-script%E3%81%AF%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A7%E3%81%82%E3%82%8B\"\u003escriptを羅列することに対する是非\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/armorik83/items/0860dc097d11f18b9973#%E6%86%94%E6%82%B4%E3%81%97%E3%81%AA%E3%81%84%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AAgulpfile%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86\"\u003eシンプルなgulpfileについての提言\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"経緯\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%8C%E7%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e経緯\u003c/h1\u003e\n\n\u003cp\u003eさて、先日このような記事が界隈で広まっていました。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://t32k.me/mol/log/npm-run-script/\"\u003eGrunt/Gulpで憔悴したおっさんの話\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこの記事については同意できるところと、そうでもないところと、両方有りました。ただ、Grunt / gulpを使っていて色々歯がゆさを感じている方は昨今増えているだろうと感じます。\u003c/p\u003e\n\n\u003cp\u003e私は長らくGruntユーザで、プロジェクトによってはそのままgulpを使うという程度でしたが、一応両方触って流れは把握しています。\u003ccode\u003eGruntfile.json\u003c/code\u003eは毎回一から書かず、頻繁に使う部分はコピペ+修正だったのですっかり秘伝のタレ化し、\u003ccode\u003edevDependencies\u003c/code\u003eも増えたまま無自覚にインストールしている状態でした。\u003c/p\u003e\n\n\u003cp\u003eここで一旦、現状の何が問題なのかまとめておきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"問題点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題点\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プラグイン開発と時代の流れに乖離が起こっている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E9%96%8B%E7%99%BA%E3%81%A8%E6%99%82%E4%BB%A3%E3%81%AE%E6%B5%81%E3%82%8C%E3%81%AB%E4%B9%96%E9%9B%A2%E3%81%8C%E8%B5%B7%E3%81%93%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプラグイン開発と時代の流れに乖離が起こっている\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"/teppeis\" class=\"user-mention\" title=\"teppeis\"\u003e@teppeis\u003c/a\u003eさんの記事『\u003ca href=\"http://teppeis.hatenablog.com/entry/2015/03/grunt-parallelize-v1.1.0\"\u003egrunt-parallelize v1.1.0リリースおよび零細OSSの継続性について\u003c/a\u003e』を読みました。\u003c/p\u003e\n\n\u003cp\u003e零細OSSの継続性についてという点が重要で、大抵のビルドツール用プラグインは「それ、元のやつでできるよ」となるため、大元のライブラリの更新速度とプラグインの更新頻度の差や、それをメンテナがどうフォローするかが問題となります。\u003c/p\u003e\n\n\u003cp\u003e具体的な例として、私が愛用している\u003ca href=\"http://www.typescriptlang.org/\"\u003eTypeScript\u003c/a\u003eのコンパイラ\u003ccode\u003etsc\u003c/code\u003eは執筆時点で\u003ccode\u003e1.5.0-alpha\u003c/code\u003eがリリースされていますが、Grunt / gulp向けのtscツールは\u003ccode\u003e1.4.1\u003c/code\u003eとなっており、もしここでツールを使いながら最新版を試したいとなると、自分でForkする必要があります（オプションにカスタムコンパイラを許容している設計なら賢い）。\u003c/p\u003e\n\n\u003cp\u003eただ、Gruntもgulpもコンパイラオプションを\u003ccode\u003e{}\u003c/code\u003e Objectで渡すため、もし新しいオプションに対するプラグイン側のサポートが後手後手になれば、そのオプションはしばらく使えないことになります。\u003c/p\u003e\n\n\u003cp\u003eプラグイン開発者が\u003ca href=\"https://github.com/babel/grunt-babel\"\u003ebabelなどのように\u003c/a\u003e大元と同じならばまだ信頼度は残っていますが、「零細」となると体力を適切に判断すべきです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e普通に元のコマンド叩いたらいいじゃんって思うんです。\u003cbr\u003e\n―― Grunt/Gulpで憔悴したおっさんの話\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"browserifyとbabelの二大巨塔が凄まじい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#browserify%E3%81%A8babel%E3%81%AE%E4%BA%8C%E5%A4%A7%E5%B7%A8%E5%A1%94%E3%81%8C%E5%87%84%E3%81%BE%E3%81%98%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBrowserifyとbabelの二大巨塔が凄まじい\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://browserify.org/\"\u003eBrowserify\u003c/a\u003eも\u003ca href=\"https://babeljs.io/\"\u003ebabel\u003c/a\u003eもおなじみになりました。Webデザイン制作の現場は分かりませんが、フロントエンドで「まだGrunt? もうgulpでしょ」みたいに言われた時代はもはや過去のもので、この二大巨塔前提のビルドが増えました（\u003ca href=\"http://webpack.github.io/\"\u003ewebpack\u003c/a\u003eは個人の観測範囲ではあまり見てない）。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/substack/watchify\"\u003ewatchify\u003c/a\u003eや\u003ca href=\"https://github.com/babel/babelify\"\u003ebabelify\u003c/a\u003eといった関連ツールの登場を見ると、Grunt|gulpして更にwatchifyでbabelifyして…というのは、2段構えで冗長に感じます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"npm-run-scriptには課題がある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-run-script%E3%81%AB%E3%81%AF%E8%AA%B2%E9%A1%8C%E3%81%8C%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm run-scriptには課題がある\u003c/h2\u003e\n\n\u003cp\u003e今回記事を書こうと思った理由。\u003ccode\u003epackage.json\u003c/code\u003eの\u003ccode\u003escripts\u003c/code\u003e→\u003ccode\u003enpm run\u003c/code\u003eに全幅の信頼を寄せてはいけません。\u003c/p\u003e\n\n\u003cp\u003e冒頭に引用した記事にはこうあります。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eということで、npmで元のコマンド叩いたら皆しあわせってことでnpm run-script使おうぜって話。そんな難しいことはないです。基本的には各コマンドをpackage.jsonに記述していくだけです。\u003cbr\u003e\n―― Grunt/Gulpで憔悴したおっさんの話\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこの点が本題なので次に進みます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"npm-run-script完結には弱さがある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-run-script%E5%AE%8C%E7%B5%90%E3%81%AB%E3%81%AF%E5%BC%B1%E3%81%95%E3%81%8C%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm run-script完結には弱さがある\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"その出力黒い画面と一緒と思っていませんか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E5%87%BA%E5%8A%9B%E9%BB%92%E3%81%84%E7%94%BB%E9%9D%A2%E3%81%A8%E4%B8%80%E7%B7%92%E3%81%A8%E6%80%9D%E3%81%A3%E3%81%A6%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその出力、黒い画面と一緒と思っていませんか\u003c/h2\u003e\n\n\u003cp\u003e今回run-scriptに弱さを感じたのは、OS X Terminal.appでの出力とrun-scriptの出力に差異が出た点でした（そんなの当たり前だよと思われた方は、読み飛ばしてください）。\u003c/p\u003e\n\n\u003cp\u003eそもそもrun-scriptって何をしているんでしょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"npm-run-scriptの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-run-script%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm run-scriptの実装\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003enpm\u003c/code\u003eもJavaScriptで書かれた1ライブラリですから、読んでしまうのが早いです。読んだものは\u003ca href=\"https://github.com/npm/npm/tree/29039e12411fed3ffb8dbc2c02ba38695b01374a\"\u003enpm 2.7.5 29039e1241\u003c/a\u003eです。検証環境は\u003ccode\u003eio.js 1.6.2\u003c/code\u003e。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003espawn.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003e_spawn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"child_process\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003espawn\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventEmitter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"events\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eEventEmitter\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003espawn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecmd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eraw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e_spawn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecmd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ecooked\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventEmitter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eどうやら、生の\u003ccode\u003espawn\u003c/code\u003eを叩いてるのは\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/spawn.js#L7\"\u003espawn.js#L7\u003c/a\u003eです。callerは誰でしょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elifecycle.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003espawn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"./spawn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L6\"\u003elifecycle.js#L6\u003c/a\u003eに\u003ccode\u003erequire\u003c/code\u003eがいました。さらに親を辿るとスタックトレースを読む限り、次のようになっています。詳細は読み飛ばしてます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e_tickCallback\u003c/code\u003e（\u003ca href=\"https://github.com/iojs/io.js/blob/v1.x/src/node.js#L331\"\u003eたぶんこの辺\u003c/a\u003e）\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/run-script.js#L73\"\u003erun-script.js#L73\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/npm/read-package-json\"\u003eread-json.js\u003c/a\u003eがなんか色々やってる\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/run-script.js#L140\"\u003erun-script.js#L140\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L26\"\u003elifecycle.js#L26\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003elifecycle.jsがかなり色々やってる\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L70\"\u003elifecycle.js#L70\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L180\"\u003elifecycle.js#L180\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L207\"\u003elifecycle.js#L207\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/spawn.js#L7\"\u003espawn.js#L7\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e到着。お疲れ様でした。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"shellはshに固定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#shell%E3%81%AFsh%E3%81%AB%E5%9B%BA%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSHELLはshに固定\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L198-L207\"\u003elifecycle.jsL198-L207\u003c/a\u003eが面白いです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elifecycle.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  \u003cspan class=\"c1\"\u003e// ... \u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003esh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"sh\"\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eshFlag\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"-c\"\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eplatform\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"win32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003esh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecomspec\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cmd\"\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eshFlag\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/c\"\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewindowsVerbatimArguments\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eproc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003espawn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eshFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecmd\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nx\"\u003econf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003evar sh = \"sh\"\u003c/code\u003eで決め打ちなんですね。Windows環境下のみ\u003ccode\u003esh = process.env.comspec || \"cmd\"\u003c/code\u003eとなっていますが、Mac環境下では\u003ccode\u003esh\u003c/code\u003eを変える方法は見つかりませんでした。\u003c/p\u003e\n\n\u003cp\u003e結論として、\u003ccode\u003enpm run-script\u003c/code\u003eは常に\u003ccode\u003esh\u003c/code\u003eで実行されるため、私のようにTerminal.appでは\u003ccode\u003ezsh\u003c/code\u003eを使っていると出力が異なることが稀に起こるようです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"何が問題だったか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e何が問題だったか\u003c/h3\u003e\n\n\u003cp\u003e具体的には、私の場合\u003ccode\u003e/**/*.js\u003c/code\u003eというアスタリスク2つのワイルドカード\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"globstarというようです。（thx @laco0416さん）\"\u003e1\u003c/a\u003e\u003c/sup\u003eを用いて、この解釈が\u003ccode\u003esh\u003c/code\u003eと\u003ccode\u003ezsh\u003c/code\u003eで異なることでBrowserifyに渡るソースに違いが出たため、何度やっても必要なソースが結合されないという現象が起こりました。（これだけで2時間くらいハマった）\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"child_processについて補足\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#child_process%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%A3%9C%E8%B6%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003echild_processについて補足\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback\"\u003enode.js child_process.exec\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options\"\u003enode.js child_process.spawn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://iojs.org/api/child_process.html#child_process_child_process_exec_command_options_callback\"\u003eio.js child_process.exec\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://iojs.org/api/child_process.html#child_process_child_process_spawn_command_args_options\"\u003eio.js child_process.spawn\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eどうやら\u003ccode\u003eexec\u003c/code\u003eでは\u003ccode\u003eoptions\u003c/code\u003e引数に\u003ccode\u003e{shell: '/bin/zsh'}\u003c/code\u003eとすることで変えられるようです。しかし、なぜか\u003ccode\u003espawn\u003c/code\u003eのオプション仕様には\u003ccode\u003eshell\u003c/code\u003eが含まれていません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eexec.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eexec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'child_process'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'echo {a..z}'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/bin/sh'\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'sh'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'echo {a..z}'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/bin/bash'\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'bash'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'echo {a..z}'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/bin/zsh'\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'zsh'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eTerminal.app\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003enode exec.js\nbash\na b c d e f g h i j k l m n o p q r s t u v w x y z\n\nsh\na b c d e f g h i j k l m n o p q r s t u v w x y z\n\nzsh\n\u003cspan class=\"o\"\u003e{\u003c/span\u003ea..z\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"default-shellと揃える-いややめておこう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#default-shell%E3%81%A8%E6%8F%83%E3%81%88%E3%82%8B-%E3%81%84%E3%82%84%E3%82%84%E3%82%81%E3%81%A6%E3%81%8A%E3%81%93%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edefault shellと揃える? いや、やめておこう\u003c/h3\u003e\n\n\u003cp\u003eこれらのことから、直接\u003ccode\u003echild_process.exec\u003c/code\u003eしてoptionsを渡せばたしかにTerminal.appとnode上の処理を揃えることはできます。しかし\u003ccode\u003ezsh\u003c/code\u003eが入っていることを前提に書くのはどうも抵抗が大きく、明らかにJavaScriptビルドの守備範囲を超えています。\u003c/p\u003e\n\n\u003cp\u003ebash依存でWindowsを放置している点は周りを見てもやむを得ない感じですが、zsh依存は不採用とします。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"npm-run-scriptはインタフェースである\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-run-script%E3%81%AF%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A7%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm run-scriptはインタフェースである\u003c/h2\u003e\n\n\u003cp\u003e以前、\u003ca href=\"/Jxck_\" class=\"user-mention\" title=\"Jxck_\"\u003e@Jxck_\u003c/a\u003eさんの記事『\u003ca href=\"http://qiita.com/Jxck_/items/efaff21b977ddc782971\"\u003enpm で依存もタスクも一元化する\u003c/a\u003e』を読み、run-scriptは有用だが\u003ca href=\"http://qiita.com/Jxck_/items/efaff21b977ddc782971#%E3%82%BF%E3%82%B9%E3%82%AF%E8%87%AA%E4%BD%93%E3%81%AF%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%84\"\u003eタスク自体は書かない\u003c/a\u003eという話にとても賛同していました。これを読んだ頃にちょうどTwitterでやりとりをしていました。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\" lang=\"en\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/armorik83\"\u003e@armorik83\u003c/a\u003e \u003ca href=\"https://twitter.com/Jxck_\"\u003e@Jxck_\u003c/a\u003e さきほどの Tweet は言葉足らずでしたね。正確には \"npm run の弊害\" ではなく \"npm run のみでやるときの弊害\" でした。 Jxck さんのやり方は統一的なインターフェイスになるので良いと思います。\u003c/p\u003e— Takuto Wada (\u003ca href=\"/t_wada\" class=\"user-mention\" title=\"t_wada\"\u003e@t_wada\u003c/a\u003e) \u003ca href=\"https://twitter.com/t_wada/status/555910181721079809\"\u003eJanuary 16, 2015\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\n\n\u003cp\u003eこの\u003ca href=\"/t_wada\" class=\"user-mention\" title=\"t_wada\"\u003e@t_wada\u003c/a\u003eさんの「統一的なインターフェイス」という表現がとても印象的で、冒頭の記事を読んだときに持った違和感もこの感覚の差からきていました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ビルド途中の個別処理にアクセスさせるべきではない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E9%80%94%E4%B8%AD%E3%81%AE%E5%80%8B%E5%88%A5%E5%87%A6%E7%90%86%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%95%E3%81%9B%E3%82%8B%E3%81%B9%E3%81%8D%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビルド途中の個別処理にアクセスさせるべきではない\u003c/h3\u003e\n\n\u003cp\u003e冒頭の記事では18行に及ぶ\u003ccode\u003escripts\u003c/code\u003eが定義されていますが、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epackage.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\"build:js\": \"browserify assets/scripts/app.js \u0026gt; public/files/js/app.js\",\n\"build:css\": \"bin/build-css.sh\",\n\"build\": \"npm run build:js \u0026amp;\u0026amp; npm run build:css\",\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eのように、幾つかは\u003ccode\u003enpm run\u003c/code\u003eを叩くハイレベル、幾つかはコマンドを直接叩くローレベルの処理を定義しています。\u003ccode\u003e.sh\u003c/code\u003eも実行しています。\u003c/p\u003e\n\n\u003cp\u003e個人で管理する分にはまだしも、見ず知らずの人間がForkやPRを検討したときを考えるとこれはあまり美しいとは感じません。ここは処理の玄関として、\u003ccode\u003e\"build\": \"gulp build\"\u003c/code\u003e やはりこうしておきたいものです。\u003ccode\u003e$(npm bin)/gulp build:js\u003c/code\u003eすれば途中を実行できてしまいますが、大玄関としての\u003ccode\u003epackage.json\u003c/code\u003eは整頓しておきたい、という意図です。\u003c/p\u003e\n\n\u003cp\u003e個人管理の面でも、ディレクトリ操作の多いビルド処理ではjsonは変数が使えないため、DRYの観点から不安が残ります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"憔悴しないシンプルなgulpfileを作ろう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%86%94%E6%82%B4%E3%81%97%E3%81%AA%E3%81%84%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AAgulpfile%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e憔悴しないシンプルなgulpfileを作ろう\u003c/h1\u003e\n\n\u003cp\u003e以上のことから、\u003ccode\u003esh\u003c/code\u003eの種類で微妙な差異が生まれることを回避し、\u003ccode\u003epackage.json\u003c/code\u003e玄関に大量の\u003ccode\u003escripts\u003c/code\u003eを並べずに「シンプルなgulpfileを作ろう」というのが今回の提言です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"gulpfilejs\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gulpfilejs\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egulpfile.js\u003c/h2\u003e\n\n\u003cp\u003e今回Grunt卒業からgulp本格導入を決めて最初に書いた\u003ccode\u003egulpfile.js\u003c/code\u003eです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/crescware/cw-modal/blob/86a6d2332ccacf1f46e1f68a858565a249450d4b/gulpfile.js\"\u003ehttps://github.com/crescware/cw-modal/blob/86a6d2332ccacf1f46e1f68a858565a249450d4b/gulpfile.js\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"import\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#import\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eimport\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egulpfile.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003edel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'del'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eespower\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'gulp-espower'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eglob\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'glob'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003egulp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'gulp'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eseq\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'run-sequence'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eshell\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'gulp-shell'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eほぼgulpプラグインを使っていません。\u003ccode\u003egulp-espower\u003c/code\u003eと\u003ccode\u003egulp-shell\u003c/code\u003eのみ、あとは関連ツールとして\u003ccode\u003edel\u003c/code\u003e, \u003ccode\u003eglob\u003c/code\u003e, \u003ccode\u003erun-sequence\u003c/code\u003eです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"opt\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#opt\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eopt\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egulpfile.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eopt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eexample\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e       \u003cspan class=\"s1\"\u003e'./example'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e           \u003cspan class=\"s1\"\u003e'./lib'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e          \u003cspan class=\"s1\"\u003e'./test'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etestEs5\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e       \u003cspan class=\"s1\"\u003e'./test-es5'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etestEspowered\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'./test-espowered'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eディレクトリを定義しています。こういうのは\u003ccode\u003epackage.json\u003c/code\u003e内ではできません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"clean\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#clean\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eclean\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egulpfile.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cm\"\u003e/* clean */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'clean'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/**/*.js'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/**/*.js.map'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/**/*.js'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/**/*.js.map'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etestEs5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etestEspowered\u003c/span\u003e\n\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ecleanには\u003ccode\u003edel\u003c/code\u003eが便利。『\u003ca href=\"http://qiita.com/shinnn/items/bd7ad79526eff37cebd0\"\u003eファイル削除にはgulpプラグインを使わない\u003c/a\u003e』を参考にしました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"compile-convert\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#compile-convert\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecompile, convert\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egulpfile.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cm\"\u003e/* ts */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003etsc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'tsc -m commonjs -t es6 --noImplicitAny'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts:example_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ets\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003exargs\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003etsc\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts:lib_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e     \u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e     \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ets\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003exargs\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003etsc\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts:example'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eseq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'clean'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ts:example_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)});\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts:lib'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e     \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eseq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'clean'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ts:lib_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)});\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e         \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eseq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'clean'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts:lib_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ts:example_'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)});\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* babel */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'babel:example'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003ebabel\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003eout\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003edir\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'babel:lib'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e     \u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003ebabel\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e     \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003eout\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003edir\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'babel:test'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e    \u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003ebabel\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e    \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003eout\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003edir\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etestEs5\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'babel'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'babel:example'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'babel:lib'\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e動作例と\u003ccode\u003ee2e\u003c/code\u003eのために使う\u003ccode\u003e/example\u003c/code\u003eと、ライブラリ本体の\u003ccode\u003e/lib\u003c/code\u003eは分けて定義してから、ラッパー・タスクを用意しています。順序が前後して\u003ccode\u003ets\u003c/code\u003eしたあと\u003ccode\u003eclean\u003c/code\u003eが実行されないように\u003ccode\u003erun-sequence\u003c/code\u003e（ここでは\u003ccode\u003eseq()\u003c/code\u003e）を利用します。\u003c/p\u003e\n\n\u003cp\u003e現行のio.jsならば\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/template_strings\"\u003eTemplate Strings\u003c/a\u003eが使えるので、今回は自分用としてお構いなしに使っていますが、nodeを使う事情がある場合は先に\u003ccode\u003egulpfile.js\u003c/code\u003eをバベってしまうか、\u003ccode\u003e'おとなしく' + '結合を使ったほうが'\u003c/code\u003eいいでしょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"browserify\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#browserify\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBrowserify\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egulpfile.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cm\"\u003e/* browserify */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eglobToBrowserify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebundler\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003everbose\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebundler\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s1\"\u003e'watchify'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s1\"\u003e'-v'\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ep\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eglob\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"cm\"\u003e/**/\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eshell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ebundler\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ep\u003c/span\u003e \u003cspan class=\"nx\"\u003elicensify\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebundle\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003everbose\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e])();\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'watchify_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"nx\"\u003eglobToBrowserify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'watchify'\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'browserify_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eglobToBrowserify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'browserify'\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'watchify'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eseq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'babel'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'watchify_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)});\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'browserify'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eseq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'babel'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'browserify_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ewatchify\u003c/code\u003eもここで定義しています。\u003ccode\u003ezsh\u003c/code\u003eと\u003ccode\u003esh\u003c/code\u003eの\u003ccode\u003e/**\u003c/code\u003eの解釈の違いは\u003ccode\u003eglob\u003c/code\u003eで埋めています。該当したファイル名の配列を文字列にまとめてBrowserify|watchifyに与えます。Browserifyとwatchifyのコマンドの微妙な差は\u003ccode\u003eglobToBrowserify()\u003c/code\u003e関数を作って解決しました。\u003cdel\u003eBrowserify pluginは、なぜかどう頑張っても動かなかったので今回は除外しています。\u003c/del\u003e（150405追記: Browserify側の仕様変更に対応されたので復活しました。）\u003c/p\u003e\n\n\u003cp\u003eあとは\u003ccode\u003eglob()\u003c/code\u003eがthenableなら最高だった。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"watch\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#watch\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ewatch\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egulpfile.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cm\"\u003e/* watch */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'watch'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'watchify'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ts'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewatch\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"cm\"\u003e/**/\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ets\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"cm\"\u003e/**/\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ets\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts'\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ewatch\u003c/code\u003eもシンプルにいきます。\u003ccode\u003ewatchify\u003c/code\u003eは前のタスクですでに起動しているので、\u003ccode\u003egulp.watch\u003c/code\u003e対象は\u003ccode\u003ets\u003c/code\u003eのみです。\u003ccode\u003esass\u003c/code\u003eや\u003ccode\u003eless\u003c/code\u003eがあればここに追記するといいでしょう（実際WebStormが\u003ccode\u003ets\u003c/code\u003eを逐一コンパイルしてくれるので、本当はこれすらいらない）\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"test\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#test\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etest\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egulpfile.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cm\"\u003e/* test */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'espower'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etestEs5\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"cm\"\u003e/**/\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e\u003cspan class=\"err\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eespower\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eopt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etestEspowered\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"nx\"\u003egulp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'test'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eseq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ts:lib_'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'babel:lib'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'babel:test'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"s1\"\u003e'espower'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e)});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eここではテスト前ビルドに留めています。テストは全てES6で書き、\u003ca href=\"https://github.com/twada/power-assert\"\u003epower-assert\u003c/a\u003eのために、babel, espowerを通しています。\u003ccode\u003eespower\u003c/code\u003e出力は\u003ccode\u003emocha\u003c/code\u003eにやらせる手もあるのですが、色々自分には馴染まなかったのでこうしました。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eこの例は規模の小さめな単品ライブラリに対してなので、\u003ccode\u003eexpress\u003c/code\u003eと\u003ccode\u003eangular\u003c/code\u003e両方の面倒を見るWebアプリケーション…となると膨れますが、「プラグイン依存と更新頻度を警戒しながらシンプルに」という理念は変えずにやりたいです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"packagejson\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#packagejson\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epackage.json\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/crescware/cw-modal/blob/86a6d2332ccacf1f46e1f68a858565a249450d4b/package.json\"\u003ehttps://github.com/crescware/cw-modal/blob/86a6d2332ccacf1f46e1f68a858565a249450d4b/package.json\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epackage.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cw-modal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"dependencies\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"angular\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"1.3.15\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"bluebird\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^2.9.24\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"angular-route\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"1.3.15\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"babel\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^5.0.8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"browserify\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^9.0.7\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"del\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^1.1.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"dtsm\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^0.9.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"glob\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^5.0.3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"gulp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^3.8.11\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"gulp-espower\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^0.10.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"gulp-shell\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^0.4.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"licensify\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^1.1.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"mocha\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^2.1.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"power-assert\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^0.10.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"run-sequence\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^1.0.2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"superstatic\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^2.0.2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"testium\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^2.6.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"typescript\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"1.4.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"watchify\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"^3.1.0\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"browserify\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"gulp browserify\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"gulp build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"dtsm\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"dtsm install\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"e2e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"gulp test \u0026amp;\u0026amp; mocha ./test-espowered/e2e/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"start\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cd example \u0026amp;\u0026amp; ss --port 8080 --debug true\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"gulp test \u0026amp;\u0026amp; mocha ./test-espowered/unit/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"watch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"gulp watch\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e見本用に簡略化しています。何をするにも用意していた\u003ccode\u003egrunt-*\u003c/code\u003eは12個減り、代わりに増えた\u003ccode\u003egulp-*\u003c/code\u003eは2個だけです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003escripts\u003c/code\u003eはテスト用の2種だけ\u003ccode\u003e\u0026amp;\u0026amp; mocha\u003c/code\u003eして、開発用サーバの起動に\u003ccode\u003ecd example \u0026amp;\u0026amp; ss\u003c/code\u003eしているものの、残りはgulpに投げました。mochaはgulpで実行するとログ出力に一切色が付かなかったため妥協。\u003c/p\u003e\n\n\u003cp\u003e結果として\u003ccode\u003edevDependencies\u003c/code\u003eの一つ一つの役割は明確になり、今後の取捨選択もしやすいスリムさに。他のプロジェクトも徐々にGruntからgulpに移行していけると確信を持ちました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"追記streamを活かせてない件と釈明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%BD%E8%A8%98stream%E3%82%92%E6%B4%BB%E3%81%8B%E3%81%9B%E3%81%A6%E3%81%AA%E3%81%84%E4%BB%B6%E3%81%A8%E9%87%88%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e（追記）streamを活かせてない件と釈明\u003c/h1\u003e\n\n\u003cp\u003eGruntを使っていた時間が長いので、gulpの利点であるstreamを活かしきれておらず\u003ccode\u003etsc -\u0026gt; es6 -\u0026gt; babel -\u0026gt; js -\u0026gt; Browserify\u003c/code\u003eなことになっている点は疑問に思われた方もいるかもしれません。\u003c/p\u003e\n\n\u003cp\u003eこれについての釈明としては、WebStormが\u003ccode\u003e.ts\u003c/code\u003eの保存時に勝手にコンパイルしてしまうので、出力された\u003ccode\u003e.js\u003c/code\u003eを拾う必要があったのと、テスト時にsourcemapを出していない理由で中間ファイルの行番号を確認する必要があるからです。（…本当はgulpの良さに気付いてないだけです）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"あとがき\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eあとがき\u003c/h1\u003e\n\n\u003cp\u003eここまでお疲れさまです。余すところなく出すつもりで書いたので、またしても長文記事になりました。正直npm run-scriptの挙動を調べている最中は私も憔悴していましたが、このgulpfileにしてから顔は引き締まって血色もよく、お肌はツヤツヤに!\u003c/p\u003e\n\n\u003cp\u003eこういった手法は何かと物議を醸しますが、常に時代に合ったシンプルさでやっていきたいものです。最後まで読んでいただき、ありがとうございました。\u003c/p\u003e\n\n\u003cp\u003eおわり!\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://t32k.me/mol/log/npm-run-script/\"\u003eMOL - Grunt/Gulpで憔悴したおっさんの話\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://yosuke-furukawa.hatenablog.com/entry/2014/02/19/112931\"\u003efrom scratch - オレ的Gruntに対する最新の気持ち\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://teppeis.hatenablog.com/entry/2015/03/grunt-parallelize-v1.1.0\"\u003eteppeis blog - grunt-parallelize v1.1.0リリースおよび零細OSSの継続性について\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/Jxck_/items/efaff21b977ddc782971\"\u003eQiita Jxck_ - npm で依存もタスクも一元化する\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/shinnn/items/bd7ad79526eff37cebd0\"\u003eQiita shinnn - ファイル削除にはgulpプラグインを使わない\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://akabeko.me/blog/2015/02/watchify/\"\u003eアカベコマイリ - watchify を試す\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/gulpjs/gulp/tree/master/docs/recipes\"\u003eGitHub - gulp recipes\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eglobstarというようです。（thx \u003ca href=\"/laco0416\" class=\"user-mention\" title=\"laco0416\"\u003e@laco0416\u003c/a\u003eさん） \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"こんにちは、@armorik83です。皆さん、[Grunt](http://gruntjs.com/) / [gulp](http://gulpjs.com/)使ってますか。おなじみなので、ここでは説明はしません。\n\n**この記事の要点**\n\n- なぜGrunt / gulpは憔悴に至るのか、[経緯](http://qiita.com/armorik83/items/0860dc097d11f18b9973#%E7%B5%8C%E7%B7%AF)と[問題点](http://qiita.com/armorik83/items/0860dc097d11f18b9973#%E5%95%8F%E9%A1%8C%E7%82%B9)\n- [npm run-scriptの仕組みについて](http://qiita.com/armorik83/items/0860dc097d11f18b9973#npm-run-script%E5%AE%8C%E7%B5%90%E3%81%AB%E3%81%AF%E5%BC%B1%E3%81%95%E3%81%8C%E3%81%82%E3%82%8B)\n- `package.json`に[scriptを羅列することに対する是非](http://qiita.com/armorik83/items/0860dc097d11f18b9973#npm-run-script%E3%81%AF%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A7%E3%81%82%E3%82%8B)\n- [シンプルなgulpfileについての提言](http://qiita.com/armorik83/items/0860dc097d11f18b9973#%E6%86%94%E6%82%B4%E3%81%97%E3%81%AA%E3%81%84%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AAgulpfile%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86)\n\n# 経緯\nさて、先日このような記事が界隈で広まっていました。\n\n\u003e [Grunt/Gulpで憔悴したおっさんの話](http://t32k.me/mol/log/npm-run-script/)\n\nこの記事については同意できるところと、そうでもないところと、両方有りました。ただ、Grunt / gulpを使っていて色々歯がゆさを感じている方は昨今増えているだろうと感じます。\n\n私は長らくGruntユーザで、プロジェクトによってはそのままgulpを使うという程度でしたが、一応両方触って流れは把握しています。`Gruntfile.json`は毎回一から書かず、頻繁に使う部分はコピペ+修正だったのですっかり秘伝のタレ化し、`devDependencies`も増えたまま無自覚にインストールしている状態でした。\n\nここで一旦、現状の何が問題なのかまとめておきます。\n\n# 問題点\n## プラグイン開発と時代の流れに乖離が起こっている\n@teppeisさんの記事『[grunt-parallelize v1.1.0リリースおよび零細OSSの継続性について](http://teppeis.hatenablog.com/entry/2015/03/grunt-parallelize-v1.1.0)』を読みました。\n\n零細OSSの継続性についてという点が重要で、大抵のビルドツール用プラグインは「それ、元のやつでできるよ」となるため、大元のライブラリの更新速度とプラグインの更新頻度の差や、それをメンテナがどうフォローするかが問題となります。\n\n具体的な例として、私が愛用している[TypeScript](http://www.typescriptlang.org/)のコンパイラ`tsc`は執筆時点で`1.5.0-alpha`がリリースされていますが、Grunt / gulp向けのtscツールは`1.4.1`となっており、もしここでツールを使いながら最新版を試したいとなると、自分でForkする必要があります（オプションにカスタムコンパイラを許容している設計なら賢い）。\n\nただ、Gruntもgulpもコンパイラオプションを`{}` Objectで渡すため、もし新しいオプションに対するプラグイン側のサポートが後手後手になれば、そのオプションはしばらく使えないことになります。\n\nプラグイン開発者が[babelなどのように](https://github.com/babel/grunt-babel)大元と同じならばまだ信頼度は残っていますが、「零細」となると体力を適切に判断すべきです。\n\n\u003e 普通に元のコマンド叩いたらいいじゃんって思うんです。\n\u003e ―― Grunt/Gulpで憔悴したおっさんの話\n\n## Browserifyとbabelの二大巨塔が凄まじい\n[Browserify](http://browserify.org/)も[babel](https://babeljs.io/)もおなじみになりました。Webデザイン制作の現場は分かりませんが、フロントエンドで「まだGrunt? もうgulpでしょ」みたいに言われた時代はもはや過去のもので、この二大巨塔前提のビルドが増えました（[webpack](http://webpack.github.io/)は個人の観測範囲ではあまり見てない）。\n\n[watchify](https://github.com/substack/watchify)や[babelify](https://github.com/babel/babelify)といった関連ツールの登場を見ると、Grunt|gulpして更にwatchifyでbabelifyして…というのは、2段構えで冗長に感じます。\n\n## npm run-scriptには課題がある\n今回記事を書こうと思った理由。`package.json`の`scripts`→`npm run`に全幅の信頼を寄せてはいけません。\n\n冒頭に引用した記事にはこうあります。\n\n\u003e ということで、npmで元のコマンド叩いたら皆しあわせってことでnpm run-script使おうぜって話。そんな難しいことはないです。基本的には各コマンドをpackage.jsonに記述していくだけです。\n\u003e ―― Grunt/Gulpで憔悴したおっさんの話\n\nこの点が本題なので次に進みます。\n\n# npm run-script完結には弱さがある\n## その出力、黒い画面と一緒と思っていませんか\n今回run-scriptに弱さを感じたのは、OS X Terminal.appでの出力とrun-scriptの出力に差異が出た点でした（そんなの当たり前だよと思われた方は、読み飛ばしてください）。\n\nそもそもrun-scriptって何をしているんでしょう。\n\n### npm run-scriptの実装\n`npm`もJavaScriptで書かれた1ライブラリですから、読んでしまうのが早いです。読んだものは[npm 2.7.5 29039e1241](https://github.com/npm/npm/tree/29039e12411fed3ffb8dbc2c02ba38695b01374a)です。検証環境は`io.js 1.6.2`。\n\n```spawn.js\n// ...\nvar _spawn = require(\"child_process\").spawn\nvar EventEmitter = require(\"events\").EventEmitter\n\nfunction spawn (cmd, args, options) {\n  var raw = _spawn(cmd, args, options)\n  var cooked = new EventEmitter()\n  // ...\n}\n```\n\nどうやら、生の`spawn`を叩いてるのは[spawn.js#L7](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/spawn.js#L7)です。callerは誰でしょう。\n\n```lifecycle.js\n// ...\nvar spawn = require(\"./spawn\")\n// ...\n```\n\n[lifecycle.js#L6](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L6)に`require`がいました。さらに親を辿るとスタックトレースを読む限り、次のようになっています。詳細は読み飛ばしてます。\n\n- `_tickCallback`（[たぶんこの辺](https://github.com/iojs/io.js/blob/v1.x/src/node.js#L331)）\n- [run-script.js#L73](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/run-script.js#L73)\n- [read-json.js](https://github.com/npm/read-package-json)がなんか色々やってる\n- [run-script.js#L140](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/run-script.js#L140)\n- [lifecycle.js#L26](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L26)\n- lifecycle.jsがかなり色々やってる\n- [lifecycle.js#L70](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L70)\n- [lifecycle.js#L180](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L180)\n- [lifecycle.js#L207](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L207)\n- [spawn.js#L7](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/spawn.js#L7)\n\n到着。お疲れ様でした。\n\n### SHELLはshに固定\n[lifecycle.jsL198-L207](https://github.com/npm/npm/blob/29039e12411fed3ffb8dbc2c02ba38695b01374a/lib/utils/lifecycle.js#L198-L207)が面白いです。\n\n```lifecycle.js\n  // ... \n  var sh = \"sh\"\n  var shFlag = \"-c\"\n\n  if (process.platform === \"win32\") {\n    sh = process.env.comspec || \"cmd\"\n    shFlag = \"/c\"\n    conf.windowsVerbatimArguments = true\n  }\n\n  var proc = spawn(sh, [shFlag, cmd], conf)\n  // ...\n```\n\n`var sh = \"sh\"`で決め打ちなんですね。Windows環境下のみ`sh = process.env.comspec || \"cmd\"`となっていますが、Mac環境下では`sh`を変える方法は見つかりませんでした。\n\n結論として、`npm run-script`は常に`sh`で実行されるため、私のようにTerminal.appでは`zsh`を使っていると出力が異なることが稀に起こるようです。\n\n### 何が問題だったか\n具体的には、私の場合`/**/*.js`というアスタリスク2つのワイルドカード[^1]を用いて、この解釈が`sh`と`zsh`で異なることでBrowserifyに渡るソースに違いが出たため、何度やっても必要なソースが結合されないという現象が起こりました。（これだけで2時間くらいハマった）\n\n### child_processについて補足\n- [node.js child_process.exec](https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback)\n- [node.js child_process.spawn](https://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options)\n- [io.js child_process.exec](https://iojs.org/api/child_process.html#child_process_child_process_exec_command_options_callback)\n- [io.js child_process.spawn](https://iojs.org/api/child_process.html#child_process_child_process_spawn_command_args_options)\n\nどうやら`exec`では`options`引数に`{shell: '/bin/zsh'}`とすることで変えられるようです。しかし、なぜか`spawn`のオプション仕様には`shell`が含まれていません。\n\n```exec.js\nvar exec = require('child_process').exec;\n\nexec('echo {a..z}', {shell: '/bin/sh'}, function(error, stdout, stderr) {\n  console.log('sh');\n  console.log(stdout);\n});\n\nexec('echo {a..z}', {shell: '/bin/bash'}, function(error, stdout, stderr) {\n  console.log('bash');\n  console.log(stdout);\n});\n\nexec('echo {a..z}', {shell: '/bin/zsh'}, function(error, stdout, stderr) {\n  console.log('zsh');\n  console.log(stdout);\n});\n```\n\n```bash:Terminal.app\n$ node exec.js\nbash\na b c d e f g h i j k l m n o p q r s t u v w x y z\n\nsh\na b c d e f g h i j k l m n o p q r s t u v w x y z\n\nzsh\n{a..z}\n```\n\n### default shellと揃える? いや、やめておこう\nこれらのことから、直接`child_process.exec`してoptionsを渡せばたしかにTerminal.appとnode上の処理を揃えることはできます。しかし`zsh`が入っていることを前提に書くのはどうも抵抗が大きく、明らかにJavaScriptビルドの守備範囲を超えています。\n\nbash依存でWindowsを放置している点は周りを見てもやむを得ない感じですが、zsh依存は不採用とします。\n\n## npm run-scriptはインタフェースである\n以前、@Jxck_さんの記事『[npm で依存もタスクも一元化する](http://qiita.com/Jxck_/items/efaff21b977ddc782971)』を読み、run-scriptは有用だが[タスク自体は書かない](http://qiita.com/Jxck_/items/efaff21b977ddc782971#%E3%82%BF%E3%82%B9%E3%82%AF%E8%87%AA%E4%BD%93%E3%81%AF%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%84)という話にとても賛同していました。これを読んだ頃にちょうどTwitterでやりとりをしていました。\n\n\u003cblockquote class=\"twitter-tweet\" lang=\"en\"\u003e\u003cp\u003e\u003ca href=\"https://twitter.com/armorik83\"\u003e@armorik83\u003c/a\u003e \u003ca href=\"https://twitter.com/Jxck_\"\u003e@Jxck_\u003c/a\u003e さきほどの Tweet は言葉足らずでしたね。正確には \u0026quot;npm run の弊害\u0026quot; ではなく \u0026quot;npm run のみでやるときの弊害\u0026quot; でした。 Jxck さんのやり方は統一的なインターフェイスになるので良いと思います。\u003c/p\u003e\u0026mdash; Takuto Wada (@t_wada) \u003ca href=\"https://twitter.com/t_wada/status/555910181721079809\"\u003eJanuary 16, 2015\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\nこの@t_wadaさんの「統一的なインターフェイス」という表現がとても印象的で、冒頭の記事を読んだときに持った違和感もこの感覚の差からきていました。\n\n### ビルド途中の個別処理にアクセスさせるべきではない\n冒頭の記事では18行に及ぶ`scripts`が定義されていますが、\n\n```text:package.json\n\"build:js\": \"browserify assets/scripts/app.js \u003e public/files/js/app.js\",\n\"build:css\": \"bin/build-css.sh\",\n\"build\": \"npm run build:js \u0026\u0026 npm run build:css\",\n```\n\nのように、幾つかは`npm run`を叩くハイレベル、幾つかはコマンドを直接叩くローレベルの処理を定義しています。`.sh`も実行しています。\n\n個人で管理する分にはまだしも、見ず知らずの人間がForkやPRを検討したときを考えるとこれはあまり美しいとは感じません。ここは処理の玄関として、`\"build\": \"gulp build\"` やはりこうしておきたいものです。`$(npm bin)/gulp build:js`すれば途中を実行できてしまいますが、大玄関としての`package.json`は整頓しておきたい、という意図です。\n\n個人管理の面でも、ディレクトリ操作の多いビルド処理ではjsonは変数が使えないため、DRYの観点から不安が残ります。\n\n# 憔悴しないシンプルなgulpfileを作ろう\n以上のことから、`sh`の種類で微妙な差異が生まれることを回避し、`package.json`玄関に大量の`scripts`を並べずに「シンプルなgulpfileを作ろう」というのが今回の提言です。\n\n## gulpfile.js\n\n今回Grunt卒業からgulp本格導入を決めて最初に書いた`gulpfile.js`です。\n\n- https://github.com/crescware/cw-modal/blob/86a6d2332ccacf1f46e1f68a858565a249450d4b/gulpfile.js\n\n### import\n\n```gulpfile.js\nvar del = require('del');\nvar espower = require('gulp-espower');\nvar glob = require('glob');\nvar gulp = require('gulp');\nvar seq = require('run-sequence');\nvar shell = require('gulp-shell');\n```\n\nほぼgulpプラグインを使っていません。`gulp-espower`と`gulp-shell`のみ、あとは関連ツールとして`del`, `glob`, `run-sequence`です。\n\n### opt\n\n```gulpfile.js\nvar opt = {\n  example:       './example',\n  lib:           './lib',\n  test:          './test',\n  testEs5:       './test-es5',\n  testEspowered: './test-espowered'\n};\n```\n\nディレクトリを定義しています。こういうのは`package.json`内ではできません。\n\n### clean\n\n```gulpfile.js\n/* clean */\ngulp.task('clean', del.bind(null, [\n  opt.example + '/**/*.js',\n  opt.example + '/**/*.js.map',\n  opt.lib + '/**/*.js',\n  opt.lib + '/**/*.js.map',\n  opt.testEs5,\n  opt.testEspowered\n]));\n```\n\ncleanには`del`が便利。『[ファイル削除にはgulpプラグインを使わない](http://qiita.com/shinnn/items/bd7ad79526eff37cebd0)』を参考にしました。\n\n### compile, convert\n\n```gulpfile.js\n/* ts */\nvar tsc = 'tsc -m commonjs -t es6 --noImplicitAny';\ngulp.task('ts:example_', shell.task([`find ${opt.example} -name *.ts | xargs ${tsc}`]));\ngulp.task('ts:lib_',     shell.task([`find ${opt.lib}     -name *.ts | xargs ${tsc}`]));\n\ngulp.task('ts:example', function(done) {seq('clean', 'ts:example_', done)});\ngulp.task('ts:lib',     function(done) {seq('clean', 'ts:lib_', done)});\ngulp.task('ts',         function(done) {seq('clean', ['ts:lib_', 'ts:example_'], done)});\n\n/* babel */\ngulp.task('babel:example', shell.task([`babel ${opt.example} --out-dir ${opt.example}`]));\ngulp.task('babel:lib',     shell.task([`babel ${opt.lib}     --out-dir ${opt.lib}`]));\ngulp.task('babel:test',    shell.task([`babel ${opt.test}    --out-dir ${opt.testEs5}`]));\ngulp.task('babel', ['babel:example', 'babel:lib']);\n```\n\n動作例と`e2e`のために使う`/example`と、ライブラリ本体の`/lib`は分けて定義してから、ラッパー・タスクを用意しています。順序が前後して`ts`したあと`clean`が実行されないように`run-sequence`（ここでは`seq()`）を利用します。\n\n現行のio.jsならば[Template Strings](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/template_strings)が使えるので、今回は自分用としてお構いなしに使っていますが、nodeを使う事情がある場合は先に`gulpfile.js`をバベってしまうか、`'おとなしく' + '結合を使ったほうが'`いいでしょう。\n\n### Browserify\n\n```gulpfile.js\n/* browserify */\nfunction globToBrowserify(bundler) {\n  var verbose = (bundler === 'watchify')? '-v' : '';\n  return function(done) {\n    var p = new Promise(function(resolve) {\n      glob(`${opt.example}/**/*.js`, function(er, files) {\n        resolve(files.join(' '));\n      });\n    });\n    p.then(function(names) {\n      shell.task([`${bundler} ${names} -p licensify \u003e ${opt.example}${opt.bundle} ${verbose}`])();\n      done();\n    });\n  };\n}\n\ngulp.task('watchify_',   globToBrowserify('watchify'));\ngulp.task('browserify_', globToBrowserify('browserify'));\n\ngulp.task('watchify',   function(done) {seq('ts', 'babel', 'watchify_', done)});\ngulp.task('browserify', function(done) {seq('ts', 'babel', 'browserify_', done)});\n```\n\n`watchify`もここで定義しています。`zsh`と`sh`の`/**`の解釈の違いは`glob`で埋めています。該当したファイル名の配列を文字列にまとめてBrowserify|watchifyに与えます。Browserifyとwatchifyのコマンドの微妙な差は`globToBrowserify()`関数を作って解決しました。~~Browserify pluginは、なぜかどう頑張っても動かなかったので今回は除外しています。~~（150405追記: Browserify側の仕様変更に対応されたので復活しました。）\n\nあとは`glob()`がthenableなら最高だった。\n\n### watch\n\n```gulpfile.js\n/* watch */\ngulp.task('watch', ['watchify', 'ts'], function() {\n  gulp.watch([`${opt.example}/**/*.ts`, `${opt.lib}/**/*.ts`], ['ts']);\n});\n```\n\n`watch`もシンプルにいきます。`watchify`は前のタスクですでに起動しているので、`gulp.watch`対象は`ts`のみです。`sass`や`less`があればここに追記するといいでしょう（実際WebStormが`ts`を逐一コンパイルしてくれるので、本当はこれすらいらない）\n\n### test\n\n```gulpfile.js\n/* test */\ngulp.task('espower', function() {\n  return gulp.src(`${opt.testEs5}/**/*.js`)\n    .pipe(espower())\n    .pipe(gulp.dest(opt.testEspowered));\n});\ngulp.task('test', function(done) {seq('ts:lib_', ['babel:lib', 'babel:test'], 'espower', done)});\n```\n\nここではテスト前ビルドに留めています。テストは全てES6で書き、[power-assert](https://github.com/twada/power-assert)のために、babel, espowerを通しています。`espower`出力は`mocha`にやらせる手もあるのですが、色々自分には馴染まなかったのでこうしました。\n\n---\n\nこの例は規模の小さめな単品ライブラリに対してなので、`express`と`angular`両方の面倒を見るWebアプリケーション…となると膨れますが、「プラグイン依存と更新頻度を警戒しながらシンプルに」という理念は変えずにやりたいです。\n\n## package.json\n\n- https://github.com/crescware/cw-modal/blob/86a6d2332ccacf1f46e1f68a858565a249450d4b/package.json\n\n```package.json\n{\n  \"name\": \"cw-modal\",\n  \"dependencies\": {\n    \"angular\": \"1.3.15\",\n    \"bluebird\": \"^2.9.24\"\n  },\n  \"devDependencies\": {\n    \"angular-route\": \"1.3.15\",\n    \"babel\": \"^5.0.8\",\n    \"browserify\": \"^9.0.7\",\n    \"del\": \"^1.1.1\",\n    \"dtsm\": \"^0.9.1\",\n    \"glob\": \"^5.0.3\",\n    \"gulp\": \"^3.8.11\",\n    \"gulp-espower\": \"^0.10.1\",\n    \"gulp-shell\": \"^0.4.0\",\n    \"licensify\": \"^1.1.0\",\n    \"mocha\": \"^2.1.0\",\n    \"power-assert\": \"^0.10.1\",\n    \"run-sequence\": \"^1.0.2\",\n    \"superstatic\": \"^2.0.2\",\n    \"testium\": \"^2.6.0\",\n    \"typescript\": \"1.4.1\",\n    \"watchify\": \"^3.1.0\"\n  },\n  \"scripts\": {\n    \"browserify\": \"gulp browserify\",\n    \"build\": \"gulp build\",\n    \"dtsm\": \"dtsm install\",\n    \"e2e\": \"gulp test \u0026\u0026 mocha ./test-espowered/e2e/\",\n    \"start\": \"cd example \u0026\u0026 ss --port 8080 --debug true\",\n    \"test\": \"gulp test \u0026\u0026 mocha ./test-espowered/unit/\",\n    \"watch\": \"gulp watch\"\n  }\n}\n```\n\n見本用に簡略化しています。何をするにも用意していた`grunt-*`は12個減り、代わりに増えた`gulp-*`は2個だけです。\n\n`scripts`はテスト用の2種だけ`\u0026\u0026 mocha`して、開発用サーバの起動に`cd example \u0026\u0026 ss`しているものの、残りはgulpに投げました。mochaはgulpで実行するとログ出力に一切色が付かなかったため妥協。\n\n結果として`devDependencies`の一つ一つの役割は明確になり、今後の取捨選択もしやすいスリムさに。他のプロジェクトも徐々にGruntからgulpに移行していけると確信を持ちました。\n\n# （追記）streamを活かせてない件と釈明\nGruntを使っていた時間が長いので、gulpの利点であるstreamを活かしきれておらず`tsc -\u003e es6 -\u003e babel -\u003e js -\u003e Browserify`なことになっている点は疑問に思われた方もいるかもしれません。\n\nこれについての釈明としては、WebStormが`.ts`の保存時に勝手にコンパイルしてしまうので、出力された`.js`を拾う必要があったのと、テスト時にsourcemapを出していない理由で中間ファイルの行番号を確認する必要があるからです。（…本当はgulpの良さに気付いてないだけです）\n\n# あとがき\nここまでお疲れさまです。余すところなく出すつもりで書いたので、またしても長文記事になりました。正直npm run-scriptの挙動を調べている最中は私も憔悴していましたが、このgulpfileにしてから顔は引き締まって血色もよく、お肌はツヤツヤに!\n\nこういった手法は何かと物議を醸しますが、常に時代に合ったシンプルさでやっていきたいものです。最後まで読んでいただき、ありがとうございました。\n\nおわり!\n\n# 参考\n\n- [MOL - Grunt/Gulpで憔悴したおっさんの話](http://t32k.me/mol/log/npm-run-script/)\n- [from scratch - オレ的Gruntに対する最新の気持ち](http://yosuke-furukawa.hatenablog.com/entry/2014/02/19/112931)\n- [teppeis blog - grunt-parallelize v1.1.0リリースおよび零細OSSの継続性について](http://teppeis.hatenablog.com/entry/2015/03/grunt-parallelize-v1.1.0)\n- [Qiita Jxck_ - npm で依存もタスクも一元化する](http://qiita.com/Jxck_/items/efaff21b977ddc782971)\n- [Qiita shinnn - ファイル削除にはgulpプラグインを使わない](http://qiita.com/shinnn/items/bd7ad79526eff37cebd0)\n- [アカベコマイリ - watchify を試す](http://akabeko.me/blog/2015/02/watchify/)\n- [GitHub - gulp recipes](https://github.com/gulpjs/gulp/tree/master/docs/recipes)\n\n[^1]: globstarというようです。（thx @laco0416さん）\n","coediting":false,"created_at":"2015-04-04T16:27:35+09:00","id":"0860dc097d11f18b9973","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"Node.js","versions":[]},{"name":"npm","versions":[]},{"name":"grunt","versions":[]},{"name":"gulp","versions":[]}],"title":"もうgulpで憔悴しない - 低依存gulpfileのレシピ","updated_at":"2015-04-05T13:44:35+09:00","url":"http://qiita.com/armorik83/items/0860dc097d11f18b9973","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}},{"rendered_body":"\u003cp\u003eこんにちは、\u003ca href=\"/armorik83\" class=\"user-mention\" title=\"armorik83\"\u003e@armorik83\u003c/a\u003eです。\u003ca href=\"http://ngjapan.org/\"\u003eng-japan\u003c/a\u003eに参加された皆様お疲れさまでした。Qiitaにて色々載せていたおかげか、83の中の人として声をかけてもらい嬉しかったです。\u003c/p\u003e\n\n\u003cp\u003eさて、Angular 2に関する情報も続々と出始めていますが、ng-japan内で私が直接質問した内容が些か衝撃的だったため、翻訳に対して文字起こししておきます。\u003c/p\u003e\n\n\u003cp\u003eなお、この模様は\u003ca href=\"https://www.youtube.com/watch?v=QzyUePqt4RM\"\u003e動画として\u003c/a\u003eも収録されていますので、興味のある方はそちらもどうぞ。（この件については17:30辺りから）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"angular-2でbroadcast-onなどのemitterの仕組みは用意されるのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#angular-2%E3%81%A7broadcast-on%E3%81%AA%E3%81%A9%E3%81%AEemitter%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%AF%E7%94%A8%E6%84%8F%E3%81%95%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAngular 2で$broadcast, $onなどのEmitterの仕組みは用意されるのか?\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003eIgor Minar\u003c/strong\u003e 18:50\u003cbr\u003e\nこのメカニズムというのは、Angular 2では用意されません。EventEmitterというのもありません。しかし、それに替わる機能というのを盛り込んでいます。\u003c/p\u003e\n\n\u003cp\u003eコミュニケーションのやり方をちょっと変えようということで、アプリケーションの様々な異なるパーツ間でのコミュニケーションのやり方が変わっていきます。ただ、これをコード無しで説明するのはちょっと難しいのですが、Angular 2のほうがより成熟度を増すにつれて、デモとしてご覧頂けるようになります。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eIgor Minar\u003c/strong\u003e 19:57\u003cbr\u003e\n代わりにお伝えできることが2種類あります。1つはDOM Eventですね。Angular specificなEventを使う代わりにDOM Eventを使っていただくという方法と、2つ目は\u003ca href=\"https://github.com/baconjs/bacon.js/\"\u003ebacon.js\u003c/a\u003eといったサードパーティのライブラリを使っていただくということもできます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eBrian Ford\u003c/strong\u003e 20:30\u003cbr\u003e\n僕からもIgorに質問していいかい?（会場笑）Eventシステムを変更することについて、どこにアドバンテージがあるの?\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eIgor Minar\u003c/strong\u003e 21:35\u003cbr\u003e\nこの変更の訳ですが、多くのシナリオにおいて、今のスタイルのAngular Event（※\u003ccode\u003e$broadcast\u003c/code\u003e等）を使っていくとtypoがたくさん起こる、Event名を間違ってしまう、ということがある。そうすると、Event名が有効でないとき何が問題だったのか結局（開発者は）分からないという状態で終わってしまうことになる。その問題を改善するためにEvent Injectionを入れたというわけです。これによって、ダイレクトにEventが相手側のパーツ（※おそらくComponent等）に伝達されていきます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eChirayu Krishnappa\u003c/strong\u003e 22:55\u003cbr\u003e\n現行のシステムは非常に疎結合になっているので、ジェネリックなものしかできない。そのようなジェネリックな仕組みを継承していく必要はないだろう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"この回答から何が得られたか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E5%9B%9E%E7%AD%94%E3%81%8B%E3%82%89%E4%BD%95%E3%81%8C%E5%BE%97%E3%82%89%E3%82%8C%E3%81%9F%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの回答から何が得られたか\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e$broadcast\u003c/code\u003e, \u003ccode\u003e$on\u003c/code\u003eはAngular 2では廃止される\n\n\u003cul\u003e\n\u003cli\u003etypoによって動かなくなってしまう問題が多いため\u003c/li\u003e\n\u003cli\u003eAngular 2自体がEmitterを用意することもない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e複数Component間の値渡しのためのシステムは用意されるが、この場では説明が難しいので今後のデモを待つ\n\n\u003cul\u003e\n\u003cli\u003eそれはEvent Injectionというらしい\u003c/li\u003e\n\u003cli\u003e現行の疎結合なシステムは継承しない（密結合ともならない何らかのInjection…?）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e任意でDOM Eventやbacon.jsなどを用いることは可能\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e3人の開発者によるやりとりで濃い回答となり、質問者としては大変満足しています。発言者ソースではなく翻訳後の内容をソースとしている点が不本意ですが、翻訳の方の技術理解が大変素晴らしく、こちらの質問の意図も十分に伝わっていたことに驚きと安心がありました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"自分の知見と合わせた感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%88%86%E3%81%AE%E7%9F%A5%E8%A6%8B%E3%81%A8%E5%90%88%E3%82%8F%E3%81%9B%E3%81%9F%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自分の知見と合わせた感想\u003c/h1\u003e\n\n\u003cp\u003eあっ無くなるの? というのが正直なところですが、typoについては私も危険性を常々勉強会や記事などで伝えてきたので、納得できるところです。\u003ca href=\"http://facebook.github.io/react/\"\u003eReact\u003c/a\u003eもそれ自体はEventEmitterを抱えておらず\u003ca href=\"https://github.com/facebook/flux\"\u003efacebook/flux\u003c/a\u003e側が扱っているので、自然な流れともいえます。\u003c/p\u003e\n\n\u003cp\u003e一方で、Angular 2自身が備えるとされているDI機構はAngular 1とは異なるものになるようですが、ここにEventやりとり機構も含まれるということで若干の不安があり、これはデモを待ってから判断しようと思います。Angular 1にて\u003ccode\u003e$broadcast\u003c/code\u003eを多用している方は（あっ…自分のことだ）とりあえずfacebook/fluxが採っているアプローチのようなEventEmitterにするか、大人しくビルトインの新Event機構を待ったほうが良いでしょう。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eng-japanについては他の誰かがまとめるだろうと思いますが、今後Angular 2に関する記事は徐々に書いていこうと思います。以上です。\u003c/p\u003e\n","body":"こんにちは、@armorik83です。[ng-japan](http://ngjapan.org/)に参加された皆様お疲れさまでした。Qiitaにて色々載せていたおかげか、83の中の人として声をかけてもらい嬉しかったです。\n\nさて、Angular 2に関する情報も続々と出始めていますが、ng-japan内で私が直接質問した内容が些か衝撃的だったため、翻訳に対して文字起こししておきます。\n\nなお、この模様は[動画として](https://www.youtube.com/watch?v=QzyUePqt4RM)も収録されていますので、興味のある方はそちらもどうぞ。（この件については17:30辺りから）\n\n# Angular 2で$broadcast, $onなどのEmitterの仕組みは用意されるのか?\n**Igor Minar** 18:50\nこのメカニズムというのは、Angular 2では用意されません。EventEmitterというのもありません。しかし、それに替わる機能というのを盛り込んでいます。\n\nコミュニケーションのやり方をちょっと変えようということで、アプリケーションの様々な異なるパーツ間でのコミュニケーションのやり方が変わっていきます。ただ、これをコード無しで説明するのはちょっと難しいのですが、Angular 2のほうがより成熟度を増すにつれて、デモとしてご覧頂けるようになります。\n\n**Igor Minar** 19:57\n代わりにお伝えできることが2種類あります。1つはDOM Eventですね。Angular specificなEventを使う代わりにDOM Eventを使っていただくという方法と、2つ目は[bacon.js](https://github.com/baconjs/bacon.js/)といったサードパーティのライブラリを使っていただくということもできます。\n\n**Brian Ford** 20:30\n僕からもIgorに質問していいかい?（会場笑）Eventシステムを変更することについて、どこにアドバンテージがあるの?\n\n**Igor Minar** 21:35\nこの変更の訳ですが、多くのシナリオにおいて、今のスタイルのAngular Event（※`$broadcast`等）を使っていくとtypoがたくさん起こる、Event名を間違ってしまう、ということがある。そうすると、Event名が有効でないとき何が問題だったのか結局（開発者は）分からないという状態で終わってしまうことになる。その問題を改善するためにEvent Injectionを入れたというわけです。これによって、ダイレクトにEventが相手側のパーツ（※おそらくComponent等）に伝達されていきます。\n\n**Chirayu Krishnappa** 22:55\n現行のシステムは非常に疎結合になっているので、ジェネリックなものしかできない。そのようなジェネリックな仕組みを継承していく必要はないだろう。\n\n# この回答から何が得られたか\n- `$broadcast`, `$on`はAngular 2では廃止される\n  - typoによって動かなくなってしまう問題が多いため\n  - Angular 2自体がEmitterを用意することもない\n- 複数Component間の値渡しのためのシステムは用意されるが、この場では説明が難しいので今後のデモを待つ\n  - それはEvent Injectionというらしい\n  - 現行の疎結合なシステムは継承しない（密結合ともならない何らかのInjection…?）\n- 任意でDOM Eventやbacon.jsなどを用いることは可能\n\n3人の開発者によるやりとりで濃い回答となり、質問者としては大変満足しています。発言者ソースではなく翻訳後の内容をソースとしている点が不本意ですが、翻訳の方の技術理解が大変素晴らしく、こちらの質問の意図も十分に伝わっていたことに驚きと安心がありました。\n\n# 自分の知見と合わせた感想\nあっ無くなるの? というのが正直なところですが、typoについては私も危険性を常々勉強会や記事などで伝えてきたので、納得できるところです。[React](http://facebook.github.io/react/)もそれ自体はEventEmitterを抱えておらず[facebook/flux](https://github.com/facebook/flux)側が扱っているので、自然な流れともいえます。\n\n一方で、Angular 2自身が備えるとされているDI機構はAngular 1とは異なるものになるようですが、ここにEventやりとり機構も含まれるということで若干の不安があり、これはデモを待ってから判断しようと思います。Angular 1にて`$broadcast`を多用している方は（あっ…自分のことだ）とりあえずfacebook/fluxが採っているアプローチのようなEventEmitterにするか、大人しくビルトインの新Event機構を待ったほうが良いでしょう。\n\n---\n\nng-japanについては他の誰かがまとめるだろうと思いますが、今後Angular 2に関する記事は徐々に書いていこうと思います。以上です。\n","coediting":false,"created_at":"2015-03-23T17:50:31+09:00","id":"d3d93ee1e4454e01d2a3","private":false,"tags":[{"name":"AngularJS","versions":["2.0"]},{"name":"angular","versions":["2.0"]}],"title":"Angular 2では$broadcastが無くなる模様","updated_at":"2015-03-23T17:50:31+09:00","url":"http://qiita.com/armorik83/items/d3d93ee1e4454e01d2a3","user":{"description":"","facebook_id":"","followees_count":12,"followers_count":118,"github_login_name":"armorik83","id":"armorik83","items_count":80,"linkedin_id":"","location":"","name":"OKUNOKENTARO","organization":"Crescware（フリーランス）","permanent_id":17959,"profile_image_url":"https://pbs.twimg.com/profile_images/597632171856175104/C8zptgfr_normal.png","twitter_screen_name":"armorik83","website_url":"https://forkwell.com/u/armorik83"}}]